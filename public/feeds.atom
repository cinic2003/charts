<?xml version="1.0" encoding="UTF-8"?>
<feed xml:lang="en-US" xmlns="http://www.w3.org/2005/Atom">
  <id>tag:www.thoughtrails.com,2005:/feeds</id>
  <link rel="alternate" type="text/html" href="http://www.thoughtrails.com"/>
  <link rel="self" type="application/atom+xml" href="http://www.thoughtrails.com/feeds.atom"/>
  <title></title>
  <updated>2011-06-22T08:41:55Z</updated>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/120</id>
    <published>2011-06-06T22:33:16+08:00</published>
    <updated>2011-06-22T09:36:53+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/120-"/>
    <title>rails seed &#20013;&#20351;&#29992; paperclip &#20445;&#23384;&#22270;&#29255; </title>
    <summary>Image model &#20195;&#30721;&#22914;&#19979;

    # cat app/models/image.rb
    class Image &lt; ActiveRecord::Base
      has_attached_file :data,
                        :url  =&gt; "/system/images/:id/:style_:basename.:extension",
                        :path =&gt; ":rails_root/public/system/images/:id/:style_:basename.:extension",
                        :styles =&gt; { :normal =&gt; ['400x300#', :png], :thumb =&gt; ['200x150#', :png] }
    
      validates_attachment_size :data, :less_than =&gt; 2.megabytes
      validates_attachment_presence :data
    end

&#37027;&#20040;&#24819;&#22312; seed &#20013;&#20445;&#23384;&#20960;&#20010;&#22270;&#29255;&#21040; Image&#65292;&#23601;&#36825;&#26679;&#20889;

    # cat db/seeds.rb
    #first, add  gem "content_type"  to Gemfile and bundle install, http://rubygems.org/gems/content_type
    attachment_file = "#{Rails.root}/public/images/rails.png"
    attachment = {
      :original_filename =&gt; File.basename(attachment_file),
      :content_type =&gt; File.content_type(attachment_file),
      :tempfile =&gt; File.open(attachment_file, 'rb')
    }
    data_obj = ActionDispatch::Http::UploadedFile.new(attachment)
    data_obj.original_filename = attachment[:original_filename]
    data_obj.content_type = attachment[:content_type]
    Image.create!(:data =&gt; data_obj)</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/119</id>
    <published>2011-06-06T21:56:11+08:00</published>
    <updated>2011-06-22T01:15:09+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/119-"/>
    <title>rake auto generate i18n.zh-CN.activerecord </title>
    <summary>&#36825;&#20010; rake &#20027;&#35201;&#29992;&#26469;&#22312;rails&#20013;&#33258;&#21160;&#29983;&#25104; config/locales/zh-CN.model.yml &#65292;&#24314;&#22909;model&#21518;&#25191;&#34892;&#19968;&#19979;&#65292;&#20027;&#35201;&#20026;&#20102;&#25552;&#39640;&#24037;&#20316;&#25928;&#29575;&#29992;&#65292;&#20889;&#30340;&#27604;&#36739;&#31616;&#38475;&#65292;&#21621;&#21621;&#65292;&#20945;&#21512;&#30528;&#29992;&#21704;&#20808;

    #encoding: utf-8
    # 
    # by: vkill vkill.net@gmail.com
    # updated_at: 2011.6.6
    # first, please install psych gem, YAML dump support Chinese
    #
    # usage:
    #   write it to Rails.root.join("lib/tasks/model_i18n_column.rake")
    #   &gt;rake model:i18n_column
    #
    require 'find'
    require 'fileutils'
    require 'tmpdir'
    
    namespace :model do
      desc 'this is auto generate i18n.zh-CN.activerecord'
      task :i18n_column =&gt; :environment do
    
        t = {
          "id" =&gt; '&#24207;&#21495;',
          "type" =&gt; '&#31867;&#22411;',
          "name" =&gt; '&#21517;&#31216;',
          "state" =&gt; '&#29366;&#24577;',
          "title" =&gt; '&#26631;&#39064;',
          "content" =&gt; '&#27491;&#25991;',
          "created_at" =&gt; '&#21019;&#24314;&#26102;&#38388;',
          "updated_at" =&gt; '&#26356;&#26032;&#26102;&#38388;',
          "user_id" =&gt; '&#29992;&#25143;id'
        }
        i18n_new = {
          "zh-CN" =&gt; {
            "activemodel" =&gt; {
              "models" =&gt; {},
              "attributes" =&gt; {}
            },
            "activerecord" =&gt; {
              "models" =&gt; {},
              "attributes" =&gt; {}
            }
          }
        }
        i18n_file = Rails.root.join("config/locales/zh-CN.model.yml").to_s
        i18n_tmp = File.join(Dir.tmpdir, File.basename(i18n_file) + "_" + Time.now.strftime('%Y%m%d%H%M%S'))
        i18n = YAML.load_file(i18n_file) || i18n_new
        
        Find.find(Rails.root.join("app/models").to_s) do |path|
          if FileTest.directory?(path)
            if File.basename(path)[0] == ?.
              Find.prune
            else
              next
            end
          else
            require path
          end
        end
    
        ObjectSpace.each_object(Class) do |k|
          if k.ancestors.include?(ActiveRecord::Base)
            if k.name != "ActiveRecord::Base" and !k.abstract_class?
              if k.table_exists?
                if k.column_names.include?('type') and k.subclasses.size &gt; 0
                  next
                end
                #puts k.name
                model = k.name.underscore
                i18n_new["zh-CN"]["activerecord"]["models"][model] = i18n["zh-CN"]["activerecord"]["models"][model] || model
                i18n_new["zh-CN"]["activerecord"]["attributes"][model] = i18n["zh-CN"]["activerecord"]["attributes"][model] || {}
                k.column_names.each do |column|
                  if !i18n_new["zh-CN"]["activerecord"]["attributes"][model][column]
                    i18n_new["zh-CN"]["activerecord"]["attributes"][model][column] = t[column.to_s] || column.to_s
                  end
                end
                if enums = i18n["zh-CN"]["activerecord"]["attributes"][model]["enums"]
                  i18n_new["zh-CN"]["activerecord"]["attributes"][model]["enums"] =  enums
                end
              end
            end
          end
        end
    
        FileUtils.cp(i18n_file, i18n_tmp)
    
        require 'psych'
        require 'yaml'
        YAML::ENGINE.yamler= 'psych'
        File.open(i18n_file, "wb") do |f|
          f.write YAML.dump(i18n_new)
        end
        YAML::ENGINE.yamler= 'syck'
    
        puts "updated #{i18n_file}, old file backup to #{i18n_tmp}"
      end
    end

</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/118</id>
    <published>2011-06-04T08:44:28+08:00</published>
    <updated>2011-06-22T11:18:43+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/118-"/>
    <title>RVM&#19979;&#36935;&#21040;&#30340;openssl&#30340;&#38382;&#39064;&#35299;&#20915;&#20998;&#20139;</title>
    <summary>&#20170;&#22825;&#22312;&#20351;&#29992;RVM&#30340;&#26102;&#20505;&#65292;&#30001;&#21407;&#26469;&#30340;1&#12290;9&#20999;&#25442;&#21040;1.8&#26102;&#20986;&#29616;&#20102;&#19968;&#20123;&#21015;&#30340;&#38382;&#39064;&#65292;&#26412;&#30528;&#20998;&#20139;&#30340;&#24819;&#27861;&#65292;&#24635;&#32467;&#19979;&#12290;
&#20197;&#21069;&#26159;&#26159;&#20351;&#29992;RVM&#19979;&#30340;RUby1.9&#26469;&#20316;Rails3&#30340;&#24320;&#21457;&#65292;&#29616;&#22312;&#26377;&#20010;&#39033;&#30446;&#26159;Ruby1.8&#19979;&#30340;&#65292;&#20294;&#26159;&#20986;&#29616;&#20102;&#19968;&#31995;&#21015;&#30340;&#25105;&#38590;&#39064;&#65292;Jerry&#30340;&#24110;&#21161;&#19979;&#39034;&#21033;&#30340;&#35299;&#20915;&#25481;&#20102;&#65292;&#38750;&#24120;&#30340;&#24863;&#35874;Jerry.
&#39318;&#20808;&#26159;&#20999;&#25442;&#21040;1.8
$&gt; rvm use 1.8@rail2s
&#28982;&#21518;&#26159;&#36827;&#20837;&#39033;&#30446;&#30340;&#30446;&#24405;&#19979;&#65292;&#23433;&#35013;gems
&#20294;&#26159;&#20986;&#29616;&#20102;&#65306;
in `require_frameworks': no such file to load -- openssl (RuntimeError)
&#21363;&#32570;&#23569;openssl&#30340;&#19996;&#35199;
&#25152;&#20197;&#38656;&#35201;&#23433;&#35013;openssl &#30456;&#20851;&#30340;lib
$&gt;sudo apt-get install libopenssl-ruby  libssl-dev
&#20063;&#21487;&#20197;&#26159;sudo apt-get install libopenssl-ruby1.8
(&#20063;&#21487;&#20197;&#26159;&#20808;&#23433;&#35013;libopenssl-ruby&#21518;&#20877;&#23433;&#35013;libopenssl-ruby1.8&#20294;&#26159;&#26377;&#20010;&#25552;&#31034;&#65306;
Note, selecting 'libruby1.8' instead of 'libopenssl-ruby1.8'
libruby1.8 is already the newest version.
&#23601;&#26159;&#35828;&#20320;&#29992; libruby1.8 &#26367;&#25442;&#20102; &#21069;&#32773;
)
&#20043;&#21518;&#36827;&#20837;ruby1.8.7&#30340;&#28304;&#30721;&#30446;&#24405;&#65288;&#20877;&#27425;&#20986;&#20320;&#21487;&#20197;&#20351;&#29992;rvm info &#26469;&#26597;&#30475;&#21734;&#25214;&#21040;&#65289;
&#36827;&#20837;.rvm/src&#21518;&#25214;&#21040;&#20320;&#30340;ruby1.8.7&#23545;&#24212;&#30340;&#30446;&#24405;
&#28982;&#21518;&#23601;&#26159;cd etc/openssl;ruby ruby extconf.rb
&#25509;&#30528;&#23601;&#26159; &#32534;&#35793;&#23433;&#35013; make ;make install
&#24456;&#22909; &#24212;&#35813;&#33021;&#39034;&#21033;&#30340;&#23436;&#25104;&#20102;&#65288;&#26377;&#38382;&#39064;&#21487;&#20197;&#30475;&#36755;&#20986;&#30340;&#19996;&#35199;&#22312;&#22788;&#29702;)
&#25509;&#30528;&#20986;&#29616;&#36825;&#26679;&#30340;&#38382;&#39064;&#65306;
in `gem_original_require': no such file to load -- gbarcode (MissingSourceFile)

&#32570;&#23569;gbarcode &#65288;gbarcode &#26159; Ruby &#29992;&#26469;&#22788;&#29702;&#26465;&#24418;&#30721;&#30340;&#24320;&#21457;&#21253;&#65289;

$  sudo apt-get install barcode ; gem install gbarcode

&#20043;&#21518;&#23601;&#26159;&#23433;&#35013;&#19968;&#20123;&#20854;&#20182;&#30340;gem,&#20294;&#26159;&#26377;&#20123;gem&#26159;&#26469;&#33258;github,&#21487;&#20197;&#20351;&#29992;:
$ gem sources -a http://gems.github.com
&#26469;&#28155;&#21152;gem specifacation&#21644;cache&#21040;&#20320;&#30340;rubygemzho&#20013;
&#19968;&#20999;&#25630;&#23450;&#20102; &#21621;&#21621; &#26102;&#38388;2&#65306;00&#20102;  &#24635;&#32467;&#19979;&#20998;&#20139;
</summary>
    <author>
      <name>kewin</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/117</id>
    <published>2011-05-24T12:51:28+08:00</published>
    <updated>2011-06-22T02:48:45+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/117-install-rails3-dot-1-rc-with-rvm"/>
    <title>install rails 3.1 rc with RVM</title>
    <summary>## &#36890;&#36807;rvm&#23433;&#35013;rails3.1rc ##

**&#39318;&#20808;&#26356;&#26032;&#19968;&#19979;&#20320;&#30340;RVM**

    $ rvm get head

`$ rvm -v`&#24212;&#35813;&#24471;&#21040;&#22914;&#19979;&#20449;&#24687;:  

    rvm 1.6.14 by Wayne E. Seguin (wayneeseguin@gmail.com) [https://rvm.beginrescueend.com/]

**&#21019;&#24314;rails3.1rc gemset**

    $ rvm gemset create rails31rc
    'rails31rc' gemset created (/Users/shenjerry/.rvm/gems/ruby-1.9.2-p180@rails31rc).

**&#20999;&#21040;rails31rc&#30340;gemset**

    $ rvm use @rails31rc

**&#23433;&#35013;rails3.1rc**  

    $ gem install rails --pre

**&#26597;&#30475;rails&#29256;&#26412;**  

    $ rails -v
    Rails 3.1.0.rc1  




    

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/116</id>
    <published>2011-05-18T08:50:41+08:00</published>
    <updated>2011-06-22T14:54:58+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/116-"/>
    <title>rails rake &#33719;&#21462;&#25152;&#26377;model&#31867;&#21517; </title>
    <summary>&#20889;&#31532;&#19968;&#20010; rake &#65292;&#23398;&#21040;&#20102;&#19968;&#20123;&#19996;&#35199;&#65292;&#20889;&#36825;&#20010;&#21602;&#65292;&#20043;&#21069;&#24819;&#30340;&#26159;&#20570;&#26435;&#38480;&#65292;&#21518;&#26469;&#24819;&#20102;&#19979;&#20063;&#27809;&#24324;&#65292;&#29616;&#22312;&#36825;&#31867;&#30340;&#24211;&#27604;&#36739;&#25104;&#29087;&#20102;&#65292;&#21151;&#33021;&#20063;&#27604;&#36739;&#23436;&#21892;&#65292;&#36825;&#26679;&#31867;&#20284;&#30340;&#21487;&#20197;&#24471;&#21040;&#25152;&#26377; controller &#30340;&#31867;&#21517;&#65292;&#21487;&#20197;&#20570;&#19968;&#20123;&#20107;&#24773;&#21543;&#24212;&#35813;&#65292;&#20197;&#21518;&#20272;&#35745;&#21487;&#20197;&#29992;&#30340;&#21040;&#65292;&#19978;&#20195;&#30721;

    #encoding: utf-8
    #rails rake &#33719;&#21462;&#25152;&#26377;model&#31867;&#21517;
    require 'find'
    namespace :model do
      desc 'this is auto generate models list'
      task :generate_list =&gt; :environment do
        Find.find(Rails.root.join("app/models").to_s) do |path|
          if FileTest.directory?(path)
            if File.basename(path)[0] == ?.
              Find.prune
            else
              next
            end
          else
            require path
          end
        end
    
        ObjectSpace.each_object(Class) do |k|
          if k.ancestors.include?(ActiveRecord::Base)
            #&#21435;&#25481; ActiveRecord::Base &#23427;&#33258;&#24049;
            #&#21435;&#25481; &#34394;&#25311;&#31867;
            #&#21435;&#25481; &#21333;&#34920;&#32487;&#25215;&#30340;&#29238;&#31867;
            if k.name != "ActiveRecord::Base" and k.abstract_class != true
              if k.column_names.include?('type') and k.subclasses.size &gt; 0
                next
              end
              puts k.name
            end
          end
        end
      end
    end</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/115</id>
    <published>2011-05-10T15:24:27+08:00</published>
    <updated>2011-06-22T04:12:04+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/115-memcached-Depth-analytical-04"/>
    <title>memcached &#28145;&#24230;&#35299;&#26512;&#65288;&#22235;&#65289;</title>
    <summary>**memcached&#30340;&#20998;&#24067;&#24335;&#26159;&#20160;&#20040;&#24847;&#24605;&#65311;**

&#36825;&#37324;&#22810;&#27425;&#20351;&#29992;&#20102;&#8220;&#20998;&#24067;&#24335;&#8221;&#36825;&#20010;&#35789;&#65292;&#20294;&#24182;&#26410;&#20570;&#35814;&#32454;&#35299;&#37322;&#12290;&#29616;&#22312;&#24320;&#22987;&#31616;&#21333;&#22320;&#20171;&#32461;&#19968;&#19979;&#20854;&#21407;&#29702;&#65292;&#21508;&#20010;&#23458;&#25143;&#31471;&#30340;&#23454;&#29616;&#22522;&#26412;&#30456;&#21516;&#12290;

&#19979;&#38754;&#20551;&#35774;memcached&#26381;&#21153;&#22120;&#26377;node1&#65374;node3&#19977;&#21488;&#65292;&#24212;&#29992;&#31243;&#24207;&#35201;&#20445;&#23384;&#38190;&#21517;&#20026;&#8220;tokyo&#8221;&#8220;kanagawa&#8221;&#8220;chiba&#8221;&#8220;saitama&#8221;&#8220;gunma&#8221; &#30340;&#25968;&#25454;&#12290;

![alt text][1]


&#22270;1 &#20998;&#24067;&#24335;&#31616;&#20171;&#65306;&#20934;&#22791;

&#39318;&#20808;&#21521;memcached&#20013;&#28155;&#21152;&#8220;tokyo&#8221;&#12290;&#23558;&#8220;tokyo&#8221;&#20256;&#32473;&#23458;&#25143;&#31471;&#31243;&#24207;&#24211;&#21518;&#65292;&#23458;&#25143;&#31471;&#23454;&#29616;&#30340;&#31639;&#27861;&#23601;&#20250;&#26681;&#25454;&#8220;&#38190;&#8221;&#26469;&#20915;&#23450;&#20445;&#23384;&#25968;&#25454;&#30340;memcached&#26381;&#21153;&#22120;&#12290;&#26381;&#21153;&#22120;&#36873;&#23450;&#21518;&#65292;&#21363;&#21629;&#20196;&#23427;&#20445;&#23384;&#8220;tokyo&#8221;&#21450;&#20854;&#20540;&#12290;

![alt text][2]

&#22270;2 &#20998;&#24067;&#24335;&#31616;&#20171;&#65306;&#28155;&#21152;&#26102;

&#21516;&#26679;&#65292;&#8220;kanagawa&#8221;&#8220;chiba&#8221;&#8220;saitama&#8221;&#8220;gunma&#8221;&#37117;&#26159;&#20808;&#36873;&#25321;&#26381;&#21153;&#22120;&#20877;&#20445;&#23384;&#12290;

&#25509;&#19979;&#26469;&#33719;&#21462;&#20445;&#23384;&#30340;&#25968;&#25454;&#12290;&#33719;&#21462;&#26102;&#20063;&#35201;&#23558;&#35201;&#33719;&#21462;&#30340;&#38190;&#8220;tokyo&#8221;&#20256;&#36882;&#32473;&#20989;&#25968;&#24211;&#12290;&#20989;&#25968;&#24211;&#36890;&#36807;&#19982;&#25968;&#25454;&#20445;&#23384;&#26102;&#30456;&#21516;&#30340;&#31639;&#27861;&#65292;&#26681;&#25454;&#8220;&#38190;&#8221;&#36873;&#25321;&#26381;&#21153;&#22120;&#12290;&#20351;&#29992;&#30340;&#31639;&#27861;&#30456;&#21516;&#65292;&#23601;&#33021;&#36873;&#20013;&#19982;&#20445;&#23384;&#26102;&#30456;&#21516;&#30340;&#26381;&#21153;&#22120;&#65292;&#28982;&#21518;&#21457;&#36865;get&#21629;&#20196;&#12290;&#21482;&#35201;&#25968;&#25454;&#27809;&#26377;&#22240;&#20026;&#26576;&#20123;&#21407;&#22240;&#34987;&#21024;&#38500;&#65292;&#23601;&#33021;&#33719;&#24471;&#20445;&#23384;&#30340;&#20540;&#12290;

![alt text][3]

&#22270;3 &#20998;&#24067;&#24335;&#31616;&#20171;&#65306;&#33719;&#21462;&#26102;

&#36825;&#26679;&#65292;&#23558;&#19981;&#21516;&#30340;&#38190;&#20445;&#23384;&#21040;&#19981;&#21516;&#30340;&#26381;&#21153;&#22120;&#19978;&#65292;&#23601;&#23454;&#29616;&#20102;memcached&#30340;&#20998;&#24067;&#24335;&#12290; memcached&#26381;&#21153;&#22120;&#22686;&#22810;&#21518;&#65292;&#38190;&#23601;&#20250;&#20998;&#25955;&#65292;&#21363;&#20351;&#19968;&#21488;memcached&#26381;&#21153;&#22120;&#21457;&#29983;&#25925;&#38556;&#26080;&#27861;&#36830;&#25509;&#65292;&#20063;&#19981;&#20250;&#24433;&#21709;&#20854;&#20182;&#30340;&#32531;&#23384;&#65292;&#31995;&#32479;&#20381;&#28982;&#33021;&#32487;&#32493;&#36816;&#34892;&#12290;






  [1]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0004-01.png
  [2]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0004-02.png
  [3]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0004-03.png</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/114</id>
    <published>2011-05-06T09:59:08+08:00</published>
    <updated>2011-06-21T21:28:54+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/114-memcached-Depth-analytical-03"/>
    <title>memcached &#28145;&#24230;&#35299;&#26512;&#65288;&#19977;&#65289;</title>
    <summary>**memcached&#22312;&#25968;&#25454;&#21024;&#38500;&#26041;&#38754;&#26377;&#25928;&#21033;&#29992;&#36164;&#28304;**

&#25968;&#25454;&#19981;&#20250;&#30495;&#27491;&#20174;memcached&#20013;&#28040;&#22833;

&#19978;&#27425;&#20171;&#32461;&#36807;&#65292; memcached&#19981;&#20250;&#37322;&#25918;&#24050;&#20998;&#37197;&#30340;&#20869;&#23384;&#12290;&#35760;&#24405;&#36229;&#26102;&#21518;&#65292;&#23458;&#25143;&#31471;&#23601;&#26080;&#27861;&#20877;&#30475;&#35265;&#35813;&#35760;&#24405;&#65288;invisible&#65292;&#36879;&#26126;&#65289;&#65292;&#20854;&#23384;&#20648;&#31354;&#38388;&#21363;&#21487;&#37325;&#22797;&#20351;&#29992;&#12290;

Lazy Expiration

memcached&#20869;&#37096;&#19981;&#20250;&#30417;&#35270;&#35760;&#24405;&#26159;&#21542;&#36807;&#26399;&#65292;&#32780;&#26159;&#22312;get&#26102;&#26597;&#30475;&#35760;&#24405;&#30340;&#26102;&#38388;&#25139;&#65292;&#26816;&#26597;&#35760;&#24405;&#26159;&#21542;&#36807;&#26399;&#12290;&#36825;&#31181;&#25216;&#26415;&#34987;&#31216;&#20026;lazy&#65288;&#24816;&#24615;&#65289;expiration&#12290;&#22240;&#27492;&#65292;memcached&#19981;&#20250;&#22312;&#36807;&#26399;&#30417;&#35270;&#19978;&#32791;&#36153;CPU&#26102;&#38388;&#12290;

**LRU&#65306;&#20174;&#32531;&#23384;&#20013;&#26377;&#25928;&#21024;&#38500;&#25968;&#25454;&#30340;&#21407;&#29702;**

memcached&#20250;&#20248;&#20808;&#20351;&#29992;&#24050;&#36229;&#26102;&#30340;&#35760;&#24405;&#30340;&#31354;&#38388;&#65292;&#20294;&#21363;&#20351;&#22914;&#27492;&#65292;&#20063;&#20250;&#21457;&#29983;&#36861;&#21152;&#26032;&#35760;&#24405;&#26102;&#31354;&#38388;&#19981;&#36275;&#30340;&#24773;&#20917;&#65292;&#27492;&#26102;&#23601;&#35201;&#20351;&#29992;&#21517;&#20026; Least Recently Used&#65288;LRU&#65289;&#26426;&#21046;&#26469;&#20998;&#37197;&#31354;&#38388;&#12290;&#39038;&#21517;&#24605;&#20041;&#65292;&#36825;&#26159;&#21024;&#38500;&#8220;&#26368;&#36817;&#26368;&#23569;&#20351;&#29992;&#8221;&#30340;&#35760;&#24405;&#30340;&#26426;&#21046;&#12290;&#22240;&#27492;&#65292;&#24403;memcached&#30340;&#20869;&#23384;&#31354;&#38388;&#19981;&#36275;&#26102;&#65288;&#26080;&#27861;&#20174;slab class &#33719;&#21462;&#21040;&#26032;&#30340;&#31354;&#38388;&#26102;&#65289;&#65292;&#23601;&#20174;&#26368;&#36817;&#26410;&#34987;&#20351;&#29992;&#30340;&#35760;&#24405;&#20013;&#25628;&#32034;&#65292;&#24182;&#23558;&#20854;&#31354;&#38388;&#20998;&#37197;&#32473;&#26032;&#30340;&#35760;&#24405;&#12290;&#20174;&#32531;&#23384;&#30340;&#23454;&#29992;&#35282;&#24230;&#26469;&#30475;&#65292;&#35813;&#27169;&#22411;&#21313;&#20998;&#29702;&#24819;&#12290;

&#19981;&#36807;&#65292;&#26377;&#20123;&#24773;&#20917;&#19979;LRU&#26426;&#21046;&#21453;&#20498;&#20250;&#36896;&#25104;&#40635;&#28902;&#12290;memcached&#21551;&#21160;&#26102;&#36890;&#36807;&#8220;-M&#8221;&#21442;&#25968;&#21487;&#20197;&#31105;&#27490;LRU&#65292;&#22914;&#19979;&#25152;&#31034;&#65306;

    $ memcached -M -m 1024

&#21551;&#21160;&#26102;&#24517;&#39035;&#27880;&#24847;&#30340;&#26159;&#65292;&#23567;&#20889;&#30340;&#8220;-m&#8221;&#36873;&#39033;&#26159;&#29992;&#26469;&#25351;&#23450;&#26368;&#22823;&#20869;&#23384;&#22823;&#23567;&#30340;&#12290;&#19981;&#25351;&#23450;&#20855;&#20307;&#25968;&#20540;&#21017;&#20351;&#29992;&#40664;&#35748;&#20540;64MB&#12290;

&#25351;&#23450;&#8220;-M&#8221;&#21442;&#25968;&#21551;&#21160;&#21518;&#65292;&#20869;&#23384;&#29992;&#23613;&#26102;memcached&#20250;&#36820;&#22238;&#38169;&#35823;&#12290;&#35805;&#35828;&#22238;&#26469;&#65292;memcached&#27605;&#31455;&#19981;&#26159;&#23384;&#20648;&#22120;&#65292;&#32780;&#26159;&#32531;&#23384;&#65292;&#25152;&#20197;&#25512;&#33616;&#20351;&#29992;LRU&#12290;

</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/113</id>
    <published>2011-05-03T15:15:14+08:00</published>
    <updated>2011-06-22T10:12:37+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/113-quickstart-guide-to-using-compass-haml-sass-scss-with-rails3"/>
    <title>Quickstart Guide to Using Compass, Haml, SASS, SCSS with Rails 3</title>
    <summary>## &#21019;&#24314;&#19968;&#20010;&#26032;&#30340;rails3&#24212;&#29992; ##

&#22312;&#36825;&#37324;&#20197; rails3.0.7&#20026;&#20363;&#21019;&#24314;&#19968;&#20010;&#39033;&#30446;:  

    $ rails new demo

&#25171;&#24320;`Gemfile` &#24182;&#21152;&#20837;&#20197;&#19979;gem:  

    gem 'compass'
    gem 'haml'  

&#28982;&#21518;&#36827;&#20837;&#39033;&#30446;&#26681;&#30446;&#24405;&#23433;&#35013;gem:  

    $ bundle install

## &#37197;&#32622; Compass ##  

&#21018;&#25165;&#24050;&#32463;&#21019;&#24314;&#20102;&#39033;&#30446;&#24182;&#19988;&#23433;&#35013;&#20102;gems, &#29616;&#22312;&#26159;&#37197;&#32622;Compass&#30340;&#26102;&#20505;&#20102;:  

    compass init rails . --using blueprint/semantic

&#22240;&#20026;&#38656;&#35201;&#29992;&#21040;haml&#65292;&#25152;&#20197;&#39033;&#30446;&#20013;&#33258;&#24102;&#30340;`layouts/application.html.erb`&#23601;&#21487;&#20197;&#21024;&#38500;&#20102;:  

    rm app/views/layouts/application.html.erb  

&#21019;&#24314; `app/views/layouts/application.html.haml` &#24182;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;:  

    !!!
    %html
      %head
        %title demo
        = stylesheet_link_tag 'compiled/screen.css', :media =&gt; 'screen, projection'
        = stylesheet_link_tag 'compiled/print.css', :media =&gt; 'print'
        /[if lt IE 8]
          = stylesheet_link_tag 'compiled/ie.css', :media =&gt; 'screen, projection'
          = csrf_meta_tag
      %body.bp
        #container
          = yield  

## &#37197;&#32622; Rails3 Haml Generator ##  

&#39033;&#30446;&#20013;&#40664;&#35748;&#37197;&#32622;&#30340;view&#24341;&#25806;&#26159;erb&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#29992;haml&#26469;&#26367;&#20195;:  

&#22312;`config/application.rb`&#20013;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;:  

    config.generators do |g|
      g.template_engine :haml
    end  

&#30446;&#21069;&#20026;&#27490;&#65292;&#25152;&#26377;&#27493;&#39588;&#37117;&#24050;&#32463;&#37197;&#32622;&#23436;&#25104;&#12290;

## SASS SCSS&#29992;&#27861; ##  

&#22240;&#20026;&#22312;lauout&#20013;&#24341;&#20837;&#20102;`screen.css`&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#21019;&#24314;&#19968;&#20010;scss&#25991;&#20214; `app/views/stylesheets/screen.scss`, &#28982;&#21518;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;:  

    #container {@include container;}  

&#36825;&#26679;&#26469;&#20889;css&#26377;&#20160;&#20040;&#22909;&#22788;&#21602;&#65311; &#24403;&#28982;&#65292;&#36825;&#26679;&#20889;&#30340;&#22909;&#22788;&#23601;&#26159;DRY, &#19981;&#38656;&#35201;&#20889;&#24456;&#22810;&#37325;&#22797;&#30340;&#19996;&#35199;&#65292; css&#20063;&#20855;&#26377;&#20102;&#23618;&#27425;&#32467;&#26500;&#12290;&#20043;&#21069;&#25105;&#29992;&#36807;less&#65292;&#20294;&#26159;&#20889;&#23436;less&#36824;&#35201;&#25191;&#34892;&#25165;&#33021;&#29983;&#25104;SCSS&#30340;&#22909;&#22788;&#23601;&#22312;&#20110;&#20889;&#23436;&#21518;&#30452;&#25509;&#21047;&#26032;&#39029;&#38754;&#23601;&#33021;&#30475;&#21040;&#20102;&#12290;</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/112</id>
    <published>2011-05-03T09:50:44+08:00</published>
    <updated>2011-06-20T10:20:59+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/112-memcached-Depth-analytical-02"/>
    <title>memcached &#28145;&#24230;&#35299;&#26512;&#65288;&#20108;&#65289;</title>
    <summary>**Slab Allocation&#26426;&#21046;&#65306;&#25972;&#29702;&#20869;&#23384;&#20197;&#20415;&#37325;&#22797;&#20351;&#29992;**

&#26368;&#36817;&#30340;memcached&#40664;&#35748;&#24773;&#20917;&#19979;&#37319;&#29992;&#20102;&#21517;&#20026;Slab Allocator&#30340;&#26426;&#21046;&#20998;&#37197;&#12289;&#31649;&#29702;&#20869;&#23384;&#12290;&#22312;&#35813;&#26426;&#21046;&#20986;&#29616;&#20197;&#21069;&#65292;&#20869;&#23384;&#30340;&#20998;&#37197;&#26159;&#36890;&#36807;&#23545;&#25152;&#26377;&#35760;&#24405;&#31616;&#21333;&#22320;&#36827;&#34892;malloc&#21644;free&#26469;&#36827;&#34892;&#30340;&#12290;&#20294;&#26159;&#65292;&#36825;&#31181;&#26041;&#24335;&#20250;&#23548;&#33268;&#20869;&#23384;&#30862;&#29255;&#65292;&#21152;&#37325;&#25805;&#20316;&#31995;&#32479;&#20869;&#23384;&#31649;&#29702;&#22120;&#30340;&#36127;&#25285;&#65292;&#26368;&#22351;&#30340;&#24773;&#20917;&#19979;&#65292;&#20250;&#23548;&#33268;&#25805;&#20316;&#31995;&#32479;&#27604;memcached&#36827;&#31243;&#26412;&#36523;&#36824;&#24930;&#12290;Slab Allocator&#23601;&#26159;&#20026;&#35299;&#20915;&#35813;&#38382;&#39064;&#32780;&#35806;&#29983;&#30340;&#12290;

&#19979;&#38754;&#26469;&#30475;&#30475;Slab Allocator&#30340;&#21407;&#29702;&#12290;&#19979;&#38754;&#26159;memcached&#25991;&#26723;&#20013;&#30340;slab allocator&#30340;&#30446;&#26631;&#65306;

the primary goal of the slabs subsystem in memcached was to eliminate memory fragmentation issues totally by using fixed-size memory chunks coming from a few predetermined size classes.

&#20063;&#23601;&#26159;&#35828;&#65292;Slab Allocator&#30340;&#22522;&#26412;&#21407;&#29702;&#26159;&#25353;&#29031;&#39044;&#20808;&#35268;&#23450;&#30340;&#22823;&#23567;&#65292;&#23558;&#20998;&#37197;&#30340;&#20869;&#23384;&#20998;&#21106;&#25104;&#29305;&#23450;&#38271;&#24230;&#30340;&#22359;&#65292;&#20197;&#23436;&#20840;&#35299;&#20915;&#20869;&#23384;&#30862;&#29255;&#38382;&#39064;&#12290;

Slab Allocation&#30340;&#21407;&#29702;&#30456;&#24403;&#31616;&#21333;&#12290; &#23558;&#20998;&#37197;&#30340;&#20869;&#23384;&#20998;&#21106;&#25104;&#21508;&#31181;&#23610;&#23544;&#30340;&#22359;&#65288;chunk&#65289;&#65292;&#24182;&#25226;&#23610;&#23544;&#30456;&#21516;&#30340;&#22359;&#20998;&#25104;&#32452;&#65288;chunk&#30340;&#38598;&#21512;&#65289;&#65288;&#22270;1&#65289;&#12290;

![alt text][1]


&#22270;1 Slab Allocation&#30340;&#26500;&#36896;&#22270;

&#32780;&#19988;&#65292;slab allocator&#36824;&#26377;&#37325;&#22797;&#20351;&#29992;&#24050;&#20998;&#37197;&#30340;&#20869;&#23384;&#30340;&#30446;&#30340;&#12290;&#20063;&#23601;&#26159;&#35828;&#65292;&#20998;&#37197;&#21040;&#30340;&#20869;&#23384;&#19981;&#20250;&#37322;&#25918;&#65292;&#32780;&#26159;&#37325;&#22797;&#21033;&#29992;&#12290;

**Slab Allocation&#30340;&#20027;&#35201;&#26415;&#35821;**

**Page**

&#20998;&#37197;&#32473;Slab&#30340;&#20869;&#23384;&#31354;&#38388;&#65292;&#40664;&#35748;&#26159;1MB&#12290;&#20998;&#37197;&#32473;Slab&#20043;&#21518;&#26681;&#25454;slab&#30340;&#22823;&#23567;&#20999;&#20998;&#25104;chunk&#12290;

**Chunk**

&#29992;&#20110;&#32531;&#23384;&#35760;&#24405;&#30340;&#20869;&#23384;&#31354;&#38388;&#12290;

**Slab Class**

&#29305;&#23450;&#22823;&#23567;&#30340;chunk&#30340;&#32452;&#12290;

**&#22312;Slab&#20013;&#32531;&#23384;&#35760;&#24405;&#30340;&#21407;&#29702;**

&#19979;&#38754;&#35828;&#26126;memcached&#22914;&#20309;&#38024;&#23545;&#23458;&#25143;&#31471;&#21457;&#36865;&#30340;&#25968;&#25454;&#36873;&#25321;slab&#24182;&#32531;&#23384;&#21040;chunk&#20013;&#12290;

memcached&#26681;&#25454;&#25910;&#21040;&#30340;&#25968;&#25454;&#30340;&#22823;&#23567;&#65292;&#36873;&#25321;&#26368;&#36866;&#21512;&#25968;&#25454;&#22823;&#23567;&#30340;slab&#65288;&#22270;2&#65289;&#12290; memcached&#20013;&#20445;&#23384;&#30528;slab&#20869;&#31354;&#38386;chunk&#30340;&#21015;&#34920;&#65292;&#26681;&#25454;&#35813;&#21015;&#34920;&#36873;&#25321;chunk&#65292;&#28982;&#21518;&#23558;&#25968;&#25454;&#32531;&#23384;&#20110;&#20854;&#20013;&#12290;

![alt text][2]

&#22270;2 &#36873;&#25321;&#23384;&#20648;&#35760;&#24405;&#30340;&#32452;&#30340;&#26041;&#27861;

&#23454;&#38469;&#19978;&#65292;Slab Allocator&#20063;&#26159;&#26377;&#21033;&#20063;&#26377;&#24330;&#12290;&#19979;&#38754;&#20171;&#32461;&#19968;&#19979;&#23427;&#30340;&#32570;&#28857;&#12290;

**Slab Allocator&#30340;&#32570;&#28857;**

Slab Allocator&#35299;&#20915;&#20102;&#24403;&#21021;&#30340;&#20869;&#23384;&#30862;&#29255;&#38382;&#39064;&#65292;&#20294;&#26032;&#30340;&#26426;&#21046;&#20063;&#32473;memcached&#24102;&#26469;&#20102;&#26032;&#30340;&#38382;&#39064;&#12290;

&#36825;&#20010;&#38382;&#39064;&#23601;&#26159;&#65292;&#30001;&#20110;&#20998;&#37197;&#30340;&#26159;&#29305;&#23450;&#38271;&#24230;&#30340;&#20869;&#23384;&#65292;&#22240;&#27492;&#26080;&#27861;&#26377;&#25928;&#21033;&#29992;&#20998;&#37197;&#30340;&#20869;&#23384;&#12290;&#20363;&#22914;&#65292;&#23558;100&#23383;&#33410;&#30340;&#25968;&#25454;&#32531;&#23384;&#21040;128&#23383;&#33410;&#30340;chunk&#20013;&#65292;&#21097;&#20313;&#30340;28&#23383;&#33410;&#23601;&#28010;&#36153;&#20102;&#65288;&#22270;3&#65289;&#12290;

![alt text][3]

&#22270;3 chunk&#31354;&#38388;&#30340;&#20351;&#29992;

&#23545;&#20110;&#35813;&#38382;&#39064;&#30446;&#21069;&#36824;&#27809;&#26377;&#23436;&#32654;&#30340;&#35299;&#20915;&#26041;&#26696;&#65292;&#20294;&#22312;&#25991;&#26723;&#20013;&#35760;&#36733;&#20102;&#27604;&#36739;&#26377;&#25928;&#30340;&#35299;&#20915;&#26041;&#26696;&#12290;

The most efficient way to reduce the waste is to use a list of size classes that closely matches (if that's at all possible) common sizes of objects that the clients of this particular installation of memcached are likely to store.

&#23601;&#26159;&#35828;&#65292;&#22914;&#26524;&#39044;&#20808;&#30693;&#36947;&#23458;&#25143;&#31471;&#21457;&#36865;&#30340;&#25968;&#25454;&#30340;&#20844;&#29992;&#22823;&#23567;&#65292;&#25110;&#32773;&#20165;&#32531;&#23384;&#22823;&#23567;&#30456;&#21516;&#30340;&#25968;&#25454;&#30340;&#24773;&#20917;&#19979;&#65292;&#21482;&#35201;&#20351;&#29992;&#36866;&#21512;&#25968;&#25454;&#22823;&#23567;&#30340;&#32452;&#30340;&#21015;&#34920;&#65292;&#23601;&#21487;&#20197;&#20943;&#23569;&#28010;&#36153;&#12290;

&#20294;&#26159;&#24456;&#36951;&#25022;&#65292;&#29616;&#22312;&#36824;&#19981;&#33021;&#36827;&#34892;&#20219;&#20309;&#35843;&#20248;&#65292;&#21482;&#33021;&#26399;&#24453;&#20197;&#21518;&#30340;&#29256;&#26412;&#20102;&#12290;&#20294;&#26159;&#65292;&#25105;&#20204;&#21487;&#20197;&#35843;&#33410;slab class&#30340;&#22823;&#23567;&#30340;&#24046;&#21035;&#12290;&#25509;&#19979;&#26469;&#35828;&#26126;growth factor&#36873;&#39033;&#12290;

**&#20351;&#29992;Growth Factor&#36827;&#34892;&#35843;&#20248;**

memcached&#22312;&#21551;&#21160;&#26102;&#25351;&#23450; Growth Factor&#22240;&#23376;&#65288;&#36890;&#36807;-f&#36873;&#39033;&#65289;&#65292;&#23601;&#21487;&#20197;&#22312;&#26576;&#31181;&#31243;&#24230;&#19978;&#25511;&#21046;slab&#20043;&#38388;&#30340;&#24046;&#24322;&#12290;&#40664;&#35748;&#20540;&#20026;1.25&#12290;&#20294;&#26159;&#65292;&#22312;&#35813;&#36873;&#39033;&#20986;&#29616;&#20043;&#21069;&#65292;&#36825;&#20010;&#22240;&#23376;&#26366;&#32463;&#22266;&#23450;&#20026;2&#65292;&#31216;&#20026;&#8220;powers of 2&#8221;&#31574;&#30053;&#12290;

&#35753;&#25105;&#20204;&#29992;&#20197;&#21069;&#30340;&#35774;&#32622;&#65292;&#20197;verbose&#27169;&#24335;&#21551;&#21160;memcached&#35797;&#35797;&#30475;&#65306;

    $ memcached -f 2 -vv

&#19979;&#38754;&#26159;&#21551;&#21160;&#21518;&#30340;verbose&#36755;&#20986;&#65306;

    slab class   1: chunk size    128 perslab  8192
    slab class   2: chunk size    256 perslab  4096
    slab class   3: chunk size    512 perslab  2048
    slab class   4: chunk size   1024 perslab  1024
    slab class   5: chunk size   2048 perslab   512
    slab class   6: chunk size   4096 perslab   256
    slab class   7: chunk size   8192 perslab   128
    slab class   8: chunk size  16384 perslab    64
    slab class   9: chunk size  32768 perslab    32
    slab class  10: chunk size  65536 perslab    16
    slab class  11: chunk size 131072 perslab     8
    slab class  12: chunk size 262144 perslab     4
    slab class  13: chunk size 524288 perslab     2

&#21487;&#35265;&#65292;&#20174;128&#23383;&#33410;&#30340;&#32452;&#24320;&#22987;&#65292;&#32452;&#30340;&#22823;&#23567;&#20381;&#27425;&#22686;&#22823;&#20026;&#21407;&#26469;&#30340;2&#20493;&#12290;&#36825;&#26679;&#35774;&#32622;&#30340;&#38382;&#39064;&#26159;&#65292;slab&#20043;&#38388;&#30340;&#24046;&#21035;&#27604;&#36739;&#22823;&#65292;&#26377;&#20123;&#24773;&#20917;&#19979;&#23601;&#30456;&#24403;&#28010;&#36153;&#20869;&#23384;&#12290;&#22240;&#27492;&#65292;&#20026;&#23613;&#37327;&#20943;&#23569;&#20869;&#23384;&#28010;&#36153;&#65292;&#20004;&#24180;&#21069;&#36861;&#21152;&#20102;growth factor&#36825;&#20010;&#36873;&#39033;&#12290;

&#26469;&#30475;&#30475;&#29616;&#22312;&#30340;&#40664;&#35748;&#35774;&#32622;&#65288;f=1.25&#65289;&#26102;&#30340;&#36755;&#20986;&#65288;&#31687;&#24133;&#25152;&#38480;&#65292;&#36825;&#37324;&#21482;&#20889;&#21040;&#31532;10&#32452;&#65289;&#65306;

    slab class   1: chunk size     88 perslab 11915
    slab class   2: chunk size    112 perslab  9362
    slab class   3: chunk size    144 perslab  7281
    slab class   4: chunk size    184 perslab  5698
    slab class   5: chunk size    232 perslab  4519
    slab class   6: chunk size    296 perslab  3542
    slab class   7: chunk size    376 perslab  2788
    slab class   8: chunk size    472 perslab  2221
    slab class   9: chunk size    592 perslab  1771
    slab class  10: chunk size    744 perslab  1409

&#21487;&#35265;&#65292;&#32452;&#38388;&#24046;&#36317;&#27604;&#22240;&#23376;&#20026;2&#26102;&#23567;&#24471;&#22810;&#65292;&#26356;&#36866;&#21512;&#32531;&#23384;&#20960;&#30334;&#23383;&#33410;&#30340;&#35760;&#24405;&#12290;&#20174;&#19978;&#38754;&#30340;&#36755;&#20986;&#32467;&#26524;&#26469;&#30475;&#65292;&#21487;&#33021;&#20250;&#35273;&#24471;&#26377;&#20123;&#35745;&#31639;&#35823;&#24046;&#65292;&#36825;&#20123;&#35823;&#24046;&#26159;&#20026;&#20102;&#20445;&#25345;&#23383;&#33410;&#25968;&#30340;&#23545;&#40784;&#32780;&#25925;&#24847;&#35774;&#32622;&#30340;&#12290;

&#23558;memcached&#24341;&#20837;&#20135;&#21697;&#65292;&#25110;&#26159;&#30452;&#25509;&#20351;&#29992;&#40664;&#35748;&#20540;&#36827;&#34892;&#37096;&#32626;&#26102;&#65292;&#26368;&#22909;&#26159;&#37325;&#26032;&#35745;&#31639;&#19968;&#19979;&#25968;&#25454;&#30340;&#39044;&#26399;&#24179;&#22343;&#38271;&#24230;&#65292;&#35843;&#25972;growth factor&#65292;&#20197;&#33719;&#24471;&#26368;&#24688;&#24403;&#30340;&#35774;&#32622;&#12290;&#20869;&#23384;&#26159;&#29645;&#36149;&#30340;&#36164;&#28304;&#65292;&#28010;&#36153;&#23601;&#22826;&#21487;&#24796;&#20102;&#12290;

&#25509;&#19979;&#26469;&#20171;&#32461;&#19968;&#19979;&#22914;&#20309;&#20351;&#29992;memcached&#30340;stats&#21629;&#20196;&#26597;&#30475;slabs&#30340;&#21033;&#29992;&#29575;&#31561;&#21508;&#31181;&#21508;&#26679;&#30340;&#20449;&#24687;&#12290;

**&#26597;&#30475;memcached&#30340;&#20869;&#37096;&#29366;&#24577;**

memcached&#26377;&#20010;&#21517;&#20026;stats&#30340;&#21629;&#20196;&#65292;&#20351;&#29992;&#23427;&#21487;&#20197;&#33719;&#24471;&#21508;&#31181;&#21508;&#26679;&#30340;&#20449;&#24687;&#12290;&#25191;&#34892;&#21629;&#20196;&#30340;&#26041;&#27861;&#24456;&#22810;&#65292;&#29992;telnet&#26368;&#20026;&#31616;&#21333;&#65306;

    $ telnet &#20027;&#26426;&#21517; &#31471;&#21475;&#21495;

&#36830;&#25509;&#21040;memcached&#20043;&#21518;&#65292;&#36755;&#20837;stats&#20877;&#25353;&#22238;&#36710;&#65292;&#21363;&#21487;&#33719;&#24471;&#21253;&#25324;&#36164;&#28304;&#21033;&#29992;&#29575;&#22312;&#20869;&#30340;&#21508;&#31181;&#20449;&#24687;&#12290;&#27492;&#22806;&#65292;&#36755;&#20837;"stats slabs"&#25110;"stats items"&#36824;&#21487;&#20197;&#33719;&#24471;&#20851;&#20110;&#32531;&#23384;&#35760;&#24405;&#30340;&#20449;&#24687;&#12290;&#32467;&#26463;&#31243;&#24207;&#35831;&#36755;&#20837;quit&#12290;

&#36825;&#20123;&#21629;&#20196;&#30340;&#35814;&#32454;&#20449;&#24687;&#21487;&#20197;&#21442;&#32771;memcached&#36719;&#20214;&#21253;&#20869;&#30340;protocol.txt&#25991;&#26723;&#12290;

    $ telnet localhost 11211
    Trying ::1...
    Connected to localhost.
    Escape character is '^]'.
    stats
    STAT pid 481
    STAT uptime 16574
    STAT time 1213687612
    STAT version 1.2.5
    STAT pointer_size 32
    STAT rusage_user 0.102297
    STAT rusage_system 0.214317
    STAT curr_items 0
    STAT total_items 0
    STAT bytes 0
    STAT curr_connections 6
    STAT total_connections 8
    STAT connection_structures 7
    STAT cmd_get 0
    STAT cmd_set 0
    STAT get_hits 0
    STAT get_misses 0
    STAT evictions 0
    STAT bytes_read 20
    STAT bytes_written 465
    STAT limit_maxbytes 67108864
    STAT threads 4
    END
    quit

&#21478;&#22806;&#65292;&#22914;&#26524;&#23433;&#35013;&#20102;libmemcached&#36825;&#20010;&#38754;&#21521;C/C++&#35821;&#35328;&#30340;&#23458;&#25143;&#31471;&#24211;&#65292;&#23601;&#20250;&#23433;&#35013; memstat &#36825;&#20010;&#21629;&#20196;&#12290;&#20351;&#29992;&#26041;&#27861;&#24456;&#31616;&#21333;&#65292;&#21487;&#20197;&#29992;&#26356;&#23569;&#30340;&#27493;&#39588;&#33719;&#24471;&#19982;telnet&#30456;&#21516;&#30340;&#20449;&#24687;&#65292;&#36824;&#33021;&#19968;&#27425;&#24615;&#20174;&#22810;&#21488;&#26381;&#21153;&#22120;&#33719;&#24471;&#20449;&#24687;&#12290;

    $ memstat --servers=server1,server2,server3,...

libmemcached&#21487;&#20197;&#20174;&#19979;&#38754;&#30340;&#22320;&#22336;&#33719;&#24471;&#65306;

http://libmemcached.org/libMemcached.html

**&#26597;&#30475;slabs&#30340;&#20351;&#29992;&#29366;&#20917;**

&#20351;&#29992;memcached&#30340;&#21019;&#36896;&#30528;Brad&#20889;&#30340;&#21517;&#20026;memcached-tool&#30340;Perl&#33050;&#26412;&#65292;&#21487;&#20197;&#26041;&#20415;&#22320;&#33719;&#24471;slab&#30340;&#20351;&#29992;&#24773;&#20917;&#65288;&#23427;&#23558;memcached&#30340;&#36820;&#22238;&#20540;&#25972;&#29702;&#25104;&#23481;&#26131;&#38405;&#35835;&#30340;&#26684;&#24335;&#65289;&#12290;&#21487;&#20197;&#20174;&#19979;&#38754;&#30340;&#22320;&#22336;&#33719;&#24471;&#33050;&#26412;&#65306;

&#8226;http://code.sixapart.com/svn/memcached/trunk/server/scripts/memcached-tool

&#20351;&#29992;&#26041;&#27861;&#20063;&#26497;&#20854;&#31616;&#21333;&#65306;

    $ memcached-tool &#20027;&#26426;&#21517;:&#31471;&#21475; &#36873;&#39033;

&#26597;&#30475;slabs&#20351;&#29992;&#29366;&#20917;&#26102;&#26080;&#38656;&#25351;&#23450;&#36873;&#39033;&#65292;&#22240;&#27492;&#29992;&#19979;&#38754;&#30340;&#21629;&#20196;&#21363;&#21487;&#65306;

    $ memcached-tool &#20027;&#26426;&#21517;:&#31471;&#21475;

&#33719;&#24471;&#30340;&#20449;&#24687;&#22914;&#19979;&#25152;&#31034;&#65306;

    #  Item_Size   Max_age  1MB_pages Count   Full?
     1     104 B  1394292 s    1215 12249628    yes
     2     136 B  1456795 s      52  400919     yes
     3     176 B  1339587 s      33  196567     yes
     4     224 B  1360926 s     109  510221     yes
     5     280 B  1570071 s      49  183452     yes
     6     352 B  1592051 s      77  229197     yes
     7     440 B  1517732 s      66  157183     yes
     8     552 B  1460821 s      62  117697     yes
     9     696 B  1521917 s     143  215308     yes
    10     872 B  1695035 s     205  246162     yes
    11     1.1 kB 1681650 s     233  221968     yes
    12     1.3 kB 1603363 s     241  183621     yes
    13     1.7 kB 1634218 s      94   57197     yes
    14     2.1 kB 1695038 s      75   36488     yes
    15     2.6 kB 1747075 s      65   25203     yes
    16     3.3 kB 1760661 s      78   24167     yes

&#21508;&#21015;&#30340;&#21547;&#20041;&#20026;&#65306;

   &#21015;	                               &#21547;&#20041;


   #	                        slab class&#32534;&#21495;


Item_Size	                  Chunk&#22823;&#23567;


Max_age	          LRU&#20869;&#26368;&#26087;&#30340;&#35760;&#24405;&#30340;&#29983;&#23384;&#26102;&#38388;


1MB_pages	         &#20998;&#37197;&#32473;Slab&#30340;&#39029;&#25968;


Count	                 Slab&#20869;&#30340;&#35760;&#24405;&#25968;


Full?   	            Slab&#20869;&#26159;&#21542;&#21547;&#26377;&#31354;&#38386;chunk

&#20174;&#36825;&#20010;&#33050;&#26412;&#33719;&#24471;&#30340;&#20449;&#24687;&#23545;&#20110;&#35843;&#20248;&#38750;&#24120;&#26041;&#20415;&#65292;&#24378;&#28872;&#25512;&#33616;&#20351;&#29992;&#12290;

**&#20869;&#23384;&#23384;&#20648;&#30340;&#24635;&#32467;**

&#26412;&#27425;&#31616;&#21333;&#35828;&#26126;&#20102;memcached&#30340;&#32531;&#23384;&#26426;&#21046;&#21644;&#35843;&#20248;&#26041;&#27861;&#12290;&#24076;&#26395;&#35835;&#32773;&#33021;&#29702;&#35299;memcached&#30340;&#20869;&#23384;&#31649;&#29702;&#21407;&#29702;&#21450;&#20854;&#20248;&#32570;&#28857;&#12290;

&#19979;&#27425;&#23558;&#32487;&#32493;&#35828;&#26126;LRU&#21644;Expire&#31561;&#21407;&#29702;&#65292;&#20197;&#21450;memcached&#30340;&#26368;&#26032;&#21457;&#23637;&#26041;&#21521;&#8212;&#8212; &#21487;&#25193;&#20805;&#20307;&#31995;&#65288;pluggable architecher&#65289;&#65289;&#12290;

  [1]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0002-01.png
  [2]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0002-02.png
  [3]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0002-03.png</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/111</id>
    <published>2011-05-02T11:46:37+08:00</published>
    <updated>2011-06-21T01:23:07+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/111-memcached-Depth-analytical-01"/>
    <title>memcached &#28145;&#24230;&#35299;&#26512;&#65288;&#19968;&#65289;</title>
    <summary>**memcached&#26159;&#20160;&#20040;&#65311;**

&#35768;&#22810;Web&#24212;&#29992;&#37117;&#23558;&#25968;&#25454;&#20445;&#23384;&#21040;RDBMS&#20013;&#65292;&#24212;&#29992;&#26381;&#21153;&#22120;&#20174;&#20013;&#35835;&#21462;&#25968;&#25454;&#24182;&#22312;&#27983;&#35272;&#22120;&#20013;&#26174;&#31034;&#12290;&#20294;&#38543;&#30528;&#25968;&#25454;&#37327;&#30340;&#22686;&#22823;&#12289;&#35775;&#38382;&#30340;&#38598;&#20013;&#65292;&#23601;&#20250;&#20986;&#29616;RDBMS&#30340;&#36127;&#25285;&#21152;&#37325;&#12289;&#25968;&#25454;&#24211;&#21709;&#24212;&#24694;&#21270;&#12289;&#32593;&#31449;&#26174;&#31034;&#24310;&#36831;&#31561;&#37325;&#22823;&#24433;&#21709;&#12290;

&#36825;&#26102;&#23601;&#35813;memcached&#22823;&#26174;&#36523;&#25163;&#20102;&#12290;memcached&#26159;&#39640;&#24615;&#33021;&#30340;&#20998;&#24067;&#24335;&#20869;&#23384;&#32531;&#23384;&#26381;&#21153;&#22120;&#12290;&#19968;&#33324;&#30340;&#20351;&#29992;&#30446;&#30340;&#26159;&#65292;&#36890;&#36807;&#32531;&#23384;&#25968;&#25454;&#24211;&#26597;&#35810;&#32467;&#26524;&#65292;&#20943;&#23569;&#25968;&#25454;&#24211;&#35775;&#38382;&#27425;&#25968;&#65292;&#20197;&#25552;&#39640;&#21160;&#24577;Web&#24212;&#29992;&#30340;&#36895;&#24230;&#12289;&#25552;&#39640;&#21487;&#25193;&#23637;&#24615;&#12290;

![alt text][1]


&#22270;1 &#19968;&#33324;&#24773;&#20917;&#19979;memcached&#30340;&#29992;&#36884;

**memcached&#30340;&#29305;&#24449;**

memcached&#20316;&#20026;&#39640;&#36895;&#36816;&#34892;&#30340;&#20998;&#24067;&#24335;&#32531;&#23384;&#26381;&#21153;&#22120;&#65292;&#20855;&#26377;&#20197;&#19979;&#30340;&#29305;&#28857;&#12290;

 1. &#21327;&#35758;&#31616;&#21333;
 2. &#22522;&#20110;libevent&#30340;&#20107;&#20214;&#22788;&#29702;
 3. &#20869;&#32622;&#20869;&#23384;&#23384;&#20648;&#26041;&#24335;
 4. memcached&#19981;&#20114;&#30456;&#36890;&#20449;&#30340;&#20998;&#24067;&#24335;

**&#21327;&#35758;&#31616;&#21333;**

memcached&#30340;&#26381;&#21153;&#22120;&#23458;&#25143;&#31471;&#36890;&#20449;&#24182;&#19981;&#20351;&#29992;&#22797;&#26434;&#30340;XML&#31561;&#26684;&#24335;&#65292;&#32780;&#20351;&#29992;&#31616;&#21333;&#30340;&#22522;&#20110;&#25991;&#26412;&#34892;&#30340;&#21327;&#35758;&#12290;&#22240;&#27492;&#65292;&#36890;&#36807;telnet &#20063;&#33021;&#22312;memcached&#19978;&#20445;&#23384;&#25968;&#25454;&#12289;&#21462;&#24471;&#25968;&#25454;&#12290;&#19979;&#38754;&#26159;&#20363;&#23376;&#12290;

    $ telnet localhost 11211
    Trying 127.0.0.1...
    Connected to localhost.localdomain (127.0.0.1).
    Escape character is '^]'.
    set foo 0 0 3     &#65288;&#20445;&#23384;&#21629;&#20196;&#65289;
    bar               &#65288;&#25968;&#25454;&#65289;
    STORED            &#65288;&#32467;&#26524;&#65289;
    get foo           &#65288;&#21462;&#24471;&#21629;&#20196;&#65289;
    VALUE foo 0 3     &#65288;&#25968;&#25454;&#65289;
    bar               &#65288;&#25968;&#25454;&#65289;

**&#22522;&#20110;libevent&#30340;&#20107;&#20214;&#22788;&#29702;**

libevent&#26159;&#20010;&#31243;&#24207;&#24211;&#65292;&#23427;&#23558;Linux&#30340;epoll&#12289;BSD&#31867;&#25805;&#20316;&#31995;&#32479;&#30340;kqueue&#31561;&#20107;&#20214;&#22788;&#29702;&#21151;&#33021;&#23553;&#35013;&#25104;&#32479;&#19968;&#30340;&#25509;&#21475;&#12290;&#21363;&#20351;&#23545;&#26381;&#21153;&#22120;&#30340;&#36830;&#25509;&#25968;&#22686;&#21152;&#65292;&#20063;&#33021;&#21457;&#25381;O(1)&#30340;&#24615;&#33021;&#12290; memcached&#20351;&#29992;&#36825;&#20010;libevent&#24211;&#65292;&#22240;&#27492;&#33021;&#22312;Linux&#12289;BSD&#12289;Solaris&#31561;&#25805;&#20316;&#31995;&#32479;&#19978;&#21457;&#25381;&#20854;&#39640;&#24615;&#33021;&#12290;&#20851;&#20110;&#20107;&#20214;&#22788;&#29702;&#36825;&#37324;&#23601;&#19981;&#20877;&#35814;&#32454;&#20171;&#32461;&#65292;&#21487;&#20197;&#21442;&#32771;Dan Kegel&#30340;The C10K Problem&#12290;

**&#20869;&#32622;&#20869;&#23384;&#23384;&#20648;&#26041;&#24335;**

&#20026;&#20102;&#25552;&#39640;&#24615;&#33021;&#65292;memcached&#20013;&#20445;&#23384;&#30340;&#25968;&#25454;&#37117;&#23384;&#20648;&#22312;memcached&#20869;&#32622;&#30340;&#20869;&#23384;&#23384;&#20648;&#31354;&#38388;&#20013;&#12290;&#30001;&#20110;&#25968;&#25454;&#20165;&#23384;&#22312;&#20110;&#20869;&#23384;&#20013;&#65292;&#22240;&#27492;&#37325;&#21551;memcached&#12289;&#37325;&#21551;&#25805;&#20316;&#31995;&#32479;&#20250;&#23548;&#33268;&#20840;&#37096;&#25968;&#25454;&#28040;&#22833;&#12290;&#21478;&#22806;&#65292;&#20869;&#23481;&#23481;&#37327;&#36798;&#21040;&#25351;&#23450;&#20540;&#20043;&#21518;&#65292;&#23601;&#22522;&#20110;LRU(Least Recently Used)&#31639;&#27861;&#33258;&#21160;&#21024;&#38500;&#19981;&#20351;&#29992;&#30340;&#32531;&#23384;&#12290; memcached&#26412;&#36523;&#26159;&#20026;&#32531;&#23384;&#32780;&#35774;&#35745;&#30340;&#26381;&#21153;&#22120;&#65292;&#22240;&#27492;&#24182;&#27809;&#26377;&#36807;&#22810;&#32771;&#34385;&#25968;&#25454;&#30340;&#27704;&#20037;&#24615;&#38382;&#39064;&#12290;&#20851;&#20110;&#20869;&#23384;&#23384;&#20648;&#30340;&#35814;&#32454;&#20449;&#24687;&#65292;&#26412;&#36830;&#36733;&#30340;&#31532;&#20108;&#35762;&#20197;&#21518;&#21069;&#22338;&#20250;&#36827;&#34892;&#20171;&#32461;&#65292;&#35831;&#23626;&#26102;&#21442;&#32771;&#12290;

**memcached&#19981;&#20114;&#30456;&#36890;&#20449;&#30340;&#20998;&#24067;&#24335;**

memcached&#23613;&#31649;&#26159;&#8220;&#20998;&#24067;&#24335;&#8221;&#32531;&#23384;&#26381;&#21153;&#22120;&#65292;&#20294;&#26381;&#21153;&#22120;&#31471;&#24182;&#27809;&#26377;&#20998;&#24067;&#24335;&#21151;&#33021;&#12290;&#21508;&#20010;memcached&#19981;&#20250;&#20114;&#30456;&#36890;&#20449;&#20197;&#20849;&#20139;&#20449;&#24687;&#12290;&#37027;&#20040;&#65292;&#24590;&#26679;&#36827;&#34892;&#20998;&#24067;&#24335;&#21602;&#65311;&#36825;&#23436;&#20840;&#21462;&#20915;&#20110;&#23458;&#25143;&#31471;&#30340;&#23454;&#29616;&#12290;&#26412;&#36830;&#36733;&#20063;&#23558;&#20171;&#32461;memcached&#30340;&#20998;&#24067;&#24335;&#12290;

![alt text][2]

&#22270;2 memcached&#30340;&#20998;&#24067;&#24335;

&#21478;&#22806;&#20063;&#33021;&#23433;&#35013;&#22312;Windows&#19978;&#12290;&#36825;&#37324;&#20351;&#29992;ubuntu&#36827;&#34892;&#35828;&#26126;&#12290;

**memcached&#30340;&#23433;&#35013;**

&#36816;&#34892;memcached&#38656;&#35201;&#26412;&#25991;&#24320;&#22836;&#20171;&#32461;&#30340;libevent&#24211;&#12290;ubuntu&#20013;&#26377;&#29616;&#25104;&#30340;apt&#21253;&#65292;&#36890;&#36807;apt-get&#21629;&#20196;&#23433;&#35013;&#21363;&#21487;&#12290;

    apt-get install libevent-dev

memcached &#23433;&#35013;

   

    apt-get install memcached

**memcached&#30340;&#21551;&#21160;**

&#20174;&#32456;&#31471;&#36755;&#20837;&#20197;&#19979;&#21629;&#20196;&#65292;&#21551;&#21160;memcached&#12290;

    $ memcached -p 11211 -m 64m -vv
    slab class   1: chunk size     88 perslab 11915
    slab class   2: chunk size    112 perslab  9362
    slab class   3: chunk size    144 perslab  7281
    &#20013;&#38388;&#30465;&#30053;
    slab class  38: chunk size 391224 perslab     2
    slab class  39: chunk size 489032 perslab     2
    , 0) unless defined $ret;

&#22686;&#19968;&#21644;&#20943;&#19968;&#26159;&#21407;&#23376;&#25805;&#20316;&#65292;&#20294;&#26410;&#35774;&#32622;&#21021;&#22987;&#20540;&#26102;&#65292;&#19981;&#20250;&#33258;&#21160;&#36171;&#25104;0&#12290;&#22240;&#27492;&#65292;&#24212;&#24403;&#36827;&#34892;&#38169;&#35823;&#26816;&#26597;&#65292;&#24517;&#35201;&#26102;&#21152;&#20837;&#21021;&#22987;&#21270;&#25805;&#20316;&#12290;&#32780;&#19988;&#65292;&#26381;&#21153;&#22120;&#31471;&#20063;&#19981;&#20250;&#23545;&#36229;&#36807;2 32&#26102;&#30340;&#34892;&#20026;&#36827;&#34892;&#26816;&#26597;&#12290;

&#19979;&#27425;&#35828;&#26126;memcached&#30340;&#20869;&#37096;&#32467;&#26500;&#12290;&#20102;&#35299;memcached&#30340;&#20869;&#37096;&#26500;&#36896;&#65292;&#23601;&#33021;&#30693;&#36947;&#22914;&#20309;&#20351;&#29992;memcached&#25165;&#33021;&#20351;Web&#24212;&#29992;&#30340;&#36895;&#24230;&#26356;&#19978;&#19968;&#23618;&#27004;&#12290;&#27426;&#36814;&#32487;&#32493;&#38405;&#35835;[&#19979;&#19968;&#31456;][3]&#12290;

**&#24635;&#32467;**

&#36825;&#27425;&#31616;&#21333;&#20171;&#32461;&#20102;memcached&#65292;&#20197;&#21450;&#23427;&#30340;&#23433;&#35013;&#26041;&#27861;&#12290;&#21482;&#35201;&#30693;&#36947;&#65292;memcached&#30340;&#20351;&#29992;&#26041;&#27861;&#21313;&#20998;&#31616;&#21333;&#23601;&#36275;&#22815;&#20102;&#12290;


  [1]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0001-01.png
  [2]: http://tech.idv2.com/wp-content/uploads/2008/07/memcached-0001-02.png
  [3]: http://thoughtrails.com/episodes/112-memcached-Depth-analytical-02</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/110</id>
    <published>2011-04-29T15:30:42+08:00</published>
    <updated>2011-06-22T02:47:46+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/110-ruby-memcached-install"/>
    <title>ruby memcached gem &#23433;&#35013;</title>
    <summary>&#31995;&#32479;&#65306;ubuntu server 10.10

ruby&#65306;ree-ree-1.8.7-2010.02

&#39318;&#20808;&#25105;&#20204;&#26469;&#23433;&#35013;memcached&#26381;&#21153;&#65306;

    sudo apt-get install memcached

&#36825;&#37324;&#35201;&#27880;&#24847;&#19979; &#22914;&#26524;&#19978;&#36848;&#26174;&#31034;&#27809;&#26377;&#35201;&#23433;&#35013;libevent-dev&#36825;&#20010;&#20381;&#36182;&#21253;&#30340;&#35805;&#65288;&#22312;ubuntu &#26700;&#38754;&#29256;&#23601;&#26377;&#36825;&#20010;&#38382;&#39064;&#65289;&#36864;&#20986; &#20808;&#23433;&#35013; libevent-dev&#21253;

    sudo apt-get install libevent-dev

libevent&#26159;&#20010;&#31243;&#24207;&#24211;&#65292;&#23427;&#23558;Linux&#30340;epoll&#12289;BSD&#31867;&#25805;&#20316;&#31995;&#32479;&#30340;kqueue&#31561;&#20107;&#20214;&#22788;&#29702;&#21151;&#33021;&#23553;&#35013;&#25104;&#32479;&#19968;&#30340;&#25509;&#21475;&#12290;&#21363;&#20351;&#23545;&#26381;&#21153;&#22120;&#30340;&#36830;&#25509;&#25968;&#22686;&#21152;&#65292;&#20063;&#33021;&#21457;&#25381;O(1)&#30340;&#24615;&#33021;&#12290; memcached&#20351;&#29992;&#36825;&#20010;libevent&#24211;&#65292;&#22240;&#27492;&#33021;&#22312;Linux&#12289;BSD&#12289;Solaris&#31561;&#25805;&#20316;&#31995;&#32479;&#19978;&#21457;&#25381;&#20854;&#39640;&#24615;&#33021;&#12290;

&#36825;&#26679;&#23601;OK&#20102; &#65292;&#19979;&#26469;&#25105;&#20204;&#23454;&#39564;&#19979;&#26102;&#20505;&#23433;&#35013;&#22909;&#20102; &#65292;&#24320;&#21551;memcached&#26381;&#21153;

    memcached -p 11211 &amp;
    &#31995;&#32479;&#36820;&#22238;
     [1] 986 # &#36827;&#31243;ID&#21495;&#30721; &#35828;&#26126;&#23433;&#35013;&#21644;&#21551;&#21160;&#25104;&#21151;


&#19979;&#36793;&#25105;&#20204;&#26469;&#23433;&#35013;memcached GEM



&#20808;&#35201;&#23433;&#35013;&#19968;&#20123; &#20381;&#36182;&#21253;&#65306;

    sudo aptitude install libmemcached-dev libsasl2-dev libmemcached-dbg


libmemcached&#26159;&#19968;&#20010;&#22522;&#20110;C/C++&#23454;&#29616;&#30340;memcached client library&#65292;memcached gem&#32473;&#36825;&#20010;library&#25552;&#20379;&#20102;ruby&#23553;&#35013;&#65292;&#26681;&#25454;&#21407;&#20316;&#32773;&#30340;&#24615;&#33021;&#35780;&#27979;&#65292;&#23427;&#27604;&#30446;&#21069;&#24120;&#29992;&#30340;memcache-client gem&#26368;&#22810;&#35201;&#24555;150&#20493;&#12290; 

&#28982;&#21518;&#23601;&#21487;&#20197;&#23433;&#35013;&#20102;&#65306;

    gem install memcached --no-rdoc --no-ri

&#27809;&#20986;&#38169;&#35823;&#23601;OK&#20102;&#65292;&#23454;&#39564;&#19968;&#19979;

    &#22312;Ruby&#31243;&#24207;&#37324;&#38754;&#65292;&#24341;&#20837;&#36825;&#20010;&#24211;&#24182;&#20840;&#23616;&#23454;&#20363;&#21270;&#23545;&#35937;&#65306;
     require 'rubygems'
     require 'memcached' 

     $cache = Memcached.new("localhost:11211") 

     &#28982;&#21518;&#20320;&#23601;&#21487;&#20197;&#36827;&#34892;Memcached&#25805;&#20316;&#20102;&#65306;

     value = 'hello' 

     $cache.set 'test', value  

     $cache.get 'test' #=&gt; "hello" 

     &#20063;&#21487;&#20197;&#35774;&#32622;&#19968;&#20010;&#22833;&#25928;&#26102;&#38388;&#65306;
     
     value = 'hello' 

     $cache.set 'test', value, 1 

    sleep(2)  

    $cache.get 'test' #=&gt; &#25243;&#20986;&#24322;&#24120;&#65306; Memcached::NotFound 

&#22909;&#20102;&#65292;&#21097;&#19979;&#30340;&#33258;&#24049;&#21435;&#30740;&#31350;&#21543;&#65281;





</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/109</id>
    <published>2011-04-27T17:53:14+08:00</published>
    <updated>2011-06-22T14:19:43+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/109-sina-weibo-singnin"/>
    <title>&#32593;&#31449;&#25972;&#21512;&#26032;&#28010;&#24494;&#21338;&#30331;&#24405;</title>
    <summary>Oauth&#30340;&#21407;&#29702;&#35831;&#30475; [&#36825;&#37324;][1]

&#31532;&#19968;&#27493; &#23433;&#35013;oauth
&#25226; gem 'oauth' &#25918;&#21040;gemfile&#37324;
&#28982;&#21518;bundle install

&#31532;&#20108;&#27493; &#33719;&#21462;&#29992;&#25143;&#30340;&#25480;&#26435;

1&#65306;&#39318;&#20808;&#21462;&#24471;&#26410;&#25480;&#26435;token,&#28982;&#21518;&#36339;&#36716;&#21040;&#26032;&#28010;&#29992;&#25143;&#25480;&#26435;&#39029;&#38754;

&#21019;&#24314;consumer

      def consumer
        ::OAuth::Consumer.new("key", "secret", :site =&gt; "http://api.t.sina.com.cn")
      end

&#33719;&#24471;request_token

     def request_token
         @request_token = consumer.get_request_token
         session[:request_token] = @request_token.token
         session[:request_token_secret] = @request_token.secret
         redirect_to @request_token.authorize_url(:oauth_callback =&gt; 'http://xxx.xxx.xxx') 
      end

2.&#29992;&#25143;&#25480;&#26435;&#20197;&#21518;&#65292;&#36890;&#36807;callback_url&#36820;&#22238;&#33258;&#24049;&#30340;&#25509;&#25910;&#39029;&#38754;&#65292;&#25509;&#25910;&#24050;&#25480;&#26435;&#30340;token&#21644;oauth_verifier&#12290;&#20351;&#29992;&#24050;&#25480;&#26435;&#30340;token&#21644;&#20854;&#20182;&#21442;&#25968;&#33719;&#21462;&#29992;&#25143;&#30340;access_token&#21644;token_secret&#12290;

    def access_token 
            request_token = OAuth::RequestToken.new(
              consumer,
              session[:request_token],
              session[:request_token_secret]
            )
            access_token = request_token.get_access_token(:oauth_verifier=&gt;params["oauth_verifier"])
             session[:access_token] = access_token.token
             session[:access_token_secret] = access_token.secret   
    end

&#33719;&#21462;&#21040;&#25480;&#26435;&#21518;&#21487;&#20197;&#32771;&#34385;&#28155;&#21152;&#24494;&#21338;&#32465;&#23450;&#21040;&#26412;&#31449;&#24080;&#21495;&#30340;&#21151;&#33021;&#65288;authlogic&#37324;login,password&#21644;eamil&#26159;&#19981;&#33021;&#20026;&#31354;&#30340;&#65289;
  users&#37324;&#28155;&#21152;&#20004;&#23383;&#27573;&#65306;oauth_token,oauth_secret,&#23558;session[:access_token]&#12289;session[:access_token_secret]&#20998;&#21035;&#20445;&#23384;&#21040;

    oauth_token,oauth_secret

  &#29992;&#25143;&#25480;&#26435;&#20320;&#30340;&#24212;&#29992;&#21518;oauth_token,oauth_secret&#27704;&#36828;&#19981;&#20250;&#25913;&#21464;&#65292;&#38500;&#38750;&#29992;&#25143;&#21462;&#28040;&#25480;&#26435;,&#20197;&#21518;&#30331;&#24405;&#23601;&#29992;oauth_token

3:&#30331;&#24405;&#21151;&#33021;

    def singinin
        request_token = OAuth::RequestToken.new(
          consumer,
          session[:request_token],
          session[:request_token_secret]
        )
        access_token = request_token.get_access_token(:oauth_verifier=&gt;params["oauth_verifier"])
        session[:access_token] = access_token.token
        session[:access_token_secret] = access_token.secret 
        @user = User.find_by_oauth_token(oauth.access_token.token)
        ...............
      end


  [1]: http://thoughtrails.com/episodes/103-oauth</summary>
    <author>
      <name>aoner</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/108</id>
    <published>2011-04-24T10:28:51+08:00</published>
    <updated>2011-06-22T15:43:37+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/108-"/>
    <title>rails view&#20013; &#19978;&#19968;&#20010;&#12289;&#19979;&#19968;&#20010; &#30340;&#23454;&#29616; </title>
    <summary>&#20854;&#23454;&#38382;&#39064;&#30340;&#20851;&#38190;&#23601;&#26159;&#33719;&#21462;&#19978;&#19968;&#20010;&#12289;&#19979;&#19968;&#20010;&#30340; id
&#36825;&#37324;&#25105;&#20204;&#20351;&#29992; inherit resources &#36825;&#20010;&#25554;&#20214;&#65292;&#25554;&#20214;&#22320;&#22336; https://github.com/josevalim/inherited_resources
&#20026;&#20160;&#20040;&#20351;&#29992;&#36825;&#20010;&#25554;&#20214;&#21602;&#65311;&#20027;&#35201;&#26159;&#22914;&#26524;&#22810;&#20010;c&#20013;&#37117;&#35201;&#33719;&#21462;&#19978;&#19968;&#20010;&#12289;&#19979;&#19968;&#20010;&#30340; id &#30340;&#35805;&#22312;&#27599;&#20010;c&#20013;&#20889;&#22826;&#40635;&#28902;
&#19979;&#38754;&#19978;&#20195;&#30721;

    app/controller/inherit_resources_base_controller.rb
    class InheritResourcesBaseController &lt; ApplicationController
      inherit_resources
      private
      def define_previous_and_next
        @previous =
        begin
          resource_class.where("id &lt; ?",params[:id]).select(:id).last.id
        rescue
          params[:id]
        end
        
        @next =
        begin
          resource_class.where("id &gt; ?",params[:id]).select(:id).first.id
        rescue
          params[:id]
        end
      end
    end


    app/controller/records_controller.rb
    class RecordsController &lt; InheritResourcesBaseController
      before_filter :define_previous_and_next, :only =&gt; [:show]

c&#20013;&#36825;&#26679;&#23601;&#22909;&#20102;&#65292;v&#20013;&#21602;&#65311;&#26356;&#31616;&#21333;&#21679;&#65292; xxxx_path(@next) &#36825;&#26679;&#23601;&#22909;&#21679;&#65292;&#24403;&#28982;&#20063;&#21487;&#20197;&#22312;c&#20013;&#22914;&#26524;&#26159;&#31532;&#19968;&#20301;&#26102;&#36171;&#20540;&#20026;0&#65292;&#36825;&#26679;v&#20013;&#23601;&#21487;&#20197;&#20808;&#21028;&#26029;&#19979;&#22914;&#26524;&#26159;0&#65292;&#23601;link_to # &#21435;&#65292;&#21621;&#21621;&#65292;&#36825;&#20010;&#30475;&#20010;&#20154;&#38656;&#27714;&#20102;

&#29983;&#25104;&#30340;sql&#35821;&#21477;&#22914;&#19979;

    SELECT id FROM "records" WHERE (id &lt; '4173') ORDER BY id DESC LIMIT 1
    SELECT id FROM "records" WHERE (id &gt; '4173') ORDER BY id LIMIT 1

</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/107</id>
    <published>2011-04-14T15:13:59+08:00</published>
    <updated>2011-06-22T13:52:16+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/107-useful-validate-plugin-of-client-side-validations"/>
    <title>&#23454;&#29992;&#30340;&#21069;&#21488;&#26657;&#39564;&#25554;&#20214; client_side_validations</title>
    <summary>**&#23433;&#35013;**  

Gemfile&#20013;&#21152;&#20837;&#19968;&#19979;&#20195;&#30721;:  

    gem 'client_side_validations', '~&gt; 3.0.2'  

&#28982;&#21518;&#36816;&#34892;`bundle install`  


**&#21021;&#22987;&#21270;**  

    rails g client_side_validations:install  

&#20197;&#19978;&#36825;&#20010;&#21629;&#20196;&#20250;&#25335;&#36125;&#20004;&#20010;&#25991;&#20214;&#21040;&#39033;&#30446;&#20013;,&#20998;&#21035;&#26159;:  

    config/initializers/client_side_validations.rb
    public/javascripts/rails.validations.js

**&#29992;&#27861;:**  

&#22312;layout&#20013;&#21253;&#21547;rails.validations.js:  

    &lt;%= javascript_include_tag 'jquery', 'rails.validations'-%&gt;

&#27604;&#22914;&#26377;&#27169;&#22411;Book, &#21518;&#31471;&#26657;&#39564;&#22914;&#19979;:  

    class Book &lt; ActiveRecord::Base
        validates :name. :presence =&gt; true
    end

&#25171;&#24320;form&#30340;&#39564;&#35777;&#24320;&#20851;, &#23601;&#21487;&#20197;&#30475;&#21040;js&#30340;&#26657;&#39564;&#25928;&#26524;&#20102;:  

    &lt;%= semantic_form_for @book, :validate =&gt; true do |form| -%&gt;
    	&lt;%= form.inputs do %&gt;
    		&lt;%= form.input :name %&gt;
    	&lt;% end %&gt;
    
    	&lt;%= form.buttons do %&gt;
    		&lt;%= form.commit_button true %&gt;
    	&lt;% end %&gt;
    &lt;% end %&gt;  

&#22914;&#26524;&#19981;&#24819;&#20351;&#29992;&#21069;&#21488;&#26657;&#39564;&#65292;&#35774;&#32622; `:validate =&gt; false`  &#21363;&#21487;&#12290;

&#25509;&#19979;&#26469;&#20320;&#23601;&#21487;&#20197;&#30475;&#30475;&#25928;&#26524;&#20102;&#12290;&#26356;&#20855;&#20307;&#30340;&#25991;&#26723;&#35831;&#30475;github&#39033;&#30446;&#22320;&#22336;:  [https://github.com/bcardarella/client_side_validations][1]


  [1]: https://github.com/bcardarella/client_side_validations</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/106</id>
    <published>2011-04-14T09:53:08+08:00</published>
    <updated>2011-06-21T20:56:42+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/106-useful-configuration-plugin-of-settingslogic"/>
    <title>&#23454;&#29992;&#30340;&#37197;&#32622;&#25991;&#20214;&#25554;&#20214; Settingslogic</title>
    <summary>**&#23433;&#35013;:**  

    gem 'settingslogic', '~&gt; 2.0.6', :require =&gt; 'settingslogic'  

&#28982;&#21518;&#36816;&#34892;

    bundle install  



**&#37197;&#32622;:**  

**&#23450;&#20041;&#19968;&#20010;Settings&#31867;&#65292;&#31867;&#20284;&#19979;&#38754;&#30340;&#20889;&#27861;**  

    # app/models/settings.rb
    class Settings &lt; Settingslogic
      source "#{Rails.root}/config/application.yml"
      namespace Rails.env
    end
  
  
  
**&#21019;&#24314;&#37197;&#32622;&#25991;&#20214; application.yml**  

    # app/config/application.yml
    defaults: &amp;defaults
      cool:
        saweet: nested settings
      neat_setting: 24
      awesome_setting: &lt;%= "Did you know 5 + 5 = #{5 + 5}?" %&gt;
    
    development:
      &lt;&lt;&lt;&gt; Rails.env
    =&gt; "development"
    
    &gt;&gt; Settings.cool
    =&gt; "#"
    
    &gt;&gt; Settings.cool.saweet
    =&gt; "nested settings"
    
    &gt;&gt; Settings.neat_setting
    =&gt; 800
    
    &gt;&gt; Settings.awesome_setting
    =&gt; "Did you know 5 + 5 = 10?"

  
**&#24403;&#28982;&#20063;&#21487;&#20197;&#36827;&#34892;&#20854;&#23427;&#20219;&#20309;&#20320;&#24819;&#35201;&#30340;&#37197;&#32622;**  

    class Post &lt; ActiveRecord::Base
      self.per_page = Settings.pagination.posts_per_page
    end

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/105</id>
    <published>2011-04-12T14:41:02+08:00</published>
    <updated>2011-06-22T09:11:43+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/105-Association-of-belongs-to"/>
    <title>belongs_to &#22810;&#32423;&#20851;&#32852;</title>
    <summary>&#26377;&#19968;&#31181;&#24773;&#20917;,&#26159;&#36825;&#26679;&#30340;c&#23646;&#20110;b,b&#23646;&#20110;a,&#20294;&#26159;&#25105;&#20204;&#26377;&#26102;&#20505;&#24819;&#24314;&#31435;c&#23646;&#20110;a&#30340;&#20851;&#31995;,&#20063;&#23601;&#26159;c.a&#26367;&#20195;&#21407;&#26469;&#30340;c.b.a,&#37027;&#20040;&#21487;&#20197;&#20351;&#29992;through&#21644;has_one&#30340;&#32467;&#21512;&#20351;&#29992;&#26469;&#23454;&#29616;&#36825;&#20010;.  

&#20363;&#22914;


1)

    class A
      has_one :b
    end
    
    class B
      belongs_to :a
      has_one :c
    end
    
    class C
      belongs_to :b
      has_one :a, :through =&gt; b
    end

 


&#27880;&#24847;:   belongs_to &#19981;&#33021;&#21644;through&#19968;&#36215;&#20351;&#29992;,&#33267;&#20110;&#21407;&#22240;,&#25105;&#30475;&#20102;rails&#23448;&#26041;&#35299;&#37322;,&#20294;&#26159;&#30475;&#19981;&#25026;.  
 

2)  

&#36824;&#26377;&#19968;&#20123;&#20854;&#20182;&#30340;&#35299;&#20915;&#26041;&#24335;,&#20363;&#22914;delegate&#20063;&#21487;&#20197;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;  

    class A
      has_one :b
    end
    
    class B
      belongs_to :a
      has_one :c
    end
    
    class C
      belongs_to :b
      delegate :a, :to =&gt; :b, :allow_nil =&gt; true
    end 

</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/104</id>
    <published>2011-04-12T13:15:34+08:00</published>
    <updated>2011-06-22T15:02:30+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/104-state-mechine-of-AASM"/>
    <title>&#23454;&#29992;&#30340;&#29366;&#24577;&#26426;&#25554;&#20214; AASM</title>
    <summary>**&#23433;&#35013;**  

    gem install aasm  

&#19968;&#20010; aasm &#30340;&#31616;&#21333;&#23567;&#20363;&#23376;:  

    class Conversation
      include AASM
    
      aasm_column :current_state # defaults to aasm_state
    
      aasm_initial_state :unread
    
      aasm_state :unread
      aasm_state :read
      aasm_state :closed
    
      aasm_event :view do
        transitions :to =&gt; :read, :from =&gt; [:unread]
      end
    
      aasm_event :close do
        transitions :to =&gt; :closed, :from =&gt; [:read, :unread]
      end
    end

&#22312;&#20320;&#30340;model&#20013;`include AASM` &#21363;&#21487;&#20351;&#29992;&#65292;AASM&#30340;&#40664;&#35748;&#23383;&#27573;&#20026;  aasm_state, &#24403;&#28982;&#20063;&#21487;&#20197;&#33258;&#23450;&#20041;&#23383;&#27573;&#27604;&#22914; `aasm_column :current_state`  
&#23454;&#29616;&#27969;&#31243;&#30340;&#20889;&#27861;&#24456;&#31616;&#21333;&#65292;&#30475;&#20363;&#23376;&#21363;&#21487;&#12290;    
  
  

&#19979;&#38754;&#26469;&#30475;&#19968;&#20010;&#22797;&#26434;&#19968;&#28857;&#30340;&#20363;&#23376;: &#30456;&#20449;&#20195;&#30721;&#22823;&#23478;&#37117;&#33021;&#30475;&#30340;&#25026;&#65292;&#20063;&#23601;&#19981;&#19968;&#19968;&#35299;&#37322;&#20102;&#12290;&#36825;&#31181;&#20195;&#30721;&#21363;&#25991;&#26723;&#30340;&#24418;&#24335;&#38750;&#24120;&#22909;&#12290;

    class Relationship
      include AASM
    
      aasm_column :status
    
      aasm_initial_state Proc.new { |relationship| relationship.strictly_for_fun? ? :intimate : :dating }
    
      aasm_state :dating,   :enter =&gt; :make_happy,        :exit =&gt; :make_depressed
      aasm_state :intimate, :enter =&gt; :make_very_happy,   :exit =&gt; :never_speak_again
      aasm_state :married,  :enter =&gt; :give_up_intimacy,  :exit =&gt; :buy_exotic_car_and_wear_a_combover
    
      aasm_event :get_intimate do
        transitions :to =&gt; :intimate, :from =&gt; [:dating], :guard =&gt; :drunk?
      end
    
      aasm_event :get_married do
        transitions :to =&gt; :married, :from =&gt; [:dating, :intimate], :guard =&gt; :willing_to_give_up_manhood?
      end
    
      def strictly_for_fun?; end
      def drunk?; end
      def willing_to_give_up_manhood?; end
      def make_happy; end
      def make_depressed; end
      def make_very_happy; end
      def never_speak_again; end
      def give_up_intimacy; end
      def buy_exotic_car_and_wear_a_combover; end
    end</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/103</id>
    <published>2011-04-07T15:25:26+08:00</published>
    <updated>2011-06-22T14:10:48+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/103-oauth"/>
    <title>oauth&#35748;&#35777;&#21407;&#29702;</title>
    <summary>**OAuth&#26377;&#20160;&#20040;&#29992;&#65311;&#20026;&#20160;&#20040;&#35201;&#20351;&#29992;OAuth&#65311;**

&#29992;&#25143;&#24076;&#26395;&#22312;&#31532;&#19977;&#32593;&#31449;&#21644;&#24212;&#29992;&#19978;&#20351;&#29992;&#20182;&#22312;SNS&#32593;&#31449;&#19978;&#30340;&#29992;&#25143;&#20449;&#24687;&#65292;&#36825;&#20123;&#31532;&#19977;&#26041;&#32593;&#31449;&#32852;&#31995;SNS&#32593;&#31449;&#65292;&#20294;&#26159;&#30001;&#20110;&#27809;&#26377;&#29992;&#25143;&#35748;&#35777;&#20449;&#24687;&#65292;&#36825;&#26102;&#36825;&#20123;&#29992;&#25143;&#20449;&#24687;&#26159;&#19981;&#20801;&#35768;&#35775;&#38382;&#30340;&#12290;

&#20030;&#20010;&#25105;&#20204;&#36523;&#36793;&#22269;&#20869;&#30340;&#20363;&#23376;&#21543;&#65306;&#27604;&#22914; &#22242;&#36141;&#32593;&#31449; &#20320;&#38656;&#35201;&#25226;&#19968;&#26465;&#22242;&#36141;&#20449;&#24687;&#21457;&#21040;&#20320;&#30340;&#26032;&#28010;&#24494;&#21338;&#19978;&#24182;&#36890;&#30693;&#20320;&#30340;&#22909;&#21451;&#65292;&#20197;&#21069;&#30340;&#26041;&#27861;&#26159;&#20320;&#38656;&#35201;&#22312;&#22242;&#36141;&#32593;&#31449;&#36755;&#20837;&#20320;&#30340;&#26032;&#28010;&#24494;&#21338;&#36134;&#21495;&#65292;&#23494;&#30721;&#25165;&#33021;&#35843;&#29992;&#65292;&#34429;&#28982;&#32593;&#31449;&#19978;&#21487;&#33021;&#37117;&#33258;&#35859;&#8220;&#19981;&#20445;&#30041;&#26032;&#28010;&#24494;&#21338;&#29992;&#25143;&#21517;&#23494;&#30721;&#8221;&#65292;&#20294;&#26159;&#22823;&#23478;&#20449;&#21527;&#65311;

OAuth&#23601;&#26159;&#20026;&#20102;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#32780;&#35806;&#29983;&#30340;&#65292;&#29992;&#25143;&#35775;&#38382;&#31532;&#19977;&#26041;&#36164;&#28304;&#65292;&#19981;&#20877;&#38656;&#35201;&#32593;&#31449;&#25552;&#20132;&#20320;&#30340;&#29992;&#25143;&#21517;&#65292;&#23494;&#30721;&#12290;&#36825;&#26679;&#22909;&#22788;&#33258;&#24049;&#26159;&#23433;&#20840;&#65292;&#32780;&#19988;&#19981;&#20250;&#27844;&#38706;&#20320;&#30340;&#38544;&#31169;&#32473;&#19981;&#20449;&#20219;&#30340;&#19968;&#26041;&#12290;

**&#22312;&#35748;&#35777;&#21644;&#25480;&#26435;&#30340;&#36807;&#31243;&#20013;&#28041;&#21450;&#30340;&#19977;&#26041;&#21253;&#25324;&#65306;**

**&#26381;&#21153;&#25552;&#20379;&#26041;&#65306;**&#29992;&#25143;&#20351;&#29992;&#26381;&#21153;&#25552;&#20379;&#26041;&#26469;&#23384;&#20648;&#21463;&#20445;&#25252;&#30340;&#36164;&#28304;&#65292;&#22914;&#29031;&#29255;&#65292;&#35270;&#39057;&#65292;&#32852;&#31995;&#20154;&#21015;&#34920;&#12290;&#65288;&#19978;&#36848;&#25152;&#35828;&#30340; &#26032;&#28010;&#24494;&#21338;&#65289;
**&#29992;&#25143;&#65306;**&#23384;&#25918;&#22312;&#26381;&#21153;&#25552;&#20379;&#26041;&#30340;&#21463;&#20445;&#25252;&#30340;&#36164;&#28304;&#30340;&#25317;&#26377;&#32773;&#12290;&#65288;&#20320;&#65289;
**&#23458;&#25143;&#31471;&#65306;**&#35201;&#35775;&#38382;&#26381;&#21153;&#25552;&#20379;&#26041;&#36164;&#28304;&#30340;&#31532;&#19977;&#26041;&#24212;&#29992;&#65292;&#36890;&#24120;&#26159;&#32593;&#31449;&#65292;&#22914;&#25552;&#20379;&#29031;&#29255;&#25171;&#21360;&#26381;&#21153;&#30340;&#32593;&#31449;&#12290;&#22312;&#35748;&#35777;&#36807;&#31243;&#20043;&#21069;&#65292;&#23458;&#25143;&#31471;&#35201;&#21521;&#26381;&#21153;&#25552;&#20379;&#32773;&#30003;&#35831;&#23458;&#25143;&#31471;&#26631;&#35782;&#12290;&#65288;&#19978;&#36848;&#25152;&#35828;&#30340;&#22242;&#36141;&#32593;&#31449;&#65292;&#20063;&#21483;&#31532;&#19977;&#26041;&#32593;&#31449;&#65289;

**&#20351;&#29992;OAuth&#36827;&#34892;&#35748;&#35777;&#21644;&#25480;&#26435;&#30340;&#36807;&#31243;&#22914;&#19979;&#25152;&#31034;:**

1&#31532;&#19977;&#26041;&#32593;&#31449;&#21521;SNS&#32593;&#31449;&#25480;&#26435;&#26381;&#21153;&#21457;&#20986;&#33719;&#21462;request token&#30340;&#35831;&#27714;&#12290;SNS&#25480;&#26435;&#26381;&#21153;&#21709;&#24212;&#35831;&#27714;&#65292;&#36820;&#22238;&#19968;&#20010;&#23578;&#26410;&#35748;&#35777;&#30340;request token.

2&#31532;&#19977;&#26041;&#32593;&#31449;&#33719;&#21462;&#21709;&#24212;&#20013;&#21253;&#21547;&#30340;request token&#65292;&#25353;&#29031;&#21327;&#35758;&#35268;&#33539;&#65292;&#38468;&#24102;&#36825;&#20010;request token&#65292;&#23558;&#20854;&#37325;&#23450;&#21521;&#21040;SNS&#25552;&#20379;&#30340;&#25480;&#26435;&#39029;&#38754;(User Authorization URL)&#12290;&#22914;&#26524;&#29992;&#25143;&#27809;&#26377;&#30331;&#24405;&#65292;&#29992;&#25143;&#21521;&#26222;&#36890;&#30331;&#24405;&#19968;&#26679;&#65292;&#36755;&#20837;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#23436;&#25104;&#30331;&#24405;&#12290;&#22914;&#26524;&#29992;&#25143;&#24050;&#32463;&#30331;&#24405;&#65288;&#20351;&#29992;&#35760;&#24405;Cookie&#30340;&#26041;&#24335;&#65289;&#65292;&#20250;&#20986;&#29616;&#19968;&#20010;&#39029;&#38754;&#65292;&#38382;&#29992;&#25143;&#26159;&#21542;&#20801;&#25480;&#26435;&#20849;&#20139;&#20182;&#30340;SNS&#20449;&#24687;&#32473;&#31532;&#19977;&#26041;&#32593;&#31449;&#12290;

3&#19968;&#26086;&#29992;&#25143;&#36873;&#25321;&#25480;&#26435;&#31532;&#19977;&#26041;&#32593;&#31449;&#65292;SNS&#32593;&#31449;&#23558;&#25226;Web&#27983;&#35272;&#22120;&#37325;&#23450;&#21521;&#21040;&#31532;&#19977;&#26041;&#32593;&#31449;&#65292;&#21516;&#26102;&#25226;SNS&#30340;&#29992;&#25143;&#20449;&#24687;&#20256;&#36882;&#36807;&#21435;&#12290; &#29992;&#25143;&#20915;&#23450;&#20801;&#35768;&#25110;&#25298;&#32477;&#25480;&#26435;&#32473;&#31532;&#19977;&#26041;&#32593;&#31449;&#65292;&#22914;&#26524;&#29992;&#25143;&#25298;&#32477;&#25480;&#26435;&#32473;&#27492;&#31532;&#19977;&#26041;&#24212;&#29992;&#65292;&#21017;&#34987;&#37325;&#23450;&#21521;&#21040;SNS&#30340;&#39029;&#38754;&#65292;&#32780;&#19981;&#20250;&#20877;&#22238;&#21040;&#31532;&#19977;&#26041;&#24212;&#29992;&#30340;&#39029;&#38754;&#19978;&#12290; 
&#22914;&#26524;&#29992;&#25143;&#25480;&#26435;&#32473;&#31532;&#19977;&#26041;&#32593;&#31449;&#65292;&#37027;&#20040;&#65292;SNS&#25480;&#26435;&#26381;&#21153;&#25509;&#25910;&#27492;&#35831;&#27714;&#65292;&#23558;&#29992;&#25143;&#37325;&#23450;&#21521;&#21040;&#31532;&#19977;&#26041;&#32593;&#31449;&#25552;&#20379;&#30340;&#39029;&#38754;&#19978;&#65292;&#24182;&#20256;&#36882;&#34987;&#35748;&#35777;&#20102;&#30340;request token&#12290;&#36825;&#26679;&#31532;&#19977;&#26041;&#32593;&#31449;&#23601;&#21487;&#20197;&#35775;&#38382;SNS&#32593;&#31449;&#30340;&#29992;&#25143;&#20449;&#24687;&#20102;&#12290;

4&#31532;&#19977;&#26041;&#32593;&#31449;&#25509;&#25910;&#21040;&#35748;&#35777;&#30340;request token&#21518;&#65292;&#20877;&#27425;&#21521;SNS&#36134;&#21495;&#26381;&#21153;&#21457;&#36215;&#19968;&#27425;HTTP&#35831;&#27714;&#65292;&#20197;&#25442;&#21462;access token&#12290; SNS &#36134;&#25143;&#25480;&#26435;&#26381;&#21153;&#25509;&#25910;&#35831;&#27714;&#65292;&#39564;&#35777;&#26159;&#21542;&#21512;&#27861;&#12290;&#22914;&#26524;&#21512;&#27861;&#65292;&#21017;&#36820;&#22238;&#19968;&#20010;access token&#12290;

OAuth&#23433;&#20840;&#26426;&#21046;&#26159;&#22914;&#20309;&#23454;&#29616;&#30340;&#65311;

OAuth &#20351;&#29992;&#30340;&#31614;&#21517;&#21152;&#23494;&#26041;&#27861;&#26377; HMAC-SHA1,RSA-SHA1 &#65288;&#21487;&#20197;&#33258;&#23450;&#20041;&#65289;&#12290;&#25343; HMAC-SHA1 &#26469;&#35828;&#21543;&#65292;HMAC-SHA1&#36825;&#31181;&#21152;&#23494;&#30721;&#26041;&#27861;&#65292;&#21487;&#20197;&#20351;&#29992; &#31169;&#38053; &#26469;&#21152;&#23494; &#35201;&#22312;&#32593;&#32476;&#19978;&#20256;&#36755;&#30340;&#25968;&#25454;&#65292;&#32780;&#36825;&#20010;&#31169;&#38053;&#21482;&#26377; Consumer&#21450;&#26381;&#21153;&#25552;&#20379;&#21830;&#30693;&#36947;&#65292;&#35797;&#22270;&#25915;&#20987;&#30340;&#20154;&#21363;&#20351;&#24471;&#21040;&#20256;&#36755;&#22312;&#32593;&#32476;&#19978;&#30340;&#23383;&#31526;&#20018;&#65292;&#27809;&#26377; &#31169;&#38053; &#20063;&#26159;&#30333;&#25645;&#12290;

&#31169;&#38053;&#26159;&#65306;consumer secret&amp;token secret  &#65288;&#21704;&#20004;&#20010;&#23494;&#30721;&#21152;&#19968;&#36215;&#65289;

&#35201;&#21152;&#23494;&#30340;&#23383;&#31526;&#20018;&#26159;&#65306;&#38500; oauth_signature &#22806;&#30340;&#20854;&#23427;&#35201;&#20256;&#36755;&#30340;&#25968;&#25454;&#12290;&#25353;&#21442;&#25968;&#21517;&#23383;&#31526;&#25490;&#21015;&#65292;&#22914;&#26524;&#19968;&#26679;&#65292;&#21017;&#25353; &#20869;&#23481;&#25490;&#12290;&#22914;&#65306;domain=kejibo.com&amp;oauth_consumer_key=XYZ&amp;word=welcome......................

&#21069;&#38754;&#25552;&#30340;&#21152;&#23494;&#37324;&#38754;&#37117;&#26159;&#22266;&#23450;&#30340;&#23383;&#31526;&#20018;&#65292;&#37027;&#20040;&#25915;&#20987;&#32773;&#23682;&#19981;&#26159;&#30452;&#25509;&#21487;&#20197;&#20599;&#21462;&#20351;&#29992;&#21527;&#65311;

&#19981;&#65292;oauth_timestamp&#65292;oauth_nonce&#12290;&#36825;&#20004;&#20010;&#26159;&#21464;&#21270;&#30340;&#12290;&#32780;&#19988;&#26381;&#21153;&#22120;&#20250;&#39564;&#35777;&#19968;&#20010; nonce&#65288;&#28151;&#28102;&#30721;&#65289;&#26159;&#21542;&#24050;&#32463;&#34987;&#20351;&#29992;&#12290;

&#37027;&#20040;&#36825;&#26679;&#25915;&#20987;&#32773;&#23601;&#26080;&#27861;&#33258;&#24050;&#29983;&#25104; &#31614;&#21517;&#65292;&#25110;&#32773;&#20599;&#20320;&#30340;&#31614;&#21517;&#26469;&#20351;&#29992;&#20102;&#12290;

&#21518;&#38754;&#25105;&#20250;&#19987;&#38376;&#20889;&#19968;&#20123;&#20855;&#20307;&#30340;&#20195;&#30721;&#23454;&#29616; &#38024;&#23545; &#26032;&#28010;&#24494;&#21338;

    &#24863;&#35874;&#65306;aoner&#30340;&#20998;&#20139;

</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/101</id>
    <published>2011-03-31T12:44:04+08:00</published>
    <updated>2011-06-22T08:29:28+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/101-how-to-resove-jquery-and-prototype-together"/>
    <title>jquery&#21644;prototype&#20849;&#23384;&#38382;&#39064;&#35299;&#20915;</title>
    <summary>&#23433;&#35013;jquery-rails  gem&#21253;

1: Gemfile&#20013;&#37197;&#32622;    gem "jquery-rails"

2:  &#21629;&#20196;&#34892;&#20013;&#25191;&#34892;:   rails generate jquery:install,&#26377;&#30456;&#21516;&#30340;&#25991;&#20214;&#35206;&#30422;&#25481;

3:  application.html.erb &#20013;&#35843;&#29992; &lt;%= javascript_include_tag :all, :recursive =&gt; true %&gt;

4: &#23436;&#25104;,&#27492;&#26102;jquery&#21644;prototype&#20849;&#23384;&#20102;,&#21704;&#21704;</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/100</id>
    <published>2011-03-26T19:58:05+08:00</published>
    <updated>2011-06-21T21:26:46+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/100-mysql-Access-denied"/>
    <title>rails&#39033;&#30446;mysql&#25298;&#32477;&#30331;&#24405;&#30456;&#20851;&#30340;&#38382;&#39064;</title>
    <summary>&#32593;&#31449;&#31361;&#28982;&#19981;&#33021;&#35775;&#38382;&#65292;nginx&#21644;passenger&#37117;&#27491;&#24120;&#65292;&#39033;&#30446;&#21551;&#21160;&#19981;&#20102;&#65292;&#25240;&#33150;&#20102;&#24456;&#20037;&#65292;&#26368;&#21518;&#25191;&#34892;&#20102;gem udpate --system,&#39033;&#30446;&#21040;&#26159;&#27491;&#24120;&#36215;&#21160;&#65292;mysql&#21364;&#20986;&#29616;&#20102;Access denied for user 'root'@'localhost' (using password:NO),&#38169;&#35823;&#20195;&#30721; 1045&#12290;&#24754;&#21095;&#20063;&#23601;&#24320;&#22987;&#65292;&#25240;&#33150;&#20102;&#19968;&#22825;&#65292;&#25226;mysql&#37117;&#37325;&#35013;&#20102;N&#27425;&#65292;&#26399;&#38388;&#36824;&#25226;&#19968;&#20010;&#32593;&#31449;&#30340;&#25968;&#25454;&#32473;&#24324;&#25481;&#20102;&#12290;

&#24223;&#35805;&#35828;&#20102;&#19968;&#22823;&#22534;&#65292;&#19979;&#38754;&#23601;&#26469;&#35828;&#35828; Access denied for user 'root'@'localhost' (using password:NO)
&#31532;&#19968;&#31181;&#24773;&#20917;&#65292;&#25968;&#25454;&#24211;&#26412;&#36523;&#30340;&#38382;&#39064;&#65292;&#19979;&#38754;&#19977;&#31181;&#26041;&#27861;&#21487;&#20197;&#35299;&#20915;:

&#26041;&#27861;&#19968;&#65306;

    # /etc/init.d/mysql stop
    # mysqld_safe --user=mysql --skip-grant-tables --skip-networking &amp;
    # mysql -u root mysql
    mysql&gt; UPDATE user SET Password=PASSWORD('newpassword') where USER='root';
    mysql&gt; FLUSH PRIVILEGES;
    mysql&gt; quit
    
    # /etc/init.d/mysql restart
    # mysql -uroot -p
    Enter password: &lt;&#36755;&#20837;&#26032;&#35774;&#30340;&#23494;&#30721;newpassword&gt;
    mysql&gt;

&#26041;&#27861;&#20108;&#65306;
&#30452;&#25509;&#20351;&#29992;/etc/mysql/debian.cnf&#25991;&#20214;&#20013;[client]&#33410;&#25552;&#20379;&#30340;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;:

    # mysql -udebian-sys-maint -p
    Enter password: &lt;&#36755;&#20837;[client]&#33410;&#30340;&#23494;&#30721;&gt;
    mysql&gt; UPDATE user SET Password=PASSWORD('newpassword') where USER='root';
    mysql&gt; FLUSH PRIVILEGES;
    mysql&gt; quit
    
    # mysql -uroot -p
    Enter password: &lt;&#36755;&#20837;&#26032;&#35774;&#30340;&#23494;&#30721;newpassword&gt;
    mysql&gt;

&#26041;&#27861;&#19977;&#65306;
&#36825;&#31181;&#26041;&#27861;&#25105;&#27809;&#26377;&#36827;&#34892;&#36807;&#27979;&#35797;&#65292;&#22240;&#20026;&#25105;&#30340;root&#29992;&#25143;&#40664;&#35748;&#23494;&#30721;&#24050;&#32463;&#34987;&#25105;&#20462;&#25913;&#36807;&#20102;&#65292;&#37027;&#20301;&#26377;&#31354;&#27979;&#35797;&#19968;&#19979;&#65292;&#25226;&#32467;&#26524;&#21578;&#35785;&#25105;&#65292;&#35874;&#35874;&#65281;&#65281;

    # mysql -uroot -p
    Enter password: &lt;&#36755;&#20837;/etc/mysql/debian.cnf&#25991;&#20214;&#20013;[client]&#33410;&#25552;&#20379;&#30340;&#23494;&#30721;&gt;

&#32467;&#26524;&#21457;&#29616;&#27599;&#27425;&#25191;&#34892;&#23436;&#21518;&#32593;&#31449;&#33021;&#35775;&#38382;&#65292;&#20351;&#29992;capsum&#37325;&#26032;&#19968;&#21457;&#24067;&#65292;&#21448;&#19981;&#33021;&#35775;&#38382;&#20102;,&#26368;&#21518;&#22810;&#20111;jerry&#30340;&#24110;&#21161;&#65292;&#30830;&#35748;&#19981;&#26159;&#25968;&#25454;&#24211;&#26412;&#36523;&#30340;&#38382;&#39064;&#65292;&#32780;&#26159;&#25191;&#34892;

&#20102;gem udpate -system&#21518;&#65292;YML&#35299;&#26512;&#22120;&#30340;&#38382;&#39064;&#65292;&#19981;&#33021;&#27491;&#30830;&#35299;&#26512;&#39033;&#30446;&#19979;chared/config/database.yml&#65292;&#23548;&#21046;&#25968;&#25454;&#24211;&#32852;&#25509;&#20986;&#29616;&#38382;&#39064;&#12290;
&#35299;&#20915;&#26041;&#27861;&#65306;&#22312;&#39033;&#30446;config&#30446;&#24405;&#37324;&#30340;boot.rb&#21152;&#19978;&#22914;&#19979;&#20195;&#30721;

    # TODO fix yaml error on load
    require 'yaml'
    YAML::ENGINE.yamler= 'syck'</summary>
    <author>
      <name>aoner</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/99</id>
    <published>2011-03-24T14:43:02+08:00</published>
    <updated>2011-06-22T08:02:43+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/99-rails3-user-authorization"/>
    <title>rails3 &#20013;&#26032;&#29992;&#25143;&#27880;&#20876;&#12289;&#26222;&#36890;&#29992;&#25143;&#20462;&#25913;&#36164;&#26009;&#12289;&#31649;&#29702;&#21592;&#31649;&#29702;&#29992;&#25143;&#36164;&#26009; &#26435;&#38480;&#20043;model &#32487;&#25215;&#23454;&#29616;</title>
    <summary>rails3 &#20013;&#26032;&#29992;&#25143;&#27880;&#20876;&#12289;&#26222;&#36890;&#29992;&#25143;&#20462;&#25913;&#36164;&#26009;&#12289;&#31649;&#29702;&#21592;&#31649;&#29702;&#29992;&#25143;&#36164;&#26009; &#26435;&#38480;&#20043;model &#32487;&#25215;&#23454;&#29616;


&#38656;&#27714;&#20998;&#26512;&#65306;

&#19968;&#33324;&#24773;&#20917;&#19979;&#25105;&#20204;User&#34920;&#20013;&#30340;&#22522;&#26412;&#23383;&#27573;&#22914;&#19979;&#65306;

    nickname email_address salt crypted_password is_active is_admin

&#20854;&#20013;salt crypted_password &#20026;model&#20869;&#37096;&#36171;&#20540;&#65292;&#19981;&#23545;&#22806;&#25552;&#20379;&#35775;&#38382;&#26435;&#38480;

&#37027;&#20040;&#36825;&#37324;&#20351;&#29992;&#20102;salt&#21152;&#23494;&#23494;&#30721;&#65292;&#33258;&#28982;&#24471;&#26377;&#20010;&#34394;&#25311;&#23383;&#27573; password 

&#36824;&#26377;&#26222;&#36890;&#29992;&#25143;&#20462;&#25913;&#23494;&#30721;&#26102;&#20063;&#38656;&#35201;&#39564;&#35777;&#21407;&#22987;&#23494;&#30721;&#65292;&#33258;&#28982;&#24471;&#26377;&#20010;&#34394;&#25311;&#23383;&#27573; old_password




&#30446;&#26631;&#65306;

1&#12289;&#26032;&#29992;&#25143;&#27880;&#20876;&#30340;&#26102;&#20505;&#21482;&#33021;&#20462;&#25913; &#26165;&#31216;&#12289;&#23494;&#30721;&#12289;&#37038;&#31665; &#65292;&#21363;&#24471;&#26377; nickname email_address password &#23383;&#27573;&#30340;&#20462;&#25913;&#26435;&#38480;

2&#12289;&#26222;&#36890;&#29992;&#25143;&#20462;&#25913;&#36164;&#26009;&#26102;&#39318;&#20808;&#24471;&#25552;&#20379;&#21407;&#22987;&#23494;&#30721;&#65292;&#37027;&#20040;&#23601;&#24471;&#26377; old_password &#23383;&#27573;&#30340;&#20462;&#25913;&#26435;&#38480;

   &#26222;&#36890;&#29992;&#25143;&#21482;&#33021;&#20462;&#25913;&#37038;&#31665;&#65292;&#37027;&#20040;&#23601;&#24471;&#26377; email_address &#23383;&#27573;&#30340;&#20462;&#25913;&#26435;&#38480;&#65292;&#26032;&#29992;&#25143;&#26412;&#36523;&#24050;&#32463;&#26377;&#36825;&#20010;&#23383;&#27573;&#30340;&#20462;&#25913;&#26435;&#38480;&#65292;&#22266;&#21482;&#38656;&#35201;&#32487;&#25215;&#23601;&#22909;

   &#26222;&#36890;&#29992;&#25143;&#20462;&#25913;&#20462;&#25913;&#23494;&#30721;&#24471;&#39564;&#35777;&#21407;&#22987;&#23494;&#30721;&#65292;&#20462;&#25913;&#23494;&#30721;&#19968;&#33324;&#37117;&#26159;&#21333;&#29420;&#35774;&#32622;&#39029;&#38754;&#65292;&#21333;&#29420; u.password=xx &#36825;&#26679;&#65292;&#25152;&#20197;&#36825;&#37324;&#20063;&#31105;&#27490;&#35775;&#38382; password &#23383;&#27573;

   &#26222;&#36890;&#29992;&#25143;&#19981;&#33021;&#20462;&#25913;&#26165;&#31216;&#65292;&#37027;&#20040;&#23601;&#19981;&#33021;&#26377; nickname &#23383;&#27573;&#30340;&#20462;&#25913;&#26435;&#38480;

3&#12289;&#31649;&#29702;&#21592;&#31649;&#29702;&#29992;&#25143;&#36164;&#26009;&#26102;&#21487;&#27809;&#26377;&#20219;&#20309;&#38480;&#21046;&#65292;&#19988;&#19981;&#38656;&#35201;&#25552;&#20379;&#21407;&#22987;&#23494;&#30721;&#65292;&#24635;&#32467;&#19978;&#38754;&#20004;&#28857;&#21518;&#21457;&#29616;&#65292;&#25105;&#20204;&#22312;&#32487;&#25215;&#26032;&#29992;&#25143;&#21518;&#20877;&#21152;&#19978; is_active is_admin &#36825;&#20004;&#20010;&#23383;&#27573;&#30340;&#35775;&#38382;&#26435;&#38480;&#23601;&#22909;





&#23454;&#29616;&#65306;

&#19968;&#12289;

    [root@vkill-arch ~]# rails -v
    
    Rails 3.0.3
    
    [root@vkill-arch ~]# rails new aaa &amp;&amp; cd aaa
    
    [root@vkill-arch aaa]# rails g model user nickname:string email_address:string salt:string crypted_password:string is_active:boolean is_admin:boolean
    
    [root@vkill-arch aaa]# rake db:migrate

&#25913;&#20010;&#21517;&#23383;&#65292;&#31561;&#29983;&#25104;&#23436;scaffold &#21518;&#20877;&#25913;&#22238;&#26469;

    [root@vkill-arch aaa]# mv db/migrate/20110324130836_create_users.rb db/migrate/20110324130836_create_users.rb_init

&#21152;&#20837;&#34394;&#25311;&#23383;&#27573;&#65292;&#36825;&#26679;&#25152;&#38656;&#35201;&#30340;&#23383;&#27573;&#23601;&#37117;&#40784;&#20102;

    [root@vkill-arch aaa]# cat app/models/user.rb
    
    class User &lt; ActiveRecord::Base
    
      attr_accessor :password, :old_password
    
    end


&#20108;&#12289;

&#29983;&#25104;&#26032;&#29992;&#25143;&#27880;&#20876;&#39029;&#38754;&#65292;&#25552;&#31034;&#20320; Overwrite /root/aaa/app/models/user.rb? (enter "h" for help) [Ynaqdh] &#26102;&#36873;n

&#27880;&#65306;&#21482;&#30041;&#19979; new &#21644; create &#23601;&#21487;&#20197;&#20102;

[root@vkill-arch aaa]# rails g scaffold user nickname:string email_address:string password:string

&#29983;&#25104;&#26222;&#36890;&#29992;&#25143;&#20462;&#25913;&#36164;&#26009;&#30340;&#39029;&#38754;

&#27880;&#65306;&#21482;&#30041;&#19979; edit &#21644; update &#23601;&#21487;&#20197;&#20102;

    [root@vkill-arch aaa]# rails g scaffold profile::user old_password:string nickname:string email_address:string password:string

&#20462;&#25913; admin/profile.rb &#22914;&#19979;&#65292;&#22240;&#20026;&#35201;&#32487;&#25215;User model&#65292;&#24403;&#28982;&#20063;&#35201;&#29992;&#19968;&#20010;&#34920;&#20102;

    [root@vkill-arch aaa]# cat app/models/profile/user.rb

    class Profile::User &lt; User
    
      set_table_name "users"
    
    end

&#29983;&#25104;&#31649;&#29702;&#21592;&#20462;&#25913;&#29992;&#25143;&#36164;&#26009;&#30340;&#39029;&#38754;

    [root@vkill-arch aaa]# rails g scaffold admin::user nickname:string email_address:string password:string is_active:boolean is_admin:boolean

&#20462;&#25913; admin/user.rb &#22914;&#19979;&#65292;&#36947;&#29702;&#21516;&#19978;

    [root@vkill-arch aaa]# cat app/models/admin/user.rb
    
    class Admin::User &lt; User
    
      set_table_name "users"
    
    end

&#25226;scaffold&#29983;&#25104;&#30340;migration&#21024;&#25481;&#65292;&#25226;model&#29983;&#25104;&#30340;migration&#25913;&#21517;&#22238;&#26469;

    [root@vkill-arch aaa]# find db/migrate/ -name '*_users.rb'|xargs rm
    
    [root@vkill-arch aaa]# mv db/migrate/20110324130836_create_users.rb_init db/migrate/20110324130836_create_users.rb

&#19977;&#12289;


&#29616;&#22312;&#24320;&#22987;&#35774;&#32622;&#26435;&#38480;

    [root@vkill-arch aaa]# cat app/models/user.rb
    
    class User &lt; ActiveRecord::Base
    
      attr_accessor :password, :old_password
    
      attr_accessible :nickname, :email_address, :password
    
    end

    [root@vkill-arch aaa]# cat app/models/profile/user.rb
    
    class Profile::User &lt; User
    
      set_table_name "users"
    
      attr_protected :nickname
    
      attr_protected :password #&#36825;&#37324;&#36825;&#26679;&#35774;&#32622;&#26159;&#35201;&#29992;&#25143;&#20462;&#25913;&#23494;&#30721;&#36208;&#21333;&#29420;&#30340;&#20462;&#25913;&#39029;&#38754;&#65292;&#22312;c&#20013;&#30452;&#25509; u=User.find(2);u.password='xx' 
      
      attr_accessible :old_password
    
      #&#36825;&#37324;&#19968;&#23450;&#35201;&#27880;&#24847; attr_protected &#21644; attr_accessible &#30340;&#39034;&#24207;&#65292;&#19981;&#38590;&#39072;&#20498;
    
    end
    
    [root@vkill-arch aaa]# cat app/models/admin/user.rb
    
    class Admin::User &lt; User
    
      attr_accessible :is_valid, :is_admin
    
    end


&#22235;&#12289;
&#27979;&#35797;

    irb(main):002:0&gt; u = User.new({:nickname=&gt;'a',:email_address=&gt;'b',:password=&gt;'123',:is_admin=&gt;true})
    
    =&gt; #
    
    irb(main):003:0&gt; u.save
    
    =&gt; true

&#36825;&#37324;&#21487;&#20197;&#30475;&#21040;&#26032;&#29992;&#25143;&#27880;&#20876;&#30340;&#26102;&#20505; is_admin &#26159;&#27809;&#26377;&#34987;&#25913;&#25104; true &#30340;

    irb(main):019:0&gt; u=Profile::User.find(1)
    
    =&gt; #
    
    irb(main):020:0&gt; u.update_attributes({:nickname=&gt;'aa',:email_address=&gt;'bb',:is_admin=&gt;true})
    
    =&gt; true
    
    irb(main):021:0&gt; u
    
    =&gt; #

&#36825;&#37324;&#21487;&#20197;&#30475;&#21040;&#26222;&#36890;&#29992;&#25143;&#20462;&#25913;email_address&#25104;&#21151;&#65292;&#20294;&#26159;&#20462;&#25913; nickname &#21644; is_admin &#37117;&#19981;&#25104;&#21151;


    irb(main):022:0&gt; u=Admin::User.find(1)
    
    =&gt; #
    
    irb(main):023:0&gt; u.update_attributes({:nickname=&gt;'aaa',:email_address=&gt;'bbb',:is_admin=&gt;true})
    
    =&gt; true
    
    irb(main):024:0&gt; u
    
    =&gt; #

&#36825;&#37324;&#21487;&#20197;&#30475;&#20986;admin&#19981;&#21463;&#38480;&#21046;



&#22909;&#20102;&#65292;&#25910;&#24037;&#65292;&#22522;&#26412;&#19978;model&#30340;&#26435;&#38480;&#32487;&#25215;&#22823;&#27010;&#23601;&#36825;&#26679;&#65292;&#33267;&#20110;controller &#21644; view &#30340;&#19968;&#20123;&#29992;&#19981;&#21040;&#30340;&#37117;&#21487;&#20197;&#21024;&#38500;&#21862;

&#24403;&#28982;&#65292;&#36825;&#26679;&#20570;&#36824;&#26377;&#19968;&#20010;&#24456;&#22823;&#30340;&#22909;&#22788;&#23601;&#26159;&#29983;&#25104;&#30340; c &#21644; v &#37117;&#30452;&#25509;&#21487;&#20197;&#29992;&#65292;&#19981;&#29992;&#20877;&#21435;&#20462;&#25913;&#36335;&#30001;helper

&#25105;&#20204;&#25226;&#20687;salt&#23494;&#30721;&#30340;&#36825;&#20123;&#20102;&#37117;&#21487;&#20197;&#20889;&#20837;&#21040; User &#20013;&#65292;Profile::User &#21644; Admin::User &#23601;&#21487;&#20197;&#20877;&#19981;&#29992;&#20889;&#20219;&#20309;&#19996;&#35199;&#20102;&#65292;&#21482;&#38656;&#35201;&#20889;&#37027;&#20004;&#19977;&#21477;&#26435;&#38480;&#35774;&#32622;&#23601;&#22909;&#20102; 



&#26368;&#21518;&#19968;&#23450;&#35201;&#27880;&#24847;&#65292;&#27492;&#26041;&#27861;&#20165;&#36866;&#29992;&#20110; rails3 &#65292;rails2 &#19981;&#36866;&#29992;&#65292;&#20999;&#24524;
</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/98</id>
    <published>2011-03-23T16:51:46+08:00</published>
    <updated>2011-06-22T01:08:03+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/98-deploying-rails-app-with-only-git"/>
    <title>&#21482;&#29992;Git&#37096;&#32626;rails&#24212;&#29992;</title>
    <summary>&#25105;&#23601;&#20889;&#20010;&#22823;&#27010;&#27493;&#39588;, &#32943;&#23450;&#36824;&#26377;&#19968;&#20123;&#25105;&#27809;&#25552;&#21040;&#30340;&#38382;&#39064;, &#33258;&#24049;&#30740;&#31350;&#19968;&#19979;.

&#24403;&#28982;&#25105;&#36825;&#20010;&#21069;&#25552;&#26159;&#29992;passenger+apache&#25110;nginx, &#20854;&#23427;&#30340;&#36816;&#34892;&#26041;&#24335;&#20272;&#35745;&#21487;&#20197;&#20197;&#27492;&#31867;&#25512;.

&#26381;&#21153;&#22120;&#37027;&#36793;&#24314;&#31435;&#19968;&#20010;&#38656;&#35201;&#36305;rails&#30340;&#30446;&#24405;, &#27604;&#22914;/var/www/blog

    # mkdir /var/www/blog
    # cd /var/www/blog
    # git init .
    # git config capistrano ignore

&#28982;&#21518;&#21019;&#24314;&#19968;&#20010;&#25991;&#20214; /var/www/blog/.git/hooks/post-receive, &#20869;&#23481;&#26159;

    cd ..
    env -i git reset --hard
    env -i rake db:migrate
    touch tmp/restart.txt

&#28982;&#21518;&#36890;&#36807;git&#21644;ssh&#25226;&#26412;&#26426;&#30340;&#20195;&#30721;&#25512;&#36807;&#21435;

    # git origin add deploy ssh://xx.xx.xx.xx/var/www/blog
    # git push deploy refs/heads/master

&#20197;&#21518;&#23601;&#30452;&#25509;&#29992; git push deploy &#23601;&#33021;&#23436;&#25104;&#20195;&#30721;&#19978;&#20256;&#24182;&#37325;&#21551;&#26381;&#21153;

</summary>
    <author>
      <name>danielking</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/97</id>
    <published>2011-03-22T23:20:49+08:00</published>
    <updated>2011-06-22T05:12:15+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/97-metaprogramming-ruby-for-notes"/>
    <title>&#12304;&#35835;&#20070;&#31508;&#35760;&#12305;MetaProgramming Ruby (&#19977;&#65289;</title>
    <summary>**Blocks**

blocks&#26159;&#8220;&#21487;&#35843;&#29992;&#23545;&#35937;(callable object)&#8221;&#22823;&#23478;&#26063;&#20013;&#30340;&#19968;&#21592;&#12290;

3.1  how to handle hump day
      blocks&#22522;&#30784;&#22238;&#39038;
      scopes&#27010;&#36848;&#65292; &#36824;&#26377;&#22914;&#20309;&#20351;&#29992;&#38381;&#21253;
      &#22914;&#20309;&#36890;&#36807;&#32473;instance_eval()&#26469;&#20256;&#32479;&#19968;&#20010;block&#26469;&#26356;&#22810;&#30340;&#25805;&#25511;scopes
      &#22914;&#20309;&#25226;blocks&#36716;&#25442;&#20026;callable object&#65292; &#27604;&#22914;Proc&#21644;lambdas

Back to the Basic

The current block
&#22312;&#19968;&#20010;&#26041;&#27861;&#20869;&#37096;&#65292;&#20320;&#21487;&#20197;&#38382;Ruby&#26159;&#21542;&#24403;&#21069;&#30340;&#35843;&#29992;&#21253;&#21547;&#19968;&#20010;block&#12290;
 

    def a_method
         return yield if block_given?
         'no block'
     end

3.2  Quiz: Ruby #
the using Keyword:
&#22312;c#&#37324;&#65292;using&#20851;&#38190;&#23383;&#20250;&#20570;&#19968;&#20123;&#39069;&#22806;&#30340;&#22788;&#29702;&#65306;

    RemoteConnection conn = new RemoteConnection("some_remote_server" );
    using (conn)
    {
        conn.readSomeData();
        doSomeMoreStuff();
    }

&#19981;&#31649;&#33457;&#25324;&#21495;&#20869;&#30340;&#20195;&#30721;&#26159;&#21542;&#25243;&#20986;&#24322;&#24120;&#65292; using&#20851;&#38190;&#23383;&#37117;&#20250;&#20445;&#35777;&#22312;&#20195;&#30721;&#25191;&#34892;&#20197;&#21518;&#33258;&#21160;&#35843;&#29992;&#19968;&#20010;dispose()&#26041;&#27861;&#26469;&#20851;&#38381;&#36828;&#31243;&#38142;&#25509;&#12290;

Ruby&#29256;&#26412;&#30340;using&#65306;

    def using(resource)
        begin
          yield
        ensure
          resource.dispose
        end
      end

3.3 Ruby&#38381;&#21253;&#65288;Closures&#65289;

    def my_method
       x = "Goodbye"
       yield("cruel")
     end
     &gt; x = "hello"
     #=&gt; "hello" 
     &gt; my_method{|y| "#{x}, #{y} world"}
     #=&gt; "hello, cruel world"

&#19978;&#20363;&#20013;&#65292; block&#20013;&#24341;&#29992;&#30340;x&#21464;&#37327;&#19981;&#26159;&#26041;&#27861;&#37324;&#30340;x&#21464;&#37327;&#65292;&#32780;&#26159;&#20854;&#19978;&#19979;&#25991;&#29615;&#22659;&#20013;&#30340;&#26412;&#22320;&#21464;&#37327;x&#65292; &#25105;&#20204;&#31216;&#20043;&#20026;&#38381;&#21253;&#12290;

P.S  &#36825;&#37324;&#38656;&#35201;&#27880;&#24847;&#19968;&#19979;&#65306;&#22312;Ruby1.8&#25110;&#32773;&#26356;&#26089;&#30340;&#29256;&#26412;&#65292; block&#26377;&#20010;&#38382;&#39064;&#65292;&#23601;&#26159;&#36890;&#36807;&#32473;block&#20256;&#36882;&#21442;&#25968;&#65292;&#20174;&#32780;&#25913;&#21464;&#26412;&#22320;&#21464;&#37327;&#12290;&#36825;&#26679;&#26377;&#26102;&#20505;&#20250;&#23548;&#33268;bug&#65292;&#20363;&#23376;&#65306;
 

    def my_method
         yield(2)
     end
     
     &gt; x = 1    &#65283;=&gt; 1 
      my_method do |x|
          # ...  ... todo 
      end
    
    &gt; x     #=&gt; 2 

&#36825;&#26679;&#65292;&#23601;&#32473;&#25226;&#26412;&#22320;&#21464;&#37327;x&#30340;&#20540;&#65292;&#30001;1&#21464;&#20026;&#20102;2&#65292; &#25152;&#20197;&#36825;&#20010;&#22320;&#26041;&#26159;&#26377;&#38382;&#39064;&#30340;&#12290;
&#24184;&#22909;&#65292; &#22312;Ruby1.9&#37324;&#38754;&#24050;&#32463;&#20462;&#22797;&#20102;&#36825;&#20010;&#38382;&#39064;&#12290;

Scope:
&#20316;&#29992;&#22495;&#12290;
Changing Scope
&#25913;&#21464;&#20316;&#29992;&#22495;

&#20363;&#23376;&#65306;

    v1 = 1
    class MyClass
      v2 = 2
      local_variables # =&gt; [:v2]
      def my_method
        v3 = 3
        local_variables
      end
      local_variables # =&gt; [:v2]
    end
    obj = MyClass.new
    obj.my_method # =&gt; [:v3]
    obj.my_method # =&gt; [:v3]
    local_variables # =&gt; [:v1, :obj]

OK,  &#35299;&#37322;&#36825;&#20010;&#20363;&#23376;&#65306;
&#20687;Java&#25110;&#32773;C#, &#20801;&#35768;&#19968;&#20010;inner scope&#21435;&#30475;&#21040;&#26469;&#33258;&#20110;outer scope&#30340;&#21464;&#37327;&#12290;&#20294;&#26159;&#36825;&#31181;&#24773;&#20917;&#22312;Ruby&#37324;&#26159;&#32477;&#23545;&#19981;&#20250;&#21457;&#29983;&#30340;&#12290;&#19968;&#26086;&#20320;&#24320;&#36767;&#20102;&#26032;&#30340;&#20316;&#29992;&#22495;&#65292;&#21069;&#19968;&#20010;&#20316;&#29992;&#22495;&#20013;&#30340;binding&#25968;&#25454;&#37117;&#20250;&#34987;&#26032;&#30340;&#22495;&#30340;binding&#25968;&#25454;&#31616;&#21333;&#30340;&#35206;&#30422;&#65292;&#36825;&#26159;&#26368;&#37325;&#35201;&#30340;&#19968;&#28857;&#12290;    

Scope Gates
&#23454;&#38469;&#26377;&#19979;&#38754;&#19977;&#20010;&#22320;&#26041;&#26159;scope&#21464;&#25442;&#30340;&#22330;&#26223;&#65306;
Class definitions
Module difinitions
Methods
&#28982;&#21518;&#36825;&#19977;&#20010;&#22320;&#26041;&#37117;&#20250;&#34987;&#20851;&#38190;&#23383;&#26631;&#35760;&#20026;scope&#36793;&#30028;&#65306;class, module, def
&#20182;&#20204;&#30340;&#34892;&#20026;&#20687;&#26497;&#20102;Scope Gates. &#65288;&#20316;&#29992;&#22495;&#24320;&#20851;&#65289;

&#25343;&#19978;&#20010;&#20363;&#23376;&#26469;&#35828;&#65306;

    v1 = 1
    class MyClass # SCOPE GATE: entering class
      v2 = 2
      local_variables # =&gt; ["v2"]
      def my_method # SCOPE GATE: entering def
        v3 = 3
        local_variables
      end # SCOPE GATE: leaving def
      local_variables # =&gt; ["v2"]
    end # SCOPE GATE: leaving class
    obj = MyClass.new
    obj.my_method # =&gt; [:v3]
    obj.my_method # =&gt; [:v3]
    local_variables # =&gt; [:v1, :obj]

&#36825;&#26679;&#23601;&#23481;&#26131;&#29702;&#35299;&#20102;&#65292; &#37027;&#27573;&#20195;&#30721;&#25171;&#24320;&#20102;4&#20010;&#29420;&#31435;&#30340;scope&#65306;

    a&#65292; the top-level scope
    b,   a new scope when it enters MyClass
    c,   one new scope each time it calls my_method() &#65288;&#35843;&#29992;&#20102;2&#27425;&#65292;&#25152;&#20197;&#23601;&#26159;2&#20010;new  scope&#65289;

&#36825;&#37324;&#65292; class ,module &#36319; def &#36824;&#26377;&#28857;&#24494;&#22937;&#30340;&#21306;&#21035;&#12290;   class &#25110;&#32773; module&#30340;&#23450;&#20041;&#26159;&#31435;&#21363;&#34987;&#25191;&#34892;&#30340;&#65292; &#32780;def&#27491;&#22909;&#30456;&#21453;&#65292;&#24403;&#20320;&#35843;&#29992;&#36825;&#20010;&#26041;&#27861;&#30340;&#26102;&#20505;&#25165;&#20250;&#34987;&#25191;&#34892;&#12290;

&#25554;&#25773;&#65306; Global Variables and Top-level Instance Variables
Global Variables&#21487;&#20197;&#35775;&#38382;&#20219;&#20309;scope&#12290;


    def a_scope
      $var = "some value"
    end
    def another_scope
      $var
    end
    a_scope  #=&gt;  "some value" 
    another_scope  #=&gt;  "some value" 

&#20840;&#23616;&#21464;&#37327;&#30340;&#38382;&#39064;&#26159;&#65306;&#31995;&#32479;&#30340;&#20219;&#20309;&#22320;&#26041;&#37117;&#21487;&#20197;&#25913;&#21464;&#23427;&#65292; &#25152;&#20197;&#24403;&#25105;&#20204;&#36319;&#36394;&#23427;&#30340;&#25913;&#21464;&#23601;&#21464;&#24471;&#21313;&#20998;&#22256;&#38590;&#12290;&#25152;&#20197;&#26222;&#36941;&#30340;&#35268;&#21017;&#26159;&#65306; &#35880;&#24910;&#30340;&#20351;&#29992;&#23427;&#65292; &#33021;&#19981;&#29992;&#23601;&#19981;&#29992;&#12290;

&#26377;&#26102;&#20320;&#21487;&#20197;&#29992;&#19968;&#20010;&#39030;&#32423;&#30340;&#23454;&#20363;&#21464;&#37327;&#26469;&#20195;&#26367;&#20840;&#23616;&#21464;&#37327;&#65306;


    @var = "The top-level @var"
    def my_method
      @var
    end
    my_method # =&gt; "The top-level @var"

Flattening the scope
&#24403;&#20320;&#36234;&#31934;&#36890;Ruby&#65292;&#20320;&#23601;&#20250;&#35273;&#24471;&#24819;&#36890;&#36807;scope gate&#20256;&#36882;&#32465;&#23450;&#25968;&#25454;&#36234;&#21457;&#22256;&#38590; &#65292; &#20879;&#65281;


    my_var = "Success"
    class MyClass
      # We want to print my_var here...
      def my_method
        # ..and here
      end
    end

&#38382;&#39064;&#65306; &#20320;&#24590;&#20040;&#26679;&#33021;&#25226;my_var&#21464;&#37327;&#20256;&#36882;&#21040;class&#37324;&#65311;
&#35299;&#20915;&#26041;&#26696;&#65306;


    my_var = "Success"
    MyClass = Class.new do
      # Now we can print my_var here...
      puts "#{my_var} in the class definition!"
      def my_method
        # ...but how can we print it here?
      end
    end
    MyClass.new.my_method

&#25105;&#20204;&#20351;&#29992;&#20102;block&#30340;&#38381;&#21253;&#65292;&#24039;&#22937;&#30340;&#23454;&#29616;&#20102;flattening scope&#12290;

Sharing the scope
&#26377;&#26102;&#20505;&#25105;&#20204;&#21487;&#33021;&#38656;&#35201;&#35753;&#26576;&#20123;&#26041;&#27861;&#20849;&#29992;&#19968;&#20010;&#26412;&#22320;&#21464;&#37327;&#65292;&#32780;&#19981;&#35753;&#20854;&#20182;&#26041;&#27861;&#20351;&#29992;&#65292;&#37027;&#20040;&#25105;&#20204;&#21487;&#20197;&#36825;&#20040;&#20570;&#65306;


   def define_methods
      shared = 0
      Kernel.send :define_method, :counter do
        shared
      end
    
      Kernel.send :define_method, :inc do |x|
        shared += x
      end
    end
    
    define_methods
    
    counter # =&gt; 0
    inc(4)
    counter # =&gt; 4

&#36825;&#26679;&#65292; &#22312;scope gate&#30340;&#20445;&#25252;&#19979;&#65292; &#20854;&#20182;&#26041;&#27861;&#26159;&#32943;&#23450;&#26080;&#27861;&#35775;&#38382;&#26412;&#22320;&#21464;&#37327;shared&#30340;&#12290;

3.4  instance_eval()

instance_eval()&#21644;class_eval()&#24120;&#24120;&#35753;&#24456;&#22810;&#20154;&#20135;&#29983;&#35823;&#35299;&#65306;

instance_eval()&#26041;&#27861;&#20570;&#20102;&#19979;&#38754;3&#20214;&#20107;&#24773;&#65306;
a&#65292;&#25913;&#21464;self&#20026;instance_eval&#30340;&#25509;&#25910;&#22120;
b&#65292;&#25913;&#21464;&#40664;&#35748;&#30340;definee&#32473;&#25509;&#25910;&#22120;&#30340;eigenclass&#65292;&#22914;&#26524;&#27809;&#26377;&#65292;&#21017;&#21019;&#24314;&#23427;&#12290;
c&#65292; &#25191;&#34892;block&#30340;&#20869;&#23481;&#12290;
class_eval and instance_eval &#21306;&#21035;
 

                                   self                  default definee 
    class_eval         the receiver         the receiver 
    instance_eval   the receiver          eigenclass of the receiver

&#20027;&#35201;&#26159;&#35201;&#27880;&#24847;&#26041;&#27861;&#25509;&#25910;&#22120;&#65281;&#65281;&#65281;

instance_exec()
&#36825;&#20010;&#26041;&#27861;&#26159;Ruby1.9&#24341;&#20837;&#30340;&#65292;&#34892;&#20026;&#21644;instance_eval()&#24046;&#19981;&#22810;&#65292;&#20294;&#26159;&#23427;&#20801;&#35768;&#20320;&#20256;&#20837;&#19968;&#20010;&#21442;&#25968;&#65292;&#20363;&#65306;

    class C
      def initialize
        @x, @y = 1, 2
      end
    end
    C.new.instance_exec(3) {|arg| (@x + @y) * arg } # =&gt; 9

Breaking Encapsulation
instance_eval&#36825;&#31181;&#29305;&#24615;&#24456;&#24656;&#24598;&#65292; &#22312;&#23427;&#30340;&#30524;&#30382;&#23376;&#24213;&#19979;&#65292;&#26681;&#26412;&#27809;&#26377;&#38544;&#31169;&#21487;&#35328;&#12290;

The Rspec Example:

Clean Rooms:

    class CleanRoom
      def complex_calculation
        # ...
      end
    
      def do_something
        # ...
      end
    end
    
    clean_room = CleanRoom.new
    clean_room.instance_eval do
      if complex_calculation &gt; 10
        do_something
      end
    end

&#26377;&#26102;&#20505;&#20320;&#38656;&#35201;&#21019;&#24314;&#19968;&#20010;&#23545;&#35937;&#65292; &#21482;&#26159;&#22312;block&#37324;&#25191;&#34892;&#19968;&#20123;&#26041;&#27861;&#12290;&#37027;&#20040;&#23601;&#20445;&#25345;&#19968;&#20010;&#24178;&#20928;&#30340;&#25151;&#38388;&#65292; &#25112;&#26007;&#22330;&#23601;&#22312;block&#37324;&#21543;&#12290;

3.5 Callabel Objects
&#22312;Ruby&#37324;&#65292; &#20320;&#33267;&#23569;&#26377;3&#20010;&#22320;&#26041;&#21487;&#20197;&#25171;&#21253;&#20195;&#30721;&#65306;
 Proc
 Lambda
 Method

Proc Objects
&#34429;&#28982;&#35828;&#65292;Ruby&#19968;&#20999;&#30342;&#23545;&#35937;&#65292;&#20294;blocks&#19981;&#26159;&#23545;&#35937;&#12290;&#20294;&#26159;&#20026;&#20102;&#23454;&#29616;&#25226;&#20195;&#30721;&#25171;&#21253;&#65292; &#31561;&#38656;&#35201;&#30340;&#26102;&#20505;&#20877;&#35843;&#29992;&#30340;&#30446;&#30340;&#65288;&#36825;&#20010;&#25216;&#26415;&#21483;&#20570;Deferred evaluation,&#24310;&#36831;&#27714;&#20540;&#65289;&#65292;&#25105;&#20204;&#38656;&#35201;&#19968;&#20010;&#23545;&#35937;&#12290;&#36825;&#26679;&#23601;&#20986;&#29616;&#20102;Proc&#31867;&#12290;
&#19968;&#20010;Proc&#26159;&#36716;&#25442;&#20026;&#23545;&#35937;&#30340;block&#12290;

Ruby&#25552;&#20379;&#20102;3&#31181;&#26041;&#27861;&#21435;&#25226;block&#36716;&#25442;&#25104;Proc&#23545;&#35937;&#12290;
    lambda()&#21644;proc(), Proc.new()

The &amp; Operator
&amp;&#25805;&#20316;&#31526;

    def math(a, b)
      yield(a, b)
    end
    def teach_math(a, b, &amp;operation)
      puts "Let's do the math:"
      puts math(a, b, &amp;operation)
    end



    teach_math(2, 3) {|x, y| x * y}
    # =&gt; Let's do the math:
    # =&gt; 6

&#20320;&#21487;&#20197;&#36890;&#36807;&amp;&#25805;&#20316;&#31526;&#26469;&#36716;&#25442;block&#20026;&#19968;&#20010;Proc&#23545;&#35937;&#12290;


    def my_method(&amp;the_proc)
      the_proc
    end
    p = my_method {|name| "Hello, #{name}!" }
    puts p.class  # =&gt; Proc
    puts p.call("Bill" )  #=&gt; Hello, Bill

&#29616;&#22312;&#30693;&#36947;&#22909;&#22810;block&#36716;Proc&#30340;&#26041;&#27861;&#65292;&#20294;&#26159;&#20320;&#24590;&#20040;&#36716;&#22238;&#21435;&#21602;&#65311;


    def my_method(greeting)
      puts "#{greeting}, #{yield}!"
    end
    my_proc = proc { "Bill" }
    my_method("Hello" , &amp;my_proc)

&#24403;&#20320;&#22312;my_method&#26041;&#27861;&#37324;&#20351;&#29992;&amp;&#25805;&#20316;&#31526;&#30340;&#26102;&#20505;&#65292;&#23601;&#20250;&#25226;my_proc&#36825;&#20010;Proc&#36716;&#22238;&#21435;block&#12290;

The HighLine Example:
ruby gem highline

Proc vs. Lambdas
&#25554;&#25773;&#65306;Ruby1.9&#24341;&#20837;&#19968;&#20010;&#26041;&#27861;&#65306;Proc#lambda?()  &#29992;&#26469;&#21028;&#26029;&#19968;&#20010;Proc&#26159;&#21542;&#26159;lambda&#12290;

&#21306;&#21035;&#19968;&#65306;
return&#65306;
lambda&#37324;&#38754;&#30340;return&#20250;&#34987;&#21163;&#25345;&#65292;&#20063;&#23601;&#26159;&#35828;&#65292; &#22312;lambda&#37324;&#30340;return&#21482;&#26159;return&#20986;lambda&#65288;&#22240;&#20026;lambda&#30340;&#34892;&#20026;&#20284;&#26041;&#27861;&#65289;&#12290;&#32780;Proc&#21017;&#26159;return&#20986;&#26041;&#27861;&#22806;&#12290;

&#21306;&#21035;&#20108;&#65306;
&#21442;&#25968;&#65306;
 p = Proc.new {|a, b| [a, b]}
 p.arity   #=&gt; 2

lambda&#20250;&#26816;&#26597;&#21442;&#25968;&#20010;&#25968;&#20197;&#21450;&#31867;&#22411;
Proc&#21017;&#19981;&#20250;&#26816;&#26597;&#21442;&#25968;&#20010;&#25968;&#65292;&#20294;&#20250;&#26816;&#26597;&#21442;&#25968;&#31867;&#22411;&#12290;

Kernel#proc
callable = proc { return }
callable.call  #=&gt; fails in Ruby1.9

&#22312;Ruby1.8&#37324;Kernel#proc()&#26041;&#27861;&#21482;&#26159;lambda&#30340;&#19968;&#20010;&#21035;&#21517;&#12290;
&#32780;&#22312;Ruby1.9&#37324;&#65292; Kernel#proc()&#21464;&#25104;&#20102;Proc.new&#30340;&#21035;&#21517;&#12290;
&#25152;&#20197;&#36825;&#20010;&#22320;&#26041;&#20351;&#29992;&#35201;&#21306;&#21035;&#24320;Ruby&#30340;&#29256;&#26412;&#12290;

&#36825;&#20010;&#22320;&#26041;&#30495;&#30340;&#26159;&#20081;&#19971;&#20843;&#31967;&#30340;&#12290;

Methods Revisited
&#26368;&#21518;&#19968;&#20010;callable objects&#23478;&#26063;&#25104;&#21592; &#65306; methods


    class MyClass
      def initialize(value)
        @x = value
      end
      def my_method
        @x
      end
    end

object = MyClass.new(1)
m = object.method :my_method #=&gt; m&#26159;&#20010;&#26041;&#27861;&#23545;&#35937;&#65306;#
m.call # =&gt; 1

methods&#21644;lambda&#26377;&#28857;&#30456;&#20284;&#65292;&#20294;&#26159;&#19981;&#21516;&#30340;&#26159;&#65292; lambda&#26159;&#20010;&#38381;&#21253;&#65292;&#20316;&#29992;&#22495;&#22312;&#23450;&#20041;&#23427;&#30340;&#26102;&#20505;&#19978;&#19979;&#25991;&#65292; &#32780;methods&#30340;&#20316;&#29992;&#22495;&#26159;&#22312;&#23427;&#30340;&#23545;&#35937;&#20013;&#12290;
&#20320;&#20063;&#21487;&#20197;&#29992;Method#unbind()&#20174;&#23545;&#35937;&#37324;&#20998;&#31163;&#19968;&#20010;&#26041;&#27861;&#20986;&#26469;&#65292;&#28982;&#21518;&#25226;&#23427;&#32465;&#23450;&#32473;&#21478;&#19968;&#20010;&#23545;&#35937;:
unbound = m.unbind
another_object = MyClass.new(2)
m = unbound.bind(another_object)
m.call # =&gt; 2

&#20320;&#20063;&#21487;&#20197;&#20351;&#29992;Method#to_proc&#36716;&#25442;&#19968;&#20010;&#26041;&#27861;&#23545;&#35937;&#20026;&#19968;&#20010;Proc&#23545;&#35937;&#65292;&#24182;&#19988;&#20320;&#21487;&#20197;&#29992;define_method()&#36716;&#25442;&#19968;&#20010;block&#20026;&#19968;&#20010;method&#12290;


3.6  Writing  a Domain-Specific Language

Your First DSL
&#35265;first_dsl.rb

</summary>
    <author>
      <name>blackanger</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/96</id>
    <published>2011-03-22T23:13:06+08:00</published>
    <updated>2011-06-21T20:48:39+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/96-metaprogramming-ruby-for-notes"/>
    <title>&#12304;&#35835;&#20070;&#31508;&#35760;&#12305;MetaProgramming Ruby (&#20108;&#65289;</title>
    <summary>**Methods**

2.1  A Duplication Problem

Dynamic Methods
&#20351;&#29992;&#21160;&#24577;&#26041;&#27861;&#26469;&#28040;&#38500;&#37325;&#22797;&#20195;&#30721;&#12290;

Calling Methods Dynamically
    &#20320;&#21487;&#20197;&#20351;&#29992;&#19968;&#20010;&#28857;&#26469;&#35843;&#29992;&#26041;&#27861;&#12290; &#27604;&#22914;&#65306;
   

     obj.my_method(my_arg) 
    &#20063;&#21487;&#20197;&#20351;&#29992;send(:my_method, my_arg)&#26469;&#35843;&#29992;&#12290;
&#20294;&#26159;&#65292;&#20026;&#20160;&#20040;&#25105;&#20204;&#35201;&#29992;send&#26469;&#20195;&#26367;&#8216;.&#8217;&#21602;&#65311;  &#36825;&#23454;&#38469;&#19978;&#26159;Ruby&#38750;&#24120;&#37239;&#30340;&#19968;&#28857;&#65306;
&#20351;&#29992;send()&#26041;&#27861;&#30340;&#25216;&#26415;&#34987;&#21483;&#20570; &#8220;Dynamic Dispatch&#8221;&#65292; &#19979;&#38754;&#26159;&#20010;&#20363;&#23376;&#65306;

Camping Example:
Camping(http://www.ruby-camping.com/)&#26159;&#19968;&#20010;Ruby&#20889;&#30340;&#36824;&#19981;&#21040;4k&#22823;&#23567;&#30340;&#24494;&#22411;&#26694;&#26550;&#12290;MVC&#21487;&#25918;&#22312;&#21516;&#19968;&#25991;&#20214;&#20013;&#12290;

Camping&#30340;&#37197;&#32622;&#25991;&#20214;&#26159;&#29992;YAML&#26469;&#20889;&#30340;&#65292;&#20363;&#22914;&#65306;

conf.admin = &#8216;Bill&#8217;
conf.title = &#8220;RubyLand&#8221;
conf.topic = &#8220;Ruby and More&#8221;

&#20687;&#20197;&#19978;&#30340;&#20195;&#30721;&#65292; Camping&#21482;&#33021;&#36890;&#36807;&#35835;&#21462;Yaml&#25991;&#20214;&#26469;&#21160;&#24577;&#30340;&#35843;&#29992;&#36825;&#20123;&#26041;&#27861;&#65306;

#load configuration if any
if conf.rc and File.exists?( conf.rc )
  YAML.load_file(conf.rc).each do |k, v|
      conf.send(&#8220;#{k}=&#8221;,  v)
   end
end

The Test::Unit Example
&#21478;&#19968;&#20010;&#20363;&#23376;&#65292;&#20294;&#26159;Test::Unit&#22871;&#20214;&#37324;&#29992;&#30340;&#26159;send&#30340;&#21516;&#20041;&#26041;&#27861;&#65306;__send__()

P.S&#65306; send()&#26041;&#27861;&#21487;&#20197;&#35843;&#29992;&#20219;&#20309;&#26041;&#27861;&#65292; &#24847;&#21619;&#30528;&#23545;&#35937;&#30340;&#31169;&#26377;&#26041;&#27861;&#20063;&#21487;&#20197;&#36890;&#36807;send&#34987;&#35843;&#29992;&#65292; &#22312;Ruby1.9&#37324;&#65292; send&#26041;&#27861;&#20063;&#21487;&#20197;&#35843;&#29992;&#31169;&#26377;&#26041;&#27861;&#65292;&#20294;&#26159;&#22909;&#20687;&#26159;&#19987;&#38376;&#20026;&#20102;&#36825;&#19968;&#30446;&#30340;&#65292; &#25442;&#21477;&#35805;&#35828;&#65292; &#20320;&#20250;&#26377;&#19968;&#20010;&#26032;&#30340;&#26041;&#27861;public_send()&#26041;&#27861;&#26469;&#35843;&#29992;public&#26041;&#27861;&#12290;

Defining Methods Dynamically
&#25105;&#20204;&#36824;&#21487;&#20197;&#23450;&#20041;&#21160;&#24577;&#26041;&#27861;&#12290;

&#20320;&#21487;&#20197;&#36890;&#36807;Module#define_method()&#26469;&#21160;&#24577;&#23450;&#20041;&#26041;&#27861;&#12290;&#20363;&#22914;&#65306;

    class MyClass
       define_method :my_method do |my_arg|
           my_arg * 3
       end
    end
    
    obj = MyClass.new
    obj.my_method(2) #=&gt; 6


step 1   &#20351;&#29992;send()&#26041;&#27861;



    class Computer
    def initialize(computer_id, data_source)
    @id = computer_id
    @data_source = data_source
    end
    def mouse
    component :mouse
    end
    def cpu
    component :cpu
    end
    def keyboard
    component :keyboard
    end
    def component(name)
    info = @data_source.send "get_#{name}_info" , @id
    price = @data_source.send "get_#{name}_price" , @id
    result = "#{name.to_s.capitalize}: #{info} ($#{price})"
    return "* #{result}" if price &gt;= 100
    result
    end
    end


step   &#21160;&#24577;&#29983;&#25104;&#26041;&#27861;&#65306;


    class Computer
    def initialize(computer_id, data_source)
    @id = computer_id
    @data_source = data_source
    end
    def self.define_component(name)
    define_method(name) {
    info = @data_source.send "get_#{name}_info" , @id
    price = @data_source.send "get_#{name}_price" , @id
    result = "#{name.to_s.capitalize}: #{info} ($#{price})"
    return "* #{result}" if price &gt;= 100
    result
    }
    end
    define_component :mouse
    define_component :cpu
    define_component :keyboard
    end

   
Step 3 :  Sprinkling the code with Introspection
&#20351;&#29992;&#20869;&#30465;&#26426;&#21046;&#20943;&#23569;&#20195;&#30721;&#65306;


    class Computer
    def initialize(computer_id, data_source)
    @id = computer_id
    @data_source = data_source
    data_source.methods.grep(/^get_(.*)_info$/) { Computer.define_component $1 }
    end
    
    def self.define_component(name)
    define_method(name) {
    info = @data_source.send "get_#{name}_info" , @id
    price = @data_source.send "get_#{name}_price" , @id
    result = "#{name.capitalize}: #{info} ($#{price})"
    return "* #{result}" if price &gt;= 100
    result
    }
    end
    end

&#19978;&#38754;initialize&#26041;&#27861;&#20869;&#32418;&#33394;&#30340;&#19968;&#34892;&#65292;&#23601;&#26159;&#39764;&#26415;&#21457;&#29983;&#30340;&#22320;&#26041;&#12290;&#20026;&#20102;&#29702;&#35299;&#23427;&#65292;&#20320;&#38656;&#35201;&#30693;&#36947;&#19968;&#20123;&#19996;&#19996;&#65306;&#39318;&#20808;&#65292; &#22914;&#26524;&#20320;&#32473;String#grep()&#26041;&#27861;&#20256;&#36882;&#19968;&#20010;block,  &#36825;&#20010;block&#26159;&#21305;&#37197;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#12290; &#31532;&#20108;&#65292; &#36825;&#20010;&#27491;&#21017;&#25324;&#21495;&#37324;&#34987;&#21305;&#37197;&#30340;&#37096;&#20998;&#20445;&#23384;&#22312;&#19968;&#20010;&#20840;&#23616;&#21464;&#37327;&#37324;$1&#12290;


2.3  method_missing()
&#22240;&#20026;Ruby&#26159;&#21160;&#24577;&#35821;&#35328;&#65292; &#27809;&#26377;&#32534;&#35793;&#22120;&#65292;&#36825;&#23601;&#24847;&#21619;&#30528;&#20320;&#21487;&#20197;&#35843;&#29992;&#19981;&#23384;&#22312;&#30340;&#26041;&#27861;&#12290;
Kernel#method_missing()&#26159;&#34987;&#27599;&#20010;&#23545;&#35937;&#32487;&#25215;&#20102;&#30340;&#12290;

Overriding method_missing()
&#36890;&#36807;&#37325;&#20889;method_missing()&#26041;&#27861;&#20801;&#35768;&#20320;&#35843;&#29992;&#19968;&#20010;&#24182;&#19981;&#23384;&#22312;&#30340;&#26041;&#27861;&#12290;

Ghost Method
&#24189;&#28789;&#26041;&#27861;&#65306;

&#20363;&#23376;&#65306;The Ruport Example
&#20107;&#23454;&#19978;Ruport&#37324;&#38754;&#30340;to_csv&#26041;&#27861;&#21644;rows_with_conuntry()&#37117;&#26159;&#24189;&#28789;&#26041;&#27861;&#65306;

    Class Table
        def method_missing(id, *args, &amp;block)
            return as($1.to_sym,*args,&amp;block) if id.to_s =~ /^to_(.*)/
            return rows_with($1.to_sym =&gt; args[0]) if id.to_s =~ /^rows_with_(.*)/
            super
         end

&#24403;&#20320;&#35843;&#29992;rows_with_conuntry()&#26041;&#27861;&#30340;&#26102;&#20505;&#65292;&#23454;&#38469;&#19978;&#26159;&#35843;&#29992;&#65306;rows_with(:country)&#12290;
&#24403;&#35843;&#29992;to_csv()&#30340;&#26102;&#20505;&#65292; &#26159;&#35843;&#29992;&#65306;as(:csv)
&#24403;&#35843;&#29992;&#30340;&#26041;&#27861;&#19981;&#26159;&#19978;&#38754;&#36825;2&#31181;&#26684;&#24335;&#30340;&#26102;&#20505;&#65292;&#23601;&#20250;&#25253;&#20986;NoMethod&#38169;&#35823;&#65292;&#36825;&#20063;&#23601;&#26159;super&#30340;&#20316;&#29992;&#12290;

&#20877;&#30475;&#19968;&#20010;&#20363;&#23376;&#65306;
The OpenStruct Example:
OpenStruct&#26159;Ruby&#30340;&#26631;&#20934;&#24211;&#12290;

 

    require 'ostruct'
     icecream = OpenStruct.new
     =&gt; # 
     &gt; icecream.flavor = "strawberry"
     =&gt; "strawberry" 
     &gt; icecream.flavor
     =&gt; "strawberry"
    
    &#36825;&#37324;&#30340;flavor&#23646;&#24615;&#23454;&#38469;&#19978;&#26159;&#24189;&#28789;&#26041;&#27861;&#65306;
     class MyOpenStruct
        def initialize
            @attributes = {}
        end
        def method_missing(name, *args)
            attribute = name.to_s
            if attribute =~ /=$/
              @attributes[attribute.chop] = args[0]
            else
               @attributes[attribute]
            end
          end
    end
       
    &gt; icecream = MyOpenStruct.new
       =&gt; # 
     &gt; icecream.flavor = "vanilla"
     =&gt; "vanilla"  

p.s. attribute.chop  chop&#26041;&#27861;&#21435;&#25481; icecream.flavor = &#30340;&#31561;&#21495;&#12290;


Dynamic Proxies
&#21160;&#24577;&#20195;&#29702;&#65306;
&#25226;&#19968;&#20010;&#23545;&#35937;&#30340;&#24189;&#28789;&#26041;&#27861;&#22312;&#21478;&#19968;&#20010;&#23545;&#35937;&#20013;&#20351;&#29992;&#65292;&#24182;&#19988;&#21487;&#33021;&#36827;&#34892;&#19968;&#20123;&#21253;&#35013;&#65292;&#31216;&#20043;&#20026;&#21160;&#24577;&#20195;&#29702;&#12290;

&#20877;&#27425;&#37325;&#26500;Computer Class:


    class Computer
       def initialize(computer_id, data_source)
         @id = computer_id
         @data_source = data_source
         end
       def method_missing(name, *args)
         super if !@data_source.respond_to?("get_#{name}_info" )
         info = @data_source.send("get_#{name}_info" , args[0])
         price = @data_source.send("get_#{name}_price" , args[0])
         result = "#{name.to_s.capitalize}: #{info} ($#{price})"
         return "* #{result}" if price &gt;= 100
         result
         end
       end

&#38500;&#20102;method_missing , &#25105;&#20204;&#36824;&#21487;&#20197;&#23450;&#20041; const_missing&#65292;&#30475;&#20363;&#23376;&#65306;
def Object.const_missing(name)
   name.to_s.downcase.gsub(/_/, ' ' )
   end
 =&gt; nil 
 &gt; TEST
 =&gt; "test"

2.5 More method_missing()

when methods clash
&#24403;&#26041;&#27861;&#20914;&#31361;&#30340;&#26102;&#20505;


    class Computer
       instance_methods.each do |m|
         undef_method m unless m.to_s =~ /^__|method_missing|respond_to?/
       end

&#24635;&#32467;&#65306;
&#24189;&#28789;&#26041;&#27861;&#30340;&#24615;&#33021;&#19981;&#26159;&#24456;&#39640;&#12290;
</summary>
    <author>
      <name>blackanger</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/95</id>
    <published>2011-03-21T22:52:01+08:00</published>
    <updated>2011-06-22T08:57:10+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/95-remove-default-form-validation-css"/>
    <title>&#21435;&#25481;form_for&#30340;&#25253;&#38169;&#32465;&#23450;&#23646;&#24615;&#21151;&#33021;</title>
    <summary>&#21435;&#25481;form_for&#30340;&#25253;&#38169;&#32465;&#23450;&#23646;&#24615;&#21151;&#33021;&#65292;&#22312;config&#30340;initializers&#19979;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;&#65306;

    ActionView::Base.field_error_proc = Proc.new{|html_tag, instance|
      #"
      html_tag
    }

</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/94</id>
    <published>2011-03-21T22:07:09+08:00</published>
    <updated>2011-06-22T02:49:37+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/94-metaprogramming-ruby-for-notes"/>
    <title>&#12304;&#35835;&#20070;&#31508;&#35760;&#12305;MetaProgramming Ruby (&#19968;&#65289;</title>
    <summary>Ruby&#20803;&#32534;&#31243;
1.1  Monday with Bill
1.2  Open Classes
     

     class String
     def to_alphanumeric
       gsub /[^\w\s]/, ''
     end
   end

    &#34429;&#28982;Ruby&#30340;&#31867;&#26159;&#24320;&#25918;&#30340;&#65292;&#20294;&#26159;&#31867;&#20284;&#20110;&#20197;&#19978;&#20195;&#30721;&#36825;&#31181;&#20570;&#27861;&#65292;&#20540;&#24471;&#32771;&#37327;&#65281;


    The Money Example:
    class Numeric
     def to_money
       Money.new(self * 100)
     end
   end

  Ruby&#26631;&#20934;&#24211;&#37324;&#26377;&#22909;&#22810;&#26041;&#27861;&#26159;&#25171;&#24320;class&#26469;&#28155;&#21152;&#26041;&#27861;&#30340;&#12290;

The Problem with Open Classes&#65306;
open classes&#30340;&#38452;&#26263;&#38754;&#65306; &#21487;&#33021;&#20250;&#32473;&#31867;&#24341;&#20837;bug&#65292;&#27604;&#22914;&#37325;&#20889;&#20102;&#31867;&#24050;&#32463;&#26377;&#30340;&#21516;&#21517;&#26041;&#27861;&#12290;
&#20851;&#20110;Monkeypatches&#36824;&#26377;&#26356;&#22810;&#30340;&#26041;&#27861;&#12290;

1.3   The Truth About Classes
 Ruby&#31867;&#32972;&#21518;&#30340;&#29702;&#35770;&#65306;
 What&#8217;s in a Object:
&#23454;&#20363;&#26041;&#27861;&#20445;&#25345;&#22312;&#23545;&#35937;&#30340;&#31867;&#37324;&#65292;&#32780;&#23454;&#20363;&#21464;&#37327;&#21017;&#30001;&#23545;&#35937;&#33258;&#24049;&#20445;&#25345;&#12290;&#36825;&#23601;&#26159;&#20026;&#20160;&#20040;&#30456;&#21516;&#31867;&#30340;&#23545;&#35937;&#20849;&#20139;&#23454;&#20363;&#26041;&#27861;&#32780;&#19981;&#20849;&#20139;&#23454;&#20363;&#21464;&#37327;&#30340;&#21407;&#22240;&#12290;

String.instance_methods == "abc".methods # =&gt; true
    String.methods == "abc".methods # =&gt; false

Classes Revisited
&#22240;&#20026;&#19968;&#20010;&#31867;&#20063;&#26159;&#19968;&#20010;&#23545;&#35937;&#65292;&#25152;&#20197;&#19968;&#20999;&#36866;&#29992;&#20110;&#23545;&#35937;&#30340;&#20063;&#36866;&#29992;&#20110;&#31867;&#12290; Classes&#65292;&#20687;&#20854;&#20182;&#20219;&#20309;&#23545;&#35937;&#19968;&#26679;&#20063;&#26377;&#33258;&#24049;&#30340;&#31867;&#12290;

    String.class    #= &gt;  Class

&#20687;&#19968;&#20999;&#20219;&#20309;&#20854;&#20182;&#23545;&#35937;&#65292; classes&#20063;&#26377;&#26041;&#27861;&#65292; &#31867;&#30340;&#26041;&#27861;&#20063;&#26159;&#23427;&#30340;&#31867;&#30340;&#23454;&#20363;&#26041;&#27861;&#12290;
&#36825;&#23601;&#24847;&#21619;&#30528;&#19968;&#20010;&#31867;&#30340;&#26041;&#27861;&#65292;&#20063;&#23601;&#26159;Class&#31867;&#30340;&#23454;&#20363;&#26041;&#27861;&#12290;


1. 4   

     &gt; Object.class
     =&gt; Class 
     &gt; Class.superclass
     =&gt; Module 
     &gt; Module.superclass
     =&gt; Object 
     &gt; Object.superclass
     =&gt; nil 

Object. Module, Class&#37117;&#26159;Class&#30340;&#23454;&#20363;&#23545;&#35937;&#12290;
&#32780;&#65292; Class&#30340;&#29238;&#31867;&#26159;Module,  Module&#30340;&#29238;&#31867;&#26159;Object.

     &gt; Class.class.superclass.class
     =&gt; Class 

Class&#26159;&#33258;&#24049;&#30340;&#23454;&#20363;&#12290;
Module, Object&#37117;&#26159;Class&#30340;&#23454;&#20363;&#65292; Class&#30340;&#36229;&#31867;&#21448;&#26159;Module, Object.  ???


	&#8226;	Class&#32487;&#25215;&#33258;Object
	&#8226;	Object&#30340;class&#26159;Class
	&#8226;	Class&#30340;class&#26159;&#23427;&#33258;&#24049;
	&#8226;	&#20854;&#23427;&#25152;&#26377;&#33258;&#23450;&#20041;class&#37117;&#26159;Class&#30340;object
	&#8226;	&#20854;&#23427;&#25152;&#26377;&#33258;&#23450;&#20041;class&#37117;&#32487;&#25215;&#33258;Object

&#31616;&#21333;&#30340;&#35828;&#65292;&#23601;&#26159;&#65292;&#22312;&#32487;&#25215;&#23618;&#27425;&#19978;&#65292;&#25152;&#26377;class&#37117;&#32487;&#25215;&#33258;Object&#65292;&#21516;&#26102;&#65292;&#25152;&#26377;class&#37117;&#26159;Class&#30340;&#23545;&#35937;&#65292;&#32780;Class&#21448;&#32487;&#25215;&#33258; Object&#65292;&#22240;&#27492;&#25152;&#26377;class&#20063;&#37117;&#26159;Object&#30340;&#23545;&#35937;&#65292;&#32467;&#35770;&#65306;&#25152;&#26377;class&#26082;&#32487;&#25215;&#33258;Object&#65292;&#21516;&#26102;&#21448;&#26159;Object&#30340;&#23545;&#35937;&#12290;

Ruby&#37324;&#30340;MetaClass:
metaclass&#23601;&#26159;&#23450;&#20041;&#20854;&#23427;class&#30340;class&#12290;

&#29616;&#22312;&#65292;&#25105;&#20204;&#24050;&#32463;&#30693;&#36947;&#65306;object(&#35831;&#27880;&#24847;&#65306;Ruby&#20013;&#30340;&#19968;&#20999;&#37117;&#26159;Object&#30340;&#23545;&#35937;)&#19981;&#33021;&#25317;&#26377;&#26041;&#27861;&#12290;&#20294;&#26377;&#20123;&#26102;&#20505;&#20320;&#21487;&#33021;&#24819;&#35753;&#19968;&#20010;object&#25317;&#26377;&#23427;&#33258;&#24049;&#30340;&#26041;&#27861;&#65292;&#37027;&#35813;&#22914;&#20309;&#21150;&#21602;&#65292;&#31572;&#26696;&#23601;&#26159;metaclass. 

&#37027;&#20040;&#65292;&#26222;&#36890;&#30340;classes&#65292;&#20197;&#21450;object&#65292;&#37117;&#26377;&#33258;&#24049;&#30340;metaclass&#12290;


    class Object
    &#160;&#160;# The hidden singleton lurks behind everyone
    &#160;&#160;def metaclass; class &lt;&lt; self; self; end; end
    &#160;&#160;def meta_eval &amp;blk; metaclass.instance_eval &amp;blk; end
    &#160;&#160;# Adds methods to a metaclass
    &#160;&#160;def meta_def name, &amp;blk
    &#160;&#160;&#160;&#160;meta_eval { define_method name, &amp;blk }
    &#160;&#160;end
    &#160;&#160;# Defines an instance method within a class
    &#160;&#160;def class_def name, &amp;blk
    &#160;&#160;&#160;&#160;class_eval { define_method name, &amp;blk }
    &#160;&#160;end
    end





1.5 What Happens When You Call a Method?
    &#24403;&#20320;&#35843;&#29992;&#19968;&#20010;&#26041;&#27861;&#65292; ruby&#20570;2&#20214;&#20107;&#65306;
    a&#65292; &#25214;&#21040;&#36825;&#20010;&#26041;&#27861;&#12290;&#36825;&#20010;&#36807;&#31243;&#21483;&#26041;&#27861;&#23547;&#25214;&#12290;
    b&#65292; &#25191;&#34892;&#36825;&#20010;&#26041;&#27861;&#12290;&#35201;&#23436;&#25104;&#36825;&#19968;&#27493;&#65292; Ruby&#38656;&#35201;&#19968;&#20010;&#21483;self&#30340;&#19996;&#19996;&#12290;

Method Lookup
MySubclass.ancestors # =&gt; [MySubclass, MyClass, Object, Kernel, BasicObject]
&#19981;&#35201;&#20197;&#20026; ancestors chain&#21482;&#21253;&#21547;class&#65292; &#20854;&#23454;&#20063;&#21253;&#21547;&#20102;module&#12290;&#32780;ancestors&#26041;&#27861;&#65292;&#21017;&#21453;&#26144;&#20986;&#20102;&#26041;&#27861;&#23547;&#25214;&#30340;&#36335;&#24452;&#65292; &#32780;&#19981;&#26159;superclass&#12290;

&#35805;&#35828;&#65292; BasicObject&#26159;Ruby1.9&#24341;&#20837;&#30340;&#12290;

&#26041;&#27861;&#30340;&#25191;&#34892;&#65306;
&#26041;&#27861;&#30340;&#26174;&#31034;&#21644;&#38544;&#24335;&#35843;&#29992;&#26377;&#25152;&#19981;&#21516;&#65306;&#22914;&#26524;&#20320;&#24819;&#25104;&#20026;Ruby&#30340;&#20027;&#20154;&#65292;&#37027;&#20040;&#20320;&#24517;&#39035;&#22312;&#20219;&#20309;&#26102;&#20505;&#26126;&#30830;&#30340;&#30693;&#36947;self&#20195;&#34920;&#30340;&#26159;&#21738;&#20010;object&#12290;

&#31169;&#26377;&#26041;&#27861;&#30495;&#27491;&#30340;&#24847;&#20041;&#65306;
&#20320;&#19981;&#33021;&#29992;&#19968;&#20010;&#26174;&#24335;&#30340;&#26041;&#27861;&#25509;&#25910;&#22120;&#26469;&#35843;&#29992;&#19968;&#20010;&#31169;&#26377;&#26041;&#27861;&#12290;&#25442;&#21477;&#35805;&#35828;&#65292; &#27599;&#27425;&#20320;&#24819;&#35843;&#29992;&#31169;&#26377;&#26041;&#27861;&#65292;&#24517;&#39035;&#35201;&#29992;&#38544;&#24335;self&#26469;&#35843;&#29992;&#12290; &#36825;&#24847;&#24605;&#23601;&#26159;&#31169;&#26377;&#26041;&#27861;&#22312;2&#26465;&#35268;&#21017;&#19979;&#24037;&#20316;&#65306;
&#24403;&#20320;&#24819;&#35843;&#29992;&#23545;&#35937;&#22806;&#30340;&#21035;&#30340;&#26041;&#27861;&#65292;&#37027;&#20040;&#38656;&#35201;&#19968;&#20010;&#26174;&#24335;&#30340;&#35843;&#29992;&#12290;
&#31169;&#26377;&#26041;&#27861;&#20165;&#33021;&#34987;&#38544;&#24335;&#30340;self&#35843;&#29992;&#12290;

&#36716;&#36733;&#35831;&#27880;&#26126;&#20986;&#22788;&#65306;blackanger on http://thoughtrails.com/

&#24635;&#32467;&#65306;
&#8226; An object is composed of a bunch of instance variables and a link
to a class.

   &#23545;&#35937;&#21482;&#26159;&#19968;&#32452;&#23454;&#20363;&#21464;&#37327; &#65291; &#25351;&#21521;&#23545;&#35937;&#30340;&#38142;&#25509;&#12290;

&#8226; The methods of an object live in the object&#8217;s class (from the point
of view of the class, they&#8217;re called instance methods).

   &#19968;&#20010;&#23545;&#35937;&#30340;&#26041;&#27861;&#20445;&#23384;&#22312;&#23545;&#35937;&#30340;&#31867;&#20013;

&#8226; The class itself is just an object of class Class. The name of the
class is just a constant.

   &#19968;&#20010;&#31867;&#26412;&#36523;&#21482;&#26159;Class&#31867;&#30340;&#23545;&#35937;&#12290; &#31867;&#21517;&#21482;&#26159;&#19968;&#20010;&#24120;&#25968;&#12290;

&#8226; Class is a subclass of Module. A module is basically a package of
methods. In addition to that, a class can also be instantiated (with
new( )) or arranged in a hierarchy (through its superclass( )).

  Class&#30340;&#29238;&#31867;&#26159;Module. &#19968;&#20010;module&#21482;&#26159;&#19968;&#20010;&#22522;&#26412;&#30340;&#26041;&#27861;&#38598;&#21512;&#12290; &#38500;&#27492;&#20043;&#22806;&#65292; &#19968;&#20010;&#31867;&#20063;&#21487;&#20197;&#34987;&#23454;&#20363;&#21270;&#65288;&#20351;&#29992;new()&#26041;&#27861;&#65292;&#25110;&#32773; &#36890;&#36807;superclass()&#65289;&#12290;

&#8226; Constants are arranged in a tree similar to a file system, where
the names of modules and classes play the part of directories and
regular constants play the part of files.

&#8226; Each class has an ancestors chain, beginning with the class itself
and going up to BasicObject.

 &#27599;&#20010;&#31867;&#37117;&#26377;&#19968;&#20010;&#22987;&#31062;&#38142;&#65292; &#24320;&#22987;&#20110;&#23427;&#33258;&#24049;&#65292;&#32467;&#26463;&#20110;BasicObject&#65288;Ruby1.9&#65289;.

&#8226; When you call a method, Ruby goes right into the class of the
receiver and then up the ancestors chain, until it either finds the
method or reaches the end of the chain.

  &#24403;&#20320;&#35843;&#29992;&#19968;&#20010;&#26041;&#27861;&#30340;&#26102;&#20505;&#65292; Ruby&#20250;&#27839;&#30528;&#25509;&#25910;&#22120;&#30340;&#31867;&#30340;&#22987;&#31062;&#38142;&#65292;&#25214;&#21040;&#36825;&#20010;&#26041;&#27861;&#65292;&#25110;&#32773;&#26159;&#21040;&#36798;&#38142;&#30340;&#32456;&#28857;&#12290;

&#8226; Every time a class includes a module, the module is inserted in
the ancestors chain right above the class itself.

 &#27599;&#27425;&#24403;&#19968;&#20010;&#31867;include&#19968;&#20010;module&#30340;&#26102;&#20505;&#65292; &#36825;&#20010;moudle&#20250;&#25554;&#20837;&#36825;&#20010;&#31867;&#26041;&#27861;&#38142;&#30340;&#19978;&#19968;&#23618;&#12290;

When you call a method, the receiver takes the role of self.

  &#24403;&#20320;&#35843;&#29992;&#19968;&#20010;&#26041;&#27861;&#30340;&#26102;&#20505;&#65292; &#25509;&#25910;&#22120;&#20805;&#24403;&#20102;self&#30340;&#35282;&#33394;&#12290;
 
&#36716;&#36733;&#35831;&#27880;&#26126;&#20986;&#22788;&#65306;blackanger on http://thoughtrails.com/

&#8226; When you&#8217;re defining a module (or a class), the module takes the
role of self.

&#24403;&#20320;&#39030;&#19968;&#20010;module&#65288;&#25110;&#32773;&#19968;&#20010;&#31867;&#65289;&#30340;&#26102;&#20505;&#65292; &#36825;&#20010;module&#20805;&#24403;&#20102;self&#30340;&#35282;&#33394;&#12290;

&#8226; Instance variables are always assumed to be instance variables of
self.

&#23454;&#20363;&#21464;&#37327;&#24635;&#26159;&#34987;&#25351;&#27966;&#32473;self&#30340;&#23454;&#20363;&#21464;&#37327;&#12290;

&#8226; Any method called without an explicit receiver is assumed to be a
method of self.

&#20219;&#20309;&#19981;&#34987;&#26174;&#24335;&#35843;&#29992;&#30340;&#26041;&#27861;&#65292;&#37117;&#34987;&#25351;&#27966;&#32473;self&#12290;</summary>
    <author>
      <name>blackanger</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/92</id>
    <published>2011-03-15T19:15:03+08:00</published>
    <updated>2011-06-22T15:03:32+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/92-"/>
    <title>JavaScript&#20195;&#30721;&#29983;&#25104;&#22120;&#8212;&#8212;CoffeeScript</title>
    <summary>CoffeeScript&#26159;&#20351;&#29992;Ruby&#32534;&#20889;&#30340;&#32534;&#31243;&#35821;&#35328;&#65292;&#26088;&#22312;&#36890;&#36807;&#31616;&#21333;&#30340;&#32534;&#30721;&#26041;&#24335;&#35753;&#24320;&#21457;&#32773;&#22312;Web&#24212;&#29992;&#20013;&#29983;&#25104;&#24182;&#20351;&#29992;JavaScript&#20195;&#30721;&#12290;CoffeeScript&#34701;&#21512;&#20102;Ruby&#30340;&#31616;&#27905;&#21644;JavaScript&#30340;&#28789;&#27963;&#65292;&#35753;&#24320;&#21457;&#32773;&#36890;&#36807;&#31616;&#21333;&#26131;&#35835;&#30340;&#35821;&#27861;&#26469;&#25776;&#20889;&#36923;&#36753;&#35268;&#21017;&#12290;CoffeeScript&#32534;&#35793;&#22120;&#36127;&#36131;&#23558;&#20195;&#30721;&#36880;&#34892;&#35299;&#37322;&#20026;&#31561;&#25928;&#30340;JavaScript&#31243;&#24207;&#65292;&#24182;&#20445;&#35777;&#29983;&#25104;&#30340;JavaScript&#20195;&#30721;&#19982;&#28304;&#20195;&#30721;&#22312;&#36923;&#36753;&#32467;&#26500;&#19978;&#19968;&#33268;&#12290;

&#36739;&#20043;JavaScript&#35821;&#27861;&#65292;CoffeeScript&#22312;&#35821;&#27861;&#35774;&#35745;&#19978;&#26356;&#20026;&#20005;&#35880;&#12290;&#20026;&#20102;&#35753;&#20195;&#30721;&#30475;&#36215;&#26469;&#26356;&#21152;&#31616;&#27905;&#31934;&#33268;&#65292;CoffeeScript&#20351;&#29992;&#31354;&#26684;&#32553;&#36827;&#32780;&#38750;&#22823;&#25324;&#21495;&#26469;&#36827;&#34892;&#20195;&#30721;&#27573;&#20998;&#38548;&#12290;&#24320;&#21457;&#32773;&#21487;&#20197;&#22312;CoffeeScript&#32534;&#31243;&#20013;&#35843;&#29992;&#20219;&#20309;&#24050;&#26377;&#30340;JavaScript&#31867;&#24211;&#65292;&#24182;&#33021;&#22815;&#19982;&#31867;&#24211;&#23454;&#29616;&#26080;&#32541;&#38598;&#25104;&#12290;&#32463;&#32534;&#35793;&#29983;&#25104;&#30340;JavaScript&#20195;&#30721;&#65292;&#20855;&#22791;&#33391;&#22909;&#30340;&#29256;&#24335;&#21644;&#21487;&#35835;&#24615;&#65292;&#30456;&#27604;&#36739;&#24320;&#21457;&#32773;&#25163;&#20889;&#30340;JavaScript&#20195;&#30721;&#20855;&#22791;&#21516;&#31561;&#25110;&#26356;&#20248;&#30340;&#25191;&#34892;&#25928;&#29575;&#12290;

CoffeeScript&#32763;&#35793;&#22120;&#26159;&#20351;&#29992;CoffeeScript&#35821;&#35328;&#26412;&#36523;&#32534;&#20889;&#65292;&#33021;&#22815;&#22312;&#32534;&#35793;&#30340;&#26102;&#20505;&#26684;&#24335;&#21270;JavaScript&#20195;&#30721;&#65292;&#36825;&#19968;&#28857;&#22312;CoffeeScript&#23448;&#26041;&#31449;&#28857;&#19978;&#20063;&#26377;&#25152;&#20307;&#29616;&#12290;&#31449;&#28857;&#20026;&#24320;&#21457;&#32773;&#25552;&#20379;&#20102;&#20132;&#20114;&#24335;&#30340;CoffeeScript&#22312;&#32447;&#32534;&#35793;&#29615;&#22659;&#65292;&#24320;&#21457;&#32773;&#22312;&#19968;&#20391;&#25970;&#20837;CoffeeScript&#20195;&#30721;&#30340;&#21516;&#26102;&#65292;&#20195;&#30721;&#34987;&#23454;&#26102;&#35299;&#37322;&#20026;&#23545;&#24212;&#30340;JavaScript&#31243;&#24207;&#65292;&#24182;&#21487;&#38543;&#26102;&#22312;&#27983;&#35272;&#22120;&#19978;&#36816;&#34892;&#39564;&#35777;&#12290; 

CoffeeScript&#33258;2009&#24180;12&#26376;&#20221;&#35806;&#29983;&#20197;&#26469;&#65292;&#32463;&#21382;&#20102;&#19968;&#24180;&#22810;&#24320;&#21457;&#23436;&#21892;&#65292;&#21069;&#19981;&#20037;&#21018;&#21457;&#24067;&#20102;1.0&#29256;&#26412;&#12290;&#22312;&#26032;&#29256;&#26412;&#20013;&#65292;CoffeeScript&#25913;&#36827;&#20102;&#24490;&#29615;&#20307;&#32467;&#26500;&#65292;&#24182;&#25552;&#20379;&#20102;&#31616;&#20415;&#30340;&#38381;&#21253;&#23454;&#29616;&#12290;&#20026;&#20102;&#26041;&#20415;Java&#24320;&#21457;&#32773;&#20351;&#29992;&#65292;CoffeeScript&#36824;&#25552;&#20379;&#26377;&#19968;&#20010;&#34987;&#31216;&#20316;JcoffeeScript&#30340;Java&#31867;&#24211;&#65292;&#35753;CoffeeScript&#20195;&#30721;&#33021;&#22815;&#22312;Rhino&#29615;&#22659;&#20013;&#32534;&#35793;&#12290;Rhino&#39033;&#30446;&#30001;Mozilla&#22522;&#37329;&#20250;&#36190;&#21161;&#65292;&#23436;&#20840;&#20351;&#29992;Java&#35821;&#35328;&#24320;&#21457;&#20102;JavaScript&#24341;&#25806;&#65292;&#20197;&#20415;&#23884;&#20837;&#22312;Java&#24212;&#29992;&#20013;&#20026;&#29992;&#25143;&#25552;&#20379;&#33050;&#26412;&#25903;&#25345;&#12290;

&#27492;&#22806;&#65292;CoffeeScript&#30340;&#25299;&#23637;&#24320;&#21457;&#36164;&#28304;&#20063;&#24456;&#20016;&#23500;CoffeeScript&#30340;&#26041;&#35328;Coco&#39033;&#30446;&#65292;&#22312;&#29306;&#29298;CoffeeScript&#20195;&#30721;&#21487;&#35835;&#24615;&#30340;&#21516;&#26102;&#65292;&#35753;CoffeeScript&#35821;&#27861;&#21464;&#24471;&#26356;&#20026;&#39640;&#25928;&#21644;&#23454;&#29992;&#65292;&#20197;&#20415;&#20110;&#24212;&#29992;&#30340;&#24555;&#36895;&#24320;&#21457;&#12290;&#22312;CoffeeScript&#30340;&#32534;&#30721;&#25903;&#25345;&#26041;&#38754;&#65292;Vim CoffeeScript&#39033;&#30446;&#20026;&#20351;&#29992;Vim&#25991;&#26412;&#32534;&#36753;&#22120;&#30340;&#24320;&#21457;&#32773;&#25552;&#20379;CoffeeScript&#35821;&#27861;&#39640;&#20142;&#26174;&#31034;&#65292;&#21516;&#26102;&#20026;&#24320;&#21457;&#32773;&#25552;&#20379;CoffeeScript&#20195;&#30721;&#32553;&#36827;&#25903;&#25345;&#12290;

&#30446;&#21069;&#24050;&#26377;&#19981;&#23569;Web&#24320;&#21457;&#39033;&#30446;&#24320;&#22987;&#20351;&#29992;CoffeeScript&#29983;&#25104;&#30340;JavaScript&#26469;&#26500;&#24314;&#31449;&#28857;&#12290;&#27604;&#22914;&#25552;&#20379;&#21508;&#31181;&#26032;&#25216;&#26415;&#36164;&#35759;&#30340;arstechnica.com&#31449;&#28857;&#65292;&#22312;&#20854;&#25512;&#20986;&#30340;iPad&#24212;&#29992;&#20013;&#65292;&#23601;&#26159;&#20351;&#29992;HTML&#21644;CoffeeScript&#20026;&#35835;&#32773;&#25552;&#20379;&#21069;&#31471;&#23637;&#31034;&#12290;37Signals&#21457;&#24067;&#30340;iPad&#30333;&#26495;&#24212;&#29992;Chalk&#20063;&#26159;&#20351;&#29992;CoffeeScript&#32534;&#20889;&#65292;&#24182;&#19988;&#33021;&#22815;&#20511;&#21161;Cache Manifest&#23454;&#29616;&#24212;&#29992;&#30340;&#31163;&#32447;&#36816;&#34892;&#12290;&#36816;&#34892;&#22312;&#27983;&#35272;&#22120;&#31471;&#30340;&#22374;&#20811;&#22823;&#25112;&#28216;&#25103;Orona&#21516;&#26679;&#20511;&#21161;CoffeeScript&#23454;&#29616;&#12290;&#27492;&#22806;&#65292;&#21478;&#26377;&#26377;&#36259;&#30340;&#31449;&#28857;&#20351;&#29992;CoffeeScript&#21644;JavaScript&#30340;&#30690;&#37327;&#22270;&#24418;&#24211;&#24037;&#20855;Rapha&#235;l&#26469;&#28436;&#31034;&#22914;&#20309;&#38543;&#21363;&#29983;&#25104;&#21508;&#24335;&#21508;&#26679;&#26377;&#36259;&#30340;&#22270;&#26696;&#12290;

&#26412;&#25991;&#26366;&#21457;&#34920;&#20110;&#12298;&#31243;&#24207;&#21592;&#12299;&#26434;&#24535;-2011&#24180;03&#26399;&#8221;&#31243;&#24207;&#22825;&#19979;&#20107;&#8221;&#26639;&#30446;&#12290;</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/91</id>
    <published>2011-03-14T20:13:01+08:00</published>
    <updated>2011-06-22T12:47:40+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/91-methods-of-request"/>
    <title>&#36890;&#36807;rails&#28304;&#30721;&#26469;&#20102;&#35299;request&#30340;&#21508;&#31181;&#29992;&#27861;</title>
    <summary>    module ActionController
      class AbstractRequest
    
        def method
          @request_method ||= (!parameters[:_method].blank? &amp;&amp; @env['REQUEST_METHOD'] == 'POST') ?
            parameters[:_method].to_s.downcase.to_sym :
            @env['REQUEST_METHOD'].downcase.to_sym
          @request_method == :head ? :get : @request_method
        end
    
        def get?
          method == :get
        end
    
        def post?
          method == :post
        end
    
        def put?
          method == :put
        end
    
        def delete?
          method == :delete
        end
    
        def head?
          @env['REQUEST_METHOD'].downcase.to_sym = :head
        end
    
        def content_type
          @content_type ||=
            begin
              content_type = @env['CONTENT_TYPE'].to_s.downcase
              if x_post_format = @env['HTTP_X_POST_DATA_FORMAT']
                case x_post_format.to_s.downcase
                when 'yaml'
                  content_type = 'application/x-yaml'
                when 'xml'
                  content_type = 'application/xml'
                end
              end
              Mime::Type.lookup(content_type)
            end
        end
    
        def accepts
          @accepts ||=
            if @env['HTTP_ACCEPT'].to_s.strip.empty?
              [ content_type, Mime::ALL ]
            else
              Mime::Type.parse(@env['HTTP_ACCEPT'])
            end
        end
    
        def xml_http_request?
          not /XMLHttpRequest/i.match(@env['HTTP_X_REQUESTED_WITH']).nil?
        end
        alias xhr? :xml_http_request?
    
        def remote_ip
          return @env['HTTP_CLIENT_IP'] if @env.include? 'HTTP_CLIENT_IP'
          if @env.include? 'HTTP_X_FORWARDED_FOR' then
            remote_ips = @env['HTTP_X_FORWARDED_FOR'].split(',').reject do |ip|
                ip =~ /^unknown$|^(10|172\.(1[6-9]|2[0-9]|30|31)|192\.168)\./i
            end
            return remote_ips.first.strip unless remote_ips.empty?
          end
          @env['REMOTE_ADDR']
        end
    
        def domain(tld_length = 1)
          return nil if !/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.match(host).nil? or host.nil?
          host.split('.').last(1 + tld_length).join('.')
        end
    
        def subdomains(tld_length = 1)
          return [] unless host
          parts = host.split('.')
          parts[0..-(tld_length+2)]
        end
    
        def request_uri
          if uri = @env['REQUEST_URI']
            (%r{^\w+\://[^/]+(/.*|$)$} =~ uri) ? $1 : uri
          else
            script_filename = @env['SCRIPT_NAME'].to_s.match(%r{[^/]+$})
            uri = @env['PATH_INFO']
            uri = uri.sub(/#{script_filename}\//, '') unless script_filename.nil?
            unless (env_qs = @env['QUERY_STRING']).nil? || env_qs.empty?
              uri &lt;&lt; '?' &lt;&lt; env_qs
            end
            @env['REQUEST_URI'] = uri
          end
        end
    
        def protocol
          ssl? ? 'https://' : 'http://'
        end
    
        def ssl?
          @env['HTTPS'] == 'on' || @env['HTTP_X_FORWARDED_PROTO'] == 'https'
        end
    
        def port
          @port_as_int ||= @env['SERVER_PORT'].to_i
        end
    
        def cookies
        end
    
        def session
        end
    
      end
    end

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/90</id>
    <published>2011-03-10T19:54:57+08:00</published>
    <updated>2011-06-22T11:03:07+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/90-"/>
    <title>&#20851;&#20110;VPS&#30340;PASSENGER&#20248;&#21270;</title>
    <summary>
passenger_max_pool_size

&#36825;&#20010;&#20540;&#24212;&#35813;&#21453;&#26144;&#20986;&#20320;&#27491;&#22312;&#36816;&#34892;&#30340;&#26381;&#21153;&#22120;&#20855;&#20307;&#24773;&#20917;&#12290;&#26381;&#21153;&#22120;&#36234;&#24222;&#22823;&#65292;&#36825;&#20010;&#20540;&#36234;&#39640;&#12290; &#23545;&#20110;&#23567;&#22411;&#30340;VPS&#65288;256M&#65289;&#20320;&#24212;&#35813;&#25226;&#36825;&#20010;&#20540;&#35774;&#32622;&#20026;2.&#22914;&#26524;&#20320;&#35774;&#32622;&#30340;&#27604;2&#22823;&#65292;&#20320;&#20250;&#21457;&#29616;&#27809;&#26377;&#36275;&#22815;&#36164;&#28304;&#20877;&#26381;&#21153;&#22120;&#19978;&#36816;&#34892;&#20854;&#20182;&#36719;&#20214;&#12290;&#24403;&#25105;&#20204;&#23581;&#35797;&#20877;RAILS&#26631;&#20934;&#29615;&#22659;&#19979;&#38656;&#35201;&#21516;&#26102;&#36816;&#34892;MYSQL&#21644;NGINX&#26102;&#65292;&#36825;&#31181;&#35774;&#32622;&#26174;&#24471;&#29305;&#21035;&#26377;&#25928;&#12290;&#24403;&#20320;&#38656;&#35201;&#22312;&#36816;&#34892;CRON&#25110;&#32773;&#20854;&#20182;&#21518;&#21488;&#20219;&#21153;&#26102;&#65292;&#36825;&#31181;&#35774;&#32622;&#23558;&#20250;&#32473;&#20104;&#20320;&#19968;&#23450;&#30340;&#24110;&#21161;&#21644;&#36275;&#22815;&#30340;&#28789;&#27963;&#24615;&#12290;

&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#22914;&#26524;&#20320;&#36890;&#36807;CRON&#26469;&#36816;&#34892;RAKE TASK&#26102;&#65292;&#37027;&#20040;&#21487;&#33021;&#22312;&#20320;&#25191;&#34892;&#20219;&#21153;&#20043;&#21069;&#35013;&#36733;RAILS&#29615;&#22659;&#12290;&#30001;&#20110;&#20943;&#23569;&#20102;&#21487;&#29992;&#20869;&#23384;&#65292;&#36825;&#23558;&#20250;&#20351;&#24471;&#24615;&#33021;&#20986;&#29616;&#23792;&#20540;&#12290;


passenger_pool_idle_time

&#36825;&#20010;&#25351;&#20196;&#20915;&#23450;&#20102;&#19968;&#20010;&#32593;&#31449;&#22312;&#20851;&#38381;&#21069;&#23558;&#20445;&#25345;&#22810;&#38271;&#30340;&#20241;&#30496;&#26102;&#38388;&#12290;&#36825;&#20010;&#25968;&#25454;&#21644;&#32593;&#31449;&#25509;&#21463;&#30340;&#27969;&#37327;&#30456;&#20851;&#12290;&#22914;&#26524;&#20320;&#26399;&#26395;&#27969;&#37327;&#20445;&#25345;&#19968;&#23450;&#36830;&#32493;&#24615;&#65292;&#37027;&#20040;&#20320;&#38656;&#35201;&#25226;passenger_pool_idle_time&#36825;&#20010;&#20540;&#35774;&#32622;&#30340;&#31245;&#24494;&#39640;&#19968;&#28857;&#12290;&#22914;&#26524;&#32593;&#31449;&#27969;&#37327;&#30456;&#23545;&#23567;&#19968;&#28857;&#25110;&#32773;&#27969;&#37327;&#26377;&#39640;&#26377;&#20302;&#65292;&#20320;&#24212;&#35813;&#25226;&#36825;&#20010;&#20540;&#35774;&#32622;&#30340;&#31245;&#24494;&#23567;&#19968;&#28857;&#12290;&#22240;&#20026;PASSENGER&#22312;&#19968;&#20010;&#29305;&#23450;&#26102;&#38388;&#27573;&#21518;&#20851;&#38381;&#32593;&#31449;&#65292;&#22240;&#27492;&#65292;&#29992;&#25143;&#22312;&#36825;&#20010;&#26102;&#38388;&#27573;&#21518;&#27983;&#35272;&#32593;&#31449;&#65292;&#22312;&#26032;&#30340;&#32593;&#31449;&#21551;&#21160;&#26102;&#65292;&#29992;&#25143;&#20250;&#21457;&#29616;&#19968;&#20010;&#30701;&#26242;&#30340;&#20572;&#39039;&#12290;&#20294;&#26159;&#20174;&#21478;&#19968;&#38754;&#26469;&#35828;&#65292;&#36825;&#26679;&#38477;&#20302;&#20102;&#24635;&#20307;&#30340;&#20316;&#20026;&#38750;&#20851;&#38381;&#26102;&#20869;&#23384;&#30340;&#20351;&#29992;&#12290;
&#22914;&#26524;&#36825;&#36827;&#31243;&#20174;&#19981;&#20250;&#34987;&#20851;&#38381;&#37027;&#23601;&#24212;&#35813;&#25226;&#36825;&#20010;&#20540;&#35774;&#32622;&#20026;0&#65292;PASSENGER&#25991;&#26723;&#24314;&#35758;&#20351;&#29992;&#26041;&#31243;2*X&#26469;&#35745;&#31639;&#20320;&#24212;&#35813;&#22312;&#36825;&#35774;&#32622;&#30340;&#20540;&#65292;&#36825;&#37324;&#30340;X&#26159;&#27599;&#20010;&#29992;&#25143;&#22312;&#20320;&#32593;&#31449;&#20572;&#30041;&#30340;&#24179;&#22343;&#31186;&#25968;&#12290;

passenger_pre_start

&#26080;&#35770;&#20309;&#26102;&#65292;&#25105;&#20204;&#37325;&#21551;PASSENGER&#65292;&#25105;&#20204;&#24635;&#26159;&#24076;&#26395;&#24403;WEB SERVER&#21551;&#21160;&#20102;&#30340;&#26102;&#20505;&#65292;&#25105;&#20204;&#30340;&#24212;&#29992;&#31243;&#24207;&#20063;&#24050;&#32463;&#20934;&#22791;&#23601;&#32490;&#12290;&#20026;&#20102;&#36798;&#21040;&#36825;&#20010;&#30446;&#26631;&#65292;&#20320;&#21487;&#20197;&#24212;&#29992;PASSENGER_PRE_START &#25351;&#20196;&#12290;&#24403;&#26381;&#21153;&#22120;&#21551;&#21160;&#20102;&#30340;&#26102;&#20505;&#65292;&#36825;&#20010;&#25351;&#20196;&#23558;&#20250;&#25226;&#26412;&#22320;&#35831;&#27714;&#21457;&#36865;&#21040;&#25351;&#23450;&#30340;URL&#65292;&#23601;&#22909;&#20687;&#29992;&#25143;&#31532;&#19968;&#27425;&#28857;&#20987;&#25105;&#20204;&#30340;&#32593;&#31449;&#19968;&#26679;&#65292;&#28982;&#21518;&#23558;&#36827;&#20837;&#27491;&#24120;&#30340;&#31243;&#24207;&#12290;&#20320;&#21487;&#20197;&#22312;PASSENGER DOCUMENTATION&#20013;&#25214;&#21040;&#20351;&#29992;URL&#32780;&#19981;&#26159;&#20351;&#29992;FLAG&#30340;&#25903;&#25345;&#35770;&#25454;&#12290;


&#26816;&#26597;&#20869;&#23384;&#20351;&#29992;&#24773;&#20917;&#65292;&#20197;&#27979;&#35797;&#24744;&#30340;&#26356;&#25913;
PASSENGER&#33258;&#24102;&#19968;&#20010;&#36229;&#26834;&#30340;&#24212;&#29992;&#21483;PASSENGER-MEMORY-STATS&#12290;&#36825;&#20010;&#24212;&#29992;&#35753;&#20320;&#21487;&#20197;&#30475;&#21040;&#29616;&#23454;&#30340;&#26377;&#20851;PASSENGER&#20351;&#29992;&#20869;&#23384;&#30340;&#32479;&#35745;&#25968;&#25454;&#12290;&#20854;&#23454;&#65292;&#24212;&#35813;&#25226;&#36825;&#20010;&#24037;&#20855;&#25918;&#22312;&#19968;&#20010;&#21333;&#29420;&#30340;SSH SESSION&#26469;&#36861;&#36394;&#20320;&#30340;&#35774;&#32622;&#25913;&#21464;&#24102;&#26469;&#24590;&#26679;&#30340;&#21464;&#21270;&#12290;

&#38500;&#20102;&#36825;&#20010;&#24037;&#20855;&#22806;&#65292;&#36824;&#26377;&#19968;&#20010;&#21483;PASSENGER-STATUS&#30340;&#24037;&#20855;&#12290;&#36825;&#20010;&#24037;&#20855;&#24212;&#35813;&#20197;ROOT&#36523;&#20026;&#26469;&#36816;&#34892;&#65292;&#23427;&#29616;&#23454;&#20102;PASSENGER&#30340;&#35013;&#36733;&#35774;&#32622;&#65292;&#36825;&#20010;&#35774;&#32622;&#26159;&#20998;&#20026;2&#22359;&#30340;&#65292;&#26222;&#36890;&#35774;&#32622;&#21644;&#24212;&#29992;&#35774;&#32622;&#12290;
&#22914;&#26524;&#35201;&#20102;&#35299;&#26356;&#22810;&#30340;&#20851;&#20110;&#27599;&#20010;&#35774;&#32622;&#30340;&#25253;&#21578;&#35299;&#37322;&#65292;&#35831;&#21442;&#38405;PASSENGER DOCUMENTATION&#12290;

&#23613;&#31649;&#36825;&#20123;&#20248;&#21270;&#37117;&#26159;&#38024;&#23545;&#23567;&#22411;&#32593;&#31449;&#65292;&#20294;&#26159;&#20320;&#21516;&#26679;&#21487;&#20197;&#29992;&#22312;&#22823;&#22411;&#26381;&#21153;&#22120;&#19978;&#65288;&#26576;&#31181;&#31243;&#24230;&#30340;&#22823;&#22411;&#26381;&#21153;&#22120;&#65289;&#65292;&#24403;&#28982;&#22914;&#26524;&#20320;&#30340;VPS&#25193;&#23637;&#20102;&#30340;&#35805;&#65292;&#20320;&#38656;&#35201;&#20570;&#30340;&#26356;&#22810;&#65292;&#20294;&#26159;&#25105;&#20204;&#21457;&#29616;&#36825;&#20123;&#23567;&#25552;&#31034;&#22312;&#23567;&#22411;&#24212;&#29992;&#19978;&#20250;&#26377;&#22855;&#25928;&#12290;

</summary>
    <author>
      <name>git8023</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/89</id>
    <published>2011-03-10T09:38:41+08:00</published>
    <updated>2011-06-22T01:39:41+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/89-rails-price-formatting"/>
    <title>Rails&#20013;&#20215;&#26684;&#26174;&#31034;&#30340;&#26684;&#24335;&#21270;&#26041;&#27861;</title>
    <summary>&#19968;&#31181;&#26159;&#30452;&#25509;&#22312;&#35797;&#22270;&#20013;&#38431;&#20215;&#26684;&#20449;&#24687;&#36827;&#34892;&#26684;&#24335;&#21270;
&#22914;&#65306;

    
    &lt;%= sprintf("&#65509;%0.02f",product.price) %&gt;
    

&#21478;&#22806;&#19968;&#31181;&#26159;&#29992;&#21333;&#29420;&#30340;&#36741;&#21161;&#26041;&#27861;&#26469;&#22788;&#29702;&#20215;&#26684;&#26684;&#24335;&#21270;&#65292;
&#21363;`number_to_currency`&#65292;
&#22914;&#65306;

    
        &lt;%= number_to_currency(product.price) %&gt;
    

&#26174;&#31034;&#32467;&#26524;&#20026;$100.00

    
        &lt;%= number_to_currency(product.price,  :unit=&gt;"&#65509;") %&gt;
    

&#26174;&#31034;&#32467;&#26524;&#20026;&#65509;100.00

&#23436;&#25972;&#25551;&#36848;&#20026;`number_to_currency(number,options={})`,


&#23558;&#25968;&#23383;&#26684;&#24335;&#21270;&#20026;&#37329;&#39069;&#23383;&#31526;&#20018;&#65292;

options&#26159;&#19968;&#20010;hash&#65292;&#29992;&#20110;&#23450;&#21046;&#36755;&#20986;&#26684;&#24335;

&#21253;&#21547;

    :precesion    &#25351;&#23450;&#25968;&#23383;&#30340;&#31934;&#24230;&#65292;&#40664;&#35748;&#20026;2
    :unit         &#25351;&#23450;&#36135;&#24065;&#36755;&#20986;&#26684;&#24335;,&#40664;&#35748;&#20026;$
    :separator    &#25351;&#23450;&#25972;&#25968;&#19982;&#23567;&#25968;&#20043;&#38388;&#30340;&#20998;&#38548;&#31526;,&#40664;&#35748;&#20026; "."
    :delimiter    &#25351;&#23450;&#25972;&#25968;&#37096;&#20998;&#30340;&#23450;&#30028;&#31526;

&#31034;&#20363;&#65306;

    number_to_currency(1234567890.123,:unit=&gt;"&#65509;",:separator=&gt;",",:delimiter=&gt;".")
    -&gt;1.234.567.890,123

</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/88</id>
    <published>2011-03-09T22:57:43+08:00</published>
    <updated>2011-06-22T11:17:29+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/88-how-to-use-delegate"/>
    <title>delegate&#30340;&#20351;&#29992;</title>
    <summary>&#25105;&#20204;&#26377;&#26102;&#20505;&#20250;&#36935;&#21040;&#36825;&#31181;&#24773;&#20917;&#65292;&#22914;&#19979;

    info.user.name
    info.user.age

&#25105;&#20204;&#21487;&#20197;&#35753;&#20195;&#30721;&#21464;&#24471;&#26356;&#28418;&#20142;&#20123;&#25110;&#32773;&#20320;&#24819;&#37325;&#26500;&#30340;&#26356;&#22909;&#20123;&#65292;&#37027;&#20040;&#22914;&#19979;&#65306;

    class Info&lt; ActiveRecord::Base
       belongs_to :user
       delegate :name, :address :to =&gt; :user, :prefix=&gt; true
    end
    
    &lt;%= @info.user_name %&gt;
    &lt;%= @info.user_address %&gt;</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/86</id>
    <published>2011-03-02T19:26:46+08:00</published>
    <updated>2011-06-21T23:09:00+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/86-my-rails-note"/>
    <title>&#25105;&#30340;&#31508;&#35760;&#65288;rails&#30340;&#28857;&#28857;&#28404;&#28404;&#65289;</title>
    <summary>&#21551;&#21160;&#39033;&#30446;&#65306;

    ruby script/server -e development(&#40664;&#35748;)
    ruby script/server -e test
    ruby script/server -e production

&#22312;&#32534;&#20889;ruby&#20195;&#30721;&#26102;&#65292;&#22914;&#26524;&#35201;&#24341;&#29992;&#21478;&#19968;&#20010;&#25991;&#20214;&#20013;&#30340;&#31867;&#21644;&#27169;&#22359;&#65292;&#38656;&#35201;&#20351;&#29992;require&#20851;&#38190;&#23383;&#65292;&#20294;&#26159;&#24403;&#25105;&#20204;&#22312;rails&#20013;&#24341;&#29992;&#21478;&#19968;&#20010;&#25991;&#20214;&#20013;&#30340;&#31867;&#21644;&#27169;&#22359;&#26102;&#65292;rails&#20250;&#33258;&#21160;&#25226;&#31867;&#21517;&#31216;&#26681;&#25454;&#21629;&#21517;&#32422;&#23450;&#25913;&#20026;&#25991;&#20214;&#21517;&#65292;&#28982;&#21518;&#22312;&#21516;&#19968;&#30446;&#24405;&#19979;&#21152;&#36733;&#35813;&#25991;&#20214;&#12290;


&#25353;&#27169;&#22359;&#32452;&#32455;&#25511;&#21046;&#22120;&#65306;

    ruby script/generate controller Admin::Book action1 action2

admin&#27169;&#22359;&#19979;&#30340;book_controller&#25511;&#21046;&#22120;


Rails&#32473;Enumerable&#31867;&#25193;&#23637;&#30340;&#26041;&#27861;  
1&#12299; group_by: &#23558;&#19968;&#20010;&#23545;&#35937;&#38598;&#21512;&#20998;&#32452;&#65292;&#38024;&#23545;&#27599;&#20010;&#23545;&#35937;&#35843;&#29992;&#22359;&#65292;&#28982;&#21518;&#26681;&#25454;&#20195;&#30721;&#22359;&#30340;&#36820;&#22238;&#20540;&#20316;&#20026;&#20998;&#32452;&#30340;&#38190;&#65292;&#20540;&#26159;&#25152;&#26377;&#25317;&#26377;&#21516;&#19968;&#20010;&#38190;&#30340;&#23545;&#35937;&#32452;&#25104;&#30340;&#25968;&#32452;&#12290;  
eg:

    User.all.group_by{|user| user.sex}
    User.all.group_by(&amp;:name)

2&#12299; sum&#65306; &#23545;&#38598;&#21512;&#36827;&#34892;&#21152;&#24635;&#65292;&#25226;&#27599;&#20010;&#20803;&#32032;&#20256;&#36882;&#32473;&#19968;&#20010;&#20195;&#30721;&#22359;&#65292;&#24182;&#23545;&#20195;&#30721;&#22359;&#36820;&#22238;&#30340;&#20540;&#36827;&#34892;&#32047;&#21152;&#12290;

    User.all.sum(&amp;:id)  #&#36820;&#22238;&#25152;&#26377;user&#23545;&#35937;&#30340;id&#30340;&#21644;

3&#12299; `in_groups_of(arg1, arg2)`  &#23558;&#26576;&#19968;&#20010;&#25968;&#32452;&#20998;&#20026;&#23376;&#20803;&#32032;&#30001;arg1&#20010;&#20803;&#32032;&#32452;&#21512;&#30340;&#25968;&#32452;&#20803;&#32032;&#32452;&#25104;&#30340;&#25968;&#32452;&#65292;&#20986;&#29616;&#26080;&#27861;&#22635;&#20805;&#30340;&#20540;&#30001;arg2&#22635;&#34917;&#12290;  

eg&#65306;

    [1,2,3,4,5].in_groups_of(2,"blank")     =&gt;      
    [[1,2],[3,4],[5,"blank"]]

&#23383;&#31526;&#20018;&#25193;&#23637;

    str[0] &#31532;&#19968;&#20010;&#23383;&#31526;&#30340;Ascill&#30721;&#12290;
    str[2..3] &#36820;&#22238;&#23383;&#31526;&#20018;&#30340;&#31532;&#19977;&#20010;&#23383;&#31526;&#24320;&#22987;&#30340;3&#20010;&#23383;&#31526;&#32452;&#25104;&#30340;&#23383;&#31526;&#20018;&#12290;
    str.at(0) &#31532;&#19968;&#20010;&#23383;&#31526;
    str.to(4) &#21069;5&#20010;&#23383;&#31526;&#32452;&#25104;&#30340;&#23383;&#31526;&#20018;
    str.from(4) &#26368;&#21518;5&#20010;&#23383;&#31526;&#32452;&#25104;&#30340;&#23383;&#31526;&#20018;
    str.first
    str.last
    str.starts_with?(&#23383;&#31526;&#20018;&#65289;
    str.ends_with?(&#23383;&#31526;&#20018;)
    str.each_char{|char| char.upcase}
    str.pluralize &#22797;&#25968;&#24418;&#24335;
    str.singularize  &#21333;&#25968;&#24418;&#24335;
    str.humanize
    str.titleize

&#23545;&#25968;&#20540;&#30340;&#25193;&#23637;&#65306;

    figure.ordinalize   &#36820;&#22238;&#25968;&#23383;&#30340;&#24207;&#25968;&#24418;&#24335;
    
    figure.bytes&#12289;kilobytes&#12289;megabytes&#12289;gigabytes&#12289;terabytes&#12289;
    perabytes&#12289;exabyte  &#25968;&#25454;&#22823;&#23567;
    
    figure.seconds&#12289;minutes&#12289;hours&#12289;days&#12289;weeks&#12289;fortnights&#12289;months&#12289;years  &#26102;&#38388;

&#27880;&#24847;&#65306;  `ago&#12289; until&#12289; from_now&#12289; since`  

eg:  

    1.day.ago
    1.day.ago(Time.now)


&#26102;&#38388;&#21644;&#26085;&#26399;&#30340;&#25193;&#23637;

    now = Time.now
    now.to_s(:short)&#12289;to_s(:db&#65289;&#12289;to_s(:long)&#12289;to_s(:rfc822)
    now.ago(2.days)&#12289;since(2.days)
    change(:hour =&gt; 12)  &#25913;&#21464;&#26085;&#26399;&#30340;hour&#20026;12
    advance(:hour =&gt; 12)  &#25512;&#36831;&#26085;&#26399;&#30340;12hour
    to_date&#12289;to_time
    at_beginning_of_week&#12289;at_beginning_of_month&#12289;at_beginning_of_quarter(&#23395;)&#12289;at_beginning_of_year

ruby&#31526;&#21495;&#30340;&#25193;&#23637;&#65306;

    posts.group_by{|post| post.author_id}
    posts.group_by(&amp;:author_id)


with_options&#30340;&#20351;&#29992;&#65306;  
Rails&#37324;&#26377;&#20123;&#26041;&#27861;&#20351;&#29992;&#19968;&#20010;Hash&#20316;&#20026;&#26368;&#21518;&#19968;&#20010;&#21487;&#36873;&#30340;&#21442;&#25968;&#65292;&#22914;&#26524;&#23545;&#22810;&#20010;&#26041;&#27861;&#26377;&#21516;&#26679;&#30340;&#36873;&#39033;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;with_options&#26469;&#20943;&#23569;&#20887;&#20313;:  

eg&#65306;

    with_options :if =&gt; :should_validate_password? do |user|  
      user.validates_presence_of :password  
      user.validates_confirmation_for :password  
      user.validates_format_of :password, :with =&gt; /^[^\s]+$/
    end


&#36801;&#31227;&#20219;&#21153;&#65306;

    create_table   
    :force =&gt; true  &#22914;&#26524;&#34920;&#23384;&#22312;&#65292;&#24378;&#21046;&#21024;&#38500;&#65292;&#28982;&#21518;&#20877;&#21019;&#24314;&#34920;
    :temporary =&gt; true  &#21019;&#24314;&#19968;&#24352;&#20020;&#26102;&#34920;&#65292;&#31243;&#24207;&#19982;&#25968;&#25454;&#24211;&#26029;&#24320;&#38142;&#25509;&#65292;&#21017;&#34920;&#34987;&#21024;&#38500;&#12290;
    :options =&gt; "xxxx"  &#25351;&#23450;&#38024;&#23545;&#20110;&#24213;&#23618;&#25968;&#25454;&#24211;&#30340;&#36873;&#39033;&#65292;&#36825;&#20123;&#36873;&#39033;&#20250;&#34987;&#21152;&#21040;create table&#35821;&#21477;&#30340;&#21518;&#38754;
    &#65306;primary_key &#20027;&#38190;
    &#65306;id =&gt; false  &#27809;&#26377;&#20027;&#38190;&#30340;&#34920;

&#22914;&#26524;&#36801;&#31227;&#20219;&#21153; &#25552;&#20379;&#30340;&#26041;&#27861; &#19981;&#22815;&#28385;&#36275;&#20320; &#30340;&#38656;&#35201;,&#20063; &#21487;&#20197;&#20351;&#29992;&#25968; &#25454;&#24211;&#19987;&#26377;&#30340; &#21151;&#33021;:&#20351;&#29992;execute() &#26041;&#27861;&#23601;&#21487;&#20197;&#36816;&#34892;&#21407;&#29983; SQL &#35821;&#21477;&#12290;&#20363;&#22914;&#65306;&#32473;&#34920;&#21152;&#19978;&#22806;&#38190;

    class CreateLineItems &lt; ActiveRecord::Migration
        def self.up
          create_table :line_items do |t|
            t.column :product_id, :integer
            t.column :order_id,     :integer
          end
          execute "alter table line_items
              add constraint fk_line_item_products
              foreign key (product_id) references products(id)"
        end
    
         def self.down
          drop_table :line_items
         end
    end


ActiveRecord::Base

column_names  &#23646;&#24615;&#32452;&#25104;&#30340;&#25968;&#32452;

columns_hash["&#23646;&#24615;&#21517;&#31216;"]  &#23646;&#24615;&#21517;&#31216;&#20449;&#24687;

&#23646;&#24615;_before_type_cast  &#35835;&#21462;&#23646;&#24615;&#26102;&#65292;ActiveRecod&#20250;&#23613;&#37327;&#23558;&#24471;&#21040;&#30340;&#20540;&#36716;&#22411;&#25104;&#36866;&#24403;&#30340;ruby&#31867;&#22411;&#65292;&#22914;&#26524;&#25105;&#20204;&#24076;&#26395;&#30340;&#21040;&#23646;&#24615;&#30340;&#21407;&#22987;&#20540;&#65292;&#21487;&#20197;&#22312;&#23646;&#24615;&#21517;&#31216;&#21518;&#38754;&#21152;&#19978;before_type_cast&#12290;
eg&#65306;User.first.created_at    =&gt;   2010-06-24 09:41:17

&#36830;&#25509;&#25968;&#25454;&#24211;&#65306;  

    ActiveRecord::Base.establish_connection(:adapter =&gt; "mysql", :host =&gt; "localhost", :database =&gt; "rails", :username =&gt; "root", :password =&gt; "1234")


&#38450;&#27490;&#24694;&#24847;&#27880;&#20837;&#65306;

1&gt; &#38382;&#21495;&#21344;&#20301;&#31526;:   

    User.find(:all, :conditions =&gt; ["id &gt; ?", 3]

2&gt; &#21629;&#21517;&#21344;&#20301;&#31526;:   

    User.find(:all, :conditions =&gt; ["id &gt; :id", {:id =&gt; 3}])

&#27880;&#24847;&#65306;
&#21629;&#21517;&#21344;&#20301;&#31526;&#30340;&#35821;&#21477;&#21487;&#20197;&#36716;&#25442;&#20026;

    User.find(:all, :conditions =&gt; ["id &gt; :id", params[:user]])

&#33719;&#21462;&#23383;&#27573;&#32479;&#35745;&#20449;&#24687;&#65306;

    average:  
    maximum:
    minimum:
    sum  :
    count  :

&#20197;&#19978;&#26041;&#27861;&#30340;&#21442;&#25968;&#65306;  

    :conditions&#12289;:joins&#12289;:limit&#12289;:order&#12289;:having&#12289;:select&#12289; :distinct

eg: &#25317;&#26377;&#35746;&#21333;&#26368;&#22823;&#30340;&#19977;&#20010;&#24030; 

    Order.maximum :amount, :group =&gt; "state", :limit =&gt; 3&#65292; :order =&gt; "max(amount) desc"


&#26356;&#26032;&#25805;&#20316;&#65306;

    update_attribute&#12289;update_attributes&#12289;update&#12289;update_all

&#21019;&#24314;&#25805;&#20316;&#65306;

    create&#12289;create!&#12289;save&#12289;save&#65281;

&#21024;&#38500;&#25968;&#25454;&#65306;

    delete&#12289;delete_all&#12289;destroy&#12289;destroy_all

delete&#32469;&#36807;&#20102;ActiveRecord&#30340;&#22238;&#35843;&#21644;&#39564;&#35777;&#65292;destory&#27809;&#26377;&#32469;&#36807;&#22238;&#35843;&#21644;&#39564;&#35777;


&#24207;&#21015;&#21270;&#25968;&#25454;&#65306;

serialize &#65306;&#23646;&#24615;
&#24207;&#21015;&#21270;&#30340;&#23646;&#24615;&#21487;&#20197;&#30452;&#25509;&#23384;&#20837;Array&#21644;hash&#31867;&#22411;&#30340;&#25968;&#25454;&#65292;&#20063;&#21487;&#20197;&#30452;&#25509;&#35835;&#20986;&#26469;&#20351;&#29992;
&#32570;&#28857;&#65306;
ruby&#24212;&#29992;&#20043;&#22806;&#30340;&#24212;&#29992;&#35775;&#38382;&#24207;&#21015;&#21270;&#30340;&#25968;&#25454;&#26102;&#65292;&#38500;&#38750;&#23427;&#33021;&#22815;&#29702;&#35299;yaml&#26684;&#24335;&#65292;&#21542;&#21017;&#26080;&#27861;&#33719;&#21462;&#36825;&#20010;&#23383;&#27573;&#30340;&#20449;&#24687;&#12290;

&#24357;&#34917;&#36825;&#31181;&#32570;&#28857;&#30340;&#26041;&#24335;&#26159;&#29992;&#23545;&#35937;&#32858;&#21512;&#30340;&#26041;&#24335;&#26469;&#23454;&#29616;&#31867;&#20284;&#30340;&#25928;&#26524;


&#32858;&#21512;/&#32452;&#21512;&#65306;

&#32858;&#21512;&#21487;&#20197;&#25226;&#19968;&#20010;&#25110;&#22810;&#20010;&#23646;&#24615;&#23553;&#35013;&#20026;&#19968;&#20010;&#31867;&#65292;&#28982;&#21518;&#36825;&#20010;&#31867;&#37324;&#21487;&#20197;&#28155;&#21152;&#25805;&#20316;&#23646;&#24615;&#30340;&#26041;&#27861;&#65292;&#36825;&#26679;&#25105;&#20204;&#23601;&#21487;&#20197;&#23454;&#29616;&#24207;&#21015;&#21270;&#25152;&#35201;&#23454;&#29616;&#30340;&#30446;&#30340;&#20102;&#65292;&#32780;&#19988;&#21487;&#20197;&#36991;&#20813;&#24207;&#21015;&#21270;&#30340;&#32570;&#28857;&#12290;

    composed_of :attr_name, :class_name =&gt; &#31867;&#21517;&#31216;, :mapping =&gt; [&#23383;&#27573;&#19982;&#23646;&#24615;&#32452;&#25104;&#30340;&#25968;&#32452;]

eg&#65306;

    class Xingxi &lt; ActiveRecord::Base
      composed_of :inf, :class_name =&gt; "Inf", :mapping =&gt; [[:name, :name], [:phone, :phone]]
    end
    
    class Inf
        attr_reader :name, :phone
    
        def initialize(name, phone)
            @name = name
            @phone = phone
        end
    
        def to_s
          [@name, @phone].compact.join(" ")
        end
    end
    
    inf = Inf.new("zcy",  "12344454"&#65289;
    
    Xingxi.create(:inf =&gt; inf)

&#27880;&#24847;&#65306;
&#25945;&#31243;&#19978;&#25351;&#20986;  :class_name&#23545;&#24212;&#30340;&#8220;&#31867;&#21517;&#31216;&#8221;&#21487;&#20197;&#26159;&#31867;&#24120;&#37327;&#65292;&#20063;&#21487;&#20197;&#26159;&#21253;&#21547;&#31867;&#24120;&#37327;&#30340;&#23383;&#31526;&#20018;&#65292;&#20294;&#23454;&#38469;&#19978;&#21482;&#33021;&#26159;&#21253;&#21547;&#31867;&#24120;&#37327;&#30340;&#23383;&#31526;&#20018;&#65292;&#22914;&#26524;&#31867;&#21517;&#24688;&#22909;&#26159;&#23646;&#24615;&#21517;&#30340;&#28151;&#21512;&#22823;&#20889;&#24418;&#24335;&#65292;&#37027;&#20040;class_name&#21487;&#20197;&#30465;&#30053;&#65292;&#20294;&#26159;&#23454;&#38469;&#19978;&#19981;&#21487;&#20197;&#65292;&#21253;&#25324;:mapping&#20063;&#19981;&#21487;&#20197;&#12290;


&#20851;&#32852;&#65306;

    class Line &lt; ActiveRecord::Base
      belongs_to :product
    end
    belongs_to :product  &#20250;&#20135;&#29983;&#20197;&#19979;&#26041;&#27861;

1&gt;&#65306;product(force_reload=false) &#36820;&#22238;&#20851;&#32852;&#30340;product&#23545;&#35937;&#65292;&#40664;&#35748;&#24773;&#20917;&#19979;product&#23545;&#35937;&#20250;&#34987;&#32531;&#23384;&#65292;&#24403;force_reload=true&#26102;&#65292;&#23558;&#37325;&#26032;&#26597;&#35810;&#25968;&#25454;&#24211;&#12290;

2&gt;&#65306;product=: line&#23545;&#35937;&#21644;product&#23545;&#35937;&#20851;&#32852;&#36215;&#26469;&#65292;&#23558;line&#35760;&#24405;&#30340;&#22806;&#38190;&#20540;&#35774;&#20026;product&#30340;&#20027;&#38190;&#20540;&#65292;&#22914;&#26524;product&#27809;&#26377;&#20445;&#23384;&#65292;line&#20445;&#23384;&#30340;&#26102;&#20505;&#20250;&#20445;&#23384;product&#65292;&#21253;&#25324;&#22806;&#38190;&#12290;

3&gt;&#65306;build_product(attributes={}) &#26032;&#24314;&#19968;&#20010;product&#23545;&#35937;&#65292;&#29992;&#25351;&#23450;&#30340;&#23646;&#24615;&#23545;&#20854;&#21021;&#22987;&#21270;&#65292;&#30456;&#24403;&#20110;product=Product.new(attributes)&#12290;

4&gt;&#65306;build_create(attributes={}) &#21019;&#24314;&#19968;&#20010;product&#23545;&#35937;&#65292;&#19982;line&#20851;&#32852;&#65292;&#20445;&#23384;product&#23545;&#35937;&#12290;

    order:  has_one&#20013;&#20063;&#26377;order&#65292;&#20027;&#35201;&#29992;&#20110;&#20363;&#22914;&#26368;&#21518;&#19968;&#20010;***&#65292;&#27492;&#26102;&#20415;&#21487;&#20197;&#29992;order&#25351;&#23450;&#25490;&#24207;&#12290;
    :dependent   :destroy(true)&#12289;:nullify&#12289; false
        :destroy   &#21024;&#38500;&#35760;&#24405;&#30340;&#21516;&#26102;&#20063;&#21024;&#38500;&#23376;&#35760;&#24405;
        :nullify   &#21024;&#38500;&#35760;&#24405;&#30340;&#21516;&#26102;&#21024;&#38500;&#23376;&#35760;&#24405;&#30340;&#22806;&#38190;
        false      &#21482;&#21024;&#38500;&#35760;&#24405;


    has_many :lines
    class Product &lt; ActiveRecord::Base
      has_many :lines
    end
    has_many :lines  &#20250;&#20135;&#29983;&#20197;&#19979;&#26041;&#27861;
    
    lines(force_reload=false)  &#21516;&#19978;
    lines.build(attributes = {})
    lines.create(attributes = {})
    lines &lt;&lt; line  &#23558;&#24403;&#21069;line&#23545;&#35937;&#28155;&#21152;&#21040;lines&#23545;&#35937;&#25968;&#32452;&#37324;
    lines.push(line&#23545;&#35937;) line&#23545;&#35937;&#28155;&#21152;&#21040;lines
    lines.delete(line,...) &#21024;&#38500;&#19968;&#20010;&#25110;&#22810;&#20010;line&#23545;&#35937;&#65292;&#22914;&#26524;&#20851;&#32852;&#20026;:destroy =&gt; :destroy,&#23376;&#23545;&#35937;&#34987;&#21024;&#38500;&#65292;&#21542;&#21017;&#21482;&#26159;&#21024;&#38500;&#23376;&#23545;&#35937;&#30340;&#22806;&#38190;&#65292;&#25171;&#26029;&#19982;&#29238;&#23545;&#35937;&#30340;&#20851;&#32852;&#12290;
    lines.delete_all  &#35843;&#29992;&#25152;&#26377;&#23376;&#23545;&#35937;&#30340;delete&#26041;&#27861;
    lines.destroy_all   &#35843;&#29992;&#25152;&#26377;&#23376;&#23545;&#35937;&#30340;destroy&#26041;&#27861;
    lines.clear  &#21644;delete&#19968;&#26679;&#65292;&#19981;&#21516;&#30340;&#26159;clear&#38024;&#23545;&#30340;&#26159;&#25152;&#26377;&#30340;&#23376;&#23545;&#35937;&#12290;
    lines.find(options)
    lines.count(options)
    lines.size
    lines.length  &#24378;&#21046;&#21152;&#36733;&#25152;&#26377;&#23376;&#23545;&#35937;&#65292;&#36820;&#22238;&#23545;&#35937;&#30340;&#38598;&#21512;&#12290;
    lines.empty?
    lines.replace(line&#23545;&#35937;&#25968;&#32452;)  line&#23545;&#35937;&#25968;&#32452;&#26367;&#25442;&#21407;&#20808;&#30340;lines
    lines.sum(options) &#19981;&#20415;&#21033;&#20869;&#23384;&#20013;&#30340;&#23376;&#23545;&#35937;&#38598;&#21512;&#65292;&#30452;&#25509;&#22312;&#25968;&#25454;&#24211;&#31471;&#25805;&#20316;
    lines.uniq  &#36820;&#22238;&#19968;&#20010;&#25968;&#32452;&#65292;&#21253;&#21547;&#25152;&#26377;&#20855;&#22791;&#29420;&#31435;id&#30340;&#23376;&#23545;&#35937;



1&gt; finder_sql: &#37325;&#26032;&#23450;&#20041;&#20102;&#32479;&#35745;&#23376;&#35760;&#24405;&#30340;sql&#35821;&#21477;
   counter_sql: &#37325;&#26032;&#23450;&#20041;&#20102;&#32479;&#35745;&#23376;&#35760;&#24405;&#30340;&#25968;&#30446;
&#27880;&#24847;&#65306; &#22914;&#26524;&#25351;&#23450;&#20102;finder_sql&#32780;&#27809;&#26377;&#25351;&#23450;counter_sql,finder_sql&#20013;&#30340;&#23376;&#21477;&#20250;&#34987;&#26367;&#25442;&#20026;select count(*),&#28982;&#21518;&#35760;&#24405;&#23376;&#35760;&#24405;&#30340;&#25968;&#37327;&#12290;
eg&#65306;
has_many :xingxis, :finder_sql =&gt; "select x.* from xingxis x, infos i where x.info_id = i.id and x.id &gt; 4"

&#20316;&#29992;&#65306; &#24403;:conditions&#26080;&#27861;&#28385;&#36275;&#26102;&#65292;:finder_sql&#26174;&#30340;&#38750;&#24120;&#37325;&#35201;&#12290;

:order : &#20197;&#29305;&#23450;&#30340;&#39034;&#24207;&#25490;&#21015;
:conditions : &#36820;&#22238;&#31526;&#21512;&#26465;&#20214;&#30340;&#23376;&#35760;&#24405;
:dependent   :destroy&#12289;:nullify&#12289; false
    :destroy   &#21024;&#38500;&#35760;&#24405;&#30340;&#21516;&#26102;&#20063;&#21024;&#38500;&#23376;&#35760;&#24405;
    :nullify   &#21024;&#38500;&#35760;&#24405;&#30340;&#21516;&#26102;&#21024;&#38500;&#23376;&#35760;&#24405;&#30340;&#22806;&#38190;
    false      &#21482;&#21024;&#38500;&#35760;&#24405;


&#22810;&#23545;&#22810;&#30340;&#20851;&#32852;&#26377;&#20004;&#31181;
1&#65306; &#21033;&#29992;&#40664;&#35748;&#30340;&#20851;&#32852;&#34920;
2&#65306;&#33258;&#24049;&#21019;&#24314;&#20851;&#32852;&#34920;&#65292;&#21033;&#29992;&#20851;&#32852;&#20013;&#30340;:through

:through   &#21578;&#35785;rails&#36890;&#36807;guanlians&#34920;&#26469;&#23548;&#33322;&#20851;&#32852;
:source  &#29992;&#26469;&#25351;&#23450;&#20851;&#32852;&#22312;&#37027;&#20010;&#23646;&#24615;&#19978;
:uniq =&gt; true  &#21435;&#25481;&#37325;&#22797;&#30340;&#23545;&#35937; &#31561;&#21516;&#20110; :select =&gt; "distinct books.*"

eg:
class Kind &lt; ActiveRecord::Base
    has_many :guanlians
    has_many :readers, :through =&gt; :guanlians, :source =&gt; :book
end

&#27880;&#24847;&#65306;

has_many :reader1s&#65292;:conditions =&gt; "guanlians.cishu &gt; 0"
&#24403;&#20351;&#29992;conditions&#19981;&#33021;&#24456;&#22909;&#30340;&#34920;&#36798;&#26102;&#65292;&#26080;&#27861;&#25552;&#20379;&#21442;&#25968;&#65292;&#21487;&#20197;&#32771;&#34385;&#20197;&#19979;&#26684;&#24335;&#65292;&#32780;&#19988;&#24403;&#21516;&#26679;&#30340;&#26041;&#27861;&#34987;&#22810;&#27425;&#35843;&#29992;&#26102;&#65292;&#21487;&#20197;&#23558;&#26041;&#27861;&#20889;&#22312;&#27169;&#22359;&#20013;&#65292;&#28982;&#21518;&#22312;&#20851;&#32852;&#20013;:extend =&gt; "&#27169;&#22359;&#21517;&#31216;" &#26469;&#35843;&#29992;&#12290;
has_many :readers do
    def reader(limit = 3)
        find(:all, :limit =&gt; limit)
    end
end

&#21333;&#34920;&#32487;&#25215;&#65306;  
&#20248;&#28857;&#65306;  &#36825;&#26679;&#20570;&#30340;&#22909;&#22788;&#26159;&#25552;&#39640;&#35835;&#21462;&#34920;&#30340;&#36895;&#24230;&#65292;&#22240;&#20026;&#27809;&#26377;&#20851;&#32852;&#65292;&#21482;&#26377;&#19968;&#20010;&#34920;&#12290;
&#32570;&#28857;&#65306;  &#24403;&#21508;&#20010;&#23376;&#31867;&#30340;&#30456;&#20284;&#30340;&#22320;&#26041;&#24456;&#23569;&#30340;&#26102;&#20505;&#65292;&#20250;&#23548;&#33268;&#34920;&#20013;&#26377;&#24456;&#22810;&#23646;&#24615;&#65292;&#36825;&#26679;&#22788;&#29702;&#36825;&#20010;&#38382;&#39064;&#30340;&#26041;&#27861;&#26159;&#29992;&#22810;&#24577;&#20851;&#32852;&#12290;

&#22810;&#24577;&#20851;&#32852;&#65306;

types&#34920;&#20013;&#30340;&#22810;&#24577;&#22806;&#38190;&#22914;&#26524;&#26159;duotai,&#37027;&#20040;&#34920;&#30340;&#23646;&#24615;&#26159;duotai_id, duotai_type&#65292;&#19968;&#20010;&#35760;&#24405;&#38190;&#20540;&#65292;&#19968;&#20010;&#35760;&#24405;&#31867;&#21517;&#12290;

class Article &lt; ActiveRecord::Base
    has_one :type, :as =&gt; :duotai
end

class Image &lt; ActiveRecord::Base
    has_one :type, :as =&gt; :duotai
end

class Type &lt; ActiveRecord::Base
    belongs_to :duotai, :polymorphic =&gt; true
end


&#33258;&#24341;&#29992;&#30340;&#36830;&#25509;&#65306;

class Employee &lt; ActiveRecord::Base
  belongs_to :boss, :class_name =&gt; "Employee", :foreign_key =&gt; :employee_id
end

&#39044;&#20808;&#35835;&#21462;&#23376;&#35760;&#24405;
&#20197;&#19979;&#23454;&#20363;&#22914;&#26524;&#27809;&#26377;:include =&gt; :people, infos&#20026;n, &#37027;&#20040;&#20182;&#23558;&#25191;&#34892;2n+1&#27425;,&#22914;&#26524;&#25351;&#23450;&#20102;:include&#65292;&#23558;&#39044;&#21152;&#36733;&#19982;info&#26377;&#20851;&#30340;people&#35760;&#24405;&#65292;&#27492;&#26102;&#23558;&#25552;&#39640;&#25928;&#29575;&#65292;&#20294;&#26159;&#22914;&#26524;&#39044;&#21152;&#36733;&#20102;&#25968;&#25454;&#65292;&#20294;&#27809;&#26377;&#29992;&#36825;&#20123;&#25968;&#25454;&#65292;&#21453;&#32780;&#20250;&#38477;&#20302;&#25928;&#29575;&#12290;
Benchmark.bm() do |x|
    x.report{
        infos = Info.find(:all, :include =&gt; :people)
        infos.each do |info|
            info.people.name
        end
    }
end
 
&#22914;&#26524;&#19968;&#20010;&#23545;&#35937;&#21018;&#21018;&#21019;&#24314;&#20986;&#26469;&#65292;&#36824;&#27809;&#26377;&#19982;&#25968;&#25454;&#24211;&#35760;&#24405;&#24314;&#31435;&#26144;&#23556;&#65292;&#25105;&#20204;&#31216;&#23427;&#20026;&#26032;&#23545;&#35937;(new records)&#12290;&#35843;&#29992;new_records?

&#27169;&#22411;&#39564;&#35777;&#65306;
validate&#12289; validate_on_create&#12289; validate_on_update

ActiveRecord::Errors

[]  info.errors[:email]
on  info.errors.on(:email)
add(:&#23646;&#24615;&#65292; &#20449;&#24687;)
size&#12289;length&#12289;count
each&#12289;each_error  &#36845;&#20195;&#38169;&#35823;&#23646;&#24615;&#21644;&#38169;&#35823;&#23646;&#24615;&#23545;&#24212;&#30340;&#20449;&#24687;
each_full  &#36845;&#20195;&#38169;&#35823;&#20449;&#24687;
full_messages  &#38169;&#35823;&#20449;&#24687;&#32452;&#25104;&#30340;&#25968;&#32452;
invalid?(&#23646;&#24615;)  &#22914;&#26524;&#23646;&#24615;&#26080;&#25928;&#65292;&#21017;&#36820;&#22238;true
to_xml
empty?
ActiveRecord::Errors.default_error_messages  &#36825;&#20010;&#36820;&#22238;&#25152;&#26377;&#30340;&#40664;&#35748;&#20449;&#24687;&#65292;&#22914;&#26524;&#20462;&#25913;&#40664;&#35748;&#20449;&#24687;&#30340;&#35805;&#65292;&#21487;&#20197;&#20174;&#36825;&#37324;&#20462;&#25913;&#12290;


&#22238;&#35843;&#65306;

&#21019;&#24314;&#26041;&#24335;
1&#65306;&#30452;&#25509;&#22312;&#22238;&#35843;&#20013;&#20889;&#20195;&#30721;&#12290;
2&#65306;&#22768;&#26126;&#22238;&#35843;&#22788;&#29702;&#22120;&#65292;&#22788;&#29702;&#22120;&#21487;&#20197;&#26159;&#19968;&#20010;&#20195;&#30721;&#22359;&#20063;&#21487;&#20197;&#26159;&#19968;&#20010;&#26041;&#27861;,&#22914;&#26524;&#29992;&#26041;&#27861;&#20316;&#20026;&#19968;&#20010;&#22788;&#29702;&#22120;&#65292;&#24212;&#35813;&#34987;&#22768;&#26126;&#20026;private&#25110;protected&#12290;
eg
def before_save
  ...
end

before_save :check

private
def check
end

&#27880;&#24847;&#65306;&#20197;&#19979;&#26041;&#27861;&#23558;&#36339;&#36807;&#22238;&#35843;
    * decrement
    * decrement_counter
    * delete
    * delete_all
    * find_by_sql
    * increment
    * increment_counter
    * toggle
    * update_all
    * update_counters



ActiveRecord::Base

column_names:  &#25152;&#26377;&#21015;&#21517;&#32452;&#25104;&#30340;&#25968;&#32452;
columns:  &#25152;&#26377;&#21253;&#21547;&#21015;&#20449;&#24687;&#30340;&#23545;&#35937;&#32452;&#25104;&#30340;&#25968;&#32452;&#12290;
columns_hash:   &#21015;&#21517;&#19982;&#21015;&#23545;&#35937;&#32452;&#25104;&#30340;hash&#25968;&#32452;&#12290;

&#23454;&#20363;&#26041;&#27861;&#65306;
attributes&#65306;  &#25152;&#26377;&#23646;&#24615;&#21644;&#23646;&#24615;&#20540;&#32452;&#25104;&#30340;hash&#25968;&#32452;&#12290;
attributes=
attribute_names&#65306;  &#25152;&#26377;&#23646;&#24615;&#32452;&#25104;&#30340;&#25968;&#32452;&#12290;
attribute_present?(&#23646;&#24615;&#21517;&#31216;) &#22914;&#26524;&#23646;&#24615;&#21517;&#31216;&#23384;&#22312;&#65292;&#21017;&#36820;&#22238;true&#65292;&#21453;&#20043;&#20134;&#28982;&#12290;



&#20107;&#21153;&#65306; &#35201;&#20040;&#20840;&#37096;&#25191;&#34892;&#65292;&#35201;&#20040;&#20840;&#37096;&#19981;&#25191;&#34892;&#12290;

&#27169;&#22411;&#31867;.transaction do
end

begin ... rescue ...end

eg:
class Info &lt; ActiveRecord::Base
  def validate
    errors.add(:age, "age is not less than 0") if age &lt; 0
  end

  def jian(i)
    self.money = self.money - i
    self.save!
  end
end


info = Info.create!(:money =&gt; 100)

begin
Info.transaction do; info.jian(200); end
rescue
end

puts info.money   =&#12299; -100

&#35813;&#23454;&#20363;&#20013;&#35201;&#27714;money&#19981;&#33021;&#23567;&#20110;0&#65292;&#32780;&#25105;&#20204;&#20063;&#20570;&#21040;&#20102;&#65292;&#34920;&#20013;&#30340;&#25968;&#25454;&#19981;&#20250;&#34987;&#25913;&#65292;&#20294;&#26159;info.money &#36820;&#22238;&#30340;&#20540;&#26159;-100&#65292;&#27169;&#22411;&#23545;&#35937;&#30340;&#20540;&#34987;&#35813;&#21464;&#20102;&#65292;&#36825;&#26159;&#22240;&#20026;ActiveRecord&#27809;&#26377;&#36319;&#32508;&#23545;&#35937;&#22312;&#20107;&#21153;&#21069;&#21518;&#30340;&#29366;&#24577;&#65292;&#25105;&#20204;&#21487;&#20197;&#25351;&#23450;&#20107;&#21153;&#36319;&#36394;&#21738;&#20123;&#27169;&#22411;&#23545;&#35937;&#12290;
Info.transaction(info) do; .... end&#65292;&#27492;&#26102;&#36755;&#20986;&#30340;&#20540;&#23601;&#26159;100&#20102;&#12290;


&#36335;&#30001;&#65306;
map.connect &#37325;&#35201;&#21442;&#25968;
:requirements =&gt; {:name =&gt; /regexp/}  &#35201;&#27714;url&#20013;&#29305;&#23450;&#30340;&#32452;&#25104;&#37096;&#20998;&#19982;&#25351;&#23450;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#19968;&#19968;&#21305;&#37197;&#12290;
:defaults =&gt; {:name =&gt; "value", ...}  &#35774;&#23450;&#21508;&#32452;&#25104;&#37096;&#20998;&#30340;&#40664;&#35748;&#20540;
:conditions =&gt; {:name =&gt; /regexp/orstring,...}  &#35774;&#23450;&#36335;&#30001;&#30340;&#26465;&#20214;
:name =&gt; value  &#35774;&#23450;:name&#21442;&#25968;&#30340;&#40664;&#35748;&#20540;

eg&#65306;
map.connect 'infos/:year', :controller =&gt; "infos", :action =&gt; "hello", :defaults =&gt; {:year =&gt; 2008},:requirements =&gt; {:year =&gt; /(19|20)\d\d/}, :conditions =&gt; {:method =&gt; :get}

&#27880;&#24847;&#65306;
map.connect "*aa", :controller =&gt; "", :action =&gt; ""
&#31526;&#21512;&#20219;&#20309;&#30340;url&#26684;&#24335;&#65292;&#20294;&#26159;&#19968;&#23450;&#35201;&#27880;&#24847;&#30340;&#26159;&#35201;&#25918;&#22312;&#26368;&#21518;&#65292;&#21542;&#21017;&#20854;&#20182;&#30340;&#36335;&#30001;&#37117;&#26080;&#27861;&#21305;&#37197;&#20102;&#12290;


&#26377;&#21517;&#36335;&#30001;
map.hello "hello/:id", :controller =&gt; "infos", :action =&gt; "index"

1&gt;  hello_url(:id =&gt; 1)&#25110;hello_url :controller =&gt; "infos", :action =&gt; "index"
 &#21487;&#20197;&#35775;&#38382;&#36825;&#20010;url&#12290;

&#27880;&#24847;&#65306; &#20197;&#19978;url&#21487;&#20197;&#29992;path&#26367;&#20195;&#12290;

2&gt;  &#22320;&#22336;&#26639;&#20013;&#21487;&#20197;&#36755;&#20837;hello&#35775;&#38382;&#36825;&#20010;url&#12290;


&#36164;&#28304;&#36335;&#30001;&#65306;

map.resources :articles, :collection =&gt; {:recent =&gt; :get}, :member =&gt; {:release =&gt; :put}, :new =&gt; {:hello =&gt; :get}

&#22686;&#21152;&#20197;&#19979;&#35268;&#21017;&#65306;
recent_articles_path
release_article_path(:id =&gt; 1)
hello_new_article_path




map.resources :articles do |article|
  article.resources :comments
end

articles/99/comments/4


&#25511;&#21046;&#22120;&#29615;&#22659;&#65288;&#21487;&#20197;&#22312;action&#20013;&#30452;&#25509;&#24341;&#29992;)

controller_name:  controller&#21517;&#31216;
action_name:  action&#21517;&#31216;
session: session
cookies: cookie
params&#65306; &#23384;&#25918;&#30528;&#21442;&#25968;&#30340;hash&#23545;&#35937;
rsponse
request&#65306; &#36827;&#20837;&#25511;&#21046;&#22120;&#30340;&#35831;&#27714;&#23545;&#35937;&#65292;&#21253;&#21547;&#23646;&#24615;&#12290;
  domain&#65306; &#35831;&#27714;&#22320;&#22336;&#22495;&#21517;&#37096;&#20998;&#30340;&#26368;&#21518;&#20004;&#31471;&#12290;
  remote_ip&#65306; &#23458;&#25143;&#31471;&#30340;ip&#22320;&#22336;&#12290;
  env&#65306; &#36820;&#22238;&#35831;&#27714;&#30340;&#29615;&#22659;&#12290;
  get?&#12289;post&#65311;&#12289;put&#65311;&#12289;delete&#65311;&#12289;head&#65311;
  method:  &#36820;&#22238;&#23458;&#25143;&#31471;&#35775;&#38382;&#25152;&#20351;&#29992;&#30340;&#35831;&#27714;&#26041;&#27861;&#12290;
  xhr?&#25110;xml_http_request?  &#22914;&#26524;&#35831;&#27714;&#26469;&#33258;AJAX&#30340;&#36741;&#21161;&#26041;&#27861;&#65292;&#21017;&#36820;&#22238;true&#65292;&#21542;&#21017;&#36820;&#22238;false&#12290;



&#25511;&#21046;&#22120;&#24212;&#31572;&#65306;
1&#65306;&#28210;&#26579;&#19968;&#20010;&#27169;&#26495;&#65292;&#26368;&#24120;&#35265;&#30340;(.html&#12289; .rxml&#12289; .rjs)&#12290;
2&#65306;&#36820;&#22238;&#19968;&#20010;&#23383;&#31526;&#20018;&#32473;&#27983;&#35272;&#22120;&#65292;&#20027;&#35201;&#29992;&#20110;&#21457;&#36865;&#38169;&#35823;&#25552;&#31034;&#12290;
3&#65306;&#21457;&#36865;html&#20197;&#22806;&#30340;&#25968;&#25454;&#65292;&#36825;&#31181;&#26041;&#24335;&#36890;&#24120;&#29992;&#20110;&#25552;&#20379;&#19979;&#36733;&#12290;


&#25511;&#21046;&#22120;&#27599;&#27425;&#21482;&#21709;&#24212;&#19968;&#20010;&#35831;&#27714;&#65306;
render&#12289; redirect_to&#12289; send_xxx
1&gt; render :action
2&gt; render :template
3&gt; render :file
4&gt; render :partial  &#35843;&#29992;&#23616;&#37096;&#27169;&#26495;
:object &#25351;&#23450;&#20256;&#36882;&#32473;&#23616;&#37096;&#27169;&#26495;&#30340;&#23545;&#35937;&#12290;
5&gt; render :xml
6&gt; render :nothing
7&gt; render :inline
8&gt; render :text
9&gt; render(:update) do |page| ... end
&#37325;&#35201;&#21442;&#25968;:
:locals =&gt; {}&#65292;&#25351;&#23450;&#27169;&#26495;&#35201;&#20351;&#29992;&#30340;&#23616;&#37096;&#21464;&#37327;&#12290;
:layout =&gt; false|nil|true|&#27169;&#26495;&#21517;&#31216;&#12290;


render_to_string &#21487;&#20197;&#24403;&#20316;render&#20351;&#29992;&#65292;&#19981;&#36807;&#23427;&#19981;&#20250;&#36339;&#36716;&#65292;&#21482;&#20250;&#25226;&#25972;&#20010;&#30340;&#20869;&#23481;&#20316;&#20026;&#23383;&#31526;&#20018;&#36820;&#22238;&#12290;


method_missing&#65306;&#35843;&#29992;&#25351;&#23450;&#30340;action&#21517;&#31216;&#26080;&#25928;&#26102;&#65292;method_missing&#20250;&#28210;&#26579;&#19968;&#20010;&#20869;&#32852;&#30340;&#27169;&#26495;&#65292;&#23558;action&#30340;&#21517;&#31216;&#21644;&#35831;&#27714;&#21442;&#25968;&#26174;&#31034;&#20986;&#26469;&#12290;


eg&#65306;
  def method_missing(name, *args)
    render(:inline =&gt; %{ Unknown action: #{name}
    Here are the request parameters:
    &lt;%= debug(params) %&gt;})
  end




send_data(data, options)  &#21457;&#36865;&#19968;&#20010;&#25968;&#25454;&#27969;&#32473;&#23458;&#25143;&#31471;&#12290;
&#21442;&#25968;&#65306;
:filename&#12289; disposition(inline|attachment)&#12289;status&#12289;type

send_file(path, options)  &#21457;&#36865;&#19968;&#20010;&#25991;&#20214;&#32473;&#23458;&#25143;&#31471;
&#21442;&#25968;&#65306;
:filename&#12289; :disposition&#12289; :status&#12289; :type&#12289; buffer_size&#12289; stream


&#37325;&#23450;&#21521;&#65306;
redirect_to(:action =&gt; "")
redirect_to(path)
redirect_to(:back)  &#36820;&#22238;&#19978;&#19968;&#39029;&#65292;&#27880;&#24847;&#65306;&#22914;&#26524;redirect_to(:back)&#20889;&#22312;&#20102;index&#30340;action&#20013;&#65292;&#24182;&#19988;&#35775;&#38382;index&#30340;&#26102;&#20505;&#33021;&#22815;&#30452;&#25509;&#36816;&#34892;redirect_to(:back),&#21017;&#19981;&#33021;&#30452;&#25509;&#35775;&#38382;index&#30340;action&#65292;&#22240;&#20026;&#20182;&#20250;&#36339;&#36716;&#19978;&#19968;&#39029;&#65292;&#20294;&#26159;&#27809;&#26377;&#19978;&#19968;&#39029;&#12290;


&#36807;&#28388;&#22120;&#65306;
prepend_before_filter
before_filter&#12289;append_before_filter
prepend_after_filter
after_filter&#12289;append_before_filter

&#21442;&#25968;:
:only&#12289; :except

&#23450;&#20041;&#36807;&#28388;&#22120;&#30340;&#26041;&#24335;&#65306;
1&#65306;
before_filter do
  ...
end

2:
before_filter :hello, :only =&gt; [:show, :index]


skip_filter&#12289; skip_before_filter&#12289;skip_after_filter
&#21442;&#25968;:
:only&#12289; :except


&#32531;&#23384;:

&#29255;&#27573;&#32531;&#23384;&#12289; &#39029;&#38754;&#32531;&#23384;&#12289; action&#32531;&#23384;
caches_page&#12289; caches_action&#12289; cache do .... end

&#40664;&#35748;&#37197;&#32622;&#19979;&#65292;cache&#21482;&#26377;&#22312;&#20135;&#21697;&#29615;&#22659;&#19979;&#25165;&#29983;&#25928;&#65292;&#22914;&#26524;&#35201;&#22312;&#24320;&#21457;&#29615;&#22659;&#19979;&#29983;&#25928;&#65292;&#35201;&#37197;&#32622;&#20197;&#19979;&#20449;&#24687;&#20013;&#30340;&#19968;&#26465;&#12290;&#65288;config/environments/development.rb&#65289;
ActionController::Base.perform_caching = true|false
config.action_controller.perform_caching = true

&#35299;&#38500;&#32531;&#23384;&#65306;
expire_action&#12289; expire_page&#12289; expire_fragment :controller =&gt; "...", :action =&gt; "..."

1&#12299;&#40664;&#35748;&#65306;&#32531;&#23384;&#29255;&#27573;&#30340;&#21517;&#23383;&#21462;&#20915;&#20110;&#28210;&#26579;&#35813;&#39029;&#38754;&#30340;&#25511;&#21046;&#22120;&#21517;&#31216;&#21644;action&#21517;&#31216;&#65292;&#25152;&#20197;&#20351;&#29992;expire_fragment&#25351;&#23450;&#25511;&#21046;&#22120;&#21517;&#31216;&#21644;action&#21517;&#31216;&#26469;&#26159;&#23545;&#24212;&#30340;&#29255;&#27573;&#32531;&#23384;&#22833;&#25928;&#12290;
2&#12299;&#25351;&#23450;&#32531;&#23384;&#21517;&#31216;&#65288;&#31561;&#21516;&#20110;url_for&#30340;&#21442;&#25968;&#65289;


&#32531;&#23384;&#23384;&#20648;&#26426;&#21046;&#30340;&#20840;&#23616;&#35774;&#32622;(environment.rb&#35774;&#32622;)&#65306;
&#32531;&#23384;&#30446;&#24405;&#65306;
config.action_controller.page_cache_directory = RAILS_ROOT + "/public/caches"
&#32531;&#23384;&#31867;&#22411;&#65306;
config.action_controller.page_cache_extension = ".html"


&#32570;&#28857;&#65306;&#23548;&#33268;&#22823;&#37327;&#30340;&#25968;&#25454;&#20174;&#32593;&#32476;&#39537;&#21160;&#22120;&#20256;&#36755;&#21040;&#26576;&#19968;&#21488;&#20855;&#20307;&#30340;web&#26381;&#21153;&#22120;&#65292;&#28982;&#21518;&#23558;&#36825;&#20123;&#25968;&#25454;&#21457;&#36865;&#32473;&#29992;&#25143;&#65292;&#25152;&#20197;&#65292;&#22914;&#26524;&#22312;&#39640;&#21520;&#37327;&#30340;&#32593;&#31449;&#20013;&#20351;&#29992;&#36825;&#31181;&#23384;&#20648;&#26426;&#21046;&#65292;&#26381;&#21153;&#22120;&#20043;&#38388;&#30340;&#32593;&#32476;&#23485;&#24102;&#24212;&#35813;&#38750;&#24120;&#23485;&#12290;

&#32531;&#23384;&#23384;&#20648;&#20307;&#31995;&#21482;&#23545;action&#32531;&#23384;&#21644;&#29255;&#27573;&#26377;&#25928;&#65292;&#20840;&#39029;&#38754;&#32531;&#23384;&#24517;&#39035;&#20197;&#25991;&#20214;&#30340;&#24418;&#24335;&#25918;&#22312;public&#30446;&#24405;&#19979;&#12290;

&#39029;&#38754;&#32531;&#23384;&#26159;&#26368;&#24555;&#36895;&#30340;&#19968;&#31181;&#32531;&#23384;&#24212;&#29992;&#12290;&#37027;&#20040;&#24212;&#35813;&#22312;&#20160;&#20040;&#26102;&#20505;&#20351;&#29992;&#20182;&#21602;&#65311;
1&#12289;&#23545;&#20110;&#25152;&#26377;&#29992;&#25143;&#37117;&#30456;&#21516;&#30340;&#39029;&#38754;
2&#12289;&#20844;&#24320;&#30340;&#39029;&#38754;&#65292;&#27809;&#26377;&#29992;&#25143;&#35748;&#35777;&#30340;&#39029;&#38754;

&#32531;&#23384;&#20998;&#39029;:
&#22240;&#20026;&#39029;&#38754;&#32531;&#23384;&#30340;&#26102;&#20505;&#20250;&#24573;&#30053;&#25481;&#20687;/blog /list?page=2&#36825;&#26679;&#30340;&#21442;&#25968;&#65292;&#25152;&#20197;&#20320;&#38656;&#35201;&#20351;&#29992;/blog/list/2&#36825;&#26679;&#30340;&#22320;&#22336;&#24418;&#24335;&#65292;&#32780;&#21407;&#26469;&#25105;&#20204;&#20351;&#29992;&#30340;&#26159;id&#20445;&#23384;&#21442;&#25968;&#20540;&#65292;&#29616;&#22312;&#25105;&#20204;&#38656;&#35201;&#29992; page&#26469;&#20445;&#23384;&#21442;&#25968;&#20540;&#12290;
&#19979;&#38754;&#25105;&#20204;&#20462;&#25913; /config/routes.rb&#25991;&#20214;

map.connect 'blog/list/:page',
    :controller =&gt; 'blog',
    :action =&gt; 'list',
    :requirements =&gt; { :page =&gt; /\d+/},
    :page =&gt; nil

&#20351;&#29992;&#20102;&#26032;&#30340;routes&#23450;&#20041;&#65292;&#25105;&#20204;&#30340;&#36830;&#25509;&#20063;&#24212;&#35813;&#25913;&#25104;

&lt;%= link_to "Next Page", :controller =&gt; 'blog', :action =&gt; 'list', :page =&gt; 2 %&gt;

&#26368;&#32456;&#30340;&#36830;&#25509;&#32467;&#26524;&#26159;"/blog/list/2"&#65292;&#24403;&#25105;&#20204;&#28857;&#36825;&#20010;&#36830;&#25509;&#30340;&#26102;&#20505;&#65292;&#21518;&#21488;&#20250;&#22788;&#29702;&#20004;&#20214;&#20107;&#24773;
1&#12289;&#24212;&#29992;&#23558;2&#25918;&#20837;page&#36825;&#20010;&#21442;&#25968;&#20013;&#65292;&#32780;&#19981;&#26159;&#21407;&#26469;id&#36825;&#20010;&#21442;&#25968;
2&#12289;&#32531;&#23384;&#23558;&#29983;&#25104; /public/blog/list/2.html &#36825;&#20010;&#39029;&#38754;

&#25152;&#20197;&#65292;&#32531;&#23384;&#20998;&#39029;&#65292;&#23601;&#35201;&#23558;&#39029;&#38754;&#21442;&#25968;&#21464;&#25104;&#39029;&#38754;&#30340;&#19968;&#37096;&#20998;&#65292;&#32780;&#19981;&#35201;&#20351;&#29992;&#22320;&#22336;&#21442;&#25968;&#30340;&#24418;&#24335;&#65292;&#20182;&#26159;&#20250;&#34987;&#24573;&#30053;&#30340;&#12290;


&#35299;&#20915;&#21361;&#38505;&#38142;&#25509;&#30340;&#26041;&#24335;&#65306;
1&#65306;&#20351;&#29992;&#34920;&#21333;&#21644;&#25353;&#38062;&#65288;button_to&#65289;
2&#65306;&#20351;&#29992;&#30830;&#35748;&#39029;&#38754;


link_to&#12289;link_to_if&#12289;link_to_unless&#12289;button_to
stylesheet_link_tag
javascript_include_tag:   &#20551;&#35774;&#25991;&#20214;&#22312;public/javascripts&#30446;&#24405;

&#23545;&#35937;&#35843;&#29992;&#23646;&#24615;&#65306;
eg&#65306; info.name &#25110; info["name"]

form_for&#12289; form_tag

form_for(:info, @info, :url =&gt; {:action =&gt; "create"}, :html =&gt; {:method =&gt; "post"}
:info   &#21578;&#35785;rails&#27491;&#22312;&#25805;&#20316;&#21738;&#20010;&#27169;&#22411;&#31867;&#30340;&#23545;&#35937;
@info   &#36890;&#36807;&#21738;&#20010;&#23454;&#20363;&#21464;&#37327;&#33719;&#24471;&#35813;&#23545;&#35937;
:url    &#35775;&#38382;&#30340;action&#22320;&#22336;
:html   &#23450;&#20041;&#35775;&#38382;&#30340;&#26041;&#27861;&#65292;&#21487;&#20197;&#23450;&#20041;:multipart =&gt; true&#65292;&#19978;&#20256;&#12290;


select&#26631;&#31614;:
1&gt;collection_select(:post, :author_id, Author.all, :id, :name_with_initial, {:prompt =&gt; true})

2&gt;select&#12289;select_tag "people", "David"

3&gt;options_from_collection_for_select(@people, 'id', 'name')

4&gt;options_for_select({ "Basic" =&gt; "$20", "Plus" =&gt; "$40" }, "$40")

&#23376;&#34920;&#21333;&#65306;
&lt;% fields_for :name, @info.name do |field| %&gt;
  Name: &lt;%= field.text_field :name %&gt;
&lt;% end %&gt;


&#21368;&#36733;layout&#39029;&#38754;&#20013;&#65306;

&lt;% content_for :head do %&gt;
  ab
&lt;% end %&gt;

&lt;%= yield :head %&gt;



&#21457;&#36865;&#37038;&#20214;&#65306;

config.action_mailer.delivery_method = :smtp|:sendmail|:test

&#24320;&#21457;&#29615;&#22659;&#19979;&#40664;&#35748;&#30340;&#35774;&#32622;&#26159;:smtp&#12290;
:smtp&#12289;:sendmail &#21487;&#20197;&#35753;ActionMailer&#21457;&#36865;&#37038;&#20214;&#12290;
:test &#21487;&#20197;&#29992;&#20110;&#21333;&#20803;&#27979;&#35797;&#21644;&#21151;&#33021;&#27979;&#35797;&#65292;&#30005;&#23376;&#37038;&#20214;&#19981;&#20250;&#21457;&#36865;&#20986;&#21435;&#65292;&#32780;&#26159;&#34987;&#25918;&#20837;&#19968;&#20010;&#25968;&#32452;&#12290;

&#31105;&#27490;&#24320;&#21457;&#29615;&#22659;&#19979;&#21457;&#36865;&#37038;&#20214;&#65306;
config/environments/development.rb&#20013;&#35774;&#32622;config.action_mailer.delivery_method = :test

config.action_mailer.perform_deliveries = true|false
perform_deliveries&#20026;true&#65292;&#37038;&#20214;&#34987;&#27491;&#24120;&#21457;&#36865;&#65292;&#21542;&#21017;&#19981;&#21457;&#36865;&#65292;&#29992;&#20110;&#27979;&#35797;&#12290;

config.action_mailer.raise_delivery_errors = true|false
&#35774;&#32622;&#37038;&#20214;&#21457;&#36865;&#36807;&#31243;&#20013;&#30340;&#24322;&#24120;&#26159;&#21542;&#25243;&#36824;&#32473;&#24212;&#29992;&#31243;&#24207;&#12290;false&#20026;&#24573;&#30053;&#65292;true&#20026;&#25243;&#36824;&#12290;

config.action_mailer.default_charset = "utf-8"
&#35774;&#32622;&#21457;&#36865;&#37038;&#20214;&#30340;&#23383;&#31526;&#38598;&#12290;

ActionMailer::Base.smtp_settings = {
    :address =&gt; "smtp.163.com",:port =&gt; 25,:domain =&gt; ".com",    :authentication =&gt; :login,:user_name =&gt; "zhangcaiyan0123@163.com",:password =&gt; "zhangcaiyan",}
&#35774;&#32622;smtp&#26381;&#21153;&#22120;&#65288;&#20854;&#20013;domain&#26159;&#22495;&#21517;&#31216;&#65289;


ruby script/generate mailer OrderMailer confirm sent
&#27169;&#22411;&#20013;&#23450;&#20041;&#26041;&#27861;&#65306;
  def confirm(sent_at = Time.now)
    subject    '&#26631;&#39064;'
    recipients "zhangcaiyanbeyond@gmail.com"
    from       'zhangcaiyan0123@163.com'
    sent_on    sent_at
    body       "&#37038;&#20214;&#27491;&#25991;"
  end

bcc          &#26263;&#36865;
cc           &#25220;&#36865;
charset        &#40664;&#35748;&#20026;smtp_settings&#20013;&#30340;default_charset&#23646;&#24615;
subject        &#26631;&#39064;
from        &#21457;&#20214;&#20154;&#30340;&#37038;&#31665;
recipients     &#25910;&#20214;&#20154;&#30340;&#37038;&#31665;
body        &#27491;&#25991;
send_on     &#21457;&#36865;&#26102;&#38388;
headers        &#25351;&#23450;&#37038;&#20214;&#30340;&#22836;&#20449;&#24687;
attachment(&#19978;&#20256;&#25554;&#20214;) :filename =&gt; &#25991;&#20214;&#21517;&#31216;, :body =&gt; &#25991;&#20214;&#20869;&#23481;(file.read), :content_type =&gt; "&#20869;&#23481;&#31867;&#22411;"


OrderMailer.deliver_confirm   &#21457;&#36865;&#37038;&#20214;

email = OrderMailer.create_confirm    &#21019;&#24314;&#37038;&#20214;&#23545;&#35937;&#65288;TMail::Mail&#23545;&#35937;&#65289;
OrderMailer.deliver(email)

&#27880;&#24847;&#65306;  OrderMailer&#26159;&#27169;&#22411;&#31867;&#65292;create_confirm&#20013;&#30340;create&#26159;&#34920;&#31034;&#35201;&#21019;&#24314;&#23545;&#35937;&#65292;confirm&#26159;&#34920;&#31034;&#27169;&#22411;&#31867;&#20013;&#30340;&#26041;&#27861;&#65292;deliver&#34920;&#31034;&#35201;&#21457;&#36865;&#37038;&#20214;&#12290;



&#20445;&#25252;rails&#24212;&#29992;&#65306;

&#38450;&#24481;sql&#27880;&#20837;&#25915;&#20987;&#65306;
eg&#65306;&#36825;&#20010;&#23454;&#20363;&#23601;&#26159;&#24694;&#24847;&#27880;&#20837;&#30340;&#20363;&#23376;&#65292;&#20854;&#20013;1&#20026;true&#65292;&#20182;&#20250;&#26597;&#22788;&#34920;&#20013;&#30340;&#25152;&#26377;&#25968;&#25454;&#12290;
Core::User.find(:all, :conditions =&gt; "id &gt; '' or 1")

&#38450;&#27490;&#24694;&#24847;&#27880;&#20837;&#65306;
&#32477;&#23545;&#19981;&#35201;&#29992;ruby&#30340;#{...}&#26426;&#21046;&#30452;&#25509;&#25226;&#23383;&#31526;&#20018;&#25554;&#20837;&#21040;sql&#35821;&#21477;&#20013;&#65292;&#32780;&#24212;&#35813;&#29992;Rails&#25552;&#20379;&#30340;&#21464;&#37327;&#32465;&#23450;&#12290;
eg&#65306;
Core::User.find(:all, :conditions =&gt; ["id &gt; ?", 3])
Core::User.find(:all, :conditions =&gt; ["id &gt; :id", {:id =&gt; 3}])



&#29992;&#21442;&#25968;&#30452;&#25509;&#21019;&#24314;&#35760;&#24405;&#65306;
User.create(params[:user])

&#20026;&#20102;&#38450;&#27490;&#29992;&#25143;&#27169;&#25311;&#19968;&#20123;&#23646;&#24615;&#25552;&#20132;&#65292;&#25105;&#20204;&#21487;&#20197;&#23558;&#26576;&#20123;&#23646;&#24615;&#20445;&#25252;&#36215;&#26469;&#12290;

attr_protected  :&#23646;&#24615;1&#65292; :&#23646;&#24615;2  &#21015;&#20986;&#34987;&#20445;&#25252;&#30340;&#23646;&#24615;
attr_accessible :&#23646;&#24615;1&#65292; :&#23646;&#24615;2  &#21015;&#20986;&#20801;&#35768;&#33258;&#21160;&#36171;&#20540;&#30340;&#23646;&#24615;&#65292;&#20063;&#23601;&#26159;&#35828;&#38500;&#27492;&#20043;&#22806;&#30340;&#37117;&#26159;&#34987;&#20445;&#25252;&#30340;&#23646;&#24615;

&#34987;&#20445;&#25252;&#30340;&#23646;&#24615;&#20063;&#23601;&#26159;&#19981;&#33021;&#36890;&#36807;create(params[:user])&#30452;&#25509;&#20445;&#23384;&#65292;&#32780;&#26159;&#38656;&#35201;&#36890;&#36807;&#36171;&#20540;&#25165;&#21487;&#20197;&#12290;eg&#65306;
user = User.new
user.role = params[:role]
user.save


&#19981;&#35201;&#30456;&#20449;ID&#21442;&#25968;&#65306;
&#24403;&#25105;&#20204;&#36890;&#36807;id&#26597;&#25214;&#20986;&#25968;&#25454;&#65292;&#28982;&#21518;&#23545;&#25968;&#25454;&#36827;&#34892;&#25805;&#20316;&#26102;&#65292;&#25105;&#20204;&#35201;&#27880;&#24847;&#26576;&#20123;&#24773;&#20917;&#65306;&#20363;&#22914;&#24403;&#25105;&#20204;&#27983;&#35272;(/show/id)&#26576;&#20010;&#29992;&#25143;&#30340;&#25968;&#25454;&#26102;&#65292;&#21487;&#20197;&#21033;&#29992;url&#27983;&#35272;&#20854;&#20182;&#29992;&#25143;&#30340;&#25968;&#25454;&#65292;&#20026;&#20102;&#38450;&#27490;&#36825;&#26679;&#30340;&#20107;&#21457;&#29983;&#65292;&#21487;&#20197;&#36825;&#26679;&#65306;
eg&#65306;
1&#12299; order = Order.find(params[:id], :conditions =&gt; ["user_id = ?", user_id])
2&#12299; order = @user.orders.find(id)
3&#12299; order = @user.orders.find(id).destroy


&#38450;&#24481;XSS&#25915;&#20987;&#65306;

&#25915;&#20987;&#32773;&#25226;&#33258;&#24049;&#32534;&#20889;&#30340;javascript&#33050;&#26412;&#25918;&#36827;&#32593;&#39029;&#65292;&#26469;&#33719;&#24471;&#20182;&#20204;&#24819;&#35201;&#30340;cookie&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;rails&#25552;&#20379;&#30340;h(string)&#36741;&#21161;&#26041;&#27861;(&#23454;&#38469;&#19978;&#26159;html_escape()&#26041;&#27861;&#30340;&#21035;&#21517;)


&#29983;&#25104;rails&#39033;&#30446;&#30340;HTML&#25991;&#26723;
rake doc:app


ActiveRecord::Errors.default_error_messages = hash
&#20462;&#25913;&#40664;&#35748;&#38169;&#35823;&#26174;&#31034;&#20449;&#24687;



named_scope&#30340;&#20351;&#29992;&#65306;

named_scope :quanbu, :conditions =&gt; ["name=zcy"]
named_scope :xianzhi, :lambda{|limit|{:limit = limit}}

Shili.quanbu.xianzhi(3)


&#26174;&#31034;&#38169;&#35823;&#39029;&#38754;:  &#24403;&#25351;&#23450;&#30340;&#24322;&#24120;&#21457;&#29983;&#26102;&#65292;&#23558;&#26174;&#31034;&#29305;&#23450;&#30340;&#39029;&#38754;&#65292;&#36825;&#20010;&#26368;&#22909;&#25918;&#21040;application_controller&#20013;

rescue_from  &#24322;&#24120;&#65292; :with =&gt; :action

eg&#65306;
rescue_from Exception, :with =&gt; :error

def error
  render :file =&gt; "novel/infos/error", :layout =&gt; "novel"
end

&#23545;&#20110;boolean&#31867;&#22411;&#30340;&#25968;&#25454;&#65292;&#24212;&#35813;&#30465;&#30053;&#21069;&#38754;&#30340;is_&#65292;ActiveRecord&#20250;&#33258;&#21160;&#21152;&#20010;?&#21495;&#65292;&#26144;&#23556;&#25104;actived? &#65292;&#19981;&#26159;boolean&#22411;&#30340;&#25968;&#25454;&#20063;&#20250;&#20063;&#20250;&#25193;&#23637;&#65311;




_form&#19979;&#30340;&#20849;&#20139;&#34920;&#21333;&#65292;&#21306;&#38388;&#30340;&#24773;&#20917;

1:map.namespace :doctor do |doctor|
    doctor.resources :patients
end
["doctor", @patient ]

2:map.resources :doctor do |doctor|
    doctor.resources :patients
end
[@doctor, @patient ]







</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/85</id>
    <published>2011-03-02T19:26:00+08:00</published>
    <updated>2011-06-22T08:55:02+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/85-resolvation-download-excel-from-ie"/>
    <title>ie&#19979;&#33258;&#21160;&#19979;&#36733;excel&#34920;&#30340;&#35299;&#20915;&#26041;&#24335;&#65306;</title>
    <summary>ie&#19979;&#33258;&#21160;&#19979;&#36733;excel&#34920;&#30340;&#35299;&#20915;&#26041;&#24335;&#65306;

1&#65306; &#37197;&#32622;  

    config.action_controller.use_accept_header = false

&#29992;&#20110;&#35774;&#32622;&#30830;&#23450;response&#26684;&#24335;&#30340;&#35268;&#21017;&#12290;&#22914;&#26524;&#35813;&#20540;&#35774;&#20026;true&#65288;&#40664;&#35748;&#20540;&#65289;&#65292;&#21017;respond_to&#26041;&#27861;&#21644;Request#format&#26041;&#27861;&#20250;&#26681;&#25454;Accept Header&#36820;&#22238;&#30456;&#24212;&#26684;&#24335;&#30340;response&#12290;&#24369;&#35813;&#20540;&#35774;&#20026;false&#21017;request&#26684;&#24335;&#20250;&#21333;&#29420;&#30001;params[:format]&#26469;&#20915;&#23450;&#12290;&#22914;&#26524;&#27809;&#26377;format&#21442;&#25968;&#65292;&#21017;response&#30340;&#26684;&#24335;&#20250;&#26681;&#25454;request&#26159;&#21542;&#26159;&#19968;&#20010;Ajax request&#26469;&#20915;&#23450;&#36820;&#22238;HTML&#36824;&#26159;Javascript&#12290;

2&#65306;  controller

    before_filter :hijack_ie_default_format
    
    protected
    
    def hijack_ie_default_format  # params[:format]&#20026; nil &#26102;&#65292;&#35774;&#32622;&#20026; html
      if request.user_agent =~ /MSIE/ and params['format'].nil?
        params['format'] = 'html'
      end
    end

</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/84</id>
    <published>2011-03-02T19:19:59+08:00</published>
    <updated>2011-06-22T08:59:17+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/84-think-over-of-callback-methods"/>
    <title>&#20351;&#29992;update&#30340;&#22238;&#35843;&#26041;&#27861;&#24515;&#24471;</title>
    <summary>&#22312;&#20351;&#29992;update&#30340;&#22238;&#35843;&#26041;&#27861;&#20013;,  
  **1)&#26159;&#21542;&#36935;&#21040;&#36807; &#38656;&#35201;&#29992;&#21040;&#26356;&#25913;&#35813;&#23545;&#35937;&#23646;&#24615;&#20043;&#21069;&#30340;&#23646;&#24615;&#20540;  
  2)&#26159;&#21542;&#36935;&#21040;&#36807;&#24819;&#35201;&#21482;&#26356;&#25913;&#26576;&#20010;&#23646;&#24615;&#25165;&#21435;&#35302;&#21457;&#22238;&#35843;&#26041;&#27861;**  

&#22909;&#30340;,&#25105;&#20204;&#26469;&#35299;&#20915;&#36825;&#20004;&#20010;&#21151;&#33021;&#38656;&#27714;:    
  1)  &#26080;&#35770;&#20320;&#20351;&#29992;`before_update&#36824;&#26159;after_update`,&#24403;&#20320;&#25913;&#21464;&#20102;&#26576;&#20010;&#23646;&#24615;&#30340;&#20540;,&#20363;&#22914;age&#21543;,&#20320;&#22312;&#22238;&#35843;&#26041;&#27861;&#20013;`self.age` &#25110; `age`&#24471;&#21040;&#30340;&#37117;&#26159;&#26356;&#25913;&#21518;&#30340;&#20540;,&#26080;&#35770;&#35813;&#22238;&#35843;&#26041;&#27861;&#26159;&#21542;&#21487;&#20197;&#26377;&#25928;&#25191;&#34892;,&#36825;&#26102;&#25105;&#20204;&#35201;&#21462;&#21040;&#26356;&#25913;&#20043;&#21069;age&#24471;&#20540;&#24471;&#35805;: &#21487;&#20197;   `@obj.age_change`,&#36825;&#20010;&#26041;&#27861;&#36820;&#22238;&#24471;&#26159;&#19968;&#20010;&#25968;&#32452;,&#31532;&#19968;&#20010;&#26159;&#25913;&#21464;&#20043;&#21069;&#24471;&#20540;,&#31532;&#20108;&#20010;&#26159;&#25913;&#21464;&#20043;&#21518;&#24471;&#20540;.  

  2)  &#25105;&#20204;&#35201;&#23454;&#29616;&#20540;&#26356;&#25913;&#26576;&#20010;&#23646;&#24615;&#30340;&#24773;&#20917;&#19979;,&#25165;&#21435;&#25191;&#34892;&#22238;&#35843;&#26041;&#27861;,&#32769;&#23454;&#35828;,&#25105;&#20063;&#20570;&#19981;&#21040;,&#19981;&#36807;,&#25105;&#20204;&#21487;&#20197;&#36825;&#26679;,&#20363;&#22914;: &#22312;&#22238;&#35843;&#20013;&#21152;if&#26465;&#20214;&#65292;&#25913;&#21464;&#20102;age&#24471;&#20540;&#24471;&#26102;&#20505;,&#25165;&#21435;&#25191;&#34892;&#22238;&#35843;&#26041;&#27861;&#20013;&#24471;&#20869;&#23481;:

    def before_update
        if age_changed?  # &#25913;&#21464;&#20102;age&#23646;&#24615;&#24471;&#20540;&#24471;&#26102;&#20505;,&#25191;&#34892;......
           ........
        end
    end</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/83</id>
    <published>2011-02-22T10:58:37+08:00</published>
    <updated>2011-06-22T04:46:58+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/83-launch-a-rails3-project-without-database"/>
    <title>&#21551;&#21160;&#19968;&#20010;&#19981;&#24102;&#25968;&#25454;&#24211;&#30340;rails3&#39033;&#30446;</title>
    <summary>&#25214;&#21040;`application.rb`, &#23558; `require 'rails/all`&#26367;&#25442;&#20026;  

    require "action_controller/railtie"
    require "action_mailer/railtie"
    require "active_resource/railtie"
    require "rails/test_unit/railtie"

&#20063;&#23601;&#26159;&#25226;`active_model`&#21435;&#25481;&#20102;&#65292;&#21551;&#21160;&#39033;&#30446;&#23601;&#26080;&#38656;&#25968;&#25454;&#24211;&#20102;&#12290;
</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/82</id>
    <published>2011-02-20T23:10:54+08:00</published>
    <updated>2011-06-22T08:51:56+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/82-modify-user-of-passenger"/>
    <title>&#26356;&#25913; passenger&#30340;&#36816;&#34892;&#29992;&#25143;&#36523;&#20221;</title>
    <summary>&#29615;&#22659;&#65306; archlinux&#12289;nginx0.8.31&#12289;passenger2.2.2&#12289;rails2.3.4&#65292;rails&#37096;&#32626;&#37319;&#29992;nginx+passenger

&#20851;&#20110; passenger &#21040;&#24213;&#26159;&#20197;&#37027;&#20010;&#29992;&#25143;&#36523;&#20221;&#36816;&#34892;&#30340;&#65292;&#19979;&#38754;&#36825;&#27573;&#32473;&#20102;&#26126;&#30830;&#30340;&#23450;&#20041;

&gt; passenger&#26159;&#26681;&#25454;config/environment.rb&#36825;&#20010;&#25991;&#20214;&#30340;owner&#26469;&#20915;&#23450;&#37319;&#29992;&#21738;&#20010;&#29992;&#25143;&#26469;&#36816;&#34892;&#12290;&#22914;&#26524;
&gt; config/environment.rb&#30340;&#20027;&#20154;&#26159;www&#65292;&#37027;&#20040;&#23601;&#24050;www&#36816;&#34892;&#12290;
&gt; &#20294;&#26159;passenger&#27704;&#36828;&#20063;&#19981;&#20250;&#20197;root&#36523;&#20221;&#36816;&#34892;&#65292;&#22914;&#26524;&#23427;&#21457;&#29616;
&gt; config/environment.rb&#30340;&#20027;&#20154;&#26159;root&#65292;&#23601;&#20250;&#29992;PassengerDefaultUser&#30340;&#20540;&#26469;&#26367;&#20195;&#12290;



&#37027;&#20040;&#22914;&#20309;&#26356;&#25913; passenget  &#30340;&#36816;&#34892;&#29992;&#25143;&#36523;&#20221;&#21738;&#65311;&#21487;&#20197;&#30475;&#19979;&#38754;&#30340;&#23448;&#26041;&#25991;&#26723;
http://www.modrails.com/documentation/Users%20guide%20Nginx.html#PassengerDefaultUser

&#22909;&#20102;&#65292;&#19979;&#38754;&#35828;&#35828; nginx+passenger &#37096;&#32626;&#19979;&#22914;&#20309;&#26356;&#25913; PassengerDefaultUser &#30340;&#20540;


    &#22312;http&#27573;&#20013;&#20462;&#25913;&#65292;&#20462;&#25913;&#40664;&#35748;&#29992;&#25143;&#20026;www&#29992;&#25143;
    http{
      ...
      passenger_root /usr/src/nginx-0.8.31/passenger;
      passenger_ruby /usr/bin/ruby;
      passenger_default_user www;  
      server {
        listen 81;
        server_name localhost;
        root /srv/http/railsapp/paperclip/public;
        passenger_enabled on;
        rails_env development;
      }
      ...
    }



&#21518;&#35760;&#65306;&#24403;&#37319;&#29992; nginx+passenger &#37096;&#32626;rails&#26102;&#65292;&#27604;&#22914;&#35828;&#19978;&#20256;&#25991;&#20214;&#26102;&#65292;&#21487;&#33021;&#23601;&#20250;&#29992;&#21040;&#25991;&#20214;&#26435;&#38480;&#38382;&#39064;&#65292;&#30693;&#36947; passenger  &#30340;&#36816;&#34892;&#29992;&#25143;&#36523;&#20221;&#23601;&#24456;&#37325;&#35201;&#20102;&#12290; 
</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/81</id>
    <published>2011-02-17T21:08:17+08:00</published>
    <updated>2011-06-22T15:51:22+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/81-configuration-with-rvm-rails3-nginx-passenger-on-ubuntu"/>
    <title>ubutnu&#37197;&#32622;rvm&#12289;rails3&#12289;nginx&#21644;passenger&#30340;&#29983;&#20135;&#29615;&#22659;</title>
    <summary>&#39318;&#20808;&#65292; &#20351;&#29992; root &#24080;&#21495;&#30331;&#24405;  

&#23433;&#35013;git&#21644;curl  

    apt-get install curl git-core

&#20351;&#29992;&#33050;&#26412;&#23433;&#35013;rvm  

    bash &lt; &lt;(curl -L http://bit.ly/rvm-install-system-wide)

&#33050;&#26412;&#20250;&#33258;&#21160;&#21019;&#24314;&#19968;&#20010;rvm&#32452;&#65292;&#24182;&#23558;root&#29992;&#25143;&#21152;&#20837;  
&#32534;&#36753; `/root/.bashrc&#21644;/etc/skel/.bashrc` &#23558;

    [ -z "$PS!"] &amp;&amp; return

&#26367;&#25442;&#20026;  

    if [[ -n "$PS1" ]]; then

&#22312;&#25991;&#20214;&#26368;&#21518;&#21152;&#20837;

    fi
    if groups | grep -q rvm ; then
    source "/usr/local/lib/rvm"
    fi

&#37197;&#32622;&#29992;&#25143;  

    #&#22686;&#21152;more&#29992;&#25143;
    adduser more
    #&#23558;more&#21152;&#20837;rvm&#32452;
    adduser more rvm
    gpasswd -a more sudo  #&#23558;&#29992;&#25143;more&#28155;&#21152;&#36827;sudo&#32452;

&#30331;&#24405;more&#29992;&#25143;&#24182;&#27979;&#35797;  

    type rvm | head -n1

&#22914;&#26524;&#26174;&#31034; rvm is a function &#21017;&#34920;&#31034;&#23433;&#35013;&#27491;&#30830;  

&#23433;&#35013;ree&#20381;&#36182;&#32452;&#20214;  

    aptitude install build-essential bison openssl libreadline5 libreadline-dev \
    curl git-core zlib1g zlib1g-dev libssl-dev vim libsqlite3-0 libsqlite3-dev \
    sqlite3 libreadline-dev libxml2-dev git-core subversion autoconf

(&#40664;&#35748;&#26032;&#30340;&#36134;&#25143;&#24182;&#26377;aptitude,&#38656;&#35201;apt-get&#23433;&#35013;&#65292;&#22312;root&#29992;&#25143;&#19979;&#65292;&#23433;&#35013;&#23436;&#25104;&#22312;&#25191;&#34892;&#19978;&#38754;&#30340;&#21629;&#20196;)
&#23433;&#35013;ree  

    rvm install ree

&#35774;&#20026;&#40664;&#35748;&#29615;&#22659;  

    rvm use ree &#8211;default

&#26816;&#26597;

    ruby &#8211;v
    Gem list

&#23433;&#35013;rails

    Gem install rails

&#40664;&#35748;&#23433;&#35013;&#30340;&#26159;&#26368;&#26032;&#29256;&#26412;  
&#23433;&#35013;passenger&#21644;nginx  

    gem install passenger
    rvmsudo passenger-install-nginx-module

&#65288;&#27492;&#36807;&#31243;&#33258;&#21160;&#23433;&#35013;nginx&#65292;&#24320;&#22987;&#20808;&#20250;&#26816;&#26597;&#20381;&#36182;&#32452;&#20214;&#65292;&#22914;&#27809;&#26377;&#65292;&#20250;&#25552;&#31034;&#23433;&#35013;&#21629;&#20196;&#12290;&#26816;&#26597;&#36890;&#36807;&#20840;&#37096;&#32452;&#20214;&#23384;&#22312;&#21518;&#65292;&#25165;&#33021;&#32487;&#32493;&#21518;&#38754;&#30340;&#27493;&#39588;&#12290; &#21040;&#26368;&#21518;&#26159;1&#21644;2&#30340;&#36873;&#25321;&#65292;&#25105;&#24403;&#26102;&#36873;&#25321;&#20102;1&#65292;&#22909;&#20687;&#26159;&#33258;&#21160;&#32534;&#35793;&#20102;&#12290;&#65289;  
&#35774;&#32622;ree&#30001;passenger&#21551;&#21160;  

    rvm use ree --passenger

&#20462;&#25913;nginx&#37197;&#32622;&#25991;&#20214;

    Vi  /opt/nginx/conf/nginx.conf

&#24320;&#21551; gzip  on;&#21435;&#25481;&#21069;&#38754;&#30340;&#27880;&#37322;  

    server {
            listen       80;
            server_name  xxx.com www.xxx.com;
    	root /home/more/demo/public;
    	passenger_enabled on;
    
            location ~ ^/(image|javascripts|stylessheets)/ {
                root   /home/demo/public;
                expires 30d;
            } 
    }

&#27492;&#22788;&#25353;&#29031;&#23454;&#38469;&#26412;&#26426;&#30340;&#39033;&#30446;&#30446;&#24405;&#35774;&#23450;
&#25105;&#26159;&#30452;&#25509;&#22312;/home/more &#29992;&#25143;&#19979;&#21019;&#24314;&#20102;demo&#30340;&#39033;&#30446;

&#35774;&#32622;nginx&#24320;&#26426;&#33050;&#26412;

    curl -L http://bit.ly/nginx-ubuntu-init-file &gt; /etc/init.d/nginx
    chmod +x /etc/init.d/nginx
    update-rc.d nginx defaults
    /etc/init.d/nginx start

&#36827;&#20837;&#39033;&#30446;&#36305;&#33050;&#25163;&#26550;
rails generate scaffold Post name:string title:string content:text

&#22240;&#20026;&#26381;&#21153;&#22120;&#36305;&#24471;&#26159;production&#29615;&#22659;

    RAILS_ENV=production rake db:migrate
    /etc/init.d/nginx restart

&#26816;&#26597;&#19979;xxx.com/posts
&#26174;&#31034;&#25104;&#21151; &#24685;&#21916;&#29615;&#22659;&#25645;&#24314;&#23436;&#25104;
</summary>
    <author>
      <name>maizi</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/80</id>
    <published>2011-02-15T14:39:15+08:00</published>
    <updated>2011-06-22T06:53:31+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/80-wsdl-of-web-serveice-with-ruby"/>
    <title>ruby&#36827;&#34892;web serveice&#30340;&#26041;&#27861; wsdl</title>
    <summary>    require 'soap/wsdlDriver' 
    #url&#20026;&#35775;&#38382;&#22320;&#22336;
    url = "https://haha/gate?wsdl"
    #&#33719;&#21462;&#26381;&#21153;
    drv = SOAP::WSDLDriverFactory.new(url).create_rpc_driver 
    #gatewayOrderQuery&#26159;web serveice&#25552;&#20379;&#30340;&#26041;&#27861;&#65292;&#21487;&#20197;&#24102;&#20570;&#20010;&#21442;&#25968;&#65292;&#27880;&#24847;&#21442;&#25968;&#38656;&#35201;&#31867;&#22411;&#36716;&#25442;&#20026;SOAP&#30340;&#31867;&#22411;&#65292;&#21442;&#25968;&#20855;&#20307;&#30340;&#31867;&#22411;&#26377;&#26381;&#21153;&#20915;&#23450;&#65292;&#35831;&#30475;&#25991;&#26723;
    result = drv.gatewayOrderQuery('version'=&gt;SOAP::SOAPString.new('v2.0'),'sign'=&gt;SOAP::SOAPInt.new(1))
    #result&#26159;&#19968;&#20010;map&#23545;&#35937;
    puts result

</summary>
    <author>
      <name>atu_60692</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/78</id>
    <published>2011-01-31T19:35:29+08:00</published>
    <updated>2011-06-22T14:35:54+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/78-add-go-to-button-for-will-paginate"/>
    <title>&#32473; will_paginate &#36755;&#20986;&#21152;&#20010; goto &#25353;&#38062;</title>
    <summary>&#26041;&#27861;&#21442;&#35265;&#33258;&#65306;http://www.letrails.cn/archives/custom-will-paginate-renderer/

&#25903;&#25345;rails3 &#30340; will_paginate &#25105;&#29992;&#30340;&#26159; will_paginate-rails3 (3.0.pre)&#65292;&#19979;&#25991;&#30340;&#29615;&#22659;&#20063;&#23601;&#26159;&#36825;&#20010;&#29256;&#26412;&#65292;&#36824;&#35201;&#27880;&#24847;&#30340;&#26159;&#20351;&#29992;&#30340; jquery

&#25105;&#20204;&#30475; will_paginate-rails3 &#30340;&#28304;&#25991;&#20214; will_paginate-rails3-3.0.pre\lib\will_paginate\view_helpers\base.rb &#20013;&#21487;&#20197;&#30475;&#21040;&#21442;&#25968;&#20171;&#32461;&#65292;&#20854;&#20013;&#26377;&#20010; :renderer &#21442;&#25968;&#65292;&#20171;&#32461;&#22914;&#19979;&#65306;

    # * :renderer -- class name, class or instance of a link renderer (default:WillPaginate::LinkRenderer) 
    &#65288;&#27880;&#24847;&#65306;&#36825;&#20010;&#27880;&#37322;&#26377;&#20123;&#38169;&#35823;&#65292;&#25353;&#29031;will_paginate-rails3-3.0.pre\lib\will_paginate\view_helpers.rb &#20013; self.pagination_options &#36825;&#20010;hash&#26469;&#30475;&#24212;&#35813;&#26159; WillPaginate::ViewHelpers::LinkRenderer&#65289;

&#37027;&#20040;&#25105;&#20204;&#35201;&#25193;&#23637;will_paginate &#23601;&#24471;&#20174;&#36825;&#20010;&#21442;&#25968;&#20837;&#25163;&#65292;&#25105;&#20204;&#33258;&#23450;&#20041;&#19968;&#20010; link renderer class &#22914;&#19979;&#65292;&#25918;&#21040; /config/initializers &#19979;&#65292;&#21517;&#23383;&#38543;&#20415;&#36215;

    # \config\initializers\will_paginate_renderer.rb
    class CustomPaginationRenderer &lt; WillPaginate::ViewHelpers::LinkRenderer
      def to_html
        html = pagination.map do |item|
          item.is_a?(Fixnum) ?
          page_number(item) :
          send(item)
        end.join(@options[:separator])
        html += goto_box
        @options[:container] ? html_container(html) : html
      end
      private
      def goto_box
      &lt;
        
        
          function goto_page() {
            page = Number($('#goto_page').attr('value'))
            total = Number(#{total_pages})
    
            if (isNaN(page) == true) {
              page = 1
            } else if (page &lt; 1) {
              page = 1
            }  else if (page &gt; total) {
              page = total
            }
    
            var link = '#{url("_page")}'
            var new_link = link.replace(/_page/, page)
            alert('goto=&gt;' + new_link)
            //window.location.assign(new_link)
          }
        
        GOTO
      end
    end


&#19978;&#38754;&#20195;&#30721;&#20013; to_html &#36825;&#20010;&#26041;&#27861;&#30001; will_paginate-rails3-3.0.pre\lib\will_paginate\view_helpers\link_renderer.rb &#20013;&#21516;&#21517;&#30340; to_html &#26041;&#27861;&#20462;&#25913;&#32780;&#26469;&#65292;&#22914;&#26524;&#20320;&#24819;&#28155;&#21152;&#26356;&#22810;&#30340;&#20869;&#23481;&#21040; will_paginate &#36755;&#20986;&#65292;&#37027;&#20040;&#23601;&#32487;&#32493; html += ''

view&#20351;&#29992;&#22914;&#19979;&#65306;

    &lt;%= will_paginate @posts, :renderer =&gt; 'CustomPaginationRenderer' %&gt;


</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/77</id>
    <published>2011-01-30T00:07:47+08:00</published>
    <updated>2011-06-22T15:06:40+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/77-rails-in-the-method-of-operation-of-time"/>
    <title>rails&#20013;&#23545;&#26102;&#38388;&#30340;&#25805;&#20316;&#26041;&#27861;</title>
    <summary>&#20570;web&#24212;&#29992;&#65292;&#21644;&#26102;&#38388;&#25171;&#20132;&#36947;&#26159;&#19981;&#21487;&#20813;&#30340;&#12290;rails&#23545;ruby&#30340;&#26102;&#38388;&#27169;&#22359;&#20570;&#20102;&#25193;&#23637;&#12290;
&#26412;&#25991;&#20316;&#20110;2011&#24180;1&#26376;29&#26085;, ruby&#29256;&#26412;&#20026;1.8.7, rails&#29256;&#26412;&#20026;3.0.3

###&#22522;&#26412;&#30340;&#26102;&#38388;&#36716;&#25442;  

    now=Time.now
    =&gt; Sat Jan 29 21:47:07 0800 2011

###utc&#31186;&#25968;&#20114;&#30456;&#36716;&#25442;

    now.to_i
    =&gt; 1296308827
    Time.at(1296308827)
    =&gt; Sat Jan 29 21:47:07 0800 2011

###&#24403;&#21069;&#26102;&#38388;&#30340;&#19968;&#20123;&#21464;&#37327;  

    now.sec 
    =&gt; 7
    now.min
    =&gt; 47
    now.hour
    =&gt; 21
    now.month
    =&gt; 1
    now.year
    =&gt; 2011

###&#29616;&#22312;&#26159;&#26143;&#26399;&#20960;(&#27880;&#24847;!!!&#21608;&#26085;&#26159;&#36820;&#22238; 0 )  

    now.wday
    =&gt; 6

###&#29616;&#22312;&#26159;&#26412;&#26376;&#31532;&#20960;&#22825;  

    now.day
    =&gt; 29  

###&#29616;&#22312;&#26159;&#20170;&#24180;&#31532;&#20960;&#22825;  

    now.yday
    =&gt; 29

###&#26102;&#38388;&#21442;&#25968;&#30340;&#25968;&#32452;  

    now.to_a
    =&gt; [7, 47, 21, 29, 1, 2011, 6, 29, false, "CST"]

###&#26102;&#38388;&#21270;&#36755;&#20986;  

    now.strftime("%Y-%m-%d %H:%M:%S")
    =&gt; "2011-01-29 21:47:07"


&#21442;&#25968;&#35299;&#37322;&#22914;&#19979;  

    %a - &#26143;&#26399;&#20960;&#30340;&#33521;&#25991;&#31616;&#20889; (``Sun'')
    %A - &#26143;&#26399;&#20960;&#30340;&#33521;&#25991;&#20840;&#31216; (``Sunday'')
    %b - &#26376;&#20221;&#30340;&#33521;&#25991;&#31616;&#20889; (``Jan'')
    %B - &#26376;&#20221;&#30340;&#33521;&#25991;&#20840;&#31216; (``January'')
    %c - &#40664;&#35748;&#30340;&#39318;&#36873;&#26412;&#22320;&#26102;&#38388;&#36755;&#20986;&#26684;&#24335;
    %d - &#26412;&#26376;&#31532;&#20960;&#22825; (01..31)
    %H - 24&#23567;&#26102;&#21046;&#30340;&#23567;&#26102; (00..23)
    %I - 12&#23567;&#26102;&#21046;&#30340;&#23567;&#26102; (01..12)
    %j - &#20170;&#24180;&#30340;&#31532;&#20960;&#22825; (001..366)
    %m - &#26376;&#20221; (01..12)
    %M - &#20998;&#38047; (00..59)
    %p - &#19978;&#21320;&#36824;&#26159;&#19979;&#21320; (``AM''  or  ``PM'')
    %S - &#31186;&#25968; (00..60)
    %U - &#20174;&#26143;&#26399;&#22825;&#31639;&#19968;&#21608;&#24320;&#22987;&#30340;&#26412;&#24180;&#31532;&#20960;&#21608; (00..53)
    %W - &#20174;&#26143;&#26399;&#19968;&#31639;&#19968;&#21608;&#24320;&#22987;&#30340;&#26412;&#24180;&#31532;&#20960;&#21608; (00..53)
    %w - &#29616;&#22312;&#26159;&#26143;&#26399;&#20960; (&#21608;&#26085;&#26159;0 , 0..6)
    %x - &#40664;&#35748;&#30340;&#26085;&#26399;&#36755;&#20986;&#26684;&#24335; ("01/29/11")
    %X - &#40664;&#35748;&#30340;&#26102;&#38388;&#36755;&#20986;&#26684;&#24335; ("21:47:07")
    %y - &#24180;&#20221;&#30340;&#21518;&#20004;&#20301; (00..99)
    %Y - &#24180;&#20221;
    %Z - &#26102;&#21306;&#21517;
    %% - &#36755;&#20986;%&#23383;&#31526;


&#20197;&#19978;&#26159;ruby&#30340;&#22522;&#26412;&#26041;&#27861;&#65292;rails&#23545;&#20854;&#20570;&#20102;&#26356;&#22810;&#30340;&#25193;&#23637;


###&#37325;&#20889;&#20102;to_s&#26041;&#27861;&#65292;&#33021;&#22815;&#25509;&#21463;&#21442;&#25968;  

    now.to_s
    =&gt; "Sat Jan 29 21:47:07 +0800 2011"
    now.to_s(:db)
    =&gt; "2011-01-29 21:47:07"
    now.to_s(:number)
    =&gt; "20110129214707"
    now.to_s(:time)
    =&gt; "21:47"
    now.to_s(:short)
    =&gt; "29 Jan 21:47"
    now.to_s(:long)
    =&gt; "January 29, 2011 21:47"
    now.to_s(:long_ordinal)
    =&gt; "January 29th, 2011 21:47"
    now.to_s(:rfc822)
    =&gt; "Sat, 29 Jan 2011 21:47:07 +0800"

&#22914;&#26524;&#35201;&#33258;&#24049;&#35774;&#35745;&#26102;&#38388;&#36755;&#20986;&#26684;&#24335;&#65292;&#25353;&#19979;&#38754;&#26041;&#27861;&#26469;&#65292;&#26032;&#24314;&#19968;&#20010;&#37197;&#32622;&#25991;&#20214;

    # config/initializers/time_formats.rb
    Time::DATE_FORMATS[:month_and_year] = "%B %Y"
    Time::DATE_FORMATS[:short_ordinal] = lambda { |time| time.strftime("%B ###{time.day.ordinalize}") }


rails&#23545;&#26085;&#26399;&#30340;&#19968;&#20123;&#25193;&#23637;  

###&#25351;&#23450;&#26102;&#38388;  

    now.change(:year=&gt;2012, :month=&gt;12, :day =&gt; 21, :hour =&gt; 0, :min =&gt; 0, :sec =&gt; 0, :usec =&gt; 0)
    =&gt; Fri Dec 21 00:00:00 0800 2012

###begginning&#23478;&#26063;  

     now.beginning_of_day
    =&gt; Sat Jan 29 00:00:00 0800 2011
     now.midnight
    =&gt; Sat Jan 29 00:00:00 0800 2011
     now.beginning_of_week
    =&gt; Mon Jan 24 00:00:00 0800 2011
     now.beginning_of_month
    =&gt; Sat Jan 01 00:00:00 0800 2011
     now.beginning_of_quarter
    =&gt; Sat Jan 01 00:00:00 0800 2011
     now.beginning_of_year
    =&gt; Sat Jan 01 00:00:00 0800 2011  

###end&#23478;&#26063;  

     now.end_of_day
    =&gt; Sat Jan 29 23:59:59 0800 2011
     now.end_of_week
    =&gt; Sun Jan 30 23:59:59 0800 2011
     now.end_of_month
    =&gt; Mon Jan 31 23:59:59 0800 2011
     now.end_of_quarter
    =&gt; Thu Mar 31 23:59:59 0800 2011
     now.end_of_year
    =&gt; Sat Dec 31 23:59:59 0800 2011

###&#26102;&#38388;&#30340;&#39764;&#26415;&#26041;&#27861;  

     now.yesterday
    =&gt; Fri Jan 28 21:47:07 0800 2011
     now.tomorrow
    =&gt; Sun Jan 30 21:47:07 0800 2011
     now.next_week
    =&gt; Mon Jan 31 00:00:00 0800 2011
     now.next_month
    =&gt; Mon Feb 28 21:47:07 0800 2011
     now.next_year  

###&#27880;&#24847;&#27809;&#26377;prev_week  

     now.prev_month
    =&gt; Wed Dec 29 21:47:07 0800 2010
     now.prev_year
    =&gt; Fri Jan 29 21:47:07 0800 2010

###&#20170;&#26085;&#24050;&#36807;&#31186;&#25968;  

     now.seconds_since_midnight
    =&gt; 78427.615017  

###&#26085;&#26399;&#36755;&#20986;  

     now.to_date
    =&gt; Sat, 29 Jan 2011
     now.to_datetime
    =&gt; Sat, 29 Jan 2011 21:47:07 0800

###&#25353;&#31186;&#25968;&#35745;&#31639;  

     now.ago(3600)
    =&gt; Sat Jan 29 20:47:07 0800 2011
     now.since(3600)
    =&gt; Sat Jan 29 22:47:07 0800 2011

&#23454;&#38469;&#19978;&#36824;&#26377;&#24456;&#22810;&#26041;&#27861;&#27809;&#26377;&#21015;&#20986;&#65292;&#20855;&#20307;&#20351;&#29992;&#36824;&#26159;&#21442;&#32771;rails&#30340;api&#25163;&#20876;&#20026;&#20934;&#12290;

&#21478;&#22806;&#26377;&#19968;&#20010;rails&#25554;&#20214;bystar&#23545;&#27492;&#20570;&#20102;&#26356;&#22810;&#30340;&#25193;&#23637;, &#21518;&#38754;&#20250;&#21478;&#22806;&#20889;&#19968;&#31687;&#25991;&#31456;&#26469;&#35828;&#26126;</summary>
    <author>
      <name>ZoOL</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/73</id>
    <published>2011-01-26T22:27:21+08:00</published>
    <updated>2011-06-22T03:58:59+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/73-rails-in-some-of-the-ways-to-obtain-information-url"/>
    <title>rails&#20013;&#33719;&#21462;url&#20449;&#24687;&#30340;&#19968;&#20123;&#26041;&#27861;</title>
    <summary>[&#21407;&#24086;](http://blog.zool.it/posts/rails-in-some-of-the-ways-to-obtain-information-url)

&#22914;&#26412;&#26426;&#25105;&#27979;&#35797;&#22495;&#21517;&#20026;test.blog.zool.it:3000  

&#25171;&#24320;&#30340;uri&#20026; /post/Hello-World  

fullurl&#20026; http://test.blog.zool.it:3000/post/Hello-world  

&#21017;rails&#30340;&#36335;&#30001;&#29983;&#25104;&#19968;&#19979;&#20960;&#20010;&#26041;&#27861;

**domain(tld_length = 1)**
&#21462;&#24471;&#22495;&#21517;

    request.domain #=&gt;  zool.it
    request.domain(2) #=&gt; blog.zool.it


**subdomain(tld_length = 1)**
**subdomains(tld_length = 1)**
&#21462;&#24471;&#23376;&#22495;&#21517;

    request.subdomain #=&gt;  "test.blog"
    request.subdomain(2) #=&gt; "test"
    request.subdomain #=&gt;  ["test", "blog"]
    request.subdomain(2) #=&gt; ["test"]


**host()**

&#21462;&#24471;&#20027;&#26426;&#21517;

    request.host #=&gt; "test.blog.zool.it"


**host_with_port()**

&#21462;&#24471;&#24102;&#31471;&#21475;&#30340;&#20027;&#26426;&#21517;

    request.host_with_port #=&gt; "test.blog.zool.it:3000"


**raw_host_with_port()**  

&#20195;&#29702;&#26381;&#21153;&#22120;&#30340;&#20027;&#26426;&#21517;&#21644;&#31471;&#21475;

    request.raw_host_with_port #=&gt; "test.blog.zool.it:3000"



**port()**

&#21462;&#24471;&#30001;raw_host_with_port()&#33719;&#24471;&#30340;&#31471;&#21475;&#25968;&#20540;

    request.port #=&gt; 3000


**port_string()**

&#21462;&#24471;raw_host_with_port()&#33719;&#24471;&#30340;&#31471;&#21475;&#25991;&#26412;&#23383;&#31526;&#20018;

    request.port_string #=&gt; ":3000"


**protocol()**

&#21462;&#24471;&#24403;&#21069;&#20351;&#29992;&#32593;&#32476;&#21327;&#35758;

    request.protocol #=&gt; "http://"


**scheme()**

&#21462;&#24471;&#32593;&#32476;&#21327;&#35758;

    request.scheme #=&gt; "http"




**request_uri()**

request&#35831;&#27714;&#30340;uri&#22320;&#22336;

    request.request_uri #=&gt; "/posts/Hello-World"



server_port

**server_port()**

&#21462;&#24471;&#30001;env['SERVER_PORT']&#36820;&#22238;&#30340;&#31471;&#21475;&#20540;

    request.server_port #=&gt; "3000"


**ssl?()**

&#24403;&#21069;&#26159;&#21542;&#22312;&#26159;&#29992;https&#21152;&#23494;&#21327;&#35758;

    request.ssl?() #=&gt; false


**standard_port()**  

&#36820;&#22238;&#32593;&#32476;&#21327;&#35758;&#26631;&#20934;&#31471;&#21475;(http&#20026;80, https&#20026;443)

    request.standard_port #=&gt; 80


**standard_port?()**  

&#21028;&#26029;&#24403;&#21069;&#21327;&#35758;&#26159;&#21542;&#26159;&#26631;&#20934;&#31471;&#21475;

    request.standard_port? #=&gt; false


**url()**  

&#21462;&#24471;&#24403;&#21069;requset&#23436;&#25972;url

    request.url #=&gt; "http://test.blog.zool.it:3000/posts/Hello-World"
</summary>
    <author>
      <name>ZoOL</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/72</id>
    <published>2011-01-13T17:28:22+08:00</published>
    <updated>2011-06-21T21:54:44+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/72-railsftw-ruby-on-rails-for-the-windows"/>
    <title>RailsFTW&#65306;windows&#19979;&#19968;&#38190;&#24335;RoR&#23433;&#35013;&#21253;</title>
    <summary>RailsFTW&#65306;windows&#19979;&#19968;&#38190;&#24335;RoR&#23433;&#35013;&#21253;
RailsFTW&#21253;&#21547;&#20197;&#19979;&#21253;:
RubyInstaller 1.9.2-p136
Ruby on Rails (v3.0.3), sqlite3-ruby , &#21450; mysql2 gem
SQLite3 DLL
libmysql.dll &#26469;&#33258;MariaDB
&#39033;&#30446;&#32593;&#22336;&#65306;[http://railsftw.bryanbibat.net/][1]


  [1]: http://railsftw.bryanbibat.net/</summary>
    <author>
      <name>oncode</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/71</id>
    <published>2011-01-10T22:11:12+08:00</published>
    <updated>2011-06-22T14:04:58+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/71-migrate-windows-ruby-187-rails-23-to-linux-ruby-192-rails-3"/>
    <title>windows + ruby 1.8.7 + rails 2.3 &#21040; linux + ruby 1.9.2 + rails 3 </title>
    <summary>&#26368;&#36817;&#25240;&#33150;&#19968;&#32593;&#31449;
&#20174; windows ruby 1.8.7 + rails 2.3.5
&#21040; windows ruby 1.8.7 + rails 3.0.3
&#21448;&#21040; windows ruby 1.9.2 + rails 3.0.3
&#21448;&#21040; linux ruby 1.9.2 + rails 3.0.3

&#20013;&#38388;&#30830;&#23454;&#30456;&#24403;&#30340;&#25240;&#33150;&#20154;&#65292;&#19979;&#38754;&#35760;&#24405;&#19968;&#19979;&#25240;&#33150;&#20986;&#26469;&#30340;&#32463;&#39564;&#21543;
rails 2.3 &#21040; rails 3 &#38656;&#35201;&#25913;&#30340;&#22810;&#20102;&#65292;&#36825;&#20010;&#36339;&#36807;&#65292;&#36825;&#37324;&#37325;&#28857;&#35828;&#35828;&#20854;&#20182;&#30340;

windows &#19978; &#20174; ruby 1.8.7 + rails 3.0.3 &#21040; ruby 1.9.2 + rails 3.0.3

&#23433;&#35013;&#65306;&#29992; RubyInstaller &#25552;&#20379;&#30340;&#23433;&#35013;&#21363;&#21487;&#65292;&#19979;&#36733;&#22312;&#36825;&#37324; http://rubyforge.org/frs/?group_id=167

&#24120;&#35265;&#38169;&#35823;&#19968;&#65306;rake db:migrate &#26102;&#20986;&#29616;&#38169;&#35823;&#65306;
...rubygems.rb:340:in `bin_path': can't find executable rake for rake-0.8.7 (Gem::Exception)
&#35299;&#20915;&#26041;&#27861;&#65306;ruby1.9.2&#23433;&#35013;&#30446;&#24405; /lib/ruby/gems/1.9.1/specifications/&#19979;&#21024;&#38500; rake.gemspec &#25991;&#20214;

&#24120;&#35265;&#38169;&#35823;&#20108;&#65306;rails server &#26102;&#20986;&#29616;&#38169;&#35823;&#65306;
Could not find gem 'sqlite3-ruby' in any of the gem sources.
&#35299;&#20915;&#26041;&#27861;&#65306;&#36825;&#26159;&#30001;&#20110;&#25105;&#20204;&#20351;&#29992;&#30340;&#26159; sqlite3-ruby 1.2.5 &#30340;&#32536;&#25925;&#65292;&#22312;1.8.7&#19979;&#27809;&#38382;&#39064;&#65292;&#21040;&#20102;1.9.2&#19979;&#21518;&#32534;&#30721;&#30340;&#21407;&#22240;&#24517;&#39035;&#29992;1.3.1 + &#30340;sqlite3-ruby &#29256;&#26412;&#65292;&#36825;&#37324;&#36824;&#35201;&#27880;&#24847;&#30340;&#26159; 1.3.1 &#24517;&#39035;&#35201; sqlite3 &#30340;&#26032;&#29256;&#26412;&#65292;&#23433;&#35013;&#30340;&#26102;&#20505;&#20250;&#25552;&#31034;&#20320;&#30340;&#65292;&#25105;down&#20102;&#26368;&#26032;&#30340; 3.7.4 &#29992;&#20102;
Gemfile &#20013; &#36825;&#26679;&#20889; gem 'sqlite3-ruby', '1.3.1',  :require =&gt; 'sqlite3'


--------------------------------------------------------------------------------


ruby 1.9.2 + rails 3.0.3 &#20174; windows &#21040; linux

&#24120;&#35265;&#38169;&#35823;1&#65306;bundle install &#21518; bundle list &#25552;&#31034;&#19979;&#38754;&#30340;&#38169;&#35823;&#65292;&#32780;&#27492;&#26102; bundle install &#19968;&#20999;&#27491;&#24120;&#65292;gem list &#20063;&#26377;rake
Gems included by the bundle:
Could not find rake-0.8.7 in any of the sources
&#36824;&#26377;&#19968;&#20010;&#29616;&#35937;&#26159; bundle install &#30340;&#26102;&#20505;&#20840;&#37096;&#24324;&#21040;&#36825;&#20010;&#30446;&#24405;&#21435;&#20102; vender\cache
&#36825;&#20010;&#38382;&#39064;&#25240;&#33150;&#20102;&#22909;&#38271;&#26102;&#38388;&#65292;&#26368;&#21518;&#25165;&#21457;&#29616;&#26102;bundler &#30340;&#38382;&#39064;
&#35299;&#20915;&#26041;&#27861;&#65306;&#20462;&#25913; .bundle/config &#25991;&#20214;&#65292;BUNDLE_PATH: vendor\cache &#30475;&#21040;&#20102;&#21543;&#65292;&#21621;

&#24120;&#35265;&#38382;&#39064;2&#65306;incompatible character encodings: ASCII-8BIT and UTF-8
&#36825;&#20010;&#38382;&#39064;&#21487;&#33021;&#30340;&#21407;&#22240;&#22810;&#20102;&#65292;&#32593;&#19978;&#20063;&#24456;&#22810;&#26041;&#27861;&#65292;&#22914;&#26524;&#30896;&#21040;&#20102;&#37117;&#35797;&#35797;&#65292;&#21621;
&#36825;&#37324;&#35828;&#19979;&#32593;&#19978;&#27809;&#30340;&#35762;&#21040;&#30340;&#19968;&#20010;&#21407;&#22240;&#65292;&#23601;&#26159; sqlite3-ruby &#30340;&#29256;&#26412;&#30340;&#38382;&#39064;
&#22914;&#26524;&#20320;sql&#26597;&#21040;&#30340;&#32467;&#26524;&#20013;&#27809;&#20013;&#25991;&#27491;&#24120;&#65292;&#26377;&#20013;&#25991;&#23601;&#36339;&#36825;&#20010;&#38169;&#35823;&#30340;&#35805;&#65292;&#37027;&#23601;&#26159; sqlite3-ruby &#30340;&#29256;&#26412;&#30340;&#38382;&#39064;&#20102;&#65292;&#20174; 1.2.5 &#25442;&#21040; 1.3.1+ &#23601;&#27809;&#38382;&#39064;&#21862;&#65292;&#21704;&#12290;&#22240;&#20026;sqlite3 &#40664;&#35748;&#30340;&#35835;&#21462;&#26041;&#24335;&#23601;&#26159; utf-8 &#65292;&#25152;&#20197;&#36825;&#37324;&#19981;&#29992;&#32771;&#34385;database.yml &#20013;&#30340;&#35774;&#32622;&#38382;&#39064;&#65292;&#22914;&#26524;&#26159; mysql &#23601;&#35201;&#32771;&#34385;&#20102;
&#32493;&#35760;&#65306;&#32593;&#19978;&#25552;&#21040;&#30340; incompatible character encodings: ASCII-8BIT and UTF-8 &#30340;&#19968;&#20123;&#35299;&#20915;&#26041;&#27861;&#65306;
1&#12289;Adding to application.rb:
Encoding.default_external = Encoding::UTF_8
or
Encoding.default_internal = 'utf-8'
2&#12289;Adding to application.erb.html head:

3&#12289;Adding to any view templates  head:

4&#12289;Unfortunately adding "encoding: utf-8" to the database.yml did not have any effect. 


&#21518;&#35760;&#65306;mysql2 &#26377;&#20102;win&#29256;&#26412; mysql2-0.2.6-x86-mingw32.gem &#65292;&#21704;&#21704;
</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/70</id>
    <published>2011-01-05T19:46:35+08:00</published>
    <updated>2011-06-21T19:17:35+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/70-ckeditor-3-4-3-pre-upload-500-error%20"/>
    <title>ckeditor-3.4.3.pre upload 500 error </title>
    <summary>&#29615;&#22659;&#65306;ruby 1.8.7&#12289;rails3.0.1&#12289;ckeditor-3.4.3.pre
&#38169;&#35823;&#24773;&#20917;&#65306;&#24403;&#25105;&#20204;&#25226;ckeditor&#25918;&#22312;admin&#21518;&#21488;&#20351;&#29992;&#30340;&#26102;&#20505;&#65292;&#19978;&#20256;&#30340;&#26102;&#20505;&#21487;&#33021;&#20250;&#20986;500&#38169;&#35823;&#30340;js&#24377;&#20986;&#25552;&#31034;

ckeditor &#30340;&#23433;&#35013;&#21442;&#35265; &#33258;&#24102;&#30340;&#35828;&#26126;&#25991;&#20214;

&#20855;&#20307;&#30340;&#24590;&#20040;&#25918;&#21040;admin&#21518;&#21488;&#20351;&#29992;&#65292;&#25105;&#26159;&#20462;&#25913;&#22312;admin&#30446;&#24405;&#19979;&#21435;&#30340;&#65292;&#26368;&#37325;&#35201;&#30340;&#26159;&#20462;&#25913; /config/initializers/ckeditor.rb &#20013;&#30340;&#19968;&#20123;&#35774;&#32622;

&#20998;&#26512;&#65306;
&#24403;&#20986;&#29616;&#36825;&#20010;&#38169;&#35823;&#30340;&#26102;&#20505;&#65292;&#25105;&#20204;&#25171;&#24320;log&#30475;&#20250;&#21457;&#29616;&#19979;&#38754;&#36825;&#27573;



    Started POST "/admin/ckeditor/create/image?_party_school_session=BAh7CyIQX2NzcmZfdG9rZW4iMVhGQW9YTW1JVEY5V1QyMzRqNkF6NS9JT2xLN1FYMDhFSHVIUVZBd0ZrVms9Ig1uaWNrbmFtZSIKYWRtaW4iD3Nlc3Npb25faWQiJTkxMTAyNGI2NzJjZDc0YmY0ZWY5ODQ4YjJmNzhmOWQyIgt1c2VyaWRpBiINaXNfYWRtaW5UIg1pc192YWxpZFQ%253D--754594c1962e66f017af514b212810dac4991872&amp;authenticity_token=XFAoXMmITF9WT234j6Az5%252FIOlK7QX08EHuHQVAwFkVk%253D" for 127.0.0.1 at Sat Dec 25 17:38:46 +0800 2010
      Processing by Admin::CkeditorController#create as TEXT/*
      Parameters: {"Filename"=&gt;"&#34507;&#31957;.jpg", "kind"=&gt;"image", "data"=&gt;#, "_party_school_session"=&gt;"BAh7CyIQX2NzcmZfdG9rZW4iMVhGQW9YTW1JVEY5V1QyMzRqNkF6NS9JT2xLN1FYMDhFSHVIUVZBd0ZrVms9Ig1uaWNrbmFtZSIKYWRtaW4iD3Nlc3Npb25faWQiJTkxMTAyNGI2NzJjZDc0YmY0ZWY5ODQ4YjJmNzhmOWQyIgt1c2VyaWRpBiINaXNfYWRtaW5UIg1pc192YWxpZFQ%3D--754594c1962e66f017af514b212810dac4991872", "authenticity_token"=&gt;"XFAoXMmITF9WT234j6Az5%2FIOlK7QX08EHuHQVAwFkVk%3D", "Upload"=&gt;"Submit Query"}
    Redirected to http://127.0.0.1:3000/notifier/notifier?redirect_url=......
    Completed 302 Found in 16ms
    
    Started GET "/notifier/notifier?redirect_url=......&amp;msg=......" for 127.0.0.1 at Sat Dec 25 15:28:15 +0800 2010
      Processing by NotifierController#notifier as TEXT/*
      Parameters: {"msg"=&gt;"......", "redirect_url"=&gt;"......"}
    Completed   in 63ms
    
    ActionView::MissingTemplate (Missing template notifier/notifier with {:handlers=&gt;[:rhtml, :erb, :rxml, :rjs, :builder], :formats=&gt;[:"text/*"], :locale=&gt;[:en, :en]} in view paths "D:/test/ror_new/party_school/app/views", ......):
      
    
    Rendered D:/language/ruby187/lib/ruby/gems/1.8/gems/actionpack-3.0.1/lib/action_dispatch/middleware/templates/rescues/missing_template.erb within rescues/layout (0.0ms)


&#37027;&#20040;&#23601;&#21487;&#20197;&#21457;&#29616;&#36825;&#20010;&#38169;&#35823;&#20026;&#20160;&#20040;&#20986;&#29616;&#65292;&#23601;&#26159;&#24403; redirect_to &#30340;&#26102;&#20505;&#23601;&#20250;&#20986;&#29616;500&#38169;&#35823;&#25552;&#31034;&#20102;

&#22909;&#20102;&#38382;&#39064;&#20851;&#38190;&#28857;&#25214;&#21040;&#20102;&#65292;&#20294;&#26159;&#26377;&#20010;&#30097;&#38382;&#65306; /admin/ckeditor/images &#35775;&#38382;&#27491;&#24120;&#65292;&#24590;&#20040; /admin/ckeditor/create &#23601;&#19981;&#33021;&#35775;&#38382;&#20102;&#21602;&#65311;

&#20174;&#21069;&#38754;&#21487;&#30693; Admin::CkeditorController &#32487;&#25215;&#33258; Admin::BaseController &#65292;&#32780; Admin::BaseController &#20013;&#21152;&#20102;&#20010;before_filter :deny_noadmin &#65292; session&#26410;&#39564;&#35777;&#36890;&#36807;&#24773;&#20917;&#19979;&#25165;redirect_to&#30340;

&#37027;&#20040;&#38382;&#39064;&#23601;&#26159;&#25105;&#20204;upload&#30340;&#26102;&#20505;session &#28040;&#22833;&#20102;&#65292;&#25105;&#20570;&#36807;&#35797;&#39564;&#30830;&#23454;&#26159;&#36825;&#26679;&#65292;&#22914;&#26524;&#20320;&#24819;&#20570;&#19979;&#37027;&#20040;&#23601; &#32473;create&#21152;&#20010; before_filter &#65292;&#29992; logger.info('session&#19981;&#23384;&#22312;') if !session[:login]

&#37027;&#20040;&#25105;&#20204;&#22312;&#36825;&#37324;&#23601;&#35201;&#32473;&#36825;&#20010; action &#21435;&#25481; Admin::BaseController &#20013;&#30340; before_filter :deny_noadmin&#65292;&#21435;&#25481;&#21518;&#35797;&#39564;&#36890;&#36807;&#20102;

&#36825;&#37324;&#23601;&#26377;&#20010;&#38382;&#39064;&#20102;&#65292;session&#39564;&#35777;&#21435;&#25481;&#21518;&#37027;&#19981;&#26159;&#35841;&#37117;&#21487;&#20197;&#35775;&#38382; create &#20102;&#65311;&#25105;&#20204;&#36824;&#35201;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;

&#20877;&#30475;&#26085;&#24535;&#65292;&#21457;&#29616;post &#30340;&#26102;&#20505;&#65292;&#37027;&#20010;&#22320;&#22336;&#21518;&#38754;&#21152;&#20102;&#20004;&#20010;params&#65292;&#24456;&#29087;&#24713;&#26159;&#19981;&#65311;&#19968;&#20010;&#26159; session &#30340;&#26412;&#22320;&#23384;&#20648;&#20540;&#65292;&#19968;&#20010;&#26159; authenticity_token

&#37027;&#20040;&#25105;&#20204;&#23601;&#21487;&#20197;&#29992;&#36825;&#20004;&#20010;&#21442;&#25968;&#26469;&#35299;&#20915;&#39564;&#35777;&#65292;&#23433;&#20840;&#24615;&#36824;&#26159;&#26377;&#25226;&#25569;&#30340;

&#29616;&#22312;&#23601;&#35201;&#20808;&#35201;&#25630;&#28165;&#26970;&#36825;&#20004;&#20010;&#21442;&#25968;&#24590;&#20040;&#26469;&#30340;&#21602;&#65311;

&#25171;&#24320; /vendor/plugins/ckeditor-3.4.3.pre/app/views/admin/ckeditor/images.html.erb &#21487;&#20197;&#30475;&#21040;&#22914;&#19979;



        
      var upload_path = "&lt;%=raw ckeditor_attachment_path(:image) %&gt;";


&#36335;&#24452;&#23601;&#26159;&#36825;&#20040;&#26469;&#30340;&#65292;&#36825;&#20010;&#26041;&#27861;&#26159;&#26159;&#21738;&#37324;&#30340;&#21602;&#65311;&#22312; /vendor/plugins/ckeditor-3.4.3.pre/app/helpers/admin/ckeditor/ckeditor_helper.rb &#20013;&#21487;&#20197;&#30475;&#21040;&#36825;&#20010;&#26041;&#27861;&#21040;&#24213;&#26159;&#21861;


    module Admin::CkeditorHelper
      def ckeditor_attachment_path(kind)
        path = case kind
          when :image then Ckeditor.file_manager_image_upload_uri
          when :file  then Ckeditor.file_manager_upload_uri
          else '/ckeditor/create/default'
        end
    
        session_key = Rails.application.config.send(:session_options)[:key]
    
        options = Rails.application.routes.recognize_path(path, :method =&gt; :post)
        options[:protocol] = "http://"
        options[session_key] = Rack::Utils.escape(cookies[session_key])
    
        if protect_against_forgery?
          options[request_forgery_protection_token] = Rack::Utils.escape(form_authenticity_token)
        end
    
        url_for(options)
      end
    end


&#30475;&#21040;&#20102;&#21543;&#65292;&#23601;&#26159;&#36825;&#20040;&#29983;&#25104;&#30340;&#65292;&#22909;&#20102;&#65292;&#29616;&#22312;&#23601;&#24320;&#22987;&#32473; create &#20570;&#39564;&#35777;&#65292;&#20063;&#23601;&#26159;&#37027;&#20010;helper&#30340;&#21453;&#21521;&#35299;&#23601;&#22909;&#20102;&#65292;&#20889;&#22909;&#30340; Admin::CkeditorController &#22914;&#19979;


    class Admin::CkeditorController &lt; Admin::BaseController #&#35760;&#24471;&#36825;&#37324;&#30340;&#32487;&#25215;controller &#35201;&#20462;&#25913;&#36807;&#26469;
    
      #&#21457;&#29983;500&#38169;&#35823;&#30340;&#26102;&#20505;&#35299;&#20915;&#30340;
      skip_before_filter :deny_noadmin, :only=&gt;[:create]  #&#21333;&#29420;&#20026;create &#36339;&#36807; Admin::BaseController &#20013;&#20570;&#30340;&#39564;&#35777;
      before_filter :session_key_auth, :only =&gt; [:create]  #&#21333;&#29420;&#20026;create &#20570; session_key &#30340;&#39564;&#35777;
    
      #&#36825;&#20960;&#20010;&#26159;&#21407;&#26377;&#40664;&#35748;&#30340;
      skip_before_filter :verify_authenticity_token, :only =&gt; [:create]
      before_filter :swf_options, :only =&gt; [:images, :files, :create]
      respond_to :html, :xml, :json
      layout "ckeditor"
    
      def images
        #......
      end
    
      def files
        #......
      end
    
      def create
        #......
      end
    
      private
        def swf_options
          #......
        end
    
        def session_key_auth
          session_key = Rails.application.config.send(:session_options)[:key]
          #&#36825;&#37324;&#20570; &#39564;&#35777;cookies[session_key] &#21644; &#25191;&#34892;verify_authenticity_token &#65292;&#20320;&#21487;&#20197;&#33258;&#24049;&#20462;&#25913;
          #&#36825;&#37324; [-40,40] &#30340;&#30446;&#30340;&#26159; cookies[session_key] escape &#22909;&#20687;&#26377;&#26102;&#20505;&#19981;&#19968;&#26679;&#65292;&#20026;&#20102;&#20445;&#38505;&#36824;&#26159;&#21482;&#39564;&#35777;&#21518;&#38754;&#30340;&#37027;&#20010; sha1 &#23383;&#31526;&#20018;&#20102;
          if params[session_key][-40,40] != Rack::Utils.escape(cookies[session_key])[-40,40] or \
            params[request_forgery_protection_token] != Rack::Utils.escape(form_authenticity_token)
            redirect_to '/'
          end
        end
    end


&#21518;&#35760;&#65306;&#20854;&#23454; create &#20063;&#21487;&#20197;&#20570; verify_authenticity_token &#30340;&#65292;&#23454;&#29616;&#30340;&#35805;&#21482;&#38656;&#35201;&#20462;&#25913;&#19979;helper&#20013;&#37096;&#20998;&#20869;&#23481;&#23601;&#21487;&#20197;&#20102;


    if protect_against_forgery?
      #options[request_forgery_protection_token] = Rack::Utils.escape(form_authenticity_token)
      #&#25226;&#19978;&#38754;&#30340;&#37027;&#26465;&#20462;&#25913;&#20026;&#19979;&#38754;&#36825;&#20010;&#23601;&#21487;&#20197;&#20102;&#65292;&#20026;&#20160;&#20040;&#35201;&#36825;&#26679;&#20889;&#21602;&#65311;&#30475;api&#20013; csrf_meta_tag() &#30340;&#28304;&#30721;
      options[Rack::Utils.escape_html(request_forgery_protection_token)] = Rack::Utils.escape_html(form_authenticity_token)
    end




</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/69</id>
    <published>2011-01-05T19:43:12+08:00</published>
    <updated>2011-06-22T08:46:34+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/69-rails3-will-paginate-use-UJS%20"/>
    <title>rails3 will_paginate use UJS </title>
    <summary>&#21069;&#25552;&#26159;&#20351;&#29992; jquery &#30340; UJS &#65292;&#24590;&#20040;&#20351;&#29992;&#21602;&#65311;https://github.com/rails/jquery-ujs &#36825;&#37324;&#19979;&#36733;plugin &#65292;&#30475; readme


&#19981;&#20351;&#29992; UJS &#30340; index.html.erb &#22823;&#27010;&#22914;&#19979;


    
    ......
    
    
    &lt;%= will_paginate @posts, :previous_label =&gt; "&amp;lt;&#19978;&#19968;&#39029;", :next_label =&gt; "&#19979;&#19968;&#39029;&amp;gt;" %&gt;




&#35201;&#20351;&#29992; UJS 


1&#12289;&#22312; /views/posts/index.html.erb &#20013;&#26368;&#21518;&#21152;&#20837;&#19968;&#27573;js &#65292;&#22914;&#19979;
.pagination &#22312; &#26032;&#29983;&#25104;&#30340;html&#20195;&#30721;


    
      $('.pagination a').attr('data-remote', 'true');
    



&#29616;&#22312;&#20877;&#28857;&#20987; &#19978;/&#19979;&#39029;&#31561;&#38142;&#25509; &#30340;&#26102;&#20505;&#23601;&#20250;&#26159; UJS

2&#12289;&#22312; /controllers/posts_controller.rb &#20013;&#21152;&#20837; format.js

3&#12289;&#26032;&#24314; /views/posts/index.js.erb&#65292;&#20869;&#23481;&#22914;&#19979;&#65306;



    &lt;% @html = capture do %&gt;
    
      
        Title
        
        
        
      
      &lt;% @posts.each do |post| %&gt;
        
          &lt;%= post.title %&gt;
          &lt;%= link_to 'Show', post %&gt;
          &lt;%= link_to 'Edit', edit_post_path(post) %&gt;
          &lt;%= link_to 'Destroy', post, :confirm =&gt; 'Are you sure?', :method =&gt; :delete %&gt;
        
      &lt;% end %&gt;
    
    &lt;% end %&gt;
    
    
    //&#26356;&#26032;table&#20869;&#23481;
    $('#posts_index').html("&lt;%= raw @html.gsub(/[\t\n\r]/,'').gsub("\"",'\'') %&gt;");
    //&#26356;&#26032;&#20998;&#39029;&#26639;
    $('.pagination').html('&lt;%= will_paginate @posts, :previous_label =&gt; "&amp;lt;&#19978;&#19968;&#39029;", :next_label =&gt; "&#19979;&#19968;&#39029;&amp;gt;" %&gt;')
    //&#21152; data-remote
    $('.pagination a').attr('data-remote', 'true');


ok&#65292;&#36825;&#26679;&#23601;&#22909;&#21679;&#65292;&#21704;&#21704;


</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/68</id>
    <published>2011-01-02T11:25:41+08:00</published>
    <updated>2011-06-22T10:43:49+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/68-nginx-server-log-cutting"/>
    <title>nginx &#26085;&#24535;&#20999;&#21106;</title>
    <summary>nginx&#19981;&#25903;&#25345;&#20687;apache&#19968;&#26679;&#20351;&#29992;cronolog&#26469;&#36718;&#36716;&#26085;&#24535;&#65292;&#20294;&#26159;&#21487;&#20197;&#37319;&#29992;&#20197;&#19979;&#26041;&#24335;&#26469;&#23454;&#29616;&#26085;&#24535;&#25991;&#20214;&#30340;&#20999;&#21106;&#65306;

    mv /usr/lcoal/nginx/logs/access.log  /usr/lcoal/nginx/logs/access_20100101.log
    kill -USR1 Nginx &#20027;&#36827;&#31243;&#21495;

&#39318;&#20808;&#36890;&#36807;MV&#21629;&#20196;&#23558;&#26085;&#24535;&#25991;&#20214;&#37325;&#21629;&#21517;&#20026;access_20100101.log&#65292;&#28982;&#21518;&#21457;&#36865; kill -USR1 &#20449;&#21495;&#32473;Nginx&#30340;&#20027;&#36827;&#31243;&#21495;&#65292;&#35753;Nginx&#37325;&#26032;&#29983;&#25104;&#19968;&#20010;&#26032;&#30340;&#26085;&#24535;&#25991;&#20214;access.log

&#22914;&#26524;&#24819;&#27599;&#22825;&#23450;&#26102;&#20999;&#21106;&#26085;&#24535;&#65292;&#36824;&#38656;&#35201;&#20511;&#21161;crontab.&#25105;&#20204;&#21487;&#20197;&#20123;&#19968;&#20010;&#25353;&#22825;&#20999;&#21106;&#30340;&#26085;&#24535;&#65292; &#25353;&#24180;/&#26376;&#20221;&#30446;&#24405;&#23384;&#25918;&#26085;&#24535;&#30340;shell&#30340;&#33050;&#26412;

    vi /usr/lcoal/nginx/sbin/cut_nginx_log.sh


&#36755;&#20837;&#20197;&#19979;&#20869;&#23481;&#24182;&#20445;&#23384;&#65306;

    #!/bin/bash
    logs_path='/usr/lcoal/nginx/logs/'
    mkdir -p ${logs_path}$(date -d "yesterday" +"%Y")/$(date -d "yesterday" +"%m")/
    mv ${logs_path}access.log ${logs_path}$(date -d "yesterday" +"%Y")/$(date -d "yesterday" +"%m")/access_$(date -d "yesterday" +"%Y%m%d").log
    pid=$(cat /usr/lcoal/nginx/logs/nginx.pid)
    kill -USR1 ${pid}

&#21478;&#22806;&#37197;&#32622;crontab&#27599;&#26085;&#20940;&#26216;00:00&#23450;&#26102;&#25191;&#34892;&#36825;&#20010;&#33050;&#26412;&#65306;

    vi /etc/crontab

&#36755;&#20837;&#20197;&#19979;&#20869;&#23481; &#24182;&#20445;&#23384;&#65306;

    00 00    * * *      root /bin/bash       /usr/lcoal/nginx/sbin/cut_nginx_log.sh

&#36825;&#20010;shell&#33050;&#26412;&#21644;crontab&#37197;&#32622;&#20027;&#35201;&#23454;&#29616;&#30340;&#21151;&#33021;&#20026;&#65306;&#20551;&#35774;&#20170;&#22825;&#30340;&#26085;&#26399;&#26159;2011.1.1&#65292;Nginx&#24403;&#21069;&#30340;&#26085;&#24535;&#25991;&#20214;&#20026;/usr/lcoal/nginx/logs/access.log,2011.1.2 00:00&#20250;&#25191;&#34892;cut_nginx_log.sh&#33050;&#26412;&#65292;cut_nginx_log.sh&#33050;&#26412;&#39318;&#20808;&#20250;&#21019;&#24314;/usr/lcoal/nginx/logs/2011/01&#12289;&#65292;&#28982;&#21518;&#23558;/usr/lcoal/nginx/logs/access.log&#25991;&#20214;&#31227;&#21160;&#24182;&#37325;&#26032;&#21629;&#21517;&#20026;/usr/lcoal/nginx/logs/2011/01/access_20110101.log,&#20877;&#21457;&#36865;kill -USR1&#20449;&#21495;&#32473;Nginx&#20027;&#36827;&#31243;&#21495;&#65292;&#21578;&#35785;Nginx&#37325;&#26032;&#29983;&#25104;&#19968;&#20010;/usr/lcoal/nginx/logs/access.log&#25991;&#20214;&#12290;</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/67</id>
    <published>2010-12-23T14:59:12+08:00</published>
    <updated>2011-06-22T11:56:29+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/67-animation-using-jquery-position-to-realize-the-adjustment-of-the-page"/>
    <title>&#36816;&#29992;jquery&#30340;&#21160;&#30011;&#25928;&#26524;&#23454;&#29616;&#23545;&#39029;&#38754;&#20301;&#32622;&#30340;&#35843;&#25972;</title>
    <summary>&#25105;&#20204;&#29992;&#19968;&#20010; blog posts list &#30340;&#20363;&#23376;&#26469;&#35828;&#19979;&#21543; &#65292;&#24403;&#22312;&#19968;&#20010;blog &#32593;&#31449;&#30340;&#39318;&#39029;&#19968;&#33324;&#37117;&#26159;&#26368;&#26032;&#21457;&#24067;blog posts list &#12290;&#22312;&#26368;&#19979;&#36793;&#24212;&#35813;&#26159;&#20998;&#39029;&#30340;&#25353;&#38062;&#12290;&#24403;&#25105;&#20204;&#19981;&#29992;AJAX&#20570;&#30340;&#26102;&#20505;&#65292;&#28857;&#20987;&#20998;&#39029;&#25353;&#38062;&#65292;&#23601;&#20250;&#20174;&#26032;&#21152;&#36733;&#39029;&#38754;&#65292;&#36825;&#26679;&#39029;&#38754;&#33258;&#28982;&#20250;&#22238;&#21040;&#39030;&#31471;&#65292;&#20320;&#30475;&#21040;&#20063;&#26159;&#19979;&#19968;&#20010;&#39029;&#38754;&#30340;&#31532;&#19968;&#20010;blog&#26631;&#39064;&#12290;&#20294;&#26159;&#24403;&#25105;&#20204;&#20351;&#29992;AJAX&#21435;&#26367;&#25442;&#25481;&#36825;&#20010; blog posts list &#21602;&#65292;&#28857;&#20987;&#20998;&#39029;&#65292;&#34429;&#28982;list&#20869;&#23481;&#25913;&#21464;&#20102; &#65292;&#20294;&#26159; &#24403;&#21069;&#30340;&#31383;&#21475;&#36824;&#26159;&#20572;&#30041;&#22312;&#20998;&#39029;&#25353;&#38062;&#36825;&#37324;&#12290;&#30475;&#19978;&#21435;&#24456;&#19981;&#29245;&#12290;&#37027;&#20040; &#25105;&#20204;&#29616;&#22312;&#23601;&#29992;&#21160;&#30011;&#30340;&#24418;&#24335;&#65292;&#24403;&#20320;&#28857;&#23436;&#20998;&#39029;&#25353;&#38062;&#21518;&#65292;&#39029;&#38754;&#20250;&#32531;&#24930;&#30340;&#22238;&#21040; list &#30340;top&#22788;

    2
      

      function p(page) {
       nowpage=page;
       loadContent(); #&#21152;&#36733;&#20320;&#39029;&#38754;&#30340;&#26041;&#27861;
    nowpage&gt;1 &amp;&amp; $('html,body').animate({scrollTop:500},1000) #500&#26159;&#20174;&#39029;&#38754;TOP&#21040;&#20320;list top&#30340;&#39640;&#24230; 1000&#26159;&#21160;&#30011;&#26102;&#38388; &#27627;&#31186;
    }</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/66</id>
    <published>2010-12-05T17:50:49+08:00</published>
    <updated>2011-06-22T01:05:33+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/66-paperclip-use-sample-on-windows"/>
    <title>rails plugin Paperclip&#22312;windows&#19979;&#30340;&#20351;&#29992;&#31508;&#35760; </title>
    <summary>&#27979;&#35797;&#29615;&#22659;&#65306; ruby 1.8.7 + rails 2.3.5 + paperclip 2.3.6 + RMagick-2.12.0-ImageMagick-6.5.6-8-Q8


----------


&#20855;&#20307;&#30340;&#20351;&#29992;&#26041;&#27861;&#35265;&#36825;&#31687;&#25991;&#31456;
http://cn.asciicasts.com/episodes/134-paperclip


----------


windows&#20013;&#20351;&#29992;&#21069;&#20808;&#20570;&#30340;&#20004;&#20214;&#20107;&#65306;

1&#12289;&#22240;&#20026;&#20854;&#20182;&#22320;&#26041;&#36824;&#35201;&#20351;&#29992; RMagick &#65292;&#25152;&#20197;&#21040;&#23448;&#26041;&#19979;&#36733;&#23433;&#35013;&#21253;&#26469;&#23433;&#35013;
rmagick&#23448;&#26041;http://rubyforge.org/projects/rmagick/ &#32593;&#31449;&#19979;&#36733; rmagick-win32 &#30340; binary gem for Ruby 1.8.6 &#65288;&#20063;&#36866;&#21512;&#20110;1.8.7&#65289;
&#21363;&#65306;http://rubyforge.org/frs/download.php/64917/RMagick-2.12.0-ImageMagick-6.5.6-8-Q8.zip &#23433;&#35013;exe&#21518;&#20877;&#23433;&#35013;gem &#23601;&#21487;&#20197;&#20102;
&#21478;&#22806;&#23433;&#35013;&#23436;&#20102;&#21518;&#28155;&#21152;&#21040; path &#65292;&#30830;&#20445;cmd&#19979;&#21487;&#25191;&#34892; identify

2&#12289;&#20462;&#25913; c:\WINDOWS\system32\convert.exe &#20026; c:\WINDOWS\system32\_convert.exe &#65292;&#22240;&#20026; imagemagick &#20013; convert &#21644;&#36825;&#20914;&#31361; 


----------


&#30896;&#21040;&#30340;&#19968;&#20123;&#38169;&#35823;&#30340;&#35299;&#20915;&#65306;

1&#12289;is not recognized by the 'identify' command. &#38169;&#35823;&#35299;&#20915;


    /config/initializers/paperclip.rb
    Paperclip.options[:command_path] = 'D:\Program Files\ImageMagick-6.5.6-Q8'
    Paperclip.options[:swallow_stderr] = false
    #&#19979;&#38754;&#36825;&#27573;&#35828;&#26159;&#8220;&#24341;&#21495;&#30340;&#38382;&#39064;&#8221;&#65292;&#19981;&#36807;&#25105;&#27809;&#21457;&#29616;&#26377;&#36825;&#20010;&#38382;&#39064;&#65292;&#20808;&#35760;&#22312;&#36825;&#37324;
    #&#20855;&#20307;&#24773;&#20917;&#21442;&#35265;http://www.javaeye.com/topic/722813
    #def quote_command_options(*options)
    #  options.map do |option|
    #    option.split("'").map{|m| "'#{m}'" }.join("\\'")
    #  end
    #end



2&#12289;ie&#20013;&#19978;&#20256;&#25552;&#31034; content type is not one of image/jpeg, image/png &#38169;&#35823;&#35299;&#20915;
&#26159;&#22240;&#20026;ie image MIME &#21644;ff&#19981;&#21516;&#65292;&#20462;&#25913;model&#20013;&#39564;&#35777;&#22914;&#19979;


    validates_attachment_content_type :photo, :content_type =&gt; ['image/jpeg','image/png','image/pjpeg','image/x-png']



3&#12289;&#20013;&#25991;&#21517;&#25991;&#20214; &#26080;&#27861;&#19978;&#20256;&#30340;&#38382;&#39064;&#35299;&#20915;
&#21442;&#35265;&#36825;&#31687;&#25991;&#31456; http://malijun.javaeye.com/blog/800850


----------


&#19968;&#20123; javaeye&#19978;&#20171;&#32461;paperclip&#30340;&#22909;&#25991;

http://yuan.javaeye.com/blog/604174 Rails&#25991;&#20214;&#19978;&#20256;&#21033;&#22120;&#8212;&#8212;paperclip&#31508;&#35760;
</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/65</id>
    <published>2010-12-03T22:44:40+08:00</published>
    <updated>2011-06-22T13:34:06+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/65-nginx-auto-start-with-server-reboot"/>
    <title>Ubuntu Nginx &#24320;&#26426;&#33258;&#21551;&#21160;</title>
    <summary>&#39318;&#20808; &#25105;&#20204;&#38656;&#35201;&#22312; /etc/init.d/&#30446;&#24405;&#19979;&#21019;&#24314;&#19968;&#20010;nginx&#30340;&#33050;&#26412;&#25991;&#20214;&#65292;&#21629;&#20196; vi nginx &#36755;&#20837;&#20197;&#19979;&#20869;&#23481;

    #! /bin/sh
    # Author: rui ding
    # Modified: Geoffrey Grosenbach http://topfunky.com
    # Modified: Clement NEDELCU
    # Reproduced with express authorization from its contributors
    set -e
    PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
    DESC="nginx daemon"
    NAME=nginx
    DAEMON=/usr/local/nginx/sbin/$NAME
    SCRIPTNAME=/etc/init.d/$NAME
    
    
    # If the daemon file is not found, terminate the script.
    test -x $DAEMON || exit 0
    
    d_start() {
      $DAEMON || echo -n " already running"
    }
    
    d_stop() {
      $DAEMON &#8211;s quit || echo -n " not running"
    }
    
    d_reload() {
      $DAEMON &#8211;s reload || echo -n " could not reload"
    }
    
    case "$1" in
      start)
        echo -n "Starting $DESC: $NAME"
        d_start
        echo "."
      ;;
      stop)
        echo -n "Stopping $DESC: $NAME"
        d_stop
        echo "."
      ;;
      reload)
        echo -n "Reloading $DESC configuration..."
        d_reload
        echo "reloaded."
      ;;
      restart)
      echo -n "Restarting $DESC: $NAME"
      d_stop
    # Sleep for two seconds before starting again, this should give the
    # Nginx daemon some time to perform a graceful stop.
      sleep 2
      d_start
      echo "."
      ;;
      *)
      echo "Usage: $SCRIPTNAME {start|stop|restart|reload}" &gt;&amp;2
      exit 3
      ;;
    esac
    exit 0

&#28982;&#21518;&#36755;&#20837; &#20197;&#19979;&#21629;&#20196;

    [root@example.com ~]# update-rc.d &#8211;f nginx defaults

&#22909;&#20102; &#20174;&#26032;&#21551;&#21160;&#30475;&#30475;NGINX&#21551;&#21160;&#20102;&#27809;

&#22914;&#26524;&#35201;&#21462;&#28040;&#24320;&#26426;&#21551;&#21160;&#21487;&#20197;&#36825;&#26679;

    update-rc.d -f nginx remove


----------
&#34917;&#20805;&#36164;&#26009;&#65306;

/etc/init.d/&#37324;&#23384;&#25918;&#20102;&#25152;&#26377;&#30340;&#21551;&#21160;&#33050;&#26412;&#65292;&#25105;&#20204;&#24179;&#26102;&#21487;&#20197;&#36890;&#36807;/etc/init.d/&#33050;&#26412;&#21517; &#21551;&#21160;&#27169;&#24335; &#26469;&#21551;&#21160;&#26576;&#20010;&#24212;&#29992;&#12290;
&#20363;&#22914;&#36755;&#20837;&#21629;&#20196;&#8220;/etc/init.d/smb start&#8221;&#26469;&#21551;&#21160;smb&#26381;&#21153;&#12290;
&#22914;&#26524;&#26159;&#22312;RedHat&#31995;&#32479;&#19979;&#65292;&#36824;&#21487;&#20197;&#36890;&#36807;service smb start&#26469;&#21551;&#21160;&#26576;&#20010;&#26381;&#21153;&#12290;

&#23613;&#31649;/etc/init.d&#30446;&#24405;&#20013;&#30340;&#33050;&#26412;&#21487;&#20197;&#21551;&#21160;&#21644;&#20572;&#27490;&#21508;&#20010;&#26381;&#21153;&#65292;&#20294;&#22312;&#31995;&#32479;&#24341;&#23548;&#26102;&#65292;init&#24182;&#19981;&#26159;&#30452;&#25509;&#22312;/etc/init.d&#30446;&#24405;&#19979;&#25214;&#21508;&#20010;&#26381;&#21153;&#30340;&#21551;&#21160;&#33050;&#26412;&#65292;&#32780;&#26159;&#22312;/etc/rc.d/&#30446;&#24405;&#19979;&#26597;&#25214;&#65292;&#35813;&#30446;&#24405;&#21253;&#21547;rc0.d&#12289;rc1.d&#31561;&#20998;&#21035;&#20195;&#34920;&#19981;&#21516;&#30340;init&#21551;&#21160;&#32423;&#21035;&#30340;&#23376;&#30446;&#24405;&#12290;

&#20320;&#21487;&#20197;&#29992;Runlevel&#21629;&#20196;&#26597;&#30475;&#24403;&#21069;&#20320;&#30340;&#31995;&#32479;&#26159;&#22312;&#37027;&#20010;&#36816;&#34892;&#32423;

    #Runlevel
         N  2
    &#27880;&#65306;&#25105;&#24403;&#21069;&#30340;&#31995;&#32479;&#26159;2&#32423;


&#25509;&#30528;&#26469;&#30475;&#30475;&#36825;&#20123;rcx.d&#30340;&#30446;&#24405;&#19979;&#25152;&#21253;&#21547;&#30340;&#20869;&#23481;&#65292;&#20869;&#23481;&#20840;&#26159;&#19968;&#20123;&#31526;&#21495;&#38142;&#25509;&#65292;&#38142;&#25509;&#21040;&#19978;&#19968;&#32423;init&#30446;&#24405;&#20013;&#30340;&#33050;&#26412;&#19978;&#12290;
&#36825;&#20123;&#31526;&#21495;&#38142;&#25509;&#21517;&#31216;&#37117;&#20197;S&#25110;K&#24320;&#22836;&#65292;&#21518;&#38754;&#36319;&#19968;&#20010;&#25968;&#23383;&#20197;&#21450;&#35813;&#33050;&#26412;&#25152;&#25511;&#21046;&#30340;&#26381;&#21153;&#21517;&#65292;&#20363;&#22914;S10network&#12290;
&#24403;init&#20174;&#20302;&#30340;&#36816;&#34892;&#32423;&#21521;&#39640;&#30340;&#36816;&#34892;&#32423;&#36807;&#28193;&#26102;&#65292;&#23427;&#25353;&#29031;&#25968;&#23383;&#36882;&#22686;&#30340;&#39034;&#24207;&#36816;&#34892;&#25152;&#26377;&#20197;S&#24320;&#22836;&#30340;&#33050;&#26412;&#65292;S=start&#65292;&#21363;&#21551;&#21160;&#33050;&#26412;&#23545;&#24212;&#30340;&#26381;&#21153;&#65307;K=kill&#65292;&#21363;&#26432;&#27515;&#33050;&#26412;&#23545;&#24212;&#26381;&#21153;&#12290;

&#21069;&#38754;&#20171;&#32461;&#21040;rcx.d&#30446;&#24405;&#19979;&#25351;&#21521;&#21551;&#21160;&#33050;&#26412;&#30340;&#31526;&#21495;&#38142;&#25509;&#26159;&#30001;K&#25110;S+&#25968;&#23383;+&#26381;&#21153;&#21517; &#25152;&#32452;&#25104;&#65292;&#20013;&#38388;&#36825;&#20010;&#25968;&#23383;&#21313;&#20998;&#37325;&#35201;&#65292;&#31995;&#32479;&#21551;&#21160;&#26102;&#25353;&#29031;&#36825;&#20010;&#25968;&#23383;&#36882;&#22686;&#25191;&#34892;&#25152;&#26377;S&#24320;&#22836;&#30340;&#33050;&#26412;&#65292;&#31995;&#32479;&#20851;&#38381;&#26102;&#25353;&#29031;&#36825;&#20010;&#25968;&#23383;&#36882;&#20943;&#25191;&#34892;&#25152;&#26377;K&#24320;&#22836;&#30340;&#33050;&#26412;&#12290;

&#22914;&#20309;&#33258;&#23450;&#20041;&#31526;&#21495;&#38142;&#25509;&#65311;
&#21551;&#21160;&#33050;&#26412;&#65306;
    &#22240;&#20026;&#25105;&#21018;&#25165;&#30340;&#36816;&#34892;&#32423;&#26159;2&#32423; &#25152;&#20197;&#22312;/etc/rc.d/rc2.d &#30446;&#24405;&#19979;&#36816;&#34892;
  

    #ln -s /etc/init.d/nginx S99nginx       //&#37325;&#26032;&#23450;&#20041;nginx&#26381;&#21153;&#30340;&#33050;&#26412;&#21551;&#21160;&#39034;&#24207;

</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/64</id>
    <published>2010-12-02T21:33:46+08:00</published>
    <updated>2011-06-21T21:07:26+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/64-Do-not-create-table-use-ActiveRecord%20"/>
    <title>Do not create table use ActiveRecord </title>
    <summary>&#21487;&#33021;&#20320;&#20250;&#38382;&#20026;&#20160;&#20040;&#36825;&#26679;&#20570;
&#37027;&#20040;&#25105;&#36890;&#36807;&#19979;&#38754;&#19968;&#20010;&#20363;&#23376;&#26469;&#35828;&#26126;&#65292;&#25105;&#20026;&#20160;&#20040;&#20250;&#26377;&#36825;&#20010;&#38656;&#27714;

&#22312;&#32593;&#39029;&#30331;&#38470;qzone&#30340;&#26102;&#20505;&#65292;&#22914;&#26524;&#20320;&#39564;&#35777;&#30721;&#20889;&#38169;&#20102;&#21518;&#65292;&#20250;&#25552;&#31034;&#20320;&#39564;&#35777;&#30721;&#38169;&#20102;&#65292;&#20294;&#23494;&#30721;&#26694;&#20869;&#36824;&#26159;&#27809;&#26377;&#34987;&#28165;&#31354;&#65292;&#36825;&#20010;&#24590;&#20040;&#23454;&#29616;&#30340;&#21602;&#65311;&#25105;&#20204;&#26469;&#31616;&#21333;&#30340;&#23454;&#29616;&#19979;

1&#12289;&#21019;&#24314;model

    D:\model_test&gt;ruby script\generate model temp_model

2&#12289;&#20462;&#25913;model&#22914;&#19979;

    class TempModel &lt; ActiveRecord::Base
      attr_accessor :username, :password
    end

3&#12289;&#21019;&#24314;controller &#21644; view

    D:\model_test&gt;ruby script\generate controller account login

4&#12289;&#20462;&#25913;controller&#22914;&#19979;

    class AccountController &lt; ApplicationController
      def login
        if !request.post?
          @obj = TempModel.new
          flash[:errmsg] = nil
        else
          @obj = TempModel.new(params[:obj])
          flash[:errmsg] = rand()
          #&#36825;&#37324;&#21482;&#23450;&#20041;&#20102;&#20986;&#38169;&#30340;&#24773;&#20917;&#65292;&#30456;&#24403;&#20110;&#36825;&#37324;render(:action=&gt;self)&#20102;
          #&#22914;&#26524;&#27809;&#20986;&#38169;&#23601; redirect_to
        end
      end
    end

5&#12289;&#20462;&#25913;view&#22914;&#19979;

    &lt;% form_for :obj, @obj, :url =&gt; {:aciton=&gt;'login'} do |f| %&gt;
      &lt;%= flash[:errmsg] %&gt;
      &lt;%= f.text_field(:username) %&gt;
      &lt;%= f.text_field(:password) %&gt;
      &lt;%= f.submit 'submit' %&gt;
    &lt;% end %&gt;

6&#12289;&#25105;&#20204;&#24320;&#21551;server&#35775;&#38382;&#65292;&#20250;&#21457;&#29616;&#20986;&#38169;&#22914;&#19979;

    ActiveRecord::StatementInvalid in TestController#create 
    Could not find table 'temp_models'

&#36825;&#26159;&#22240;&#20026;&#25105;&#20204;&#27809;&#26377; rake db:migrate 
&#25191;&#34892;&#21518;&#20877;&#35775;&#38382;&#65292;&#28857;&#20987; submit &#21518;&#65292;&#21457;&#29616;&#25105;&#20204;&#30340;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#19981;&#29992;&#20877;&#36755;&#20837;&#20102;


----------


&#22909;&#20102;&#65292;&#35797;&#39564;&#30446;&#30340;&#36798;&#21040;&#20102;&#65292;&#37027;&#20040;&#36825;&#37324;&#23601;&#26377;&#20010;&#23567;&#38382;&#39064;&#65292;&#25105;&#20204;&#23436;&#20840;&#27809;&#29992;&#21040;&#36825;&#20010;&#34920;&#65292;&#21487;&#19981;&#21487;&#20197;&#19981;&#21019;&#24314;&#21602;&#65311;

&#31572;&#26696;&#26159;&#21487;&#20197;&#30340;&#65292;&#23454;&#29616;&#36215;&#26469;&#22823;&#27010;&#22914;&#19979;&#65306;

1&#12289;&#22914;&#26524;&#20320;&#26159;rails3 &#65292;&#21487;&#20197;&#29992; ActiveModel&#65292;&#35814;&#32454;&#30340;&#26041;&#27861;&#21442;&#35265;&#36825;&#31687;&#25991;&#31456;
http://hlee.javaeye.com/blog/715439

2&#12289;&#22914;&#26524;&#20320;&#26159;rails2&#65292;&#21487;&#20197;&#20351;&#29992; activerecord-tableless &#36825;&#20010;plugin &#65288;&#32676;&#37324;sunteya&#25552;&#20379;&#65289;
config.gem 'activerecord-tableless', :version =&gt; '0.1.0', :lib =&gt; 'tableless'

    class LiveProgramBatch &lt; ActiveRecord::Base
      has_no_table
    end
&#26356;&#22810;&#30340;&#20351;&#29992;&#25171;&#24320; activerecord-tableless-xxx/lib/tableless.rb &#30475;&#21069;&#38754;&#30340;&#27880;&#37322;&#65292;&#24456;&#35814;&#32454;&#30340;&#65292;&#22823;&#27010;&#22914;&#19979;

      # = ActiveRecord::Tableless
      # 
      # Allow classes to behave like ActiveRecord models, but without an associated
      # database table. A great way to capitalize on validations. Based on the
      # original post at http://www.railsweenie.com/forums/2/topics/724 (which seems
      # to have disappeared from the face of the earth).
      # 
      # = Example usage
      # 
      #  class ContactMessage &lt; ActiveRecord::Base
      #    
      #    has_no_table
      #    
      #    column :name,    :string
      #    column :email,   :string
      #    column :message, :string
      #    
      #  end
      #  
      #  msg = ContactMessage.new( params[:msg] )
      #  if msg.valid?
      #    ContactMessageSender.deliver_message( msg )
      #    redirect_to :action =&gt; :sent
      #  end
      #


</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/63</id>
    <published>2010-11-28T22:08:55+08:00</published>
    <updated>2011-06-22T10:04:16+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/63-use-sample-of-formtastic"/>
    <title>formtastic&#30340;&#20351;&#29992;</title>
    <summary>formtastic&#30340;&#20351;&#29992;  

**&#20316;&#29992;**  

&#36825;&#20010;&#25554;&#20214;&#21487;&#20197;&#24456;&#31616;&#21333;&#30340;&#29983;&#25104;&#34920;&#21333;&#30340;&#25991;&#26412;&#26694;  


**&#23433;&#35013;**  

    config.gem "formtastic"  

**&#29983;&#25104;formtastic&#20381;&#36182;&#30340;&#25991;&#20214;**

Rails 3:  

    $ rails generate formtastic:install

Rails 2:

    $ ./script/generate formtastic

**&#23548;&#20837;&#33258;&#21160;&#29983;&#25104;&#30340;formtastic&#20381;&#36182;&#30340;css&#25991;&#20214;**  

    &lt;%= formtastic_stylesheet_link_tag %&gt;

**formtastic &#30340;&#26041;&#27861;&#35299;&#26512;**  

label:  

    form.label :name, "&#22995;&#21517;"  #&#29983;&#25104;&#21517;&#20026;'&#22995;&#21517;'&#30340;&#26631;&#31614;


 inputs:(nput_field_set&#21644;inputs&#19968;&#26679;)  

:id&#21644;:class  &#35774;&#32622;inputs&#21306;&#38388;&#30340;id&#21644;class  
name:     &#29983;&#25104;&#19968;&#20010;&#21306;&#38388;&#65292;&#35813;&#22359;&#37324;&#30340;&#25152;&#26377;&#25991;&#26412;&#26694;&#65292;&#23646;&#20110;&#35813;&#21306;&#38388;  
for:   &#29983;&#25104;&#19968;&#20010;&#23376;&#34920;&#21333;&#22495;&#65292;&#25928;&#26524;&#31561;&#21516;&#20110;semantic_fields_for  
form.inputs  :name, :sex, :age    &#29983;&#25104;&#19977;&#20010;&#25991;&#26412;&#36755;&#20837;&#26694;&#65292;&#20998;&#21035;&#26159;:name, :sex, :age  

eg:  

    form.inputs :name =&gt; "&#21306;&#38388;", :id =&gt; "id", :class =&gt; "class" do
      form.input :name
    end

    form.inputs :name =&gt; "&#21306;&#38388;" do
       .....
    end

    form.inputs :name =&gt; "&#21306;&#38388;", :for =&gt; :author do |author_form|
      author.input :name
    end

semantic_form_for :   &#29983;&#25104;&#19968;&#20010;&#34920;&#21333;   

semantic_fields_for&#65306;(&#25928;&#26524;&#31561;&#21516;&#20110; inputs :for =&gt; :info)   &#29983;&#25104;&#19968;&#20010;&#23376;&#34920;&#21333;&#22495;&#65292;&#25552;&#20132;&#26102;&#21442;&#25968;&#23454;&#20363;  

&#20030;&#20363;&#65306;  

    semantic_form_for @xingxi do |form|
      form.semantic_fields_for :info do |field|
          field.input :name
          field.input :age
      end
      form.input :sex
    end

&#20256;&#36882;&#21442;&#25968;&#65306;  

    "xingxi"=&gt;{"info"=&gt;{"name"=&gt;"asdfas", "age"=&gt;"12"}&#65292; :sex =&gt; "0"}

&#27880;&#24847;:  

    semantic_fields_for :info

input&#65306;  &#29983;&#25104;&#19968;&#20010;&#34920;&#21333;&#23646;&#24615;  

:label  &#35774;&#32622;&#35813;&#36755;&#20837;&#26694;&#30340;&#26631;&#31614;&#21517;&#31216;  

:id &#21644; :class &#35774;&#32622;input&#23646;&#24615;&#30340;id&#21644;class  

required   &#25351;&#23450;&#35813;&#36755;&#20837;&#26694;&#26159;&#21542;&#24517;&#39035;&#36755;&#20837;&#65292;&#40664;&#35748;&#20026;true&#65292;&#24517;&#39035;&#36755;&#20837;(&#26143;&#21495;)  

collection &#25351;&#23450;&#19968;&#20010;&#38598;&#21512;&#65292;&#35813;&#38598;&#21512;&#26159;&#19968;&#20010;&#25968;&#32452;&#65292;&#20803;&#32032;&#21487;&#20197;&#26159;&#20855;&#20307;&#30340;&#20540;&#25110;&#23454;&#20363;&#23545;&#35937;&#65288;&#22312;&#19979;&#25289;&#26694;&#12289;&#22810;&#36873;&#26694;&#12289;&#22810;&#20010;&#21333;&#36873;&#25353;&#38062;&#20013;&#20351;&#29992;&#65289;  

form.input :name   #&#29983;&#25104;&#19968;&#20010;&#24102;&#26143;&#21495;&#34920;&#21333;&#36755;&#20837;&#26694;&#65292;&#21517;&#31216;&#20026;name,&#40664;&#35748;:required =&gt; true   

hint  &#36755;&#20837;&#26694;&#21518;&#26377;&#36755;&#20837;&#26694;&#35828;&#26126;  

input_html   &#34920;&#21333;&#36755;&#20837;&#26694;&#20013;html&#20013;&#30340;&#23646;&#24615;&#21487;&#20197;&#30452;&#25509;&#35774;&#32622;&#22312;&#36825;&#37324;  

warp_html   &#34920;&#21333;&#36755;&#20837;&#26694;&#22806;&#22260;&#21253;&#35065;&#20803;&#32032;&#30340;html&#20013;&#30340;&#23646;&#24615;&#21487;&#20197;&#30452;&#25509;&#35774;&#32622;&#22312;&#36825;&#37324;  

as  &#25351;&#23450;&#36755;&#20837;&#26694;&#30340;&#31181;&#31867;  
 &#21253;&#25324;&#65306;   
:check_boxes &#22810;&#20010;&#22797;&#36873;&#26694;  
:select  &#21333;&#20010;&#22797;&#36873;&#26694;  
:boolean  &#21333;&#20010;&#22797;&#36873;&#26694;  
:radio   &#21333;&#20010;&#21333;&#36873;&#25353;&#38062;  
:string   &#25991;&#26412;&#36755;&#20837;&#26694;  
:time_zone  &#26102;&#21306;&#19979;&#25289;&#26694;  
:password  
:text  &#25991;&#26412;&#22495;&#36755;&#20837;&#26694;  
:date  &#26085;&#26399;&#19979;&#25289;&#26694;  
:datetime   &#26085;&#26399;&#21644;&#26102;&#38388;&#19979;&#25289;&#26694;  
:time  &#26102;&#38388;&#19979;&#25289;&#26694;  
:file  
:hidden  

eg&#65306;  

    form.input :name, :id =&gt; "id", :class =&gt; "class"
    form.input :name&#65292; :required =&gt; false
    form.input :name, :hint =&gt; "Example: ruby, rails, forms"
    form.input :name, :input_html =&gt; { :id =&gt; "wode", :maxlength =&gt; 4 }
    form.input :name&#65292; :as =&gt; :check_boxes, :collection =&gt; Xingxi.all &#25110; [1,2,3,4]
    form.input :name, :warp_html =&gt; { :id =&gt; "wode" }
    form.inputs :name, :labe =&gt; "&#22995;&#21517;"
    form.input :sex, :label =&gt; "&#24615;&#21035;", :collection =&gt; {"&#30007;" =&gt; true, "&#22899;" =&gt; false}, :as =&gt; :radio, :selected =&gt; true

commit_button   &#29983;&#25104;&#19968;&#20010;&#25552;&#20132;&#25353;&#38062;  

:button_html   &#35774;&#32622;&#25353;&#38062;&#30340;html&#21487;&#20197;&#30452;&#25509;&#20889;&#22312;&#36825;&#37324;  

eg:  

    form.commit_button  "&#30830;&#35748;"
    form.commit_button "tijiao", :button_html =&gt; {:id =&gt; "button_id"}

buttons &#29983;&#25104;&#19968;&#20010;&#21306;&#38388;, :name&#25351;&#23450;&#21306;&#38388;&#30340;&#21517;&#31216;,&#31561;&#21516;&#20110;button_field_set  

eg:

    form.buttons do
       from.commit_button "tijiao"
    end

semantic_errors    &#26174;&#31034;&#21253;&#25324;&#23646;&#24615;&#21517;&#31216;&#30340;&#38169;&#35823;&#20449;&#24687;  

eg:  

    semantic_errors  :name



inline_errors_for &#21644; errors_on      &#21482;&#26174;&#31034;&#23646;&#24615;&#21517;&#31216;&#30340;&#38169;&#35823;&#20449;&#24687;  

eg:  

     inline_errors_for :name
    errors_on :name</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/62</id>
    <published>2010-11-26T22:50:34+08:00</published>
    <updated>2011-06-22T12:25:52+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/62-operation-of-large-quantities-of-data"/>
    <title>&#22823;&#37327;&#25968;&#25454;&#30340;&#25209;&#37327;&#25805;&#20316;</title>
    <summary>&#22914;&#26524;&#20320;&#26377;10,000,000&#20010;&#29992;&#25143;&#65292;&#27599;&#21608;&#38656;&#35201;&#32102;&#20182;&#20204;&#21457;&#36865;&#26368;&#26032;&#30340;&#25512;&#24191;&#37038;&#20214;&#65292;&#20320;&#21487;&#33021;&#20250;&#20174;&#25968;&#25454;&#24211;&#20013;&#36825;&#26679;&#25805;&#20316;:

    User.each do |user|   
        NewsLetter.weekly_deliver(user)   
    end  

&#20294;&#36825;&#26679;&#20570;&#20250;&#35753;ruby&#20174;&#25968;&#25454;&#24211;&#20013;&#19968;&#27425;&#21462;&#20986;10,000,000&#26465;&#25968;&#25454;&#65292;&#24182;&#21019;&#24314;10,000,000&#20010;&#23545;&#35937;&#65292;&#26381;&#21153;&#22120;&#20869;&#23384;&#20250;&#22823;&#37327;&#28040;&#32791;&#65292;&#22240;&#27492;&#36825;&#26679;&#20570;&#26159;&#19981;&#34892;&#30340;&#65292;
&#20174;rails 2.3&#24320;&#22987;&#20320;&#23601;&#21487;&#20197;&#20351;&#29992;find_each&#21644;find_in_batches&#26041;&#27861;&#20102;&#65292;&#36825;&#20004;&#20010;&#26041;&#27861;&#19987;&#38376;&#29992;&#20110;&#20998;&#25209;&#26597;&#35810;&#25968;&#25454;&#21644;&#22788;&#29702;&#65292;&#40664;&#35748;&#24773;&#20917;&#19979;find_each&#21644;find_in_batches&#27599;&#27425;&#20250;&#26597;&#20986;1000&#26465;&#25968;&#25454;&#35760;&#24405;&#65292;&#20320;&#21487;&#20197;&#21487;&#20197;&#25351;&#23450;&#27599;&#27425;&#21462;&#20986;&#30340;&#25968;&#37327;:batch_size&#65292;

    User.find_each do |user|   
         NewsLetter.weekly_deliver(user)   
     end  

find_in_batches&#26159;&#36820;&#36824;&#19968;&#20010;&#25968;&#25454;&#23545;&#35937;: 

    User.find_in_batches(:batch_size =&gt; 5000) do |users|   
         users.each { |user| NewsLetter.weekly_deliver(user) }   
    end  </summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/61</id>
    <published>2010-11-26T22:05:54+08:00</published>
    <updated>2011-06-22T08:44:21+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/61-undefined-method-to-sym-for-nil-class-when-migration%20"/>
    <title>ActiveRecord rake db:migrate errors &amp;quot;undefined method `to_sym' for nil:NilClass&amp;quot; </title>
    <summary>migrate &#22914;&#19979;

    class RenameColumnForUser &lt; ActiveRecord::Migration
      def self.up
        rename_column(:users, :email, :email_address)
      end
      def self.down
        rename_column(:users, :email_address, :email)
      end
    end

&#25191;&#34892;rake db:migrate &#38169;&#35823;&#20449;&#24687;&#22914;&#19979;

    D:\ror\vhostmgr_app&gt;rake db:migrate:up VERSION=20101126122604
    (in D:/test/ror_new/vhostmgr_app)
    ==  RenameColumnForUser: migrating ============================================
    -- rename_column(:users, :email, :email_address)
    rake aborted!
    undefined method `to_sym' for nil:NilClass


google&#26410;&#26524;&#65292;&#21040; /db/schema.rb &#37324;&#30475;&#21518;&#21457;&#29616; &#26080; &#31867;&#20284;&#19979;&#21015;&#20449;&#24687;&#65292;&#22240;&#20026;&#21035;&#30340;&#20960;&#20010;&#34920;&#37117;&#26377;&#65292;&#21807;&#29420;&#32570; users

    create_table "users", :force =&gt; true do |t|
      ...
      t.string   "email_address"
    end

&#20877;&#24448;&#21518;&#30475;&#21457;&#29616;&#19979;&#38754;&#36825;&#27573;

    # Could not dump table "users" because of following StandardError
    #   Unknown type 'str' for column 'email'


&#24212;&#35813;&#26159;&#20197;&#21069;migrate&#30340;&#26102;&#20505; email &#30340;&#23383;&#27573;&#31867;&#22411;&#20889;&#38169;&#20102;&#65292;&#22238;&#30475;&#25805;&#20316;email&#23383;&#27573;&#30340;&#37027;&#20010;migrate&#65292;&#21457;&#29616;&#20102;&#38382;&#39064;

    class AddEmailToUser &lt; ActiveRecord::Migration
      def self.up
        add_column :users, :email, :str
      end
      def self.down
        remove_column :users, :email
      end
    end

&#38382;&#39064;&#23601;&#20986;&#22312;&#36825;&#37324;&#20102;&#65292;&#37027;&#20040;&#25913;&#36807;&#26469;&#21518;&#65292;&#32487;&#32493; rake db:migrate &#36824;&#26159;&#19981;&#34892;&#65292;&#25105;&#24819;&#36825;&#24212;&#35813;&#26159; /db/schema.rb &#26410;&#25214;&#21040;create_table "users" &#32780;&#35828;&#26159; nil &#21543;
&#23454;&#22312;&#27809;&#21150;&#27861;&#20102;&#65292;&#24819;&#30528;&#29616;&#22312;&#25968;&#25454;&#37117;&#36824;&#19981;&#37325;&#35201;&#65292;&#23601; rake db:reset &#35797;&#35797;&#65292;ok&#20102;

&#26368;&#21518;&#65292;&#21560;&#21462;&#25945;&#35757;&#65292;&#19979;&#27425;migrate&#30340;&#26102;&#20505;&#35201;&#22810;&#30475;&#30475;&#65292;&#19981;&#35201;&#20889;&#38169;&#20102;
</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/60</id>
    <published>2010-11-25T13:16:18+08:00</published>
    <updated>2011-06-22T01:31:28+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/60-do-not-play-joke-everywhere"/>
    <title>&#31038;&#20132;&#32593;&#31449;&#27169;&#24335;-&#19981;&#35201;&#21040;&#22788;&#24320;&#29609;&#31505;</title>
    <summary>**&#26159;&#20160;&#20040;**

&#20154;&#20204;&#33021;&#22815;&#29702;&#35299;&#24189;&#40664;&#21644;&#35843;&#33410;&#23604;&#23596;&#27668;&#27675;&#30340;&#20431;&#30382;&#35805;&#65292;&#20294;&#30028;&#38754;&#19978;&#19981;&#37027;&#20040;&#19968;&#26412;&#27491;&#32463;&#30340;&#25991;&#23383;&#21487;&#33021;&#20250;&#35753;&#29992;&#25143;&#35273;&#24471;&#20320;&#26159;&#22312;&#25343;&#20182;&#20204;&#25214;&#20048;&#23376;&#12290;

**&#20160;&#20040;&#26102;&#20505;&#20351;&#29992;**

&#24403;&#20320;&#24819;&#22312;&#30028;&#38754;&#24324;&#28857;&#31505;&#35805;&#30340;&#26102;&#20505;&#65292;&#20351;&#29992;&#35813;&#27169;&#24335;&#12290;

**&#22914;&#20309;&#20351;&#29992;**

&#19981;&#35201;&#32431;&#20026;&#20102;&#24320;&#29609;&#31505;&#32780;&#24320;&#29609;&#31505;&#12290;&#36825;&#24182;&#19981;&#26159;&#35828;&#20320;&#19981;&#33021;&#26426;&#26234;&#25110;&#28789;&#27963;&#22320;&#19982;&#21035;&#20154;&#20998;&#20139;&#20320;&#25152;&#22312;&#30340;&#25991;&#21270;&#20256;&#32479;&#20013;&#30340;&#31505;&#35805;&#12290;&#20294;&#24456;&#23569;&#26377;&#20154;&#33021;&#25226;&#31505;&#35805;&#35762;&#30340;&#22909;&#65292;&#23588;&#20854;&#26159;&#20320;&#25152;&#38754;&#23545;&#30340;&#26159;&#26080;&#27861;&#35851;&#38754;&#30340;&#32593;&#31449;&#29992;&#25143;&#26102;&#12290;

**&#29305;&#20363;**

&#19968;&#20123;&#23567;&#32593;&#31449;&#20250;&#29992;&#19968;&#20123;&#27604;&#36739;&#32463;&#20856;&#30340;&#20431;&#30382;&#35805;&#26469;&#36814;&#21512;&#31038;&#21306;&#30340;&#21916;&#22909;&#65292;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#20182;&#20204;&#35762;&#20123;&#31505;&#35805;&#20063;&#19981;&#20250;&#35753;&#32593;&#31449;&#30340;&#29992;&#25143;&#24863;&#21040;&#38476;&#29983;&#21644;&#22256;&#24785;&#12290;

**&#20026;&#20160;&#20040;&#20351;&#29992;**

&#22240;&#20026;&#21516;&#26679;&#30340;&#24189;&#40664;&#23545;&#19981;&#21516;&#30340;&#20154;&#26469;&#35828;&#20250;&#26377;&#19981;&#21516;&#30340;&#25928;&#26524;&#65292;&#24182;&#19988;&#20320;&#20063;&#19981;&#21487;&#33021;&#30693;&#36947;&#26368;&#32456;&#30475;&#21040;&#30028;&#38754;&#25991;&#23383;&#30340;&#20154;&#26159;&#35841;&#65292;&#25152;&#20197;&#26368;&#22909;&#24443;&#24213;&#21076;&#38500;&#30028;&#38754;&#20013;&#30340;&#31505;&#35805;&#65292;&#20197;&#36991;&#20813;&#20882;&#29359;&#29992;&#25143;&#25110;&#36896;&#25104;&#20854;&#20182;&#19981;&#24517;&#35201;&#30340;&#25705;&#25830;&#12290;


&#35753;&#29992;&#25143;&#20182;&#20204;&#33258;&#24049;&#20114;&#30456;&#35762;&#20123;&#20182;&#20204;&#33258;&#24049;&#30340;&#31505;&#35805;&#21543;&#12290;</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/59</id>
    <published>2010-11-25T12:50:40+08:00</published>
    <updated>2011-06-22T11:41:08+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/59-design-pattern-of-log-out"/>
    <title>&#31038;&#20132;&#32593;&#31449;&#27169;&#24335;-&#36864;&#20986;</title>
    <summary>**&#26159;&#20160;&#20040;&#65311;**

 &#29992;&#25143;&#24819;&#36864;&#20986;&#31995;&#32479;&#65292;&#32467;&#26463;&#19982;&#31995;&#32479;&#30340;&#20250;&#35805;&#65292;&#25110;&#32773;&#20687;&#21464;&#25104;&#21311;&#21517;&#26102;&#36866;&#29992;&#12290;

**&#20160;&#20040;&#26102;&#20505;&#20351;&#29992;&#65311;**

 1. &#29992;&#25143;&#24819;&#32467;&#26463;&#20182;&#19982;&#31995;&#32479;&#30340;&#20250;&#35805;


 2. &#29992;&#25143;&#24819;&#21464;&#25104;&#21311;&#21517;


 3. &#29992;&#25143;&#22312;&#20844;&#29992;&#30340;&#35745;&#31639;&#26426;&#19978;&#65292;&#38656;&#35201;&#20445;&#25252;&#38544;&#31169;&#65292;&#20445;&#35777;&#20010;&#20154;&#25968;&#25454;&#21644;&#25104;&#26524;&#30340;&#23433;&#20840;


 4. &#29992;&#25143;&#24050;&#32463;&#36864;&#20986;&#31995;&#32479;&#24182;&#19988;&#20320;&#24819;&#32487;&#32493;&#35753;&#20182;&#21644;&#20320;&#30340;&#31449;&#28857;&#20043;&#38388;&#20445;&#25345;&#20851;&#31995;&#12290;&#20363;&#22914;&#65292;&#20320;&#24819;&#21578;&#35785;&#20182;&#25509;&#19979;&#26469;&#20182;&#21487;&#20197;&#21435;&#21738;&#37324;&#65292;&#20197;&#21450;&#19968;&#20123;&#26032;&#21151;&#33021;&#30140;&#37266;&#30340;&#20449;&#24687;&#65288;flickr.com&#30340;&#36864;&#20986;&#30028;&#38754;&#65289;

**&#22914;&#20309;&#20351;&#29992;&#65311;**

 1. &#32771;&#34385;&#25552;&#20379;&#19968;&#20010;&#27491;&#22312;&#36733;&#20837;&#39029;&#38754;&#30340;&#25552;&#31034;&#65292;&#20197;&#25250;&#20986;&#30340;&#34920;&#26126;&#29992;&#25143;&#20173;&#26410;&#30331;&#38470;


 2. &#21363;&#20351;&#29992;&#25143;&#24050;&#32463;&#36864;&#20986;&#65292;&#25110;&#32773;&#24403;&#29992;&#25143;&#36820;&#22238;&#31995;&#32479;&#26102;&#65292;&#38656;&#35201;&#25552;&#20379;&#28165;&#26970;&#30340;&#36873;&#39033;&#20379;&#29992;&#25143;&#35797;&#29992;&#20854;&#20182;&#21151;&#33021;


 3. &#25552;&#20379;&#20415;&#25463;&#30340;&#37325;&#26032;&#30331;&#38470;&#21151;&#33021;


 4. &#20381;&#25454;&#20869;&#23481;&#22810;&#23569;&#25110;&#32773;&#25152;&#21344;&#23616;&#22495;&#22823;&#23567;&#36827;&#34892;&#35843;&#25972;&#65292;&#20197;&#20445;&#35777;&#39029;&#38754;&#36731;&#20415;&#31616;&#27905;&#65292;&#36825;&#26679;&#23601;&#33021;&#20943;&#36731;&#29992;&#25143;&#30340;&#25387;&#25240;&#24863;&#65292;&#24182;&#19988;&#20197;&#19968;&#31181;&#31215;&#26497;&#30340;&#20307;&#39564;&#32467;&#26463;&#19982;&#31995;&#32479;&#30340;&#20250;&#35805;

**&#20026;&#20160;&#20040;&#20351;&#29992;&#65311;**

&#29992;&#25143;&#36864;&#20986;&#26576;&#20010;&#26381;&#21153;&#21518;&#65292;&#20182;&#25509;&#19979;&#26469;&#30340;&#30446;&#30340;&#26159;&#38750;&#24120;&#26126;&#30830;&#30340;&#12290;&#19968;&#33324;&#30340;&#32593;&#31449;&#24120;&#24120;&#20250;&#22312;&#29992;&#25143;&#36864;&#20986;&#21518;&#23558;&#29992;&#25143;&#20173;&#22238;&#39318;&#39029;&#65292;&#20294;&#26159;&#36825;&#20250;&#35753;&#29992;&#25143;&#19981;&#30693;&#25152;&#38169;&#65292;&#24182;&#19988;&#36825;&#31181;&#20570;&#27861;&#24182;&#19981;&#33021;&#28165;&#26970;&#22320;&#21578;&#30693;&#29992;&#25143;&#20182;&#26159;&#21542;&#24050;&#32463;&#25104;&#21151;&#36864;&#20986;&#20102;&#31995;&#32479;

&#25552;&#20379;&#19968;&#20010;&#27491;&#22312;&#31361;&#20986;&#30340;&#32531;&#20914;&#39029;&#38754;&#25552;&#31034;&#65292;&#20197;&#28165;&#26970;&#30340;&#34920;&#26126;&#22914;&#26524;&#29992;&#25143;&#36864;&#20986;&#31995;&#32479;&#21518;&#65292;&#31995;&#32479;&#20250;&#32473;&#20986;&#29992;&#25143;&#28165;&#26224;&#30340;&#25552;&#31034;

&#36825;&#19968;&#39029;&#38754;&#20063;&#21487;&#20197;&#26159;&#21521;&#29992;&#25143;&#20171;&#32461;&#26032;&#21151;&#33021;&#25110;&#26410;&#20351;&#29992;&#30340;&#21151;&#33021;&#30340;&#22909;&#26426;&#20250;&#65292;&#36825;&#20063;&#26159;&#35753;&#29992;&#25143;&#37325;&#26032;&#30331;&#38470;&#30340;&#19968;&#31181;&#31574;&#30053;</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/58</id>
    <published>2010-11-25T10:14:52+08:00</published>
    <updated>2011-06-22T03:04:05+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/58-design-pattern-of-invitation"/>
    <title>&#31038;&#20132;&#32593;&#31449;&#27169;&#24335;-&#36992;&#35831;</title>
    <summary>**&#26159;&#20160;&#20040;&#65311;**

&#29992;&#25143;&#25509;&#21463;&#22909;&#21451;&#30340;&#36992;&#35831;&#25110;&#25509;&#21463;&#21152;&#20837;&#21040;&#26576;&#20010;&#32593;&#31449;&#30340;&#36992;&#35831;&#65288;&#21442;&#35265; TWINE.COM&#36992;&#35831;&#29992;&#25143;&#21152;&#20837;&#65289;

**&#20160;&#20040;&#26102;&#20505;&#20351;&#29992;&#65311;**
    

 1. &#26500;&#24314;&#29992;&#25143;&#30340;&#20851;&#31995;&#32593;&#32476;&#21487;&#20197;&#25552;&#21319;&#29992;&#25143;&#20307;&#39564;


 2. &#32593;&#31449;&#30340;&#19994;&#21153;&#22686;&#38271;&#20381;&#36182;&#30340;&#26159;&#26379;&#21451;&#30340;&#26379;&#21451;


 3. &#20320;&#24819;&#34917;&#20805;&#23436;&#21892;&#8220;&#29992;&#25143;&#30456;&#20114;&#20171;&#32461;&#8221;&#36825;&#31181;&#20256;&#32479;&#30340;&#32593;&#31449;&#25512;&#20171;

**&#22914;&#20309;&#20351;&#29992;&#65311;**

 1. &#36992;&#35831;&#20013;&#24212;&#35813;&#21253;&#21547;&#21457;&#36865;&#32773;&#30340;&#20010;&#20154;&#20449;&#24687;


 2. &#24212;&#35813;&#21521;&#21463;&#36992;&#20154;&#28165;&#26970;&#30340;&#36992;&#28165;&#26970;&#30340;&#26631;&#26126;&#36992;&#35831;&#21457;&#36865;&#32773;&#30340;&#36523;&#20221;


 3. &#24212;&#35813;&#26126;&#30830;&#22320;&#21578;&#35785;&#21463;&#36992;&#20154;&#21152;&#20837;&#35813;&#32593;&#31449;&#21518;&#20250;&#26377;&#21738;&#20123;&#22909;&#22788;


 4. &#35201;&#26377;&#19968;&#20010;&#26126;&#26174;&#30340;&#8220;&#39532;&#19978;&#27880;&#20876;&#8221;&#30340;&#25353;&#38062;&#25110;&#38142;&#25509;&#65292;&#20197;&#20415;&#35753;&#21463;&#36992;&#32773;&#24456;&#23481;&#26131;&#23601;&#21487;&#20197;&#36827;&#20837;&#32593;&#31449;&#24320;&#22987;&#35797;&#29992;

**&#20026;&#20160;&#20040;&#20351;&#29992;&#65311;**

&#20026;&#29992;&#25143;&#25552;&#20379;&#19968;&#20221;&#27491;&#24335;&#30340;&#36992;&#35831;&#20989;&#20379;&#20854;&#21521;&#22909;&#21451;&#21457;&#36865;&#36992;&#35831;&#65292;&#22312;&#36825;&#20221;&#36992;&#35831;&#20989;&#20013;&#20320;&#21487;&#20197;&#23558;&#20320;&#32593;&#31449;&#30340;&#33829;&#38144;&#20449;&#24687;&#21644;&#29992;&#25143;&#30340;&#20010;&#20154;&#20449;&#24687;&#25972;&#21512;&#22312;&#19968;&#36215;&#12290;&#21478;&#22806;&#65292;&#36825;&#19968;&#36807;&#31243;&#21487;&#20197;&#20445;&#35777;&#25345;&#32493;&#26377;&#20154;&#27880;&#20876;&#32593;&#31449;&#65292;&#20197;&#28385;&#36275;&#32593;&#31449;&#30340;&#30149;&#27602;&#24335;&#25104;&#38271;&#30446;&#26631;</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/57</id>
    <published>2010-11-25T09:41:39+08:00</published>
    <updated>2011-06-22T11:51:47+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/57-the-continuity-of-log-in"/>
    <title>&#31038;&#20132;&#32593;&#31449;&#27169;&#24335;-&#30331;&#38470;&#30340;&#36830;&#32493;&#24615;</title>
    <summary>**&#26159;&#20160;&#20040;?**

&#19968;&#20010;&#26377;&#36134;&#25143;&#20294;&#29616;&#22312;&#27809;&#26377;&#30331;&#38470;&#30340;&#29992;&#25143;&#24819;&#35201;&#21457;&#34920;&#19968;&#20123;&#20869;&#23481;&#26102;&#65292;&#20351;&#29992;&#35813;&#27169;&#24335;&#12290; 
   

**&#20160;&#20040;&#26102;&#20505;&#20351;&#29992;**  

&#24403;&#21442;&#19982;&#31038;&#21306;&#24517;&#39035;&#35201;&#27714;&#36523;&#20221;&#39564;&#35777;&#26102;&#65292;&#35813;&#27169;&#24335;&#20351;&#29992;&#12290;&#21442;&#19982;&#30340;&#24418;&#24335;&#21253;&#25324;&#65288;&#20294;&#19981;&#38480;&#20110;&#65289;&#35780;&#35770;&#12289;&#25237;&#31080;&#12289;&#35780;&#20998;&#12289;&#28155;&#21152;&#26631;&#31614;&#12289;&#21457;&#21338;
&#23458;&#20197;&#21450;&#22312;&#35770;&#22363;&#21457;&#24086;&#31561;&#12290;  

  
**&#22914;&#20309;&#20351;&#29992;**  

1. &#24403;&#29992;&#25143;&#24819;&#21457;&#34920;&#35780;&#35770;&#65288;&#25110;&#36827;&#34892;&#31867;&#20284;&#25805;&#20316;&#65289;&#26102;&#65292;&#25552;&#37266;&#20182;&#38656;&#35201;&#20808;&#30331;&#38470;&#65292;&#24182;&#23558;&#20182;&#24341;&#21521;&#30331;&#38470;&#27969;&#31243;&#12290;  
2. &#24403;&#29992;&#25143;&#25104;&#21151;&#30331;&#38470;&#21518;&#65292;&#36820;&#22238;&#21040;&#20182;&#35201;&#35780;&#35770;&#65288;&#25110;&#36827;&#34892;&#31867;&#20284;&#25805;&#20316;&#65289;&#30340;&#21407;&#26377;&#19978;&#19979;&#25991;&#20013;&#12290;  
3. &#24403;&#29992;&#25143;&#25552;&#20132;&#20449;&#24687;&#30340;&#26102;&#20505;&#65292;&#22312;&#36716;&#21521;&#30331;&#38470;&#27969;&#31243;&#21069;&#35201;&#20808;&#20445;&#23384;&#29992;&#25143;&#24050;&#32463;&#24405;&#20837;&#22909;&#30340;&#25968;&#25454;&#12290;  
  
  
&#20363;&#23376;&#65306;&#24403;&#38656;&#35201;&#30340;&#26102;&#20505;&#65292;Yahoo! Buzz&#25165;&#20250;&#24377;&#20986;&#25552;&#31034;&#26694;&#65292;&#24182;&#19988;&#65292;&#19968;&#26086;&#29992;&#25143;&#30331;&#38470;&#65292;&#23601;&#20250;&#23558;&#20182;&#24102;&#22238;&#21040;&#21407;&#26469;&#30340;&#20219;&#21153;&#20013;

**&#20026;&#20160;&#20040;&#20351;&#29992;**  

&#8220;&#24517;&#39035;&#30331;&#38470;&#8221;&#30340;&#36825;&#19968;&#35201;&#27714;&#19981;&#24212;&#35813;&#20026;&#29992;&#25143;&#21442;&#19982;&#31038;&#21306;&#30340;&#27963;&#21160;&#22686;&#21152;&#20160;&#20040;&#19981;&#24517;&#35201;&#30340;&#38556;&#30861;&#12290;  
  

**&#29305;&#20363;**  
    
&#22914;&#26524;&#20986;&#20110;&#23433;&#20840;&#30340;&#32771;&#34385;&#65288;&#20363;&#22914;&#36328;&#31449;&#28857;&#33050;&#26412;&#38382;&#39064;&#21644;&#36328;&#22495;&#21517;&#30340;&#38382;&#39064;&#65289;&#38656;&#35201;&#25171;&#26029;&#27969;&#31243;&#25110;&#32773;&#38656;&#35201;&#29992;&#25143;&#36820;&#22238;&#21040;&#39318;&#39029;&#65292;&#37027;&#20040;&#33267;&#23569;&#24212;&#35813;&#28165;&#26970;&#30340;&#21521;&#29992;&#25143;&#21457;&#20986;&#35686;&#21578;&#65292;&#21578;&#30693;&#29992;&#25143;&#22914;&#20309;&#37325;&#26032;&#32487;&#32493;&#21407;&#20808;&#30340;&#20219;&#21153;&#12290;  

&#35813;&#35686;&#21578;&#20449;&#24687;&#21487;&#33021;&#21253;&#25324;&#19968;&#20010;&#25351;&#21521;&#26368;&#36817;&#19968;&#27425;&#32593;&#22336;&#30340;&#38142;&#25509;&#65292;&#19968;&#20010;&#39044;&#32622;&#30340;&#34920;&#21333;&#65292;&#25110;&#32773;&#26159;&#34920;&#26126;&#20960;&#31186;&#21518;&#37325;&#26032;&#36820;&#22238;&#21407;&#22320;&#22336;&#30340;&#20449;&#24687;&#12290;  </summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/56</id>
    <published>2010-11-25T00:19:57+08:00</published>
    <updated>2011-06-21T21:43:56+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/56-design-pattern-for-password-reset"/>
    <title>&#32593;&#31449;&#30340;&#25214;&#22238;&#23494;&#30721;&#65288;&#37325;&#32622;&#23494;&#30721;&#65289;&#30340;&#35774;&#35745;&#24605;&#36335;&#20043;&#25105;&#35265; </title>
    <summary>**&#19968;&#12289;&#25214;&#22238;&#23494;&#30721;&#26041;&#26696;&#30340;&#36873;&#25321;&#21450;&#27880;&#24847;&#65306;**

1&#12289;&#27880;&#20876;&#26102;&#19981;&#37319;&#29992; &#23494;&#30721;&#31572;&#26696;&#21644;&#38382;&#39064; &#36825;&#20010;&#26041;&#26696;  
2&#12289;&#27880;&#20876;&#26102;&#29992;&#25143;&#33258;&#24049;&#36755;&#20837;&#37038;&#31665;&#22320;&#22336;  
3&#12289;&#27880;&#20876;&#26102;&#21578;&#35785;&#29992;&#25143;&#36825;&#20010;&#37038;&#31665;&#29992;&#26469; &#28608;&#27963;&#36134;&#25143;&#21644;&#25214;&#22238;&#23494;&#30721;  
4&#12289;&#27880;&#20876;&#21518;&#36890;&#36807;&#37038;&#31665;&#28608;&#27963;&#36134;&#25143;  
5&#12289;&#25214;&#22238;&#23494;&#30721;&#26102;&#36890;&#36807;&#37038;&#31665;&#25214;&#22238;  
6&#12289;&#21457;&#36865;&#21040;&#37038;&#20214;&#20013;&#30340;&#26159; &#28608;&#27963;/&#37325;&#32622;&#23494;&#30721; &#22320;&#22336;&#65292;&#32780;&#38750;&#23494;&#30721;  

**&#20108;&#12289;&#36890;&#36807;&#37038;&#31665;&#25214;&#22238;&#23494;&#30721;&#30340;&#27493;&#39588;**  

1&#12289;&#29992;&#25143;&#25552;&#20132;&#37325;&#32622;&#23494;&#30721;&#30340;&#35831;&#27714;&#26102;  
  &#25968;&#25454;&#24211;&#20013;&#26032;&#22686;&#19968;&#26465;&#35760;&#24405;&#65306;&#29992;&#25143;_id&#12289;&#36807;&#26399;&#26102;&#38388;&#12289;&#31614;&#21517;  
  &#21457;&#36865;&#19968;&#20010;url&#21040;&#27880;&#20876;&#37038;&#31665;&#65292;url&#20026; xxx?xxx=&#31614;&#21517;  
2&#12289;&#29992;&#25143;&#25171;&#24320;&#37038;&#31665;&#20013;&#30340;url&#21518;  
  &#20808;&#35299;&#26512;&#31614;&#21517;&#36171;&#20540;&#32473;sid  
  &#25968;&#25454;&#24211;&#20013;&#26597;&#25214;&#31614;&#21517;last&#65292;&#22914;&#27809;&#26377;&#21017;&#25298;&#32477;  
  &#21028;&#26029;&#36807;&#26399;&#26102;&#38388;&#65292;&#22914;&#36229;&#36807;&#21017;&#25298;&#32477;  
  &#36339;&#36716;&#21040;&#37325;&#32622;&#23494;&#30721;&#30340;&#39029;&#38754;&#65292;&#20256;sid&#36807;&#21435;  
3&#12289;&#29992;&#25143;&#37325;&#32622;&#23494;&#30721;&#21518;  
  &#35835;&#21462;&#25552;&#20132;&#19978;&#26469;&#30340;sid&#65292;&#21518;&#35835;&#21462;&#25968;&#25454;&#24211;&#24471;&#21040; &#29992;&#25143;_id&#65292;&#20877;&#26681;&#25454; &#29992;&#25143;_id &#26356;&#26032;&#23494;&#30721;  
  &#22914;&#25104;&#21151;&#21017;&#21024;&#38500;&#25968;&#25454;&#24211;&#20013; &#25152;&#26377; &#29992;&#25143;_id &#35760;&#24405;  
&#21478;&#65306;&#27599;&#22825;shell&#36718;&#35810;&#21024;&#38500;&#25968;&#25454;&#24211;&#20013;&#24050;&#36807;&#26399;&#30340;&#35760;&#24405;&#65292;&#36890;&#36807;&#21028;&#26029;&#36807;&#26399;&#26102;&#38388;  </summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/55</id>
    <published>2010-11-23T16:55:35+08:00</published>
    <updated>2011-06-22T09:57:17+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/55-beautiful-routes-for-articles-on-rails3"/>
    <title>rails3&#33258;&#23450;&#20041;&#36335;&#30001;&#30340;&#35774;&#32622;&#65293;&#28418;&#20142;&#30340;&#25991;&#31456;&#38142;&#25509;</title>
    <summary>&#25991;&#31456;&#31867;:  

    #app/models/article.rb
    class Article &lt; ActiveRecord::Base
      acts_as_taggable
      
      validates :title, :presence =&gt; true
      validates :content, :presence =&gt; true
      
      def to_param
        permalink
      end
    end
    
    
    # == Schema Information
    #
    # Table name: articles
    #
    #  id           :integer         not null, primary key
    #  title        :string(255)
    #  content      :text
    #  created_at   :datetime
    #  updated_at   :datetime
    #  permalink    :string(255)

&#36335;&#30001;&#20013;&#28155;&#21152;&#20197;&#19979;&#20195;&#30721;&#65306;  

    # app/config/routes.rb
      resources :articles, :except =&gt; :show
      
      match ':year/:month/:day/:id' =&gt; "articles#show", :as =&gt; 'article', :constraints =&gt; { :year =&gt; /\d{4}/, :month =&gt; /\d{2}/, :day =&gt; /\d{2}/ }

helper&#20013;&#28155;&#21152;&#20197;&#19979;&#20195;&#30721;&#65306;  

    # app/helpers/application_helper.rb
      def article_slug(e)
        d = e.created_at
        article_path :year =&gt; d.year, :month =&gt; d.strftime("%m"), :day =&gt; d.strftime("%d"), :id =&gt; e.permalink
      end

&#25509;&#19979;&#26469;&#20889;&#20010;&#38142;&#25509;&#23601;&#30693;&#36947;&#25928;&#26524;&#20102;&#65306;  

    &lt;%= link_to "&#38405;&#35835;&#20840;&#25991;", article_slug(article), :title =&gt; "Permanent Link to #{article.title}" %&gt;
    &gt;&gt; http://domainname.com/2010/11/23/post-permalink

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/54</id>
    <published>2010-11-22T10:45:01+08:00</published>
    <updated>2011-06-22T09:37:51+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/54-code-refactoring-of-abstract-model"/>
    <title>&#20195;&#30721;&#37325;&#26500;&#20043;&#31867;&#30340;&#34394;&#25311;&#21270;</title>
    <summary>&#21407;&#26469;&#30340;&#20195;&#30721;:  

    # app/models/server.rb
    class Server &lt; ActiveRecord::Base
    
      validates_presence_of :name, :address, :username, :password, :encoding
      
      validates_length_of :name, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :address, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :username, :password, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :encoding, :maximum =&gt; 10, :allow_blank =&gt; true
     
    end
    
    # == Schema Information
    #
    # Table name: servers
    #
    #  id          :integer         not null, primary key
    #  name        :string(20)
    #  address     :string(20)
    #  username    :string(20)
    #  password    :string(20)
    #  encoding    :string(10)
    #  temp_path   :string(50)
    #  online_path :string(50)


    # app/models/sourcer.rb
    class Sourcer &lt; ActiveRecord::Base
    
      validates_presence_of :name, :address, :username, :password, :encoding
      
      validates_length_of :name, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :address, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :username, :password, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :encoding, :maximum =&gt; 10, :allow_blank =&gt; true
     
    end
    
    # == Schema Information
    #
    # Table name: sourcers
    #
    #  id           :integer         not null, primary key
    #  name         :string(255)
    #  address      :string(255)
    #  username     :string(255)
    #  password     :string(255)
    #  encoding     :string(255)
    #  upload_path  :string(255)
    #  archive_path :string(255)

&#19981;&#38590;&#30475;&#20986;&#65292;Server&#31867;&#21644;Sourcer&#26377;&#37096;&#20998;&#23646;&#24615;&#26159;&#30456;&#21516;&#30340;&#65292;&#37027;&#20040;&#65292;&#22914;&#20309;&#25226;&#36825;&#37096;&#20998;&#20844;&#20849;&#30340;&#26657;&#39564;&#25277;&#20986;&#26469;&#21602;&#65311;&#36825;&#37324;&#23601;&#29992;&#21040;&#20102;&#34394;&#25311;&#31867;&#12290;  

    # app/models/abstract_server.rb
    class AbstractServer &lt; ActiveRecord::Base
      self.abstract_class = true
      
      validates_presence_of :name, :address, :username, :password, :encoding
      
      validates_length_of :name, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :address, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :username, :password, :maximum =&gt; 20, :allow_blank =&gt; true
      validates_length_of :encoding, :maximum =&gt; 10, :allow_blank =&gt; true
    end

    # app/models/server.rb
    class Server &lt; AbstractServer
      # some other method
    end

    # app/models/sourcer.rb
    class Sourcer &lt; AbstractServer
      # some other method
    end

&#30001;&#20110;&#31867;&#30340;&#32487;&#25215;&#65292;&#19968;&#33324;&#29238;&#31867;&#37117;&#26159;&#30495;&#23454;&#30340;&#31867;&#65292;&#20063;&#23601;&#26159;&#35828;&#29238;&#31867;&#38656;&#35201;&#26377;&#33258;&#24049;&#30340;&#34920;&#65292;&#20294;&#26159;&#22312;&#36825;&#37324;&#65292;&#19981;&#38656;&#35201;&#65292;&#25152;&#20197;&#38656;&#35201;&#29992;self.abstract_class = true &#26469;&#34394;&#25311;&#21270;&#36825;&#20010;&#31867;&#12290;

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/53</id>
    <published>2010-11-20T20:24:15+08:00</published>
    <updated>2011-06-22T11:32:37+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/53-install-nginx-passenger-and-rails3-on-fedora-core-14"/>
    <title>fedora core 14 &#23433;&#35013; nginx passenger rails3</title>
    <summary>&#39318;&#20808;&#23433;&#35013;rails ,rubygems

    yum -y install ruby rubygems
    +++gem -v =&gt; 1.3.7
    gem install rails

&#28982;&#21518;&#23433;&#35013;passenger,nginx
 

    sudo gem install passenger
    sudo passenger-install-nginx-module

&#20013;&#38388;&#20250;&#38382;&#20320;&#25226;nginx&#23433;&#35013;&#22312;&#21738;&#65292;&#33258;&#24049;&#22635;&#22909;&#23601;&#34892;&#20102;,&#40664;&#35748;/opt/nginx&#65292;
&#28982;&#21518;&#32534;&#36753;nginx.conf

    user yourname;   =&gt; &#36825;&#37324;&#24456;&#37325;&#35201;&#65292;ubuntu&#19978;&#22909;&#20687;&#27809;&#38382;&#39064;&#65292;fc&#19978;&#19981;&#20889;&#26377;403 error
     ...
     http {
      passenger_root /usr/lib/ruby/gems/1.8/gems/passenger-3.0.0;
      passenger_ruby /usr/bin/ruby;
     ...
      server {
             listen       80;
        server_name localhost;
        root /home/maxz/rubyworks/sample/public;  =&gt;&#36825;&#37324;&#19968;&#23450;&#35201;&#26159;rails app &#30340;public
        passenger_enabled on;
        rails_env development;
     }
     ....
    }


&#28982;&#21518;sudo /opt/ngnix/sbin/nginx &#65292;&#25171;&#24320;http://localhost&#30475;&#30475;&#21543;</summary>
    <author>
      <name>maxz</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/50</id>
    <published>2010-11-19T22:45:32+08:00</published>
    <updated>2011-06-22T00:41:30+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/50-how-to-use-ruby-to-open-file-name-with-chinese-on-windows"/>
    <title>ruby win&#19978;&#25171;&#24320;&#20013;&#25991;&#36335;&#24452;&#25991;&#20214;&#30340;&#35299;&#20915;</title>
    <summary>&#26152;&#26202;&#25209;&#37327;&#22788;&#29702;&#19968;&#20123;xls&#20013;&#26576;&#19968;&#21333;&#20803;&#26684;&#20869;&#23481;&#30340;&#26102;&#20505;&#23601;&#30896;&#21040;&#20102;&#36825;&#20010;&#38382;&#39064;&#65292;&#25105;&#30452;&#25509;&#32473;&#20013;&#25991;&#36335;&#24452;&#35828;&#25214;&#19981;&#21040;&#25991;&#20214;
&#22823;&#27010;&#38169;&#35823;&#22914;&#19979;&#65306;

    No such file or directory -
    D:/hyp/excel_to_mysql??/&#27979;&#35797;.xls
    (Errno::ENOENT)

&#21518;&#26469;&#27809;&#27861;&#65292;&#25226;&#33050;&#26412;&#30452;&#25509;&#25918;&#21040;&#37027;&#20123;xls&#30340;&#30446;&#24405;&#65292;&#20351;&#21516;&#30446;&#24405;&#65292;&#20351;&#29992;&#19979;&#38754;&#30340;&#26041;&#27861;&#31639;&#26159;&#26242;&#26102;&#35299;&#20915;&#20102;&#65292;&#25171;&#24320;&#25991;&#20214;&#30340;&#26102;&#20505;&#20351;&#29992;&#30340;&#26159;WIN32OLE::CP_ACP&#32534;&#30721;&#65292;&#25805;&#20316;&#25991;&#20214;&#30340;&#26102;&#20505;&#20351;&#29992;WIN32OLE::CP_UTF8&#32534;&#30721;

    $KCODE = 'u'
    Dir.foreach(Dir.pwd) do |f|
      next if f == '.' or f == '..' or File.extname(f) != '.xls'
      WIN32OLE.codepage = WIN32OLE::CP_ACP
      excel = WIN32OLE::new('excel.Application')
      workbook = excel.Workbooks.Open("#{Dir.pwd}/#{f}")
      WIN32OLE.codepage = WIN32OLE::CP_UTF8
      worksheet = workbook.Worksheets.Item("&#22522;&#26412;&#20449;&#24687;&#34920;")
      ....
    end

&#20170;&#22825;&#21644;&#32676;&#37324; sunteya&#12289;jerry &#31561;&#35752;&#35770;&#30340;&#26102;&#20505;&#35828;&#21040;&#20102;&#24212;&#35813;&#26159;&#31995;&#32479;&#32534;&#30721;&#30340;&#38382;&#39064;&#65292;&#21363;win&#19978;&#26159;gbk&#32534;&#30721;&#65292;&#19979;&#21320;&#23601;&#39564;&#35777;&#20102;&#65292;&#26524;&#28982;&#26159;&#65292;&#39564;&#35777;&#30340;&#20195;&#30721;&#22914;&#19979;

    $KCODE = 'u'
    require 'iconv'
    Dir.foreach(Dir.pwd) do |f|
      next if f == '.' or f == '..' or File.extname(f) != '.xls'
      puts f
      puts Iconv.iconv("UTF-8//IGNORE","GBK//IGNORE", f).to_s
    end
&#36755;&#20986;&#22914;&#19979;&#65306;

    $ ruby test.rb
    &gt;&gt;&#1250;&#724;.xls
    &gt;&gt;&#27979;&#35797;.xls
    $ Exit code: 0

&#37027;&#20040;&#25105;&#20204;&#22312; win&#19978;&#25171;&#24320;&#20013;&#25991;&#36335;&#24452;&#25991;&#20214; &#26102;&#24590;&#20040;&#21150;&#21602;&#65311;

&#26041;&#27861;1&#65306;

    $KCODE = 'u'
    Dir.foreach(Dir.pwd) do |f|
      File.open(f, "r") {}
    end

&#26041;&#27861;2&#65306;

    $KCODE = 'u'
    require 'iconv'
    class String
      def to_gbk
        Iconv.iconv("GBK//IGNORE","UTF-8//IGNORE",self).to_s
      end
      def to_utf8
        Iconv.iconv("UTF-8//IGNORE","GBK//IGNORE",self).to_s
      end
    end
    file = "&#27979;&#35797;.xls"
    File.open(file.to_gbk, "r") {}




</summary>
    <author>
      <name>vkill</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/49</id>
    <published>2010-11-19T10:11:14+08:00</published>
    <updated>2011-06-22T01:37:55+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/49-use-rails-helper-method-in-model"/>
    <title>&#22312;model&#20013;&#35843;&#29992;rails helper&#26041;&#27861;</title>
    <summary>    class Server &lt; ActiveRecord::Base
      
      def name_with_free_space
        "#{name} (#{helpers.number_to_human_size(free_space)})"
      end
    
      def helpers
        ActionController::Base.helpers
      end
    
    end
    
    # == Schema Information
    #
    # Table name: servers
    #
    #  id                      :integer         not null, primary key
    #  name                :string(60)
    #  free_space       :string(40)
    #  created_at        :datetime
    #  updated_at       :datetime

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/48</id>
    <published>2010-11-15T12:50:03+08:00</published>
    <updated>2011-06-20T11:19:01+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/48-latest-deploy-script-for-rails3"/>
    <title>rails3&#39033;&#30446;&#26368;&#26032;&#21457;&#24067;&#33050;&#26412;</title>
    <summary>**&#23433;&#35013;&#26368;&#26032;&#29256;capsum 0.3.0:**  

    $ gem install capsum  

**&#21040;&#39033;&#30446;&#26681;&#30446;&#24405;&#19979;&#29983;&#25104;&#21457;&#24067;&#25991;&#20214;:**  

    $ capify .

&#32456;&#31471;&#20250;&#26377;&#22914;&#19979;&#25552;&#31034;:  

    [add] writing './Capfile'
    [add] writing './config/deploy.rb'
    [done] capified!  

**&#25913;&#20889; config/deploy.rb&#25991;&#20214;:**  

    require "capsum/typical3"
    
    set :application, "your_project_name"
    set :repository, "git@yourserver:yourproject.git"
    set :branch, "master"
    
    set :shared, %w{
      config/database.yml
      Gemfile.local
      export_tmp  # link path
    }  

**&#28155;&#21152;config/deploy/production.rb&#25991;&#20214;&#24182;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;:**  

    set :deploy_to, "/var/www/vhosts/apps/#{application}"  #deploy path
    set :user, "www-data"  # deploy user
    server "your server", :app, :web, :db, :primary =&gt; true

**&#25191;&#34892;&#21457;&#24067;&#33050;&#26412;:**  

    $ cap production deploy

&#21457;&#24067;&#26085;&#24535;&#22914;&#19979;:  

      * == Currently executing `home_new'
        triggering start callbacks for `deploy'
      * == Currently executing `multistage:ensure'
      * == Currently executing `deploy'
      * == Currently executing `deploy:update'
     ** transaction: start
      * == Currently executing `deploy:update_code'
        updating the cached checkout on all servers
        executing locally: "git ls-remote git@repo.im.b-star.cn:home_news.git master"
      * executing "if [ -d /var/www/vhosts/pukka/apps/home_news/shared/cached-copy ]; then cd /var/www/vhosts/pukka/apps/home_news/shared/cached-copy &amp;&amp; git fetch  origin &amp;&amp; git reset  --hard 97c09aca8500c588e6b71b6a4b9039436096c529 &amp;&amp; git clean  -d -x -f; else git clone  git@repo.im.b-star.cn:home_news.git /var/www/vhosts/pukka/apps/home_news/shared/cached-copy &amp;&amp; cd /var/www/vhosts/pukka/apps/home_news/shared/cached-copy &amp;&amp; git checkout  -b deploy 97c09aca8500c588e6b71b6a4b9039436096c529; fi"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
     ** [home_new1.im.b-star.cn :: out] HEAD is now at 97c09ac &#20462;&#22797;topic&#26080;&#27861;&#21019;&#24314;&#30340;bug
        command finished
        copying the cached version to /var/www/vhosts/pukka/apps/home_news/releases/20101115044817
      * executing "cp -RPp /var/www/vhosts/pukka/apps/home_news/shared/cached-copy /var/www/vhosts/pukka/apps/home_news/releases/20101115044817 &amp;&amp; (echo 97c09aca8500c588e6b71b6a4b9039436096c529 &gt; /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/REVISION)"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
      * == Currently executing `deploy:finalize_update'
      * executing "chmod -R g+w /var/www/vhosts/pukka/apps/home_news/releases/20101115044817"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
      * executing "rm -rf /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/log /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/public/system /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/tmp/pids &amp;&amp;\\\n      mkdir -p /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/public &amp;&amp;\\\n      mkdir -p /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/tmp &amp;&amp;\\\n      ln -s /var/www/vhosts/pukka/apps/home_news/shared/log /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/log &amp;&amp;\\\n      ln -s /var/www/vhosts/pukka/apps/home_news/shared/system /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/public/system &amp;&amp;\\\n      ln -s /var/www/vhosts/pukka/apps/home_news/shared/pids /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/tmp/pids"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
      * executing "find /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/public/images /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/public/stylesheets /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/public/javascripts -exec touch -t 201011150448.19 {} ';'; true"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
        triggering after callbacks for `deploy:update_code'
      * == Currently executing `deploy:symlink_shared'
      * executing "rm -rf /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/config/database.yml &amp;&amp; ln -nfs /var/www/vhosts/pukka/apps/home_news/shared/config/database.yml /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/config/database.yml"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
      * executing "rm -rf /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/Gemfile.local &amp;&amp; ln -nfs /var/www/vhosts/pukka/apps/home_news/shared/Gemfile.local /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/Gemfile.local"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
      * executing "rm -rf /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/export_tmp &amp;&amp; ln -nfs /var/www/vhosts/pukka/apps/home_news/shared/export_tmp /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/export_tmp"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
        triggering after callbacks for `deploy:symlink_shared'
      * == Currently executing `bundle:install'
      * executing "ls -x /var/www/vhosts/pukka/apps/home_news/releases"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
      * executing "bundle install --gemfile /var/www/vhosts/pukka/apps/home_news/releases/20101115044817/Gemfile --quiet --without development test"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
      * == Currently executing `deploy:symlink'
      * executing "rm -f /var/www/vhosts/pukka/apps/home_news/current &amp;&amp; ln -s /var/www/vhosts/pukka/apps/home_news/releases/20101115044817 /var/www/vhosts/pukka/apps/home_news/current"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
        triggering after callbacks for `deploy:symlink'
      * == Currently executing `whenever:update'
     ** transaction: commit
      * == Currently executing `deploy:restart'
      * executing "touch /var/www/vhosts/pukka/apps/home_news/current/tmp/restart.txt"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
        command finished
        triggering after callbacks for `deploy:restart'
      * == Currently executing `daemons:restart'
      * == Currently executing `daemons:stop'
      * executing "cd /var/www/vhosts/pukka/apps/home_news/current; if [ -e script/recorder ]; then RAILS_ENV=production script/recorder stop; fi"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
     ** [out :: home_new1.im.b-star.cn] recorder: trying to stop process with pid 29518...
     ** [out :: home_new1.im.b-star.cn] recorder: process with pid 29518 successfully stopped.
        command finished
      * == Currently executing `daemons:start'
      * executing "cd /var/www/vhosts/pukka/apps/home_news/current; if [ -e script/recorder ]; then RAILS_ENV=production script/recorder start; fi"
        servers: ["home_new1.im.b-star.cn"]
        [home_new1.im.b-star.cn] executing command
     ** [out :: home_new1.im.b-star.cn] pid-file for killed process 29518 found (/var/www/vhosts/pukka/apps/home_news/releases/20101115044817/tmp/pids/recorder.pid), deleting.
     ** [out :: home_new1.im.b-star.cn] recorder: process with pid 32095 started.
        command finished




</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/47</id>
    <published>2010-11-14T10:38:57+08:00</published>
    <updated>2011-06-21T18:54:21+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/47-set-default-encoding-to-utf8-of-mysql"/>
    <title>&#35774;&#32622;Mysql&#25968;&#25454;&#24211;&#30340;&#40664;&#35748;&#32534;&#30721;&#20026;utf8</title>
    <summary>**&#36827;&#20837;mysql&#65292;&#26597;&#30475;&#40664;&#35748;&#32534;&#30721;&#65306;**

    $ mysql -uroot -proot
    
    $ show variables like character%'

&#26174;&#31034;&#23383;&#31526;&#32534;&#30721;&#65306;

    +--------------------------+----------------------------+
    
    | Variable_name | Value |
    
    +--------------------------+----------------------------+
    
    | character_set_client | latin1 |
    
    | character_set_connection | latin1 |
    
    | character_set_database | latin1 |
    
    | character_set_filesystem | binary |
    
    | character_set_results | latin1 |
    
    | character_set_server | latin1 |
    
    | character_set_system | utf8 |
    
    | character_sets_dir | /usr/share/mysql/charsets/ |
    
    +--------------------------+----------------------------+


**&#29616;&#26242;&#20572;mysql&#26381;&#21153;&#65306;**

    $sudo /etc/init.d/mysql stop

**&#20462;&#25913; /etc/mysql/my.cnf**

    $ sudo chmod 777 /etc/mysql/my.cnf
    
    $ vim /etc/mysql/my.cnf

&#22312;[client]&#19979;&#38754;&#21152;&#19978;&#65306;

    default-character-set=utf8

&#22312;[mysqld]&#19979;&#38754;&#21152;&#19978;&#65306;

    default-character-set=utf8
    
    init_connect='SET NAMES utf8'

&#20445;&#23384;&#65292;&#36864;&#20986;wq


**&#37325;&#21551;mysql&#26381;&#21153;&#65306;**

    $sudo /etc/init.d/mysql start

&#21457;&#29616;&#20986;&#38169;&#65306;

    Warning: World-writable config file '/etc/mysql/my.cnf' is ignored
    
    /usr/bin/mysqladmin: connect to server at 'localhost' failed
    
    error: 'Access denied for user 'luoping'@'localhost' (using password: NO)'

&#21407;&#22240;&#20026;&#65306;/etc/mysql/my.cnf &#26435;&#38480;&#22826;&#39640;&#65292;&#25628;&#32034;&#20102;&#19968;&#30058;&#65292;&#26377;&#20154;&#35828;&#35768;&#25913;&#20026;600&#65292;&#20294;&#26159;&#25105;&#21457;&#35273;&#19981;&#34892;&#65292;&#26597;&#30475;&#20102;/etc/mysql/&#25991;&#20214;&#22841;&#37324;&#30340;&#20854;&#20182;&#25991;&#20214;&#65292;&#26435;&#38480;&#26159;755&#65292;&#25152;&#20197;&#20462;&#25913;&#26435;&#38480;

    $sudo chmod 755 /etc/mysql/my.cnf

&#37325;&#21551;mysql&#26381;&#21153;&#65292;OK


**&#20877;&#27425;&#26597;&#30475;&#25968;&#25454;&#24211;&#32534;&#30721;**

    $ mysql -uroot -proot
    
    $ show variables like character%'

&#26174;&#31034;&#23383;&#31526;&#32534;&#30721;&#65306;

    +--------------------------+----------------------------+
    
    | Variable_name | Value |
    
    +--------------------------+----------------------------+
    
    | character_set_client | utf8 |
    
    | character_set_connection | utf8 |
    
    | character_set_database | utf8 |
    
    | character_set_filesystem | binary |
    
    | character_set_results | utf8 |
    
    | character_set_server | utf8 |
    
    | character_set_system | utf8 |
    
    | character_sets_dir | /usr/share/mysql/charsets/ |
    
    +--------------------------+----------------------------+</summary>
    <author>
      <name>sunny</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/45</id>
    <published>2010-11-04T16:15:20+08:00</published>
    <updated>2011-06-22T13:37:56+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/45-how-to-use-select-helper"/>
    <title>Ruby on Rails&#20013;select&#20351;&#29992;&#26041;&#27861;</title>
    <summary>&#22312;Ruby on Rails&#20013;&#30495;&#30340;&#26377;&#19968;&#22534;Select helper&#21487;&#20197;&#29992;,&#25105;&#20204;&#32463;&#24120;&#23481;&#26131;&#28151;&#28102;&#12290;&#24120;&#35265;&#30340;&#26377;&#19977;&#20010;..
select, select_tag, collection_select(&#20854;&#20313;&#30340;&#20160;&#20040;select_date&#37027;&#20123;&#19981;&#35848;)
&#25105;&#20204;&#20808;&#26469;&#30475;&#30475;&#19968;&#20010;&#22522;&#26412;&#30340;&#19979;&#25289;&#24335;&#36873;&#39033;&#39592;&#26550;

    
    ROR1
    ROR2
    ROR3
    

&#22312; &#19968;&#20010;&#19979;&#25289;&#24335;&#36873;&#39033;&#20013;&#65292;&#26377;&#19968;&#20123;&#26159;&#24517;&#22791;&#30340;&#20449;&#24687;&#65292;&#20687;&#8221;name&#8221;&#12289;&#8221;value&#8221;&#19982;&#8221;text&#8221;&#19977;&#20010;&#65292;&#22312;&#22238;&#20256;&#20449;&#24687;&#32473;Serve&#26102;&#65292;&#8221;name&#8221;&#23558;&#26159;&#25509;&#25910;&#20449;&#24687;&#29992;&#30340;&#65292; &#32780;&#8221;value&#8221;&#20250;&#20256;&#22238;&#34987;&#36873;&#30340;&#20540;&#65292;&#32780;&#8221;text&#8221;&#21017;&#26159;&#20351;&#29992;&#32773;&#20250;&#30475;&#21040;&#30340;&#23383;&#65292;&#20381;&#19978;&#38754;&#30340;&#20363;&#23376;&#26469;&#35762;&#65292;ROR1&#12289;ROR2&#12289;ROR3&#23601;&#26159;&#23646;&#20110;&#8221;text&#8221;  

&#24320;&#22987;&#35762;&#35762;&#21738;&#19977;&#31181;Select helper  

select:  

    select(object, method, choices, options = {}, html_options = {})  

&#22312;ActionView::Helpers::FormOptionsHelper&#20013;&#23450;&#20041;
object&#20107;&#19968;&#20010;&#23454;&#20307;&#21270;&#21464;&#25968;&#65292;&#36825;&#37324;&#24456;&#26126;&#26174;&#30340;&#23601;&#26159;&#35201;&#25670;&#19978;model&#29289;&#20214;&#22043;&#65281;
method&#21017;&#26159;object&#30340;&#19968;&#20010;&#23646;&#24615;&#65292;&#20063;&#26159;&#36164;&#26009;&#34920;&#20013;&#30340;&#23545;&#24212;&#39033;&#30446;
choices&#23601;&#26159;&#35201;&#34987;&#36873;&#30340;&#36873;&#39033;&#65292;&#21487;&#20197;&#20107;&#38453;&#21015;&#25110;&#32773;&#20107;&#21704;&#24076;(Hash)
options&#19982;html_options&#21017;&#26159;&#19968;&#20123;&#36873;&#39033;
&#26469;&#36825;&#37324;&#20030;&#20010;&#20363;&#23376;&#21543;  

    &lt;%= select("project", "teacher_id", @teachers.collect{|t| [t.name, t.id]}, { :include_blank =&gt; false }) %&gt;
    &lt;%= select("project", "student_id", {"CFC" =&gt; '1', "EF" =&gt; '2'}) %&gt; 


&#31532;&#19968;&#20010;&#20363;&#23376;&#20013;&#65292;@teachers&#22312;Controller&#26159;&#36825;&#26679;&#30340;  

    @teachers = Teacher.find(:all, :select =&gt; 'id, name')

select_tag:  

    select_tag(name, option_tags = nil, options = {})

&#22312;ActionView::Helpers::FormTagHelper&#20013;&#23450;&#20041;
&#22914;&#26524;&#20320;&#24456;&#21916;&#27426;&#21160;&#25163;&#25171;option&#30340;&#35805;.. &#37027;&#29992;select_tag&#20934;&#27809;&#38169;&#21862;&#65281;
&#22312;select_tag&#20013;&#65292;name&#23558;&#20250;&#26159;params&#25152;&#25509;&#25910;&#20540;&#25152;&#29992;&#30340;&#38190;
&#30452;&#25509;&#30475;&#33539;&#20363;  

    &lt;%= select_tag 'user', "&lt;option&gt;CFC&lt;/option&gt;" %&gt;

&#36825;&#26102;&#22312;Controller&#20013;&#23558;&#20250;&#29992;params[:user]&#26469;&#25509;&#25910;&#20256;&#36807;&#26469;&#30340;&#20540;
&#20294;&#26159;select_tag&#20063;&#21487;&#20197;&#25645;&#37197;options_for_select&#25110;&#32773;options_from_collection_for_select&#19968;&#36215;&#20351;&#29992;.. &#26469;&#30475;&#19968;&#20010;&#33539;&#20363;&#21543;  

    &lt;%= select_tag('sid[]', options_from_collection_for_select(@students, 'id', 'name'), :multiple =&gt; true)%&gt;

&#22240;&#20026;&#21152;&#19978;&#20102;:multiple&#65292;&#25152;&#20197;&#21487;&#20197;&#25509;&#21463;&#22810;&#20540;&#36873;&#25321;&#65292;&#36825;&#26102;&#22312;Controller&#25509;&#25910;&#21040;&#30340;sid&#23558;&#20250;&#26159;&#19968;&#20010;&#38453;&#21015;&#65292;&#36825;&#20063;&#26159;&#25105;&#25152;&#21345;&#20303;&#30340;&#22320;&#26041;..  

collection_select:  

    collection_select(object, method, collection, value_method, text_method, options = {}, html_options = {})

&#22312;ActionView::Helpers::FormOptionsHelper&#20013;&#23450;&#20041;
&#22914;&#26524;&#20449;&#24687;&#26469;&#28304;&#26159;&#25968;&#25454;&#24211;&#30340;&#35805;&#65292;&#21487;&#20197;&#20351;&#29992;&#36825;&#20010;&#26469;&#20570;&#19979;&#25289;&#24335;&#36873;&#39033;&#12290;
&#36825;&#20010;Object&#19981;&#29992;&#25105;&#35828;&#65292;&#23601;&#26159;&#20320;&#30340;model
method&#21602;&#65311;&#24403;&#28982;&#23601;&#26159;&#26639;&#30446;&#20102;
&#20854;&#23454;&#35828;&#36215;&#20358;&#65292;&#36825;&#21482;&#26159;select+options_from_collection_for_select&#30340;&#32452;&#21512;&#21862;&#65281;
&#33539;&#20363;&#65306;  

    &lt;%= collection_select(:payment, :id, @payments, :id, :name, options ={:prompt =&gt; "-Select a continent"}, :class =&gt;"payment") %&gt;</summary>
    <author>
      <name>51515</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/44</id>
    <published>2010-10-26T15:29:26+08:00</published>
    <updated>2011-06-22T14:50:02+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/44-invali-authenticity-token-with-destroy-action-on-rails3"/>
    <title>ActionController:: InvalidAuthenticityToken with Destroy action</title>
    <summary>&#22312;&#21024;&#38500;&#19968;&#26465;&#35760;&#24405;&#26102;&#65292;&#20986;&#29616;&#20102;

    ActionController:: InvalidAuthenticityToken with Destroy action

 &#36825;&#20010;&#38169;&#35823;&#25552;&#31034;&#65292;&#19981;&#30693;&#36947;&#26159;&#20160;&#20040;&#21407;&#22240;&#23548;&#33268;&#30340;&#12290;&#22312;&#32593;&#19978;&#25628;&#32034;&#25214;&#21040;&#20102;&#35299;&#20915;&#26041;&#27861;&#12290;
&#22312;&#39029;&#38754;&#30340;&#22836;&#25991;&#20214;&#20013;&#21152;&#20837;&#19979;&#38754;&#36825;&#21477;&#23601;&#21487;&#20197;&#20102;&#12290;

    &lt;%= csrf_meta_tag %&gt;

&#21516;&#26102;&#20063;&#24076;&#26395;&#20102;&#35299;

    ActionController:: InvalidAuthenticityToken with Destroy action

&#36825;&#20010;&#38169;&#35823;&#21407;&#22240;&#30340;&#31461;&#38795;&#65292;&#20026;&#22823;&#23478;&#35828;&#36947;&#35828;&#36947;&#65281;</summary>
    <author>
      <name>kart</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/43</id>
    <published>2010-10-21T10:42:21+08:00</published>
    <updated>2011-06-21T22:29:01+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/43-how-to-make-an-rss-feed-in-rails"/>
    <title>rails&#20013;&#22914;&#20309;&#21046;&#20316;rss feed</title>
    <summary>&#21019;&#24314;&#19968;&#20010;feeds controller:  

    class FeedsController &lt; ApplicationController
      
      def index
        @episodes = Episode.rss
      end
      
    end

feeds/index.html.erb &#20195;&#30721;&#22914;&#19979;:  

    atom_feed do |feed|
      feed.title(@title)
    
      feed.updated(@updated)
    
      @episodes.each do |episode|
        feed.entry(episode) do |entry|
    
          entry.title(h(episode.title))
          entry.summary(strip_tags(episode.body))
    
          entry.author do |author|
            author.name(episode.user.login)
          end
        end
      end
    end

&#28982;&#21518;&#22312;layout &#30340; head&#26631;&#31614;&#20043;&#38388;&#21152;&#20837;:  

    &lt;%= auto_discovery_link_tag(:atom, "/feeds.atom") %&gt;

&#28155;&#21152;&#36335;&#30001;:  

    resources :feeds, :only =&gt; :index

&#38142;&#25509;&#21487;&#20197;&#36825;&#20040;&#20889;:  

    &lt;%= link_to "Feed", feeds_path(:format =&gt; "atom") %&gt;


</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/42</id>
    <published>2010-10-20T15:20:29+08:00</published>
    <updated>2011-06-22T09:37:38+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/42-resolve-problem-of-mysql-error-query-not-connected"/>
    <title>&#35299;&#20915;Mysql::Error: query: not connected</title>
    <summary>&#22312;&#25105;&#20351;&#29992;Mysql&#25968;&#25454;&#24211;&#25191;&#34892;&#36801;&#31227;&#20219;&#21153;&#26102;&#65292;&#20250;&#26377;&#19979;&#38754;&#30340;&#38169;&#35823;&#25552;&#31034;&#65306;

    rake aborted! Mysql::Error: query: not connected: CREATE TABLE `schema_migrations` (`version` varchar(255) NOT   NULL) ENGINE=InnoDB

&#21518;&#26469;&#21457;&#29616;&#65292;&#26159;Mysql&#26032;&#29256;&#26412;&#20013;libmySQL.dll&#25991;&#20214;&#30340;&#38382;&#39064;&#65292;&#35299;&#20915;&#21150;&#27861;&#65292;&#19979;&#36733;&#19979;&#38754;&#38142;&#25509;&#30340;&#35813;&#25991;&#20214;&#65292;&#25226;&#20182;copy&#21040;&#20320;&#30340;ruby/bin&#30446;&#24405;&#19979;&#21363;&#21487;&#65306;

[http://instantrails.rubyforge.org/svn/trunk/InstantRails-win/InstantRails/mysql/bin/libmySQL.dll][1]


  [1]: http://instantrails.rubyforge.org/svn/trunk/InstantRails-win/InstantRails/mysql/bin/libmySQL.dll</summary>
    <author>
      <name>hywhy</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/40</id>
    <published>2010-10-11T13:06:05+08:00</published>
    <updated>2011-06-21T19:39:26+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/40-reset-password-with-authlogic"/>
    <title>&#29992;Authlogic&#30340;RESTful&#30340;&#26041;&#24335;&#37325;&#35774;&#23494;&#30721;&#65288;&#25214;&#22238;&#23494;&#30721;&#65289;</title>
    <summary>&#22312;&#25105;&#20204;&#24320;&#22987;&#20043;&#21069;&#65292;&#35753;&#25105;&#20204;&#30475;&#30475;&#22522;&#26412;&#36807;&#31243;&#65306;

1.&#29992;&#25143;&#35831;&#27714;&#19968;&#20010;&#23494;&#30721;&#37325;&#32622;  
2.&#19968;&#23553;&#30005;&#23376;&#37038;&#20214;&#26159;&#21457;&#36865;&#19968;&#20010;&#38142;&#25509;&#21040;&#20182;&#20204;&#27880;&#20876;&#26102;&#30340;&#37038;&#31665;&#12290;  
3.&#29992;&#25143;&#28857;&#20987;&#38142;&#25509;&#65292;&#25171;&#24320;&#37325;&#32622;&#23494;&#30721;&#30028;&#38754;&#12290;  
4.&#24403;&#20182;&#20204;&#25913;&#21464;&#33258;&#24049;&#30340;&#23494;&#30721;&#65292;&#25105;&#20204;&#20445;&#23384;&#23427;&#20204;&#30340;&#65292;&#37325;&#23450;&#21521;&#21040;&#20182;&#20204;&#30340;&#24080;&#25143;&#12290;  
&#36825;&#20284;&#20046;&#24456;&#31616;&#21333;&#65292;&#19981;&#26159;&#21527;&#65311; &#29616;&#22312;&#65292;&#35753;&#25105;&#20204;&#24320;&#22987;&#21543;...  

**&#28155;&#21152;&#22312;reset_password_token&#21644;&#30005;&#23376;&#37038;&#20214;&#39046;&#22495;  
&#35201;&#20351;&#29992;&#23494;&#30721;&#37325;&#32622;&#21151;&#33021; &#29992;&#25143;&#27169;&#22411;&#24517;&#39035;&#35201;&#21448;email&#21644;reset_password_token&#23383;&#27573;  
&#25105;&#20204;&#29992;&#36801;&#31227;&#21152;&#19978;**  

    app/controllers/password_resets_controller.rb
    class AddUsersPasswordResetFields &lt; ActiveRecord::Migration  
      def self.up  
        add_column :people, :perishable_token, :string, :default =&gt; "", :null =&gt; false  
        add_column :people, :email, :string, :default =&gt; "", :null =&gt; false  
    
        add_index :people, :perishable_token  
        add_index :people, :email  
      end  
    
      def self.down  
        remove_column :people, :perishable_token  
        remove_column :people, :email  
      end  
    end


**&#35753;&#29992;&#25143;&#35201;&#27714;&#23494;&#30721;&#37325;&#35774;**  

    class PasswordResetsController &lt; ApplicationController
    
      def new
        render
      end

      def create
        @person = Person.find_by_email(params[:email])
        if @person
          @person.deliver_password_reset_instructions!
          flash[:notice] = "&#37325;&#32622;&#30340;&#23494;&#30721;&#24050;&#32463;&#21457;&#36865;&#32473;&#20320; " +
          "&#35831;&#26816;&#26597;&#20320;&#30340;&#30005;&#23376;&#37038;&#20214;."
          redirect_to new_person_session_path
        else
          flash[:notice] = "&#27809;&#26377;&#21457;&#29616;&#35813;&#30005;&#23376;&#37038;&#20214;&#30340;&#29992;&#25143;."
          render :action =&gt; :new
        end
      end
    end

&#35813;deliver_password_reset_instructions&#65281; &#26159;&#19968;&#31181;&#26041;&#27861;&#65292;&#23427;&#30340;&#20316;&#29992;&#26159;&#37325;&#32622;&#23494;&#30721;&#37325;&#32622;&#20196;&#29260;&#21644;&#21457;&#36865;&#30005;&#23376;&#37038;&#20214;&#12290;
&#25152;&#20197;&#25105;&#20204;&#26469;&#22312; person &#27169;&#22411;&#37324;&#21435;&#23436;&#25104;&#36825;&#20010;&#26041;&#27861;  

    def deliver_password_reset_instructions!
      reset_perishable_token!
      Notifier.deliver_password_reset_instructions(self)
    end

The reset_perishable_token! is a handy method Authlogic gives you. It basically resets the field to a unique &#8220;friendly&#8221; token and then saves the record.  

&#19979;&#38754;&#25105;&#20204;&#20316;&#19968;&#20010;&#21457;&#36865;&#37038;&#20214;&#31867;  

    app/models/notifier.rb  
    
    class Notifier &lt; ActionMailer::Base
    
      default_url_options[:host] = "127.0.0.1:3000"
    
      def password_reset_instructions(person)
        subject    '&#23494;&#30721;&#37325;&#32622;&#35828;&#26126;'
        recipients  "#{person.email}"
        from       'att21@163.com'
        sent_on     Time.now
        body       :edit_password_reset_url =&gt; edit_password_reset_url(person.perishable_token)
      end
    
    end

&#37038;&#20214;&#35797;&#22270;

    app/views/notifier/password_reset_instructions.erb  
    
    A request to reset your password has been made.
    If you did not make this request, simply ignore this email.
    If you did make this request just click the link below:
    &lt;%= @edit_password_reset_url %&gt;
    If the above URL does not work try copying and pasting it into your browser.
    If you continue to have problem please feel free to contact us.

**&#35753;&#29992;&#25143;&#37325;&#32622;&#20854;&#23494;&#30721;**

    # app/controllers/password_resets_controller.rb  
    def edit  
      render  
    end
    
    def update
      @person.password = params[:person][:password]
      @person.password_confirmation = params[:person][:password_confirmation]
      if @person.save
        flash[:notice] = "&#23494;&#30721;&#35774;&#32622;&#25104;&#21151;&#65281;"
        redirect_to login_path
      else
        render :action =&gt; :edit
      end
    end
    
    private
    def load_user_using_perishable_token
      @person = Person.find_using_perishable_token(params[:id])
      unless @person
        flash[:notice] = "&#24456;&#25265;&#27465;&#65292;&#20294;&#25105;&#20204;&#26080;&#27861;&#25214;&#21040;&#24744;&#30340;&#24080;&#25143;. " +
        "&#22914;&#26524;&#24744;&#26377;&#38382;&#39064;, &#21487;&#20197;&#20877;&#20174;&#24744;&#30340;&#30005;&#23376;&#37038;&#20214;&#22797;&#21046;&#32593;&#22336;&#24182;&#31896;&#36148;&#21040;&#27983;&#35272;&#22120; " +
        "&#25110;&#37325;&#26032;&#21551;&#21160;&#37325;&#32622;&#23494;&#30721;&#30340;&#36807;&#31243;."
        redirect_to login_path
      end
    end

&#35813;load_user_using_perishable_token&#20855;&#26377;&#29420;&#29305;&#30340;&#26041;&#27861;&#65306;
find_using_perishable_token&#12290; &#36825;&#26159;&#19968;&#20010;&#29305;&#27530;&#30340;&#26041;&#27861;&#65292;Authlogic&#32473;&#20320;&#12290;


**&#38480;&#21046;&#35775;&#38382;**  
  
&#29616;&#22312;&#25105;&#20204;&#21482;&#38656;&#35201;&#30830;&#20445;&#29992;&#25143;&#30331;&#20986;&#26102;&#35775;&#38382;&#36825;&#20123;&#26041;&#27861;&#12290;   
&#33258;&#24049;PasswordResetsController &#32534;&#20889;&#19968;&#20010;before_filter

    before_filter &#65306;require_no_person

&#26368;&#21518;&#21035;&#24536;&#20102; &#37197;&#32622;&#37038;&#20214;

      config.action_mailer.smtp_settings = {
          :address        =&gt; 'smtp.163.com',
          :port           =&gt; 25,
          :domain         =&gt; 'www.163.com',
          :authentication =&gt; :login,
          :user_name      =&gt; 'xxoo@163.com',
          :password       =&gt; 'xxoo'}
      


</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/39</id>
    <published>2010-10-09T10:40:00+08:00</published>
    <updated>2011-06-22T06:28:54+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/39-usage-of-simple-form"/>
    <title>simple_form&#20351;&#29992;</title>
    <summary> **&#23433;&#35013;simple_form**  

    $  sudo gem install simple_form

**&#20462;&#25913;Gemfile**

    $  gem "simple_form"

**&#29983;&#25104;&#37197;&#32622;&#25991;&#20214;**

    rails generate simple_form:install &#65283;&#29983;&#25104;&#25991;&#20214;  
    create  config/initializers/simple_form.rb 
    create  config/locales/simple_form.en.yml 
    create  lib/templates/erb/scaffold/_form.html.erb

**&#20197;User model&#20026;&#20363;&#35828;&#26126;&#20351;&#29992;&#26041;&#27861;**

    &lt;%= simple_form_for @user do |f| %&gt; 
    &lt;%= f.input :username %&gt; 
    &lt;%= f.input :password%&gt; 
    &lt;%= f.input :email%&gt; 
    &lt;%= f.input :profile,:as=&gt;:text%&gt; #as&#20351;&#29992; 
    &lt;%= f.input :age, :collection =&gt; 18..60 , :prompt =&gt; "Select your age"%&gt; #collection&#20351;&#29992; 
    &lt;%= f.simple_fields_for :adress do |adress_form| %&gt;  #simple_fields_for&#20351;&#29992; 
       &lt;%= adress_form.input :name %&gt; 
    &lt;% end %&gt; 
    &lt;%= f.button :submit %&gt; 
    &lt;% end %&gt;

&#19981;&#29983;&#25104; label,&#21487;&#20197;&#20351;&#20854;&#35774;&#32622;&#20026;false  

    &lt;%= f.input :login,:label=&gt;false %&gt;  

&#21516;&#26679;&#65292;&#22914;&#26524;&#24819;&#20351;required&#20026;false  

    &lt;%= f.input :login, :required =&gt; false %&gt;  

 **&#20851;&#20110;as**

  &#22312;activerecord&#19979;&#65292;&#20250;&#33258;&#21160;&#23545;&#24212;&#30456;&#20851;&#26144;&#23556;&#65292;&#20363;&#22914;&#65306;string&#29983;&#25104;&#21333;&#34892;&#25991;&#26412;&#65292;text&#29983;&#25104;&#22810;&#34892;&#25991;&#26412;&#65292;&#19981;&#36807;&#22914;&#26524;&#20351;&#29992;mongodb,&#25105;&#20351;&#29992;&#30340;&#26159;mongoid,&#27809;&#26377;text 
&#31867;&#22411;&#65292;&#20840;&#26159;string,&#25152;&#20197;&#35201;&#33258;&#24049;&#25163;&#21160;as,&#20363;&#22914; 

    &lt;%= f.input :profile,:as=&gt;:text%&gt;  

**Associations &#20351;&#29992;**  

    class User &lt; ActiveRecord::Base 
        belongs_to :company 
        has_and_belongs_to_many :roles 
      end 
       
      class Company &lt; ActiveRecord::Base 
        has_many :users 
      end 
       
      class Role &lt; ActiveRecord::Base 
        has_and_belongs_to_many :users 
      end  

&#34920;&#21333;&#20013;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;  

    &lt;%= simple_form_for @user do |f| %&gt; 
       &lt;%= f.input :name %&gt; 
       &lt;%= f.association :company %&gt; 
       &lt;%= f.association :roles %&gt; 
       &lt;%= f.button :submit %&gt; 
     &lt;% end %&gt;  

**&#37197;&#32622; config/initializers/simple_form.rb**  

   Wrapper&#65292;&#22914;&#26524;&#24819;&#20462;&#25913;&#29983;&#25104;&#30340;&#26631;&#31614;&#20026;P&#65288;&#40664;&#35748;&#20026;div&#65289;&#65292;&#21482;&#35201;&#20462;&#25913; 

    SimpleForm.wrapper_tag = :p 
    #&#40664;&#35748;&#24773;&#20917;&#19979;
    config.components = [ :label_input, :hint,:error]

&#22914;&#26524;&#19981;&#24819;&#20351;&#29992;error,&#21482;&#35201;&#21435;&#25481; &#21363;&#21487;   

    config.components = [ :label_input, :hint]  

**&#22269;&#38469;&#21270;&#65292;&#21482;&#35201;&#20462;&#25913;&#23545;&#24212;&#26412;&#22320;&#21270;&#25991;&#20214;&#21363;&#21487;**

    zh: 
      simple_form: 
        labels: 
          user: 
            username: '&#29992;&#25143;&#21517;' 
            password: '&#23494;&#30721;' 
        hints: 
          user: 
            username: '&#30331;&#24405;&#29992;&#25143;&#21517;.' 
            password: '&#36755;&#20837;&#27491;&#30830;&#30340;&#23383;&#31526;.' 
        placeholders: 
          user: 
            username: '&#20320;&#30340;&#29992;&#25143;&#21517;' 
            password: '****'42424242</summary>
    <author>
      <name>aoner</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/38</id>
    <published>2010-10-08T11:02:04+08:00</published>
    <updated>2011-06-22T16:08:04+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/38-slim-a-template-engine-simpler-than-haml"/>
    <title>Slim &#65293; &#27604; Haml &#26356;&#31616;&#21333;&#31616;&#27905;&#30340;&#27169;&#26495;&#24341;&#25806;</title>
    <summary>&#28304;&#22320;&#22336;&#65306; [http://github.com/stonean/slim][1]

&gt; Slim is a template language whose goal is reduce the syntax to the essential parts without becoming cryptic.


  [1]: http://github.com/stonean/slim</summary>
    <author>
      <name>fredwu</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/37</id>
    <published>2010-10-06T17:51:54+08:00</published>
    <updated>2011-06-22T16:26:37+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/37-use-cucumber-and-capybara"/>
    <title>Rails&#27979;&#35797;  cucumber &#65291; capybara &#40644;&#29916;&#21644;&#27700;&#35930;</title>
    <summary>&#40644;&#29916;&#65292;&#22823;&#23478;&#24212;&#35813;&#37117;&#30693;&#36947;&#12290;&#19981;&#30693;&#36947;&#30340;&#30475;&#36825;&#37324; http://www.javaeye.com/topic/417899  &#38750;&#24120;&#35814;&#32454;&#30340;&#20171;&#32461;&#65292;&#19978;&#38754;&#32473;&#30340; railscast &#38142;&#25509;&#26377;2&#20010;&#35270;&#39057;&#35762;cucumber&#30340;&#65292;&#38750;&#24120;&#20540;&#24471;&#30475;&#12290;
&#40644;&#29916;&#24456;&#24378;&#22823;&#65292;&#20294;&#26159;&#35201;&#25903;&#25345;&#27979;&#35797; javascript &#23601;&#35201;&#29992;&#21040;&#27700;&#35930;&#20102;&#65288;&#20160;&#20040;&#22855;&#24618;&#30340;&#21517;&#23383;) &#12290;
&#22312;&#26377;Capybara&#20043;&#21069;&#65292;Webrat&#26159;&#26368;&#27969;&#34892;&#30340;&#29992;&#22312;cucumber&#27979;&#35797;javascript&#30340;&#24037;&#20855;&#12290;
Capybara&#25903;&#25345;rack-test, selenium, celerity, culerity &#36825;&#20123;&#19981;&#21516;&#30340;javascript&#27979;&#35797;&#24037;&#20855;&#12290;



</summary>
    <author>
      <name>Ian</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/36</id>
    <published>2010-09-30T13:57:26+08:00</published>
    <updated>2011-06-21T22:04:46+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/36-signed-and-permanent-cookies-in-rails3%20"/>
    <title>rails3&#20013;&#27704;&#20037;&#24615;&#25480;&#26435;cookies</title>
    <summary>&#22312;&#36825;&#20043;&#21069;&#65292;&#20195;&#30721;&#24212;&#35813;&#26159;&#36825;&#26679;&#30340;&#20889;&#27861;&#65306;  

    cookies[:user_preference] = {
      :value =&gt; @current_user.preferences,
      :expires =&gt; 20.years.from_now.utc
    }  


&#29616;&#22312;&#24050;&#32463;&#19981;&#38656;&#35201;&#37027;&#20040;&#20889;&#20102;  

    cookies.permanent[:user_preference] = @current_user.preferences  

&#22914;&#26524;&#20320;&#30475;&#36807; [Pratik Naik][1]&#30340; [Railssummit&#28436;&#31034;][2]&#65292;&#20182;&#26366;&#35848;&#21040;&#20026;&#23454;&#29616;&#8220;Remember me&#8221;&#30340;&#21151;&#33021;&#20351;&#29992;[ActiveSupport::ActiveSupport::MessageVerifier][3]&#12290;dhh&#30340;push&#24456;&#22909;&#30340;&#35299;&#20915;&#30340;&#36825;&#19968;&#28857;&#12290;  

user.rb&#30340;&#27169;&#22411;&#20013;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;&#65306;  

    # User.rb
    def self.authenticated_with_token(id, stored_salt)
      u = find_by_id(user_id)
      u &amp;&amp; u.salt == stored_salt ? u : nil
    end  

&#24403;&#29992;&#25143;&#28857;&#20987; "Remember me"&#30340;check box, &#30830;&#20445;&#20197;&#19979;&#23558;&#20250;&#34987;&#25191;&#34892;&#65306;  

    cookies.permanent.signed[:remember_me] = [current_user.id, current_user.salt]  

&#20197;&#19978;&#20195;&#30721;&#23558;&#20250;&#29992; ActionController::Base.cookie_verifier_secret&#30340;secret specified&#26469;&#25480;&#26435;&#19968;&#20010;&#27704;&#20037;&#24615;&#30340;cookie&#65292;&#22914;&#26524;&#20320;&#36824;&#27809;&#26377;&#23450;&#20041; cookie_verifier_secret&#65292; &#37027;&#20040;&#21487;&#20197;&#22312;initializers&#20013;&#23450;&#20041;&#12290;

&#29616;&#22312;&#21487;&#20197;&#20351;&#29992;cookie&#36825;&#20040;&#30331;&#24405;&#20102;&#65306;  

    user = User.authenticated_with_token(*cookies.signed[:remember_me])  

&#22312;&#36825;&#31181;&#29305;&#27530;&#24773;&#20917;&#19979;&#65292;cookie&#20540;&#20013;&#20351;&#29992;salt&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#65292; &#20026;&#20102;&#30830;&#20445;&#29992;&#25143;&#22312;&#20462;&#25913;&#23494;&#30721;&#30340;&#26102;&#20505; cookie &#26159;&#26080;&#25928;&#30340;&#12290;   

&#26412;&#25991;&#32763;&#35793;&#33258; [Pratik Naik][1] &#30340;&#25991;&#31456;&#12290; &#22312;&#27492;&#29305;&#21035;&#24863;&#35874;  Pratik Naik&#12290;







  [1]: http://m.onkey.org/
  [2]: http://m.onkey.org/2009/10/18/railssummit-slides
  [3]: http://api.rubyonrails.org/classes/ActiveSupport/MessageVerifier.html</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/35</id>
    <published>2010-09-30T12:58:03+08:00</published>
    <updated>2011-06-22T12:05:59+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/35-active-record-query-interface-for-rails3"/>
    <title>Rails3&#30340;ActiveRecord &#26597;&#35810;API</title>
    <summary>&#20247;&#25152;&#21608;&#30693;&#65292;&#24456;&#22810;rails2&#30340;active record&#26597;&#35810;&#26041;&#27861;&#22312;rails3&#20247;&#24050;&#32463;&#19981;&#25512;&#33616;&#20351;&#29992;&#65292;&#20063;&#23601;&#26159;&#35828;&#65292;&#36807;&#26102;&#20102;&#12290;&#37027;&#20040;&#65292;&#21738;&#20123;&#20889;&#27861;&#22312;rails3.1&#20247;&#24050;&#32463;&#19981;&#25512;&#33616;&#20351;&#29992;&#20102;&#21602;&#65311;  

&gt; &#36825;&#20123;&#19981;&#25512;&#33616;&#20351;&#29992;&#30340;&#20889;&#27861;&#22312;rails3.1 
&gt; release&#29256;&#20013;&#20381;&#28982;&#26377;&#25928;&#65292;&#20294;&#26159;&#23558;&#20250;&#22312;rails3.2&#20013;&#20840;&#38754;&#30340;&#31227;&#38500;&#65292;&#32771;&#34385;&#21040;&#29301;&#28041;&#20102;&#27604;&#36739;&#22810;&#30340;&#20195;&#30721;&#20462;&#25913;&#65292;&#25152;&#20197;&#23558;&#20250;&#26377;&#19968;&#20010;&#23448;&#26041;&#30340;&#25554;&#20214;&#26469;&#25903;&#25345;&#20182;&#20204;&#12290;

  
&#31616;&#32780;&#35328;&#20043;&#65292;&#36890;&#36807;&#21253;&#21547;hash&#30340;&#20219;&#20309;ActiveRecord&#30340;&#31867;&#26041;&#27861;&#65292;&#37117;&#24050;&#32463;&#19981;&#25512;&#33616;&#20102;&#65292;&#27604;&#22914;&#65306;  

    :conditions, :include, :joins, :limit, :offset, :order, :select, :readonly, :group, :having, :from, :lock  


&#30446;&#21069;ActiveRecord&#25552;&#20379;&#20102;&#20197;&#19979;finder&#26041;&#27861;&#65306;  

*  find(id_or_array_of_ids, options)
*  find(:first, options)
*  find(:all, options)
*  first(options)
*  all(options)
*  update_all(updates, conditions, options)


&#36824;&#26377;&#20197;&#19979;&#30340;&#35745;&#31639;&#26041;&#27861;&#65306;  

*  count(column, options)
*  average(column, options)
*  minimum(column, options)
*  maximum(column, options)
*  sum(column, options)
*  calculate(operation, column, options)  

&#36827;&#20837;rails3&#30340;&#19990;&#30028;&#65292;&#20197;&#19978;&#30340;&#26041;&#27861;&#37117;&#26159;&#19981;&#25512;&#33616;&#20351;&#29992;&#30340;&#12290;&#36825;&#20123;&#26041;&#27861;&#23558;&#20250;&#22312;rails3.2&#20013;&#23436;&#25972;&#30340;&#31227;&#38500;&#12290;&#27492;&#22806;&#65292;find(:first) , find(:all)  &#20063;&#24050;&#32463;&#19981;&#25512;&#33616;&#20351;&#29992;&#20102;&#65292;&#23567;&#23567;&#30340;&#20363;&#22806;&#26159; count()&#26041;&#27861;&#20381;&#28982;&#25509;&#21463; :distinct &#21442;&#25968;&#12290;  

&#19979;&#38754;&#26159;&#19968;&#20123;&#22312; rails3&#20013;&#36807;&#26102;&#29992;&#27861;&#30340;&#20363;&#23376;&#65306;  

    User.find(:all, :limit =&gt; 1)
    User.find(:all)
    User.find(:first)
    User.first(:conditions =&gt; {:name =&gt; 'lifo'})
    User.all(:joins =&gt; :items)  

&#20294;&#26159;&#20197;&#19979;&#30340;&#29992;&#27861;&#36824;&#26159;&#25512;&#33616;&#20351;&#29992;&#30340;&#65306;  

    User.find(1)
    User.find(1,2,3)
    User.find_by_name('lifo')  


&#27492;&#22806;&#65292;&#22312;rails2&#20013;&#20351;&#29992;&#29575;&#30456;&#24403;&#22823;&#30340;named_scope &#20063;&#24050;&#32463;&#19981;&#25512;&#33616;&#20102;  

    named_scope :red, :conditions =&gt; { :colour =&gt; 'red' }
    named_scope :red, lambda {|colour| {:conditions =&gt; { :colour =&gt; colour }} }  

with_scope, with_exclusive_scope &#21644; default_scope &#20063;&#19981;&#25512;&#33616;&#20351;&#29992;&#12290;  

    with_scope(:find =&gt; {:conditions =&gt; {:name =&gt; 'lifo'}) { ... }
    with_exclusive_scope(:find =&gt; {:limit =&gt;1}) { ... }
    default_scope :order =&gt; "id DESC"  

&#21160;&#24577; scoped_by_  &#20063;&#23558;&#20250;&#24223;&#24323;&#12290;  

    red_items = Item.scoped_by_colour('red')
    red_old_items = Item.scoped_by_colour_and_age('red', 2)


**&#26032;&#30340;API**  

Rails3&#30340; ActiveRecord &#26377;&#20197;&#19979;&#30340;finder&#26041;&#27861;&#65306;  

*  where (:conditions)
*  having (:conditions)
*  select
*  group
*  order
*  limit
*  offset
*  joins
*  includes (:include)
*  lock
*  readonly
*  from  

**Chainability**  

&#19978;&#36848;&#30340;&#26041;&#27861;&#37117;&#20250;&#36820;&#22238;&#19968;&#20010;&#20851;&#31995;&#65292;&#20174;&#27010;&#24565;&#19978;&#35762;&#65292;&#36825;&#31181;&#20851;&#31995;&#20854;&#23454;&#37117;&#26159;&#19968;&#20010; named scope&#31867;&#22411;&#12290;&#25152;&#26377;&#30340;&#36825;&#20123;&#26041;&#27861;&#37117;&#24456;&#22909;&#30340;&#22312;&#20851;&#31995;&#23545;&#35937;&#20013;&#23450;&#20041;&#20102;&#12290;  

    lifo = User.where(:name =&gt; 'lifo')
    new_users = User.order('users.id DESC').limit(20).includes(:items)  

&#20320;&#21487;&#20197;&#22312;&#29616;&#26377;&#30340;&#20851;&#31995;&#20013;&#24212;&#29992;&#26356;&#22810;&#30340;finder&#26041;&#27861;  

    cars = Car.where(:colour =&gt; 'black')
    rich_ppls_cars = cars.order('cars.price DESC').limit(10)


**Quacks like a Model**  

Quacks relation &#22312;&#28041;&#21450;&#21040;&#20027;&#35201;&#30340;CRUD&#26041;&#27861;&#30340;&#26102;&#20505;&#20854;&#23454;&#23601;&#20687;&#19968;&#20010;&#27169;&#22411;&#65292;&#20320;&#21487;&#20197;&#35843;&#29992;&#20197;&#19979;&#20219;&#20309;&#26041;&#27861;&#12290;  

*  new(attributes)
*  create(attributes)
*  create!(attributes)
*  find(id_or_array)
*  destroy(id_or_array)
*  destroy_all
*  delete(id_or_array)
*  delete_all
*  update(ids, updates)
*  update_all(updates)
*  exists?  

&#37027;&#20040;&#65292;&#19979;&#38754;&#30340;&#20195;&#30721;&#26159;&#25105;&#20204;&#25152;&#24076;&#26395;&#30475;&#21040;&#30340;&#65306;  

    red_items = Item.where(:colour =&gt; 'red')
    red_items.find(1)
    item = red_items.new
    item.colour #=&gt; 'red'
    
    red_items.exists? #=&gt; true
    red_items.update_all :colour =&gt; 'black'
    red_items.exists? #=&gt; false  

&#35831;&#27880;&#24847;&#65292;&#35843;&#29992;&#20219;&#20309;&#30340;CRUD&#26041;&#27861;&#23558;&#20250;&#37325;&#32622;&#20851;&#31995;&#65292;&#20063;&#23601;&#26159;&#35828;&#65292;&#23558;&#20250;&#21024;&#38500;&#35760;&#24405;&#30340;&#32531;&#23384;&#65292;&#20363;&#22914; relation.size&#12290;  


**Lazy Loading  &#24310;&#36831;&#21152;&#36733;**  

&#25105;&#20204;&#21487;&#33021;&#20250;&#20174;&#19978;&#38754;&#30340;&#20363;&#23376;&#28165;&#26970;&#30340;&#30693;&#36947;&#65292;&#20851;&#31995;&#26159;&#24310;&#36831;&#21152;&#36733;&#30340;&#65292;&#20063;&#23601;&#26159;&#35843;&#29992;&#20102;&#19968;&#20010;&#26522;&#20030;&#30340;&#26041;&#27861;&#65292;&#36825;&#21644; associations &#21644; named_scopes &#26159;&#22914;&#20309;&#21327;&#20316;&#30340;&#27604;&#36739;&#30456;&#20284;&#12290;  

    cars = Car.where(:colour =&gt; 'black') # No Query
    cars.each {|c| puts c.name } # Fires "select * from cars where ..."  

&#36825;&#26159;&#38750;&#24120;&#26377;&#29992;&#30340;&#29255;&#27573;&#32531;&#23384;&#65292;&#22312;&#20320;&#30340;controller&#65292;&#21487;&#20197;&#36825;&#20040;&#20889;  

    def index
      @recent_items = Item.limit(10).order('created_at DESC')
    end  

&#28982;&#21518;&#22312;&#20320;&#30340;view&#20013;&#36825;&#20040;&#20889;  

    &lt;% cache('recent_items') do %&gt;
      &lt;% @recent_items.each do |item| %&gt;
        ...
      &lt;% end %&gt;
    &lt;% end %&gt;

&#22312;&#19978;&#36848;&#20363;&#23376;&#20013;&#65292;@recent_items &#22312;&#35270;&#22270;&#20013;&#35843;&#29992;&#20102;@recent_items.each&#21518;&#25165;&#34987;&#21152;&#36733;&#65292;&#20316;&#20026;&#25511;&#21046;&#22120;&#23454;&#38469;&#19978;&#24182;&#27809;&#26377;&#35302;&#21457;&#20219;&#20309;&#26597;&#35810;&#65292;&#22312;&#19981;&#38656;&#35201;&#20219;&#20309;&#29305;&#27530;&#24037;&#20316;&#30340;&#26102;&#20505;&#65292;&#29255;&#27573;&#32531;&#23384;&#21464;&#24471;&#38750;&#24120;&#26377;&#25928;&#12290;  

**Force loading &#8211; all, first &amp; last**  
 
&#26377;&#26102;&#20505;&#65292;&#20320;&#21487;&#33021;&#19981;&#38656;&#35201;&#24310;&#36831;&#21152;&#36733;&#65292;&#37027;&#20040;&#65292;&#20320;&#21487;&#20197;&#24378;&#21046;&#36827;&#34892;&#21152;&#36733;&#12290;  

    cars = Car.where(:colour =&gt; 'black').all  

&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;.all&#21518;&#36820;&#22238;&#30340;&#26159;&#19968;&#20010;&#25968;&#32452;&#65292;&#32780;&#19981;&#26159;&#19968;&#20010;&#20851;&#31995;&#12290;&#36825;&#21644;rails 2.3&#19979; named_scopes and associations&#26159;&#30456;&#31867;&#20284;&#30340;&#12290;  

&#21516;&#26679;&#65292;first &#21644;last &#24635;&#26159;&#20250;&#36820;&#22238;&#19968;&#20010; ActiveRecord&#23545;&#35937;&#25110;&#32773;nil.  

    cars = Car.order('created_at ASC')
    oldest_car = cars.first
    newest_car = cars.last  


**named_scope -&gt; scopes**  

named_scope&#22312;Rails3.0&#20013;&#24050;&#32463;&#19981;&#25512;&#33616;&#20351;&#29992;&#20102;&#65292;&#20320;&#21482;&#35201;&#23558; "named_"&#36825;&#37096;&#20998;&#21435;&#25481;&#23601;&#21487;&#20197;&#20102;&#12290;&#20063;&#23601;&#26159;&#35828;  named_scope&#24050;&#32463;&#34987;&#37325;&#26032;&#21629;&#21517;&#25104;scope&#20102;&#12290;  

&#32769;&#30340;&#20889;&#27861;&#26159;&#65306;  

    class Item
      named_scope :red, :conditions =&gt; { :colour =&gt; 'red' }
      named_scope :since, lambda {|time| {:conditions =&gt; ["created_at &gt; ?", time] }}
    end  

&#26032;&#30340;&#20889;&#27861;&#26159;&#65306;  

    class Item
      scope :red, :conditions =&gt; { :colour =&gt; 'red' }
      scope :since, lambda {|time| {:conditions =&gt; ["created_at &gt; ?", time] }}
    end

&#28982;&#32780;&#65292;&#20197;&#19978;&#20351;&#29992;&#30340;conditions&#30340;hash&#23558;&#20250;&#22312;Rails3.1&#20013;&#31227;&#38500;&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#36825;&#20040;&#20889;&#65306;  

    class Item
      scope :red, where(:colour =&gt; 'red')
      scope :since, lambda {|time| where("created_at &gt; ?", time) }
    end  

&#22312;&#20869;&#37096;&#65292;&#21629;&#21517;&#35268;&#33539;&#26159;&#24314;&#31435;&#22312;&#20851;&#31995;&#20043;&#19978;&#30340;&#65292;&#20351;&#23427;&#26356;&#31616;&#21333;&#30340;&#20351;&#29992;&#21644;&#28151;&#29992;finder&#26041;&#27861;&#12290;  

    red_items = Item.red
    available_red_items = red_items.where("quantity &gt; ?", 0)
    old_red_items = Item.red.since(10.days.ago)  


**Model.scoped**  

&#22914;&#26524;&#20320;&#24819;&#24314;&#31435;&#19968;&#20010;&#22797;&#26434;&#30340;&#20851;&#31995;&#26597;&#35810;&#65292;&#20174;&#19968;&#20010;&#31354;&#30333;&#30340;&#20851;&#31995;&#20986;&#21457;&#65292;&#37027;&#20040;Model.scoped&#23558;&#20250;&#26159;&#20320;&#29992;&#21040;&#30340;&#12290;  

    cars = Car.scoped
    rich_ppls_cars = cars.order('cars.price DESC').limit(10)
    white_cars = cars.where(:colour =&gt; 'red')  

&#35828;&#21040;&#20869;&#37096;&#65292;ActiveRecord::Base&#26377;&#20197;&#19979;delegations:  

    delegate :find, :first, :last, :all, :destroy, :destroy_all, :exists?, :delete, :delete_all, :update, :update_all, :to =&gt; :scoped
    delegate :select, :group, :order, :limit, :joins, :where, :preload, :eager_load, :includes, :from, :lock, :readonly, :having, :to =&gt; :scoped
    delegate :count, :average, :minimum, :maximum, :sum, :calculate, :to =&gt; :scoped  

&#20197;&#19978;&#30340;&#21487;&#33021;&#20250;&#32473;&#20320;&#19968;&#20010;&#26356;&#22909;&#30340;&#26041;&#21521;&#21435;&#29702;&#35299;ActiveRecord::Base&#31867;&#20869;&#37096;&#26159;&#22914;&#20309;&#24037;&#20316;&#30340;&#12290;&#21253;&#25324;&#21160;&#24577;&#30340;finder&#26041;&#27861;&#65292;&#27604;&#22914; find_by_name. find_all_by_name_and_colour &#31561;&#12290;  


**with_scope and with_exclusive_scope**   

with_scope&#21644;with_exclusive_scope &#29616;&#22312;&#24050;&#34987;&#36739;&#22909;&#30340;&#23454;&#26045;&#22312;&#20102;&#20851;&#31995;&#20043;&#19978;&#65306;  

    with_scope(where(:name =&gt; 'lifo')) do
      ...
    end  

&#25110;&#32773;&#20351;&#29992;&#19968;&#20010; named scope:  

    with_exclusive_scope(Item.red) do
      ...
    end  

 &#26412;&#25991;&#26159;&#32763;&#35793;&#33258;Pratik Naik &#21338;&#23458;&#30340;&#19968;&#31687;&#25991;&#31456;&#12290;[Active Record Query Interface 3.0][1] 


  [1]: http://m.onkey.org/2010/1/22/active-record-query-interface</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/34</id>
    <published>2010-09-30T10:49:04+08:00</published>
    <updated>2011-06-22T11:19:45+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/34-build-ruby-on-rails-development-enviroment-on-mac-osx-10-5-5"/>
    <title>Mac OS 10.5.5 &#25645;&#24314;ruby on rails&#29615;&#22659;</title>
    <summary>Mac OS 10.5.5 &#25645;&#24314;ruby on rails&#29615;&#22659;


1&#65306;  &#23433;&#35013;xcode&#65288;MacOS&#19979;&#30340;C&#32534;&#35793;&#22120;&#65289;&#20197;&#21450;&#24517;&#35201;&#30340;&#39537;&#21160;  

xcode &#23433;&#35013;:  
&#19979;&#36733;&#22320;&#22336;&#65306;[http://developer.apple.com/technologies/tools/][1]  
&#23433;&#35013;:   &#30452;&#25509;&#28857;&#20987;   
&#27880;&#24847;:   &#35201;&#20808;&#23433;&#35013;xcode,&#21542;&#21017;&#21518;&#38754;&#30340;vmware-tools&#23601;&#23433;&#35013;&#19981;&#19978;  
 

&#39537;&#21160;&#23433;&#35013;:

&#36164;&#26009;&#26469;&#28304;&#65306;
[http://blog.loveyuki.com/Article/snow-leopard-in-vmware.aspx][2]

&#20855;&#20307;&#27493;&#39588;&#65306;  
1&#65289;&#19979;&#36733;8y00zt_vmware-darwin-200.cab:  &#22320;&#22336;&#26639;&#20013;&#36755;&#20837;[http://blog.loveyuki.com/Attach/month_1003/8y00zt_vmware-darwin-200.cab][3],&#19979;&#36733;&#35813;&#25991;&#20214;&#65292;&#35299;&#21387;&#32553;&#21518;&#28857;&#20987;setup.cmd&#65292;&#28982;&#21518;&#23558;&#35813;&#25991;&#20214;&#22841;&#19979;&#30340;darwin.iso&#21152;&#36733;&#21040;&#34394;&#25311;&#26426;&#30340;&#20809;&#39537;&#20013;&#65288;&#35760;&#20303;&#35201;&#25171;&#24320;&#36830;&#25509;&#65292;&#20063;&#23601;&#26159;&#28857;&#20987;&#34394;&#25311;&#26426;&#21491;&#19979;&#35282;&#30340;&#20809;&#39537;&#65292;&#28982;&#21518;connect&#65289;&#12290;  

2) &#28857;&#20987;&#34394;&#25311;&#26426;&#30340;VM---&gt;Install Vmware Tools &#21152;&#36733;&#35813;&#25991;&#20214;,&#28857;&#20987;Install VMware Tools&#23433;&#35013;.(&#27880;&#24847;&#35813;&#27493;&#35201;&#20808;&#23433;&#35013;,&#21542;&#21017;&#21518;&#38754;&#30340;&#23433;&#35013;&#27493;&#39588;&#20250;&#20986;&#38169;),&#28982;&#21518;&#25171;&#24320;&#19979;&#36733;&#22320;&#22336; [http://sourceforge.net/projects/vmsvga2/files/][4], &#19979;&#36733;guestd_patches.pkg&#21644;VMsvga2_v1.2.2_Common_Installer.pkg&#12289;VMMouse_v1.2.1_Common_Installer.pkg,&#20998;&#21035;&#23433;&#35013;,&#23433;&#35013;&#23436;&#25104;&#21518;&#37325;&#21551;,&#36825;&#26679;&#23601;&#21487;&#20197;&#35843;&#33410;&#23631;&#24149;&#30340;&#20998;&#36776;&#29575;&#20102;.


2&#65306;  &#23433;&#35013;MacPort    

&#25171;&#24320;&#22320;&#22336; [http://developer.apple.com/technologies/mac/][5]  ,&#19979;&#36733;macports&#30452;&#25509;&#28857;&#20987;&#23433;&#35013;. 

&#26356;&#26032;macports:   

    $  sudo port selfupdate  


3:    &#23433;&#35013;ruby1.8.7  

&#25171;&#24320;&#32456;&#31471;  

    $  sudo port install ruby

&#23433;&#35013;&#25104;&#21151;&#20043;&#21518;,&#37325;&#26032;&#25171;&#24320;&#32456;&#31471;,&#36755;&#20837;  

    $  ruby -v

&#26174;&#31034;&#20449;&#24687;1.8.7&#20026;&#25104;&#21151;.  


4:    &#23433;&#35013;rails  

&#25171;&#24320;&#32456;&#31471;  sudo port install rb-rubygems,&#23433;&#35013;&#23436;&#21518;,&#37325;&#26032;&#25171;&#24320;&#32456;&#31471;&#36755;&#20837;gem -v,&#26174;&#31034;1.3.7&#20026;&#25104;&#21151;,&#28982;&#21518;sudo gem install rails -v=2.3.4,&#23433;&#35013;&#23436;&#21518;,&#37325;&#26032;&#25171;&#24320;&#32456;&#31471;,&#36755;&#20837;rails -v,&#26174;&#31034;2.3.4,&#21017;&#23433;&#35013;&#25104;&#21151;.  


5:    &#23433;&#35013;mysql&#21450;&#20854;gem  

1&gt; &#19979;&#36733;  [http://dev.mysql.com/downloads/mysql/5.1.html][6]  

2&gt;  &#36816;&#34892;&#35813;&#25991;&#20214;&#65292;&#20250;&#21457;&#29616;&#37324;&#38754;&#26377;4&#20010;&#25991;&#20214;&#12290;&#39318;&#20808;&#28857;&#20987;&#23433;&#35013;mysql-5.1.46-osx10.6-x86_64.pkg&#65292;&#36825;&#26159;MySQL&#30340;&#20027;&#23433;&#35013;&#21253;&#12290; &#19968;&#33324;&#24773;&#20917;&#19979;&#65292;&#23433;&#35013;&#25991;&#20214;&#20250;&#33258;&#21160;&#25226;MySQL&#23433;&#35013;&#21040;/usr/local&#19979;&#30340;&#21516;&#21517;&#25991;&#20214;&#22841;&#19979;&#12290;&#27604;&#22914;&#28857;&#20987;&#36816;&#34892;mysql-5.1.46-osx10.6- x86_64.dmg&#20250;&#25226;MySQ&#23433;&#35013;&#21040;/usr/local/mysql-5.1.46-osx10.6-x86_64&#20013;&#12290;&#19968;&#36335;&#40664;&#35748;&#23433;&#35013;&#23436;&#27605;&#21363;&#21487;&#12290;   

3&gt; &#28857;&#20987;&#23433;&#35013;&#31532;2&#20010;&#25991;&#20214;MySQLStartupItem.pkg&#65292;&#36825;&#26679;MySQL&#23601;&#20250;&#33258;&#21160;&#22312;&#24320;&#26426;&#26102;&#33258;&#21160;&#21551;&#21160;&#20102;&#12290;   


4&gt;  &#28857;&#20987;&#23433;&#35013;&#31532;3&#20010;&#25991;&#20214;MySQL.prefPane&#65292;&#36825;&#26679;&#23601;&#20250;&#22312;&#8220;&#31995;&#32479;&#35774;&#32622;&#20559;&#22909;&#8221;&#20013;&#30475;&#21040;&#21517;&#20026;&#8220;MySQL&#8221;&#30340;ICON&#65292;&#36890;&#36807;&#23427;&#23601;&#21487;&#20197;&#35774;&#32622;MySQL&#24320;&#22987;&#36824;&#26159;&#20572;&#27490;&#65292;&#20197;&#21450;&#26159;&#21542;&#24320;&#26426;&#26102;&#33258;&#21160;&#36816;&#34892;&#12290;&#21040;&#36825;&#37324;MySQL&#23601;&#22522;&#26412;&#23433;&#35013;&#23436;&#27605;&#20102;&#12290;   

5&gt;  &#20462;&#25913;/etc/bashrc&#30340;&#35835;&#20889;&#26435;&#38480;&#20026;&#21487;&#35835;&#20889;&#65306;  

    $  sudo chmod 666 /etc/bashrc

&#36890;&#36807;&#36816;&#34892;:  

    $  sudo vim /etc/bashrc  

&#22312;bash&#30340;&#37197;&#32622;&#25991;&#20214;&#20013;&#21152;&#20837;mysql&#21644;mysqladmin&#30340;&#21035;&#21517;,&#22914;&#19979;

    alias mysql=&#8217;/usr/local/mysql-5.1.41-osx10.5-x86/bin/mysql&#8217;
    alias mysqladmin=&#8217;/usr/local/ mysql-5.1.41-osx10.5-x86/bin/mysqladmin&#8217; 

6&gt;  &#37325;&#26032;&#25171;&#24320;&#32456;&#31471;&#36755;&#20837;mysql,&#25353;&#22238;&#36710;&#36827;&#20837;mysql&#25968;&#25454;&#24211;,&#40664;&#35748;&#31354;&#23494;&#30721;,&#22914;&#35201;&#20462;&#25913;&#23494;&#30721;mysqladmin -uroot -p&#8217;&#26087;&#23494;&#30721;&#8217; password '&#26032;&#23494;&#30721;'  

7&gt; &#23433;&#35013;mysql  gem:  
 

    $  gem install  mysql -- --with-mysql-config=/usr/local/mysql/bin/mysql_config


8&gt;  &#23433;&#35013;navicat,&#19979;&#36733;navicat,&#28857;&#20987;&#23433;&#35013;,&#20855;&#20307;&#19979;&#36733;&#22320;&#22336;,&#35831;&#33258;&#24049;&#25214;,&#35813;&#24037;&#20855;&#20026;&#25968;&#25454;&#24211;&#30340;&#35270;&#22270;&#21270;&#24037;&#20855;,&#22914;&#26524;&#19981;&#38656;&#35201;&#21487;&#20197;&#30465;&#30053;.  


6:   &#23433;&#35013;textmate&#65288;&#19979;&#36733;&#24050;&#30772;&#35299;&#65292;&#30452;&#25509;&#28857;&#20987;&#23433;&#35013;&#65289;  
&#27880;&#24847;:  Textmate&#20013;&#26174;&#31034;&#20013;&#25991;&#23383;&#20307;&#20250;&#37325;&#21472;&#65292;&#23433;&#35013;TextMateJ2.ttf&#23383;&#20307;&#21487;&#20197;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#12290;  


7:    &#23433;&#35013;ImageMagick  

&#22312;&#32456;&#31471;&#20013;&#36755;&#20837;sudo port install imagemagick,&#22914;&#26524;&#27809;&#26377;&#23433;&#35013;&#25104;&#21151;,&#21017;&#20877;&#27425;&#36755;&#20837;sudo   port install imagemagick,&#23433;&#35013;&#23436;&#20043;&#21518;,&#37325;&#21551;&#19968;&#20010;&#32456;&#31471;&#36755;&#20837;convert -version,&#22914;&#26524;&#36820;&#22238;&#20102;&#29256;&#26412;&#21495;,&#21017;&#23433;&#35013;&#25104;&#21151;.  

imagick.gem &#23433;&#35013;:     &#32456;&#31471;&#20013;&#23433;&#35013;gem&#21253;   

    $  sudo gem install rmagick  


  [1]: http://developer.apple.com/technologies/tools/
  [2]: http://blog.loveyuki.com/Article/snow-leopard-in-vmware.aspx
  [3]: http://blog.loveyuki.com/Attach/month_1003/8y00zt_vmware-darwin-200.cab
  [4]: http://sourceforge.net/projects/vmsvga2/files/
  [5]: http://developer.apple.com/technologies/mac/
  [6]: http://dev.mysql.com/downloads/mysql/5.1.html</summary>
    <author>
      <name>zhangcaiyan</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/33</id>
    <published>2010-09-29T09:01:01+08:00</published>
    <updated>2011-06-22T01:05:43+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/33-a-speedier-rails-app-using-rails-3-1-and-arel-2-0"/>
    <title>Rails 3.1 + Arel 2.0 &#8212;&#8212; &#22823;&#24133;&#25552;&#21319;&#25191;&#34892;&#25928;&#29575;</title>
    <summary>**Before (Rails 3.0.1pre stable branch + Arel 1.0.1):**

    Results:
    13 examples, 0 failures
    15 examples, 0 failures
    
    Took 300.66877 seconds

**After (Rails 3.1.0 master branch + Arel 2.0.0dev master branch:**

    Results:
    13 examples, 0 failures
    15 examples, 0 failures
    
    Took 197.365294 seconds</summary>
    <author>
      <name>fredwu</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/32</id>
    <published>2010-09-28T21:05:53+08:00</published>
    <updated>2011-06-20T23:40:51+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/32-use-time-ago-in-words"/>
    <title>&#24212;&#29992;time_ago_in_words&#26041;&#27861;&#35745;&#31639;&#26102;&#38388;&#24046;</title>
    <summary>   &#26368;&#36817;&#22312;&#20889;&#19968;&#20010;&#32593;&#31449;&#30340;&#26102;&#20505;&#65292;&#38656;&#35201;&#35745;&#31639;&#19968;&#20010;&#28040;&#24687;&#21457;&#24067;&#26102;&#38388;&#21040;&#29616;&#22312;&#30340;&#26102;&#38388;&#24046;&#12290;&#26412;&#25171;&#31639;&#33258;&#24049;&#20889;&#19968;&#20010;&#26041;&#27861;&#26469;&#23454;&#29616;&#65292;&#25214;&#20102;&#19968;&#19979;insoshi&#30340;&#28304;&#20195;&#30721;&#65292;&#21457;&#29616;&#20182;&#30340;&#26102;&#38388;&#24046;&#30340;&#22788;&#29702;&#20989;&#25968;time_ago_in_words &#26159;&#26469;&#33258;  rails view_helper &#37324;&#30340;&#65292;^_^ RAILS&#24050;&#32463;&#24110;&#25105;&#20204;&#32771;&#34385;&#30340;&#24456;&#21608;&#21040;&#20102;&#12290;

&#20195;&#30721;&#22914;&#19979;&#65306;

    &lt;%= time_ago_in_words message.created_at %&gt;

&#36825;&#26679;&#23601;&#21487;&#20197;&#20102; &#21487;&#26159;&#36755;&#20986;&#30340;&#26102;&#38388;&#24046;&#26159;&#33521;&#25991;&#30340; &#24590;&#20040;&#25226;&#20013;&#25991;&#21464;&#25104;&#20013;&#25991;&#30340;&#21602;&#65311;&#29616;&#22312;&#23601;&#38656;&#35201;I18n&#19978;&#22330;&#20102;

&#20174; http://github.com/svenfuchs/rails-i18n/blob/master/rails/locale/zh-CN.yml &#19979;&#36733;zh-CN.yml&#25991;&#20214; &#25918;&#21040; locales &#30446;&#24405;&#19979;
&#24182;&#19988;&#22312; environment.rb&#25991;&#20214;&#20013;&#21152;&#20837; 

    config.i18n.default_locale = "zh-CN"

&#20174;&#26032;&#21551;&#21160;&#26381;&#21153;&#65292;OK&#20013;&#25991;&#20986;&#26469;&#20102;&#12290;</summary>
    <author>
      <name>yuren</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/29</id>
    <published>2010-09-28T09:18:55+08:00</published>
    <updated>2011-06-22T02:32:45+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/29-use-parallel-tests-to-speed-up-tests"/>
    <title>&#20351;&#29992; parallel_tests &#26469;&#21152;&#36895;&#36816;&#34892;&#27979;&#35797;&#65281;</title>
    <summary>[http://github.com/grosser/parallel_tests][1]

&#20351;&#29992; parallel_tests &#21069;&#8212;&#8212;

    Finished in 365.94 seconds
    24 examples, 0 failures

&#20351;&#29992; parallel_tests &#21518;&#8212;&#8212;

    Results:
    11 examples, 0 failures
    13 examples, 0 failures
    
    Took 254.659077 seconds

  [1]: http://github.com/grosser/parallel_tests</summary>
    <author>
      <name>fredwu</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/26</id>
    <published>2010-09-27T00:47:12+08:00</published>
    <updated>2011-06-20T10:11:21+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/26-a-algorithm-problem"/>
    <title>&#32676;&#19978;&#26434;&#39064;</title>
    <summary>&#27492;&#38382;&#39064;&#26159;ruby on rails &#32676;&#19978;&#65292;&#31185;&#22810;&#21516;&#23398;&#30340;&#38754;&#35797;&#39064;&#12290;&#39064;&#30446;&#24456;&#31616;&#21333;&#65292;&#20294;&#26159;&#24819;&#23454;&#29616;&#24471;&#24178;&#20928;&#28418;&#20142;&#21364;&#26377;&#24456;&#22810;&#20540;&#24471;&#25512;&#25970;&#20043;&#22788;&#65292;&#20010;&#20154;&#21069;&#21518;&#20889;&#20102;&#19977;&#20010;&#29256;&#26412;&#65292;&#21069;&#21518;&#30342;&#26159;&#24494;&#35843;,&#31639;&#27861;&#19981;&#20540;&#24471;&#28145;&#31350;&#65292;&#20540;&#24471;&#28145;&#31350;&#30340;&#26159;&#23545;&#20195;&#30721;&#25913;&#36827;&#36807;&#31243;&#20013;&#30340;&#24605;&#36335;&#65306;
&#31532;&#19968;&#29256;&#23454;&#29616;&#65306;

    def meth(a,b,c=true)
      m=[] 
      s=b.shift 
      until b.empty?
       if b.delete(a-s) 
        m&lt;&lt;[s,a-s]
       end 
        s=b.shift 
      end 
      m=nil if m.empty? 
      c ? m : m[0]
    end

&#29992;&#27861;&#22914;&#19979;&#65306;

    meth(10,[1,2,3,4,5,6,7,8,9]) #=&gt;[[1,9],[2,8],[3,7],[4,6]]
    
    meth(10,[1,2,3,4,5,6,7,8,9],false) #=&gt;[1,9]
    
    meth(20,[1,2,3,4,5,6,7,8,9]) #=&gt;nil

&#20063;&#21363;&#26159;&#35828;&#65292;&#40664;&#35748;&#25214;&#19981;&#21040;&#28385;&#36275;&#26465;&#20214;&#30340;&#25968;&#32452;&#23545;&#26102;&#36820;&#22238;nil&#12290;&#40664;&#35748;&#36820;&#22238;&#25152;&#26377;&#30340;&#28385;&#36275;&#26465;&#20214;&#30340;&#25968;&#32452;&#23545;&#65292;&#33509;&#20351;&#29992;&#20989;&#25968;&#26102;&#25552;&#20379;&#31532;&#19977;&#20010;&#21442;&#25968;&#65292;&#21017;&#26681;&#25454;&#21442;&#25968;&#26469;&#20915;&#23450;&#36820;&#22238;&#20540;&#30340;&#36138;&#23146;&#19982;&#21542;&#12290;


&#20107;&#21518;&#65292;&#32463;&#36807;&#24605;&#32771;&#65292;&#23545;&#20195;&#30721;&#36827;&#34892;&#20102;&#22914;&#19979;&#25913;&#36827;&#65306;

    def meth(a,b,c=true)
      m=nil 	
      s=b.shift 	
      until b.empty?
      if  b.delete(a-s)
        m=[[s,a-s]] unless m  		
        m&lt;&lt;[s,a-s] if m &amp;&amp; c
      end
        s=b.shift 	
      end 
      c ? m : m[0]
    end

&#21069;&#21518;&#24605;&#36335;&#19968;&#26679;&#65292;&#21482;&#26159;&#30465;&#21435;&#20102;&#24456;&#22810;&#33073;&#20102;&#35044;&#23376;&#25918;&#23617;&#30340;&#20570;&#27861;&#12290;&#20195;&#30721;&#22240;&#27492;&#32780;&#21464;&#24471;&#31616;&#27905;&#26126;&#30333;&#20102;&#19968;&#19979;&#65292;&#20063;&#26356;&#25509;&#36817;&#20110;&#35745;&#31639;&#26426;&#30340;&#38405;&#35835;&#20064;&#24815;&#20102;&#12290;

&#31532;&#20108;&#29256;&#19982;&#31532;&#19968;&#29256;&#20165;&#20165;&#21482;&#26159;&#20889;&#27861;&#19978;&#30340;&#21464;&#21270;&#32780;&#24050;&#65292;&#20195;&#30721;&#30340;&#36816;&#31639;&#37327;&#24182;&#27809;&#26377;&#22810;&#22823;&#30340;&#21464;&#21270;&#12290;&#22312;&#23567;&#25968;&#32452;&#20869;&#36816;&#31639;&#26102;&#20197;&#19978;&#20004;&#29256;&#36816;&#31639;&#36215;&#26469;&#32496;&#32496;&#26377;&#20313;&#20102;&#65292;&#20294;&#26159;&#65292;&#22914;&#26524;b&#26159;&#19968;&#20010;&#36229;&#22823;&#25968;&#32452;&#65292;&#27604;&#22914;&#35828;&#20854;size&#20026;10000000(&#24403;&#28982;&#65292;&#36825;&#26159;&#19981;&#21487;&#33021;&#30340;)&#65292;&#21017;&#20197;&#19978;&#20004;&#20010;&#29256;&#26412;&#23601;&#26174;&#24471;&#24858;&#34850;&#26080;&#27604;&#20102;&#12290;&#22240;&#27492;&#65292;&#26377;&#20102;&#22797;&#26434;&#19968;&#28857;&#30340;&#31532;&#19977;&#29256;&#65306;

    def meth(a,b,c=true)
      m=nil 	
      s=b.shift 	
      until b.empty?
       if b.delete(a-s)
        m=[[s,a-s]]  if !m
        break if !c
        m&lt;&lt;[s,a-s] if m &amp;&amp; c
       end
        s=b.shift 	
      end 
      c ? m : m[0]
    end

&#31532;&#19977;&#29256;&#22810;&#20102;&#20010;break&#21028;&#26029;.&#20063;&#23601;&#26159;&#35828;,&#22914;&#26524;c=false,&#21017;&#36935;&#21040;&#31532;&#19968;&#32452;&#31526;&#21512;&#26465;&#20214;&#30340;&#25968;&#32452;&#23545;&#21518;&#30452;&#25509;&#36339;&#20986;,&#19981;&#20877;&#24490;&#29615;.&#19982;&#20043;&#30456;&#27604;,&#25913;&#36827;&#20043;&#21069;&#30340;&#20004;&#29256;&#21017;&#19981;&#31649;&#22914;&#20309;,&#37117;&#22312;&#25968;&#32452;&#20013;&#24490;&#29615;&#19968;&#22280;.&#26412;&#36136;&#19978;&#19981;&#35770;&#26159;&#21542;&#35774;c=false&#37117;&#20250;&#36827;&#34892;&#20840;&#26597;&#25214;.

&#20010;&#20154;&#19981;&#20250;debug,&#19981;&#20250;&#29992;&#24037;&#20855;&#26597;&#30475;&#20195;&#30721;&#30340;&#25191;&#34892;&#25928;&#29575;,&#22240;&#27492;&#33258;&#24049;&#25913;&#20102;&#19979;&#26041;&#27861;&#29992;&#20110;&#26816;&#27979;&#20195;&#30721;&#30340;&#25191;&#34892;&#27425;&#25968;:
&#39318;&#20808;&#26159;&#31532;&#20108;&#29256;&#30340;(&#31532;&#19968;&#29256;&#19982;&#31532;&#20108;&#29256;&#21407;&#29702;&#30456;&#21516;,&#30452;&#25509;&#36339;&#36807;)

    def meth(a,b,c=true)
      m=[] 
      s=b.shift 
      n=0
      while b.delete(a-s) 
        n+=1
        m&lt;&lt;[s,a-s] 
        s=b.shift 
      end 
      m=nil if m.empty? 
      # c ? m : m[0]
      n
    end

&#36825;&#37324;&#23558;&#21407;&#26412;&#30340;&#36820;&#22238;&#20540;&#27880;&#37322;&#25481;&#20102;,n&#21021;&#22987;&#20540;&#20026;0,&#27599;&#25191;&#34892;&#19968;&#27425;&#24490;&#29615;&#21017;&#36882;&#21152;1,&#20989;&#25968;&#26368;&#21518;&#36820;&#22238;&#20540;&#20026;&#24490;&#29615;&#25191;&#34892;&#30340;&#27425;&#25968;.

    puts    meth(10,[1,2,3,4,5,6,7,8,9]) #=&gt;[[1,9],[2,8],[3,7],[4,6]]
        
    puts    meth(10,[1,2,3,4,5,6,7,8,9],false) #=&gt;[1,9]
        
    puts    meth(20,[1,2,3,4,5,6,7,8,9]) #=&gt;nil

&#24471;&#21040;&#30340;&#32467;&#26524;&#26159;:

    4
    
    4
    
    0

&#23558;&#31532;&#19977;&#29256;&#20197;&#21516;&#26679;&#30340;&#26041;&#24335;&#35843;&#25972;&#36820;&#22238;n,&#24471;&#21040;&#30340;&#32467;&#26524;&#21017;&#26159;:

    4
    
    1
    
    0

&#30001;&#27492;&#21487;&#20197;&#30475;&#20986;&#24046;&#21035;.&#23567;&#35268;&#27169;&#36816;&#31639;&#26080;&#25152;&#35859;,&#22823;&#35268;&#21017;&#36816;&#31639;&#21017;&#21487;&#20197;&#33410;&#30465;&#24456;&#22810;&#36816;&#31639;&#37327;.

&#20197;&#19978;&#31639;&#27861;,&#30342;&#26159;bug&#30334;&#20986;,&#20063;&#19981;&#25913;&#20102;,&#30452;&#25509;&#25918;&#22312;&#19978;&#38754;&#26194;&#32827;&#36785;&#21543;,&#36825;&#26159;&#26080;&#38169;&#29256;&#26412;:(&#20877;&#26377;&#38169;&#25105;&#25226;&#23427;&#21507;&#20102;..)

    def meth(a,b,c=true)
      m=nil 	
      s=b.shift
      while s
       if b.delete(a-s)
        m=[[s,a-s]]  if !m
        break if !c
        m&lt;&lt;[s,a-s] if m &amp;&amp; c
       end
        s=b.shift 	
      end 
      m
    end</summary>
    <author>
      <name>suffering</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/25</id>
    <published>2010-09-26T16:58:23+08:00</published>
    <updated>2011-06-22T10:50:07+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/25-statistics-within-one-week"/>
    <title>&#32479;&#35745;&#19968;&#21608;&#30340;&#20449;&#24687;</title>
    <summary>    beginning_of_week = Time.now.beginning_of_week
    Notification.where("created_at &lt;= ? AND created_at &gt; ?", beginning_of_week, beginning_of_week + 7.days)

&#26597;&#35810;&#19968;&#21608;&#30340;&#20449;&#24687;&#32479;&#35745;&#65292;&#26368;&#32456;&#29983;&#25104;&#19968;&#20010;array

     sql = "SELECT * FROM notifications WHERE to_char(created_at,'yyyy-mm-dd') between '#{(Time.now.midnight - i.day).to_date}' and '#{Time.now.to_date}' ORDER BY  created_at DESC"

ruby&#20013;&#38590;&#24471;&#19968;&#35265;&#30340;sql&#35821;&#21477;&#65292;&#21621;&#21621;&#65292;&#34987;&#25105;&#29992;&#20102;&#29992;&#65292;&#24863;&#35273;&#30495;&#30340;&#19981;&#29245;&#65281;&#65281;

&#26597;&#35810;count&#32479;&#35745;&#25968;&#37327; 

    @notifications_count = current_user.notifications.count(:conditions =&gt; {:created_at =&gt; Time.now.midnight..(Time.now.midnight + 1.day)})  

&#27604;&#36739;&#23454;&#29992;&#21734;&#65281;
</summary>
    <author>
      <name>51515</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/24</id>
    <published>2010-09-26T10:19:13+08:00</published>
    <updated>2011-06-22T15:34:59+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/24-popular-and-useful-plugins-for-rails3"/>
    <title>rails3&#24120;&#29992;&#30340;&#25554;&#20214;&#25512;&#33616;</title>
    <summary>Rails&#20316;&#20026;&#19968;&#27454;&#26085;&#28176;&#39118;&#38753;&#30340;Web&#24320;&#21457;&#26694;&#26550;&#65292;&#20854;&#25554;&#20214;&#36215;&#20102;&#24456;&#22823;&#30340;&#20316;&#29992;&#65292;&#35753;&#24456;&#22810;&#26379;&#21451;&#19981;&#29992;&#20877;&#21435;&#23454;&#29616;&#19968;&#20123;&#22522;&#30784;&#21151;&#33021;&#12290;&#24456;&#22810;&#20154;&#19981;&#30693;&#36947;&#33258;&#24049;&#20889;&#30340;&#21151;&#33021;&#33021;&#30001;&#20160;&#20040;&#25554;&#20214;&#26469;&#20195;&#26367;&#65292;&#37027;&#20040;&#65292;&#19979;&#38754;&#20171;&#32461;&#20960;&#27454;&#24120;&#29992;&#30340;&#25554;&#20214;(&#25903;&#25345;Rails3)&#12290;

 **&#30331;&#24405;&#39564;&#35777;:**  

Authlogic: authlogic&#20316;&#20026;&#19968;&#27454;&#24378;&#22823;&#30340;&#30331;&#24405;&#39564;&#35777;&#25554;&#20214;&#65292;&#21463;&#21040;&#19981;&#23569;&#20154;&#30340;&#21916;&#27426;&#65292;&#20351;&#29992;&#38750;&#24120;&#31616;&#21333;&#65292;&#25903;&#25345;rails3&#65292;&#21487;&#20197;&#21442;&#32771;github&#19978;&#30340;api: [http://github.com/binarylogic/authlogic][1]  

**&#26435;&#38480;&#31649;&#29702;:**  

CanCan:  CanCan&#26159;&#19968;&#20010;&#29992;&#20110;Ruby on Rails&#26435;&#38480;&#25511;&#21046;&#30340;&#35299;&#20915;&#26041;&#26696;&#65292;&#25903;&#25345;Rails3&#12290;[http://github.com/ryanb/cancan][2]

**&#25628;&#32034;**  

meta_search: &#22312;Rails2&#20013;&#65292;&#30456;&#20449;&#24456;&#22810;&#20154;&#37117;&#22312;&#29992;binarylogic&#30340;searchlogic&#65292;&#27492;&#25554;&#20214;&#38750;&#24120;&#22909;&#29992;&#65292;&#20294;&#26159;&#24182;&#19981;&#25903;&#25345;Rails3&#65292;&#25152;&#20197;&#24403;&#25105;&#22312;&#24320;&#21457;Rails3&#39033;&#30446;&#30340;&#26102;&#20505;&#65292;&#21482;&#22909;&#24525;&#30171;&#21106;&#29233;&#20102;&#65292;&#25105;&#21457;&#29616;&#26377;&#19968;&#27454;&#25628;&#32034;&#25554;&#20214;&#21644;searchlogic&#24456;&#31867;&#20284;&#65292;&#21487;&#20197;&#35828;&#26159;Rails3&#29256;&#30340;searchlogic&#65292;&#25554;&#20214;&#20013;&#25193;&#23637;&#20102;&#30456;&#24403;&#22810;&#30340;&#26041;&#27861;&#26469;&#25903;&#25345;&#25628;&#32034;&#12290;
[http://github.com/ernie/meta_search][3]  

**&#20998;&#39029;**  

will_paginate: will_paginate&#26159;&#29992;&#21040;&#26368;&#21040;&#30340;&#19968;&#27454;&#25554;&#20214;&#65292;&#25903;&#25345;Rails3&#65292;&#26082;&#28982;&#26159;&#27604;&#36739;&#24120;&#29992;&#30340;&#25554;&#20214;&#65292;&#36825;&#37324;&#23601;&#19981;&#20171;&#32461;&#20102;&#65292;&#32473;&#20986;ap&#39033;&#30446;&#22320;&#22336;&#65292;&#27809;&#29992;&#36807;&#30340;&#21487;&#20197;&#21435;&#30475;&#30475;&#12290;[http://github.com/mislav/will_paginate][4]  

**FORM**  

Formtastic: Formtastic&#26159;&#19968;&#20010;Rails FormBuilder&#30340;DSL&#65292;&#25903;&#25345;rails3&#65292;Formtastic&#33021;&#21019;&#36896;&#20986;&#28418;&#20142;&#12289;&#35821;&#20041;&#20016;&#23500;&#12289;&#22810;&#26679;&#24335;&#30340;HTML Form&#12290;
[http://github.com/justinfrench/formtastic][5]  

**&#26631;&#31614;(Tag)**  

acts-as-taggable-on: web&#24320;&#21457;&#20013;&#32463;&#24120;&#20250;&#36935;&#21040;&#26631;&#31614;&#30340;&#31649;&#29702;&#65292;acts-as-taggable-on&#26159;&#19968;&#27454;&#38750;&#24120;&#36824;&#29992;&#30340;tag&#25554;&#20214;&#65292;&#20855;&#20307;&#29992;&#27861;&#35814;&#35265;&#39033;&#30446;&#22320;&#22336; [http://github.com/mbleigh/acts-as-taggable-on][6]  

**&#25991;&#20214;&#19978;&#20256;**  

paperclip: paperclip&#26159;&#19968;&#27454;&#29992;&#36884;&#38750;&#24120;&#24191;&#27867;&#30340;&#25991;&#20214;&#19978;&#20256;&#25554;&#20214;&#65292;&#24182;&#19988;&#26377;&#30456;&#24403;&#22909;&#30340;&#21487;&#25193;&#23637;&#24615;&#65292;&#25105;&#20204;&#22312;&#25991;&#20214;&#19978;&#20256;&#36807;&#31243;&#20013;&#32463;&#24120;&#38656;&#35201;&#36716;&#25442;&#26684;&#24335;&#65292;&#25110;&#32773;&#21516;&#27493;&#22788;&#29702;&#20854;&#23427;&#19968;&#20123;&#21160;&#20316;&#65292;&#36890;&#36807;paperclip&#65292;&#37117;&#21487;&#20197;&#24456;&#22909;&#30340;&#23454;&#29616;&#12290; &#39033;&#30446;&#22320;&#22336;&#65306; [http://github.com/thoughtbot/paperclip][7]  

**&#23500;&#25991;&#26412;&#32534;&#36753;&#22120;**

ckeditor: &#22312;&#21338;&#23458;&#25110;&#32773;&#20854;&#23427;&#25991;&#26412;&#32534;&#36753;&#30456;&#23545;&#36739;&#22810;&#30340;&#22320;&#26041;&#32463;&#24120;&#20250;&#29992;&#21040;&#19968;&#20123;&#25991;&#26412;&#32534;&#36753;&#22120;&#65292;ckeditor&#26159;&#19968;&#27454;&#30456;&#24403;&#22909;&#29992;&#30340;&#25554;&#20214;&#65292;&#25903;&#25345;rails3,&#37197;&#32622;&#20063;&#24456;&#31616;&#21333;&#65292;&#25512;&#33616;&#20351;&#29992;&#12290; &#39033;&#30446;&#22320;&#22336;&#65306; [http://github.com/galetahub/rails-ckeditor][8]  

**&#24322;&#27493;&#21457;&#36865;&#37038;&#20214;**  

ar_mailer_rails3: web&#24320;&#21457;&#20013;&#20250;&#36935;&#21040;&#36739;&#22810;&#30340;&#37038;&#20214;&#21151;&#33021;&#65292;&#27604;&#22914;&#29992;&#25143;&#27880;&#20876;&#22909;&#20043;&#21518;&#20250;&#21457;&#36865;&#19968;&#23553;&#30830;&#35748;&#20449;&#12289;&#27599;&#21608;&#25110;&#27599;&#26376;&#30340;newsletter&#31561;&#65292;&#24403;&#29992;&#25143;&#21464;&#30340;&#30456;&#24403;&#22810;&#30340;&#26102;&#20505;&#65292;&#25191;&#34892;&#19968;&#20010;&#30452;&#25509;&#21457;&#36865;&#30340;&#21160;&#20316;&#24448;&#24448;&#20250;&#35753;&#32593;&#31449;&#21464;&#30340;&#24456;&#24930;&#65292;ar_mailer_rails3 &#21487;&#20197;&#24110;&#20320;&#35299;&#20915;&#36825;&#20010;&#22256;&#24785;&#65292;&#20182;&#30340;&#24895;&#24847;&#26159;&#23558;&#37038;&#20214;&#23384;&#20837;&#25968;&#25454;&#24211;&#65292;&#28982;&#21518;&#36890;&#36807;&#21518;&#21488;&#20219;&#21153;&#21435;&#19968;&#23553;&#23553;&#30340;&#23450;&#26102;&#21457;&#36865;&#12290;&#25903;&#25345;rails3&#65292; &#39033;&#30446;&#22320;&#22336;&#65306; [http://github.com/yzhang/ar_mailer_rails3][9]  

**markdown&#35299;&#26512;**  

maruku: &#30456;&#20449;&#24456;&#22810;&#20154;&#22312;&#29992;markdown&#26684;&#24335;&#30340;&#25991;&#26412;&#65292;thoughtrails.com&#20063;&#19968;&#26679;&#65292;&#22240;&#20026;markdown&#26159;&#19968;&#31181;&#38750;&#24120;&#22909;&#29992;&#30340;&#36731;&#37327;&#32423;&#26631;&#35760;&#35821;&#35328;&#65292;&#21487;&#20197;&#32467;&#21512;&#20854;&#23427;&#25554;&#20214;&#20570;&#20986;&#24456;&#26834;&#30340;&#25928;&#26524;&#65292;&#27604;&#22914;&#32467;&#21512;coderay&#20570;&#20986;&#28418;&#20142;&#30340;&#39640;&#20142;&#25928;&#26524;&#31561;&#31561;&#65292;&#32780;maruku&#26159;&#19968;&#20010;&#23558;markdown&#25991;&#26412;&#36716;&#21270;&#20026;html&#30340;&#24037;&#20855;&#65292;&#20855;&#26377;&#33391;&#22909;&#30340;&#21487;&#25193;&#23637;&#24615;&#12290;&#39033;&#30446;&#22320;&#22336;&#65306; [http://github.com/nex3/maruku][10]  

**Schema&#20449;&#24687;**  

annotate: annotate &#33021;&#22815;&#20197;&#27880;&#37322;&#30340;&#26041;&#24335;&#22312;Model&#39030;&#37096;&#33258;&#21160;&#29983;&#25104;&#27492;Model&#30340;&#22823;&#32434;&#65288;schema&#65289;&#20449;&#24687;&#65292;&#24182;&#21487;&#20197;&#22312;Model&#30340;&#22823;&#32434;&#21457;&#29983;&#21464;&#21270;&#21518;&#33258;&#21160;&#26356;&#26032;&#12290;  

&#23545;&#20110;&#25317;&#26377;&#35768;&#22810;Model&#30340;&#22823;&#22411;&#39033;&#30446;&#26469;&#35828;&#65292;&#22312;Model&#30456;&#20851;&#25991;&#20214;&#20013;&#32500;&#25252;&#27492;model&#30340;&#22823;&#32434;&#20449;&#24687;&#23601;&#26174;&#24471;&#23588;&#20026;&#37325;&#35201;&#65292;&#20320;&#19981;&#38656;&#35201;&#21435;db/migrate&#30446;&#24405;&#19979;&#25628;&#23547;&#27492; Model&#30456;&#20851;&#30340;Migration&#25991;&#20214;&#65292;&#20063;&#19981;&#38656;&#35201;&#21435;mysql&#20013;&#25970;describe XXX&#21629;&#20196;&#65292;&#23601;&#21487;&#20197;&#36805;&#36895;&#20102;&#35299;&#27492;Model&#23545;&#24212;&#30340;&#34920;&#25317;&#26377;&#37027;&#20123;&#23383;&#27573;&#12290;&#21516;&#26679;&#25903;&#25345;rails3,&#39033;&#30446;&#22320;&#22336;&#65306; [http://github.com/ctran/annotate_models][11]


  [1]: http://github.com/binarylogic/authlogic
  [2]: http://github.com/ryanb/cancan
  [3]: http://github.com/ernie/meta_search
  [4]: http://github.com/mislav/will_paginate
  [5]: http://github.com/justinfrench/formtastic
  [6]: http://github.com/mbleigh/acts-as-taggable-on
  [7]: http://github.com/thoughtbot/paperclip
  [8]: http://github.com/galetahub/rails-ckeditor
  [9]: http://github.com/yzhang/ar_mailer_rails3
  [10]: http://github.com/nex3/maruku
  [11]: http://github.com/ctran/annotate_models</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/23</id>
    <published>2010-09-21T21:48:30+08:00</published>
    <updated>2011-06-22T10:58:33+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/23-careful-to-use-establish-connection"/>
    <title>&#24910;&#29992;establish_connection</title>
    <summary>&#22312;&#19968;&#20010;Rails&#24212;&#29992;&#20013;&#36830;&#25509;&#22810;&#20010;&#25968;&#25454;&#24211;&#65292;&#25105;&#20204;&#24120;&#24120;&#36825;&#20040;&#20570;?

    class Cookie &amp;lt; ActiveRecord::Base
        establish_connection :monitor_spider
        ..
    end

&#36825;&#26679;&#65292;&#22312;&#20351;&#29992;Cookie.find&#31561;&#25805;&#20316;&#30340;&#26102;&#20505;&#65292;&#23601;&#20250;&#36830;&#25509;&#21040;database.yml&#20013;monitor_spider&#37197;&#32622;&#30340;&#25968;&#25454;&#24211;&#19978;&#25805;&#20316;&#12290;  

&#20197;&#21069;&#19968;&#30452;&#37117;&#36825;&#20040;&#29992;&#65292;&#27809;&#21457;&#29616;&#20160;&#20040;&#19981;&#22949;&#12290;&#26368;&#36817;&#19968;&#20010;&#39033;&#30446;&#65292;&#30001;&#20110;&#21551;&#21160;&#30340;&#36827;&#31243;&#27604;&#36739;&#22810;&#65292;&#32769;&#26159;&#30896;&#21040;&#25968;&#25454;&#24211;&#36830;&#25509;&#27744;&#38142;&#25509;&#33719;&#21462;&#36229;&#26102;&#30340;&#38169;&#35823;&#12290;&#36890;&#36807;MySQL Client&#29992;&#21629;&#20196; :show processlist &#21457;&#29616;&#25968;&#25454;&#24211;&#36830;&#25509;&#25968;&#37327;&#19968;&#30452;&#23621;&#39640;&#19981;&#19979;&#65292;&#36731;&#36731;&#26494;&#26494;&#23601;&#19978;2k+&#30340;&#36830;&#25509;&#12290;&#36890;&#36807;&#35835;Rails&#26694;&#26550;&#30340;connection_pool.rb&#25991;&#20214;&#20195;&#30721;&#65292;&#21457;&#29616;&#22312;&#21508;&#27169;&#22411;&#20013;&#29992; establish_connection &#36830;&#25509;&#25968;&#25454;&#24211;&#20250;&#36896;&#25104;&#24456;&#22823;&#30340;&#38382;&#39064;&#12290;&#25991;&#20214;&#20013;&#31867;ConnectionHandler&#30340;establish_connection&#26041;&#27861;&#20195;&#30721;&#22914;&#19979;&#65306;  

    def establish_connection(name, spec)
        # raise "establish_connection name #{name} spec #{spec}"
        @connection_pools[name] = ConnectionAdapters::ConnectionPool.new(spec)
    end

&#23545;&#24212;&#19978;&#38754;Cookie&#27169;&#22411;&#30340;&#37197;&#32622;&#65292;&#36825;&#37324;name&#30340;&#20540;&#20250;&#26159;Cookie&#12290;&#20063;&#23601;&#26159;&#35828;&#65292;&#26377;10&#20010;&#27169;&#22411;&#20013;&#20351;&#29992;&#20102;establish_connection&#37197;&#32622;&#65292;@connection_pools&#20013;&#23601;&#20250;&#21021;&#22987;&#21270;10&#20010;ConnectionPool&#65292;&#22914;&#26524;&#27599;&#20010;ConnectionPool&#30340;pool size&#26159;20&#65292;&#37027;&#20040;&#24212;&#29992;&#36816;&#34892;&#30340;&#26102;&#20505;&#65292;&#23558;&#38656;&#35201;200(10 &#215; 20&#65289;&#20010;&#25968;&#25454;&#24211;&#36830;&#25509;&#12290;&#32780;&#25105;&#30340;&#24212;&#29992;&#20013;&#26377;&#20004;&#31867;&#27169;&#22411;&#65288;&#36830;&#25509;&#21040;&#20004;&#20010;&#25968;&#25454;&#24211;&#65289;&#65292;&#27169;&#22411;&#24635;&#25968;40+&#12290;&#25353;establish_connection&#30340;&#26041;&#24335;&#35774;&#32622;&#25968;&#25454;&#24211;&#36830;&#25509;&#65292;&#37027;&#20040;mysql&#30340;&#36830;&#25509;&#36731;&#26131;&#23601;&#34987;&#28040;&#32791;&#23436;&#20102;&#12290;&#37027;&#35201;&#24590;&#20040;&#22788;&#29702;&#21602;&#65311;&#25105;&#29616;&#22312;&#30340;&#24605;&#36335;&#26159;&#33258;&#24049;&#26469;&#32500;&#25252;&#25968;&#25454;&#24211;&#36830;&#25509;&#27744;&#12290;&#39318;&#20808;&#65292;&#23545;ConnectionAdapters&#36827;&#34892;&#19968;&#19979;&#25913;&#36896;&#65292;&#23558;&#22914;&#19979;&#20195;&#30721;&#25918;&#21040;initializers&#20013;&#65306;  

    module ActiveRecord  
      module ConnectionAdapters 
        class ConnectionHandler
          def specified_establish_connection(name, spec)
            @connection_pools[name] = ConnectionAdapters::ConnectionPool.new(spec)
          end
          
          def retrieve_connection_pool(klass)
            if klass.respond_to?(:pool_name)
              pool = @connection_pools[klass.pool_name]
              # ActiveRecord::Base.logger.info "pool: #{pool.inspect}"
              return pool if pool 
            end
            pool = @connection_pools[klass.name]
            # puts pool.inspect
            return pool if pool
            return nil if ActiveRecord::Base == klass
            retrieve_connection_pool klass.superclass
          end
        end
      end
    end

&#22312;environment.rb&#20013;&#20107;&#20808;&#36830;&#25509;&#24314;&#31435;&#25968;&#25454;&#24211;&#36830;&#25509;&#27744;&#65306;  

    #specified pool
    config =  YAML::load(File.open("config/database.yml"))
    %w(monitor_center monitor_spider).each do |pool_name|
      spec = config[pool_name]
      adapter_method = "#{spec["adapter"]}_connection"
      ActiveRecord::Base.connection_handler.specified_establish_connection(pool_name, ActiveRecord::Base::ConnectionSpecification.new(spec, adapter_method)) 
    end

&#22312;&#27169;&#22411;&#20013;&#65292;&#23450;&#20041;&#26041;&#27861;pool_name&#65306;  

    class TaskStat &amp;lt; ActiveRecord::Base
      def self.pool_name;"monitor_spider";end
      ...
    end

    class TaskInfo &amp;lt; ActiveRecord::Base
      def self.pool_name;"monitor_center";end
      ...
    end

&#36825;&#26679;&#65292;TaskStat&#23601;&#20250;&#29992;monitor_spider pool&#65292;TaskInfo&#20250;&#29992;monitor_center pool&#12290;&#21516;&#26102;&#25972;&#20010;&#24212;&#29992;&#23601;&#21482;&#26377;&#19977;&#20010;ConnectionPool&#65288;&#22806;&#21152;&#40664;&#35748;&#30340;ActiveRecord::Base&#30340;&#65289;&#36890;&#36807;&#36825;&#26679;&#30340;&#25913;&#36896;&#20043;&#21518;&#65292;&#25928;&#26524;&#26126;&#26174;&#65292;&#29616;&#22312;show processlist&#19968;&#33324;&#21482;&#26377;200~300&#30340;&#36830;&#25509;&#25968;&#12290;</summary>
    <author>
      <name>holin</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/22</id>
    <published>2010-09-17T15:41:41+08:00</published>
    <updated>2011-06-22T09:41:21+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/22-applicate-polymorphic-to-rails"/>
    <title>&#22312;Rails&#20013;&#24212;&#29992;&#22810;&#24577;&#20851;&#32852;</title>
    <summary>&#22312;&#36825;&#37324;&#20197;&#25991;&#31456;&#21644;&#38382;&#39064;&#30340;&#25237;&#31080;&#20026;&#20363;&#65306;  

&#39318;&#20808;&#21019;&#24314;3&#20010;model&#65292;&#27599;&#20010;migration&#22914;&#19979;&#65306;  

votes:  

    class CreateVotes &lt; ActiveRecord::Migration
      def self.up
        create_table :votes do |t|
          t.integer :user_id
          t.integer :voteable_id
          t.string :voteable_type, :limit =&gt; 25
    
          t.timestamps
        end
        add_index "votes", ["voteable_id", "voteable_type"], :name =&gt; "fk_votes"
        add_index "votes", ["user_id"], :name =&gt; "fk_user"
      end
    
      def self.down
        drop_table :votes
      end
    end  

episodes:  

    class CreateEpisodes &lt; ActiveRecord::Migration
      def self.up
        create_table :episodes do |t|
          t.integer :user_id
          t.string :title
          t.text :body
    
          t.timestamps
        end
        add_index :episodes, :user_id
      end
    
      def self.down
        drop_table :episodes
      end
    end  

questions:  

    class CreateQuestions &lt; ActiveRecord::Migration
      def self.up
        create_table :questions do |t|
          t.integer :user_id
          t.string :title
          t.text :body
    
          t.timestamps
        end
        add_index :questions, :user_id
      end
    
      def self.down
        drop_table :questions
      end
    end  

&#36825;&#37324;&#37325;&#35201;&#30340;&#26159;votes&#34920;&#30340;&#21019;&#24314;&#65292;:voteable_id, ::voteable_type &#26159;&#22810;&#24577;&#30340;&#32422;&#23450;&#20439;&#25104;&#12290;&#21516;&#26102;&#35201;&#20570;&#22909;index&#30340;&#35774;&#32622;&#65292;&#19981;&#28982;&#20197;&#21518;&#25968;&#25454;&#22810;&#20102;&#65292;&#26597;&#35810;&#36215;&#26469;&#20250;&#36739;&#24930;&#12290;  

&#25509;&#19979;&#26469;&#28155;&#21152;model&#20013;&#30340;&#20851;&#31995;&#65306;  

Episode.rb&#65306;  

    class Episode &lt; ActiveRecord::Base
      belongs_to :user
      has_many :votes, :as =&gt; :voteable
    end  

Question.rb&#65306;  

    class Question &lt; ActiveRecord::Base
      belongs_to :user
      has_many :votes, :as =&gt; :voteable
    end  

Vote.rb:  

    class Vote &lt; ActiveRecord::Base
      belongs_to :user
      belongs_to :voteable, :polymorphic =&gt; true
    end

&#23450;&#20041;&#22909;&#20102;&#21508;model&#30340;&#20851;&#31995;&#21518;&#65292;&#25105;&#20204;&#26469;&#35797;&#39564;&#19968;&#19979;&#22810;&#24577;&#20851;&#32852;&#26159;&#21542;&#25104;&#21151;&#65306;  

    &gt;&gt;  episode = Episode.create(:user_id =&gt; 1, :title =&gt; "just for test", :body =&gt; "just for test") 
    &gt;&gt;  episode.votes.new  
    &gt;&gt;  # 

&#34920;&#31034;&#24050;&#32463;&#20851;&#32852;&#25104;&#21151;&#65292;&#33391;&#22909;&#30340;&#36816;&#29992;&#22810;&#24577;&#20250;&#35753;&#20320;&#30340;&#25968;&#25454;&#24211;&#32467;&#26500;&#21464;&#30340;&#38750;&#24120;&#28165;&#26224;&#65292;&#32780;&#19988;&#26497;&#22823;&#30340;&#31616;&#21270;&#20102;&#20195;&#30721;&#37327;&#12290;
</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/21</id>
    <published>2010-09-17T14:26:48+08:00</published>
    <updated>2011-06-22T09:41:21+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/21-how-to-use-current-user-in-models"/>
    <title>&#22312;model&#20013;&#20351;&#29992;current_user</title>
    <summary>&#19968;&#33324;&#24773;&#20917;&#19979;&#65292;&#27809;&#26377;&#25552;&#20379;&#40664;&#35748;&#30340;&#26041;&#27861;&#22312;models&#20013;&#35843;&#29992;current_user&#65292; &#20165;&#38480;&#20110;&#22312;controllers views&#20013;&#36827;&#34892;&#35843;&#29992;&#65288;&#22312;&#36825;&#37324;&#35201;&#24863;&#35874;Authlogic&#25554;&#20214;&#30340;&#20316;&#32773;Binarylogic&#65289;&#65292;&#24456;&#22810;&#26379;&#21451;&#30896;&#21040;&#36825;&#20010;&#38382;&#39064;&#26102;&#65292;&#20250;&#37319;&#21462;&#20004;&#31181;&#26041;&#27861;&#65306;  
  
 1. &#22312;controller&#20013;&#22768;&#26126;    @object.use_id = current_user.id  
 2. &#22312;view&#20013;&#22768;&#26126;&#38544;&#34255;&#22495;    &lt;%= f.hidden_field :user_id, :value =&gt; current_user.id %&gt;  

&#20294;&#26159;&#65292;&#36825;&#26679;&#30340;&#20889;&#27861;&#22826;&#19985;&#38475;&#20102;&#65292;&#36828;&#36828;&#36798;&#19981;&#21040;&#25105;&#20204;&#30340;&#23457;&#32654;&#26631;&#20934;&#65292;&#25105;&#35748;&#20026;&#26368;&#22909;&#30340;&#26041;&#27861;&#23601;&#26159;&#29992;Thread.current&#36825;&#20010;&#25955;&#21015;&#26469;&#25226;current_user&#21152;&#21040;models&#20013;.  

    class User &lt; ActiveRecord::Base
        def self.current
            Thread.current[:user]
        end
        def self.current=(user)
            Thread.current[:user] = user
        end
    end  

&#22312;User&#36825;&#20010;&#31867;&#20013;&#65292;&#25105;&#20204;&#23450;&#20041;&#20102;&#20004;&#20010;&#31867;&#26041;&#27861;&#65292;&#25105;&#20204;&#35201;&#20570;&#30340;&#23601;&#26159;&#27599;&#27425;&#35831;&#27714;&#37117;&#35201;&#25226;current_user&#36171;&#32473;current&#65292;&#35265;&#19979;&#38754;&#20195;&#30721;&#65306;  

    class ApplicationController &lt; ActionController::Base
        def set_current_user
            User.current = current_user
        end
    end
    
    class EpisodesController &lt; ApplicationController
        before_filter :set_current_user
    end  

&#29616;&#22312;&#20320;&#24050;&#32463;&#21487;&#20197;&#22312;model&#20013;&#20351;&#29992;User.current&#26469;&#35843;&#29992;currrent_user&#20102;&#12290;



</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/19</id>
    <published>2010-09-16T15:03:10+08:00</published>
    <updated>2011-06-22T14:21:43+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/19-Math-gcd"/>
    <title>&#27714;&#38750;&#36127;&#25972;&#25968;m,n&#30340;&#26368;&#22823;&#20844;&#32422;&#25968;-&#27572;&#20960;&#37324;&#24503;&#31639;&#27861;&#30340;ruby&#23454;&#29616;</title>
    <summary>&#22914;&#39064;&#65292;&#35299;&#27861;&#22914;&#19979;&#65306;

**&#31243;&#24207;&#65306;**

    def Math.gong(m,n)
          raise ArgumentError,"m and n can't both be zero!" if m==0&amp;&amp;n==0
          m,n=n,m if m if m==0&amp;&amp;n==0
    return m if n==0
    m,n=n,m%n until m%n==0

&#25972;&#20010;&#31639;&#27861;&#30340;&#23454;&#29616;&#30340;&#19971;&#34892;&#65292;&#38500;&#20102;&#20989;&#25968;&#23450;&#20041;&#24320;&#20851;&#65288;def/end&#65289;&#21344;&#21435;&#20004;&#34892;,&#20197;&#21450;&#26368;&#21518;&#30340;&#30830;&#23450;&#36820;&#22238;&#20540;&#21344;&#21435;1&#34892;&#22806;&#65292;&#20854;&#20182;4&#34892;&#37117;&#20351;&#29992;&#29992;&#20102;&#26465;&#20214;&#20462;&#39280;&#35821;&#21477;&#12290;&#21253;&#25324;&#19968;&#20010;&#24490;&#29615;&#20462;&#39280;&#35821;&#21477;until&#12290;

*(3)&#20989;&#25968;&#26368;&#21518;&#19968;&#34892;&#21363;&#20026;&#20989;&#25968;&#36820;&#22238;&#20540;&#12290;*
&#22914;&#26524;&#26368;&#21518;&#19968;&#34892;&#37027;&#20010;&#23396;&#38646;&#38646;&#30340;n&#35753;&#20320;&#24515;&#29983;&#24604;&#24751;&#65292;&#20320;&#21487;&#20197;&#26174;&#31034;&#22320;&#32473;&#20182;&#21152;&#20010;return&#65292;&#20889;&#25104;return n.

return &#22312;&#20989;&#25968;&#20013;&#20986;&#26469;&#20102;&#20004;&#27425;&#12290;&#20004;&#27425;&#30342;&#26159;&#29992;&#20110;&#22788;&#29702;&#25968;&#23383;&#30456;&#38500;&#20013;&#29420;&#31435;&#29305;&#34892;&#30340;&#19981;&#33021;&#20570;&#20998;&#27597;&#19981;&#33021;&#34987;&#21462;&#27169;&#30340;0&#12290;&#20107;&#23454;&#19978;&#65292;&#22312;&#20989;&#25968;&#32467;&#26463;&#20043;&#21069;&#20808;return&#30340;&#24847;&#20041;&#26412;&#26469;&#23601;&#26159;&#24378;&#34892;&#36864;&#20986;&#65292;&#22914;&#26524;&#20320;&#19981;&#24819;&#21518;&#38754;&#30340;&#20195;&#30721;&#25104;&#20026;&#25670;&#35774;&#65292;&#37027;&#26368;&#22909;&#32473;&#23427;&#21152;&#20010;&#26465;&#20214;&#21028;&#26029;&#12290;&#26412;&#31639;&#27861;&#20013;&#20351;&#29992;&#20102;&#20462;&#39280;&#35821;&#21477;&#26469;&#38480;&#21046;&#23427;&#20165;&#22312;&#29305;&#23450;&#26465;&#20214;&#19979;&#24378;&#21046;&#36820;&#22238;&#12290;

**&#26411;&#65306;**

ruby&#20013;&#35753;&#20154;&#24778;&#21916;&#19981;&#24050;&#30340;&#23567;&#32454;&#33410;&#25968;&#20043;&#19981;&#23613;&#65292;&#36825;&#37324;&#23601;&#36825;&#20010;&#31639;&#27861;&#30340;&#23454;&#29616;&#24471;&#24847;&#19968;&#19979;&#12290;
&#24378;&#22823;&#30340;ruby~
</summary>
    <author>
      <name>suffering</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/18</id>
    <published>2010-09-16T13:21:34+08:00</published>
    <updated>2011-06-22T08:38:00+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/18-new-validation-of-rails3"/>
    <title>rails3.0&#26032;&#30340;&#39564;&#35777;&#26041;&#27861;</title>
    <summary>rails3.0&#26032;&#30340;&#39564;&#35777;&#26041;&#27861;&#24050;&#32463;&#20174;Active Model&#20013;&#25277;&#21462;&#20986;&#26469;,&#23427;&#25509;&#21463;&#19968;&#20010;&#23646;&#24615;&#21644;&#21704;&#31232;&#39564;&#35777;&#36873;&#39033;,&#19981;&#22312;&#20687;3.0&#20197;&#21069;&#38024;&#23545;&#27599;&#20010;&#23646;&#24615;&#20351;&#29992;&#19968;&#20010;&#39564;&#35777;&#26041;&#27861;,&#26497;&#22823;&#30340;&#31616;&#21270;&#20102;&#39564;&#35777;&#27969;&#31243;.

&#20197;&#21069;&#30340;&#26041;&#27861;&#34429;&#28982;&#36824;&#22312;,&#20294;&#19981;&#25512;&#33616;&#20351;&#29992;&#20102;,&#22240;&#20026;&#25105;&#20204;&#22815;&#25042;.

&#19979;&#38754;&#25105;&#20204;&#20808;&#26469;&#30475;&#19968;&#20010;&#31616;&#21333;&#30340;&#31034;&#20363;:

    class Person &lt; ActiveRecord::Base
        validates :email, :presence =&gt; true
    end

&#26032;&#30340;&#39564;&#35777;&#26041;&#27861;&#25509;&#25910;&#20197;&#19979;&#36873;&#39033;:

    1.  :acceptance =&gt; Boolean
    2.  :confirmation =&gt; Boolean
    3.  :exclusion =&gt; { :in =&gt; Ennumerable }
    3.  :inclusion =&gt; { :in =&gt; Ennumerable }
    4.  :format =&gt; { :with =&gt; Regexp }
    5.  :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, }
    6.  :numericality =&gt; Boolean
    7.  :presence =&gt; Boolean
    8.  :uniqueness =&gt; Boolean

&#26356;&#23481;&#26131;&#20351;&#29992;&#30340;&#39564;&#35777;&#36873;&#39033;,&#35753;&#39564;&#35777;&#26356;&#21152;&#36731;&#26494;,&#25105;&#20204;&#20197;&#19968;&#20010;&#27604;&#36739;&#23436;&#25972;&#30340;&#39564;&#35777;&#29992;&#25143;&#21517;&#21644;&#30005;&#23376;&#37038;&#20214;&#20316;&#20026;&#31034;&#20363;:

    # app/models/person.rb
    class User &lt; ActiveRecord::Base
      validates :name,  :presence =&gt; true,
                        :length =&gt; {:minimum =&gt; 1, :maximum =&gt; 254}
                       
      validates :email, :presence =&gt; true, 
                        :length =&gt; {:minimum =&gt; 3, :maximum =&gt; 254},
                        :uniqueness =&gt; true,
                        :format =&gt; {:with =&gt; /^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i}
      
    end


&#20174;&#31034;&#20363;&#20013;&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;,&#27169;&#22411;&#30340;&#21508;&#20010;&#23646;&#24615;&#20197;&#21450;&#35201;&#36827;&#34892;&#20309;&#31181;&#39564;&#35777;,&#20195;&#30721;&#30340;&#21487;&#35835;&#24615;&#20063;&#24471;&#21040;&#20102;&#25552;&#21319;.  

&#22312;&#20102;&#35299;rails 3.0&#39564;&#35777;&#26041;&#27861;&#30340;&#22522;&#26412;&#20351;&#29992;&#26041;&#27861;&#21518;,&#25105;&#20204;&#26469;&#30475;&#19979;&#19968;&#20123;&#26356;&#39640;&#32423;&#30340;&#24212;&#29992;.  
&#24403;&#29992;&#25143;&#20998;&#20026;&#19981;&#21516;&#30340;&#31561;&#32423;,&#22914;&#28216;&#23458;,&#29992;&#25143;,&#23458;&#25143;&#31561;,&#23427;&#20204;&#20849;&#29992;preson&#27169;&#22411;,&#36825;&#26102;&#25105;&#20204;&#21487;&#20197;&#24212;&#29992;: validates_with   

    # app/models/person.rb
    class User &lt; ActiveRecord::Base
      validates_with HumanValidator
    end
    
    # app/models/person.rb
    class Visitor &lt; ActiveRecord::Base
      validates_with HumanValidator
    end
    
    # app/models/person.rb
    class Customer &lt; ActiveRecord::Base
      validates_with HumanValidator
    end


&#28982;&#21518;&#22312;&#20320;&#39033;&#30446;&#30340;lib&#30446;&#24405;&#21019;&#24314;&#20197;&#19979;&#25991;&#20214;

    class HumanValidator &lt; ActiveModel::Validator
    
      def validate(record)
        record.errors[:base] &lt;&lt; "This person is dead" unless check(human)
      end
    
      private
    
        def check(record)
          (record.age &lt; 200) &amp;&amp; (record.age &gt; 0)
        end
    end


&#21551;&#21160;&#25511;&#21046;&#21488;,&#36816;&#34892;&#20197;&#19979;&#20195;&#30721;,&#20320;&#23601;&#20250;&#30475;&#21040;&#25928;&#26524;:


    $ ./script/console
    Loading development environment (Rails 3.0.pre)
    &gt;&gt; u = User.new
    =&gt; #
    &gt;&gt; u.valid?
    =&gt; false
    &gt;&gt; u.errors
    =&gt; #["This person is dead"]}&gt;

</summary>
    <author>
      <name>aoner</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/16</id>
    <published>2010-09-16T11:45:28+08:00</published>
    <updated>2011-06-22T02:59:29+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/16-initialize-hash"/>
    <title>&#29992;&#20004;&#20010;&#25968;&#32452;&#21021;&#22987;&#21270;hash</title>
    <summary>&#36825;&#20004;&#22825;&#36935;&#21040;&#19968;&#20010;&#38382;&#39064;&#65292;&#24819;&#29992;&#20004;&#20010;&#25968;&#32452;&#65292;&#21021;&#22987;&#21270;&#19968;&#20010;hash&#65292;&#20854;&#20013;&#19968;&#20010;&#25968;&#32452;&#30340;&#20540;&#20570;key&#65292;&#19968;&#20010;&#25968;&#32452;&#30340;&#20540;&#20570;value&#12290;&#25628;&#32034;&#20102;&#19968;&#19979;&#65292;&#21457;&#29616;&#19968;&#20010;&#22909;&#21150;&#27861;&#65306;

    hsh = Hash[*keys.zip(values).flatten]

&#19979;&#38754;&#26159;&#25105;&#30340;&#27979;&#35797;&#20195;&#30721;&#65306;

       def test_hash()
	     keys = ['a','b','c']
	     values = [0,1,2]
	     hsh = Hash[*keys.zip(values).flatten]

	      hsh.each do |k, v|
		      puts "key:#{k},value:#{v}"
	      end
       end
</summary>
    <author>
      <name>hywhy</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/14</id>
    <published>2010-09-13T17:53:55+08:00</published>
    <updated>2011-06-22T10:46:46+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/14-git-server-setup-using-gitosis-for-Centos"/>
    <title>centos&#19979;&#24212;&#29992;gitosis&#25645;&#24314;git&#20195;&#30721;&#20179;&#24211;</title>
    <summary>&#20808;&#35828;&#26126;,&#38024;&#23545;&#30340;&#31995;&#32479;&#26159;centos,&#20854;&#23427;&#31995;&#32479;&#19981;&#30693;&#36947;,&#20999;&#21254;&#27169;&#20223;,&#21518;&#26524;&#33258;&#36127;!  

&#23433;&#35013;git  

    $  wget http://kernel.org/pub/software/scm/git/git-1.7.2.3.tar.gz  
    $  tar -xzvf git-1.7.2.3,tar.gz  
    $  cd git-1.7.2.3  
    $  ./configure --with-curl=/usr/local  
    $  make &amp;&amp; make install  
    $  git --version  #&#26597;&#30475;&#29256;&#26412;&#21495;,&#30830;&#23454;git&#26159;&#21542;&#23433;&#35013;&#25104;&#21151;  
 
&#23433;&#35013;gitosis  

    $  yum install python python-setuptools  
    $  git clone git://eagain.net/gitosis.git  
    $  cd gitosis  
    $  python setup.py install   

&#22312;&#24320;&#21457;&#26426;&#22120;&#19978;&#29983;&#25104;&#20844;&#20849;&#23494;&#38053;(&#29992;&#26469;&#21021;&#22987;&#21270;gitosis)  

    $  ssh-keygen -t rsa   #&#19981;&#38656;&#35201;&#23494;&#30721;,&#19968;&#36335;&#22238;&#36710;&#23601;&#34892;    
    $  scp ~/.ssh/id_rsa.pub root@xxx:/tmp/   # &#19978;&#20256;&#20320;&#30340;ssh public key&#21040;&#26381;&#21153;&#22120;  

&#21021;&#22987;&#21270;gitosis  

    $  adduser git  # &#20250;&#33258;&#21160;&#29983;&#25104; /home/git/&#30446;&#24405; &#21644; git&#32452;  
    $  su - git  # &#20999;&#25442;&#20498;git&#29992;&#25143;&#19979;  
    $  gitosis-init &lt; /tmp/id_dsa.pub    
    $  rm /tmp/id_rsa.pub  # id_rsa.pub&#24050;&#32463;&#26080;&#29992;&#65292;&#21487;&#21024;&#38500;.    

&#33719;&#21462;&#24182;&#37197;&#32622;gitosis-admin:  

    $  git clone git@someServer.com:gitosis-admin.git  # &#22312;&#26412;&#22320;&#25191;&#34892;&#65292;&#33719;&#21462;gitosis&#31649;&#29702;&#39033;&#30446;    
    $  vi gitosis-admin/gitosis.conf  # &#32534;&#36753;gitosis-admin&#37197;&#32622;&#25991;&#20214;  

    [group &#32452;&#21517;]  
    writable = &#39033;&#30446;&#21517;   
    members = &#29992;&#25143;  # &#36825;&#37324;&#30340;&#29992;&#25143;&#21517;&#23383; &#35201;&#21644; keydir&#19979;&#30340;&#25991;&#20214;&#21517;&#23383;&#30456;&#19968;&#33268;   

&#25509;&#19979;&#26469;&#23601;&#21487;&#20197;&#21021;&#22987;&#21270;&#20320;&#26412;&#22320;&#30340;&#39033;&#30446;&#24182;&#25552;&#20132;&#20498;git&#26381;&#21153;&#22120;&#20102;.  

    $  rails new demo   #  &#20197;rails3&#20026;&#20363;   
    $  cd demo &amp;&amp; vi .gitignore   #  .gitignore&#21487;&#20197;&#23558;&#20320;&#19981;&#38656;&#35201;&#19978;&#20256;&#30340;&#25991;&#20214;&#26080;&#35270;&#25481;,&#27604;&#22914;database.yml&#12289;gemfile.lock&#31561;    
    
    &#36825;&#26159;&#19968;&#20010;&#20363;&#23376;:  
    .bundle  
    db/*.sqlite3  
    log/*.log  
    tmp/**/*  
    .rvmrc  
    config/database.yml  
    Gemfile.lock  
    Gemfile.local   
    
    $  git init  
    $  git add .  
    $  git commit -a -m "Initial import"  
    $  git remote add origin git@yourserver.com:projectname.git  
    $  git push origin master  


git&#22312;&#39033;&#30446;&#31649;&#29702;&#21644;&#21327;&#21516;&#26041;&#38754;&#26377;&#30528;&#26497;&#22823;&#30340;&#20248;&#21183;.

</summary>
    <author>
      <name>aoner</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/13</id>
    <published>2010-09-13T10:47:21+08:00</published>
    <updated>2011-06-21T22:07:33+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/13-how-to-install-mysql-on-windows"/>
    <title>&#26377;&#20851;windows&#19978;mysql&#30340;&#39537;&#21160;&#23433;&#35013;</title>
    <summary>rails&#23433;&#35013;&#23436;&#25104;&#20043;&#21518;&#65292;&#24635;&#26159;&#20250;&#24536;&#35760;&#23433;&#35013;&#25968;&#25454;&#24211;&#30340;&#39537;&#21160;&#65292;&#39033;&#30446;&#19968;&#21551;&#21160;&#23601;&#20250;&#25253;&#38169;&#12290;  

&#19979;&#38754;&#26159;mysql&#30340;&#39537;&#21160;&#23433;&#35013;&#36807;&#31243;:  

  1. &#23558;mysql&#23433;&#35013;&#30446;&#24405;&#19979;&#30340;ibmySQL.dll&#22797;&#21046;&#21040;ruby&#23433;&#35013;&#30446;&#24405;&#19979;&#30340;bin&#30446;&#24405;&#20013;&#12290;  
  2. &#22914;&#26410;&#23433;&#35013;rdoc&#65292;&#38656;&#20808;&#23433;&#35013;&#65306;&#21040;http://rubyforge.org/frs/?group_id=627&#19979;&#36733;rdoc-2.4.3.gem&#65292;  
&#21040;&#25991;&#20214;&#25152;&#22312;&#30446;&#24405;&#19979;&#25191;&#34892; gem install rdoc-2.4.3.gem&#12290;  
  3. &#21040;http://rubyforge.org/projects/mysql-win&#19979;&#36733;&#39537;&#21160;&#31243;&#24207;&#65306;mysql-2.7.3-mswin32.gem&#12290;  
  4. &#36827;&#20837;&#25991;&#20214;&#25152;&#22312;&#30446;&#24405;&#19979;&#65292;&#25191;&#34892;gem install mysql-2.7.3-mswin32.gem&#12290;  

&#23433;&#35013;&#25104;&#21151;&#12290;
 </summary>
    <author>
      <name>sunny</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/12</id>
    <published>2010-09-13T09:59:33+08:00</published>
    <updated>2011-06-21T23:09:48+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/12-netbeans-menu-from-zhCN-to-enUS"/>
    <title>netbeans&#33756;&#21333;&#20013;&#25991;&#36716;&#33521;&#25991;</title>
    <summary>&#22312;netbeans&#30340;&#23433;&#35013;&#30446;&#24405;&#19979;&#25214;&#21040;/etc/netbeans.conf&#25991;&#20214;&#65292;&#22312;netbeans_default_options
&#30340;&#26411;&#23614;&#21152;&#19978;&#65306;  -J-Duser.language=en -J-Duser.region=US&#65292;&#22914;&#19979;&#65306;  

    netbeans_default_options="-J-Xms256m -J-Xmx768m -J-XX:PermSize=32m -J-XX:MaxPermSize=160m -J-Xverify:none -J-Dapple.laf.useScreenMenuBar=true -J-Duser.language=en -J-Duser.region=US"    


&#20445;&#23384;&#21518;&#37325;&#26032;&#21551;&#21160;netbeans&#21363;&#21487;&#12290;

</summary>
    <author>
      <name>sunny</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/11</id>
    <published>2010-09-12T21:26:22+08:00</published>
    <updated>2011-06-22T16:24:39+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/11-line-mode-of-vim"/>
    <title>vim&#25216;&#24039;&#20043;&#19968;&#65306;&#21015;&#27169;&#24335;</title>
    <summary> &#26377;&#19968;&#20010;&#32769;&#35828;&#27861;&#65292;&#31243;&#24207;&#21592;&#20998;&#19977;&#31181;&#65292;&#19968;&#31181;&#20351;&#29992;vim&#24320;&#21457;&#65292;&#19968;&#31181;&#20351;&#29992;emacs&#24320;&#21457;&#65292;&#20854;&#20313;&#30340;&#23646;&#20110;&#31532;&#19977;&#31181;&#65307;&#20063;&#21487;&#33021;&#36825;&#20010;&#35828;&#27861;&#22312;rails&#22280;&#23376;&#37324;&#26377;&#20363;&#22806;&#65292;&#25630;rails&#30340;&#20154;&#21482;&#35201;&#20998;&#20004;&#31181;&#65292;&#19968;&#31181;&#20351;&#29992;textmate&#65292;&#20854;&#20313;&#30340;&#23646;&#20110;&#31532;&#20108;&#31181;&#65306;&#65289;&#34429;&#28982;&#36825;&#26679;&#65292;&#25105;&#36824;&#26159;&#24076;&#26395;&#25226;vim&#26041;&#38754;&#30340;&#23567;&#25216;&#24039;&#24635;&#32467;&#19979;&#26469;&#65292;&#21644;&#22823;&#23478;&#20998;&#20139;&#65292;&#20063;&#26159;&#20026;&#20102;&#28608;&#21169;&#33258;&#24049;&#19981;&#26029;&#23398;&#20064;&#12290;&#36825;&#27425;&#20808;&#35828;vim&#20013;&#30340;&#21015;&#27169;&#24335;&#12290;
    &#25991;&#26412;&#32534;&#36753;&#24037;&#20855;&#20013;&#30340;&#21015;&#27169;&#24335;&#65292;&#26159;&#25105;&#26085;&#24120;&#24037;&#20316;&#20013;&#26368;&#24120;&#29992;&#30340;&#21151;&#33021;&#20043;&#19968;&#12290;&#19979;&#38754;&#20030;&#20010;&#23567;&#20363;&#23376;&#65292;&#26469;&#35828;&#26126;vim&#20013;&#22914;&#20309;&#20351;&#29992;&#21015;&#27169;&#24335;&#65292;&#39318;&#20808;&#26377;&#19968;&#27573;&#25991;&#26412;&#22914;&#19979;,&#24403;&#28982;&#65292;&#36825;&#37324;&#25105;&#21482;&#21015;&#20986;&#22235;&#34892;&#25991;&#26412;&#65292;&#23454;&#38469;&#19978;&#34892;&#25968;&#36234;&#22810;&#65292;vim&#22312;&#21015;&#27169;&#24335;&#19978;&#30340;&#25805;&#20316;&#30340;&#26041;&#20415;&#24615;&#23601;&#36234;&#26126;&#26174;&#65306;  
&#21407;&#22987;&#25991;&#26412;&#65306;

    aaa
    bbbb
    cc
    ddddd

&#29616;&#22312;&#65292;&#25105;&#24819;&#25226;&#23427;&#21464;&#25104;&#19979;&#38754;&#30340;&#25720;&#26679;:
&#32534;&#36753;&#21518;&#30340;&#25991;&#26412;&#65306;

    &#8216;aaa','bbbb','cc','ddddd'

  &#22312;vim&#20013;&#65292;&#26377;&#22810;&#31181;&#26041;&#27861;&#21487;&#20197;&#36798;&#21040;&#36825;&#20010;&#25928;&#26524;&#65288;&#21482;&#26159;&#25105;&#30693;&#36947;&#65289;&#65292;&#19979;&#38754;&#36880;&#20010;&#20171;&#32461;&#65306;

1&#12289;&#36890;&#36807;&#22359;&#36873;&#25321;
 &#22312;vim&#20013;&#65292;&#36873;&#25321;&#27169;&#24335;&#20998;&#20026;&#19977;&#31181;&#65292;&#25353;v&#36827;&#20837;&#23383;&#31526;&#36873;&#25321;&#65292;V&#36827;&#20837;&#34892;&#36873;&#25321;&#65292;ctrl+v&#65288;windows&#19979;&#25353;ctrl+q&#65289;&#36827;&#20837;&#22359;&#36873;&#25321;&#27169;&#24335;&#12290;&#22359;&#36873;&#25321;&#27169;&#24335;&#65292;&#26159;vim&#20013;&#23454;&#29616;&#21015;&#27169;&#24335;&#30340;&#20027;&#35201;&#25163;&#27573;&#12290;
    &#20808;&#35828;&#19968;&#19979;&#24605;&#36335;&#21543;&#65292;&#20174;&#21407;&#22987;&#25991;&#26412;&#65292;&#21040;&#25105;&#24819;&#35201;&#30340;&#25991;&#26412;&#65292;&#38656;&#35201;&#36825;&#26679;&#20570;&#65292;&#22312;&#31532;&#19968;&#21015;&#21152;&#20837;&#19968;&#20010;&#21333;&#24341;&#21495;&#65292;&#28982;&#21518;&#22320;&#26367;&#25442;&#25481;&#25442;&#34892;&#31526;&#65292;&#24182;&#21024;&#38500;&#26368;&#21518;&#19968;&#20010;&#36887;&#21495;&#12290;&#19979;&#38754;&#25105;&#20808;&#20889;&#20986;&#25805;&#20316;&#26041;&#27861;&#65292;&#20877;&#20570;&#35299;&#37322;,&#25105;&#29992;&#8220;=&gt;&#8220;&#26469;&#20316;&#20026;&#36830;&#25509;&#21629;&#20196;&#30340;&#31526;&#21495;&#65306;  

    gg =&gt; ctrl+q =&gt; 3j =&gt; I =&gt; ' =&gt;  =&gt; :%s/\n//g


&gt; gg &#65306;&#22238;&#21040;&#25991;&#26412;&#24320;&#22987;&#20301;&#32622;&#65292;&#22914;&#26524;&#20809;&#26631;&#24050;&#32463;&#22312;&#36825;&#37324;&#65292;&#37027;&#36825;&#27493;&#21487;&#20197;&#30465;&#30053;&#65307;  
&gt; ctrl+q&#65306;&#36827;&#20837;&#22359;&#36873;&#25321;&#27169;&#24335;&#65307; 3j&#65306;&#36873;&#20013;&#21521;&#19979;&#30340;3&#34892;&#65307;  
&gt; I&#65306;&#22312;&#20809;&#26631;&#20301;&#32622;&#25554;&#20837;&#23383;&#31526;&#65307;  
&gt; &#8216;&#65306;&#25554;&#20837;&#19968;&#20010;&#21333;&#24341;&#21495;&#65307;   
&gt;  &#65306;&#25353;esc&#38190;  

 

&#20197;&#19978;&#20960;&#27493;&#65292;&#23436;&#25104;&#20102;&#22312;&#31532;&#19968;&#34892;&#25554;&#20837;&#21333;&#24341;&#21495;&#30340;&#25805;&#20316;&#12290;

&gt; :%s/\n//g&#65306;&#36825;&#19968;&#27493;&#21017;&#26159;&#26367;&#25442;&#25481;&#25152;&#26377;&#25442;&#34892;&#31526;  

2&#12289;&#36890;&#36807;&#26367;&#25442;  

&#20063;&#35768;&#20320;&#20250;&#35273;&#24471;&#65292;&#22312;&#31532;&#19968;&#21015;&#25554;&#20837;&#21333;&#24341;&#21495;&#30340;&#27493;&#39588;&#36807;&#20110;&#32321;&#29712;&#65292;&#20854;&#23454;&#25105;&#20063;&#36825;&#20040;&#35273;&#24471;&#65292;&#25152;&#20197;&#25105;&#26356;&#20542;&#21521;&#20110;&#20351;&#29992;&#26367;&#25442;&#21629;&#20196;&#26469;&#23436;&#25104;&#36825;&#20010;&#27493;&#39588;&#65292;&#20063;&#23601;&#26159;&#35828;&#65292;&#25105;&#25226;&#27599;&#34892;&#30340;&#24320;&#22836;&#65292;&#26367;&#25442;&#20026;&#21333;&#24341;&#21495;&#65292;&#21629;&#20196;&#22914;&#19979;&#65306;

    :%s/^/\'/g  

&#36825;&#26679;&#23601;&#31616;&#21333;&#22810;&#20102;&#21543;&#65292;&#32780;&#19988;vim&#21487;&#20197;&#36890;&#36807;&#31526;&#21495;&#8221;|&#8220;&#25226;&#20004;&#20010;&#21629;&#20196;&#36830;&#36215;&#26469;&#25191;&#34892;&#65292;&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#25226;&#20004;&#37096;&#25805;&#20316;&#36830;&#36215;&#26469;&#65306;

    :%s/^/\'/g | %s/\n//g  

&#36825;&#26679;&#21482;&#38656;&#35201;&#19978;&#38754;&#19968;&#26465;&#21629;&#20196;&#65292;&#23601;&#21487;&#20197;&#36798;&#21040;&#25105;&#35201;&#30340;&#25928;&#26524;&#20102;&#12290;  


3&#12289;&#36890;&#36807;&#23439;
&#21478;&#19968;&#31181;&#21150;&#27861;&#23601;&#26159;&#36890;&#36807;&#23439;&#20102;&#65292;&#34429;&#28982;&#36825;&#21487;&#33021;&#26377;&#28857;&#23567;&#39064;&#22823;&#20316;&#65292;&#32780;&#19988;&#25805;&#20316;&#36215;&#26469;&#24182;&#19981;&#35265;&#24471;&#26041;&#20415;&#22810;&#23569;&#65292;&#20294;&#36825;&#19968;&#20010;&#21150;&#27861;&#65292;&#23601;&#24403;&#20171;&#32461;vim&#30340;&#23439;&#21543;&#65306;&#65289;&#36824;&#26159;&#20808;&#21015;&#20986;&#25805;&#20316;&#27493;&#39588;&#65306;
&#24405;&#21046;&#23439;&#65306;

    qa =&gt; i =&gt; ' =&gt;  =&gt; A =&gt; ', =&gt; j0 =&gt; q  

&gt; qa&#65306;&#24320;&#22987;&#24405;&#21046;&#21517;&#31216;&#20026;a&#30340;&#23439; i &#65306;&#25554;&#20837; '&#65306;&#25554;&#20837;&#21333;&#24341;&#21495;  
&gt; &#65306;&#36864;&#20986;&#25554;&#20837;&#27169;&#24335; A&#65306;&#22312;&#34892;&#23614;&#25554;&#20837; ',&#65306;&#25554;&#20837;&#21333;&#24341;&#21495;&#21644;&#36887;&#21495;  
&gt; j0&#65306;j&#26159;&#21040;&#19979;&#19968;&#34892;&#65292;0&#26159;&#22238;&#21040;&#34892;&#39318; q&#65306;&#24405;&#21046;&#23439;&#32467;&#26463;  

&#19978;&#38754;&#23439;&#25152;&#30340;&#25805;&#20316;&#26102;&#65292;&#22312;&#19968;&#34892;&#30340;&#24320;&#22987;&#21152;&#20837;&#21333;&#24341;&#21495;&#65292;&#22312;&#32467;&#23614;&#21152;&#20837;&#21333;&#24341;&#21495;&#21644;&#36887;&#21495;&#12290;&#28982;&#21518;&#20877;&#25191;&#34892;&#19979;&#38754;&#30340;&#21629;&#20196;&#23436;&#25104;&#25805;&#20316;&#65306;  

    3@a =&gt;  gg =&gt; 4gJ  

&gt; 3@a&#65306;&#25191;&#34892;&#19977;&#27425;&#23439;a   
&gt; gg&#65306;&#22238;&#21040;&#25991;&#26412;&#30340;&#24320;&#22987;  
&gt; 4gJ&#65306;&#21512;&#24182;4&#34892;&#25991;&#26412;  

    &#20174;&#19978;&#38754;&#36825;&#19977;&#20010;&#26041;&#27861;&#21487;&#20197;&#30475;&#20986;&#65292;vim&#26159;&#19968;&#20010;&#38750;&#24120;&#28789;&#27963;&#30340;&#24037;&#20855;&#65292;&#26681;&#25454;&#19981;&#21516;&#30340;&#24773;&#20917;&#65292;&#32452;&#21512;&#20351;&#29992;&#19981;&#21516;&#30340;&#21629;&#20196;&#65292;&#36798;&#21040;&#26368;&#22909;&#30340;&#25928;&#26524;&#65292;&#26159;&#29992;&#22909;vim&#26368;&#37325;&#35201;&#30340;&#22320;&#26041;&#12290;&#20197;&#21518;&#26377;&#26356;&#22909;&#30340;&#32463;&#39564;&#65292;&#38543;&#26102;&#19982;&#22823;&#23478;&#20998;&#20139;&#12290;&#22914;&#26524;&#22823;&#23478;&#26377;&#26356;&#22909;&#30340;&#25216;&#24039;&#65292;&#20063;&#35831;&#38543;&#26102;&#26469;&#20998;&#20139;&#65306;&#65289;</summary>
    <author>
      <name>hywhy</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/10</id>
    <published>2010-09-11T16:29:21+08:00</published>
    <updated>2011-06-22T11:54:06+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/10-deploy-rails-application-with-capistrano"/>
    <title>&#24212;&#29992;capistrano&#21457;&#24067;rails&#24212;&#29992;</title>
    <summary>&#23433;&#35013;capsum

    $  gem install capsum

&#21040;&#39033;&#30446;&#30446;&#24405;&#19979;&#21019;&#24314;&#21457;&#24067;&#25991;&#20214;:  

    $  capify .  

&#20462;&#25913;&#29983;&#25104;&#30340;&#25991;&#20214;config/deploy.rb, &#20195;&#30721;&#22914;&#19979;:

    require "capsum/typical"
    set :application, "application"   # &#24212;&#29992;&#21517;&#31216;
    set :repository, "git@gitserver:application.git"  # git@git&#26381;&#21153;&#22120;&#22320;&#22336;:&#24212;&#29992;&#21517;&#31216;.git
    set :branch, "master"
    set :shared, %w{
      config/database.yml
    }
    
    namespace :whenever do
      task :update do
      end
    end
{.ruby}

&#20462;&#25913; config/deploy/dev.rb, &#20195;&#30721;&#22914;&#19979;:

    set :deploy_to, "/var/www/vhosts/default/apps/#{application}"
    set :user, "www-data"  #  &#21457;&#24067;&#39033;&#30446;&#30340;&#29992;&#25143;&#21517;
    server "production_server", :app, :web, :db, :primary =&gt; true  #  production_serer &#20026;&#20320;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#22320;&#22336;
    set :deploy_via, :copy
{.ruby}

&#33050;&#26412;&#37197;&#32622;&#24050;&#32463;&#23436;&#27605;, &#21021;&#22987;&#21270;&#21457;&#24067;&#21069;&#35774;&#32622;&#30340;&#21457;&#24067;&#29992;&#25143;&#38656;&#26377;&#20320;&#30340;&#20844;&#38053;&#35777;&#20070;,&#22312;www-data&#30340;&#29992;&#25143;&#30446;&#24405;&#19979;&#21019;&#24314;authorized_keys&#25991;&#20214;:  

    $  mkdir .ssh  
    $  vi authorized_keys  # &#36148;&#20837;&#20320;&#30340;&#20844;&#38053;&#35777;&#20070;&#28982;&#21518; :w &#20445;&#23384;&#36864;&#20986;.

&#25509;&#19979;&#26469;&#25105;&#20204;&#21021;&#22987;&#21270;&#21457;&#24067;:

    $  cap dev deploy:setup

&#22312;/var/www/vhosts/default/apps/#{application}/shared/config/&#19979;&#37197;&#32622;&#22909;database.yml

    common: &amp;common
      adapter: postgresql
      encoding: utf8
      username: postgres
      password: postgres
      host: localhost

    development:
      &lt;&lt;&lt;&lt;: *common
      database: application_product
{.yaml}

&#27491;&#24335;&#21457;&#24067;

    $  cap dev deploy

ok, &#30475;&#32456;&#31471;&#36755;&#20986;&#26159;&#21542;&#21457;&#24067;&#25104;&#21151;&#21602;&#65311; &#20139;&#21463;&#33258;&#21160;&#21270;&#37096;&#32626;&#24102;&#26469;&#30340;&#24555;&#20048;&#21543;.

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/9</id>
    <published>2010-09-10T16:57:50+08:00</published>
    <updated>2011-06-22T16:02:00+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/9-asynchronous-sending-email-under-actionmailer3"/>
    <title>actionmailer 3.0 &#32467;&#21512;ar_mailer_rails3 &#24322;&#27493;&#21457;&#36865;&#37038;&#20214;</title>
    <summary>&#31532;&#19968;&#27493;&#24403;&#28982;&#26159;&#29983;&#25104;actionmailer&#30340;&#25991;&#20214;&#20102;:  

    $  rails g mailer notifier  

&#29983;&#25104;&#22909;&#24517;&#35201;&#30340;&#25991;&#20214;&#21518;,&#25105;&#20204;&#26469;&#30475;&#20197;&#19979;actionmailer3&#26032;&#30340;&#20889;&#27861;:  

    class Notifier &lt; ActionMailer::Base
      default :from =&gt; "from@example.com"
      
      def signup_notification
        mail(:to =&gt; "friend@gmail.com", :subject =&gt; "New account information")
      end
      
    end  

&#28982;&#21518;&#22312;&#30456;&#24212;&#30340;view&#30446;&#24405;&#19979;&#24314;&#19968;&#20010;signup_notification.html.erb&#25991;&#20214;.  

&#24320;&#22987;&#23433;&#35013;ar_mailer_rails3,&#22312;gemfile&#37324;&#21152;&#20837;  

    gem 'ar_mailer_rails3'

&#36816;&#34892;:  

    $  bundle install  

&#23436;&#25104;&#21518;&#65292;&#23601;&#21487;&#20197;&#26469;&#21019;&#24314;&#20020;&#26102;&#23384;&#20648;&#37038;&#20214;&#30340;&#34920;&#20102;:  

    $  rails g ar_mailer_rails3 email  

initializers&#30446;&#24405;&#19979;&#20250;&#29983;&#25104;&#19968;&#20010;ar_mailer.rb&#30340;&#21021;&#22987;&#21270;&#25991;&#20214;&#65292;&#20026;&#20102;&#26041;&#20415;&#36215;&#35265;&#65292;&#25105;&#20204;&#21487;&#20197;&#25226;gmail&#30340;smtp&#37197;&#32622;&#20449;&#24687;&#20889;&#22312;&#36825;&#37324;:  

    config_file = "#{Rails.root}/config/smtp_gmail.yml"
    raise "Sorry, you must have #{config_file}" unless File.exists?(config_file)
    
    config_options = YAML.load_file(config_file) 
    ActionMailer::Base.smtp_settings = {
      :address =&gt; "smtp.gmail.com",
      :port =&gt; 587,
      :authentication =&gt; :plain,
      :enable_starttls_auto =&gt; true
    }.merge(config_options) # Configuration options override default options  

&#24403;&#28982;&#65292;&#25105;&#20204;&#39318;&#20808;&#35201;&#22312;config/&#30446;&#24405;&#19979;&#21019;&#24314;&#19968;&#20010;smtp_gmail.yml&#30340;gmail&#29992;&#25143;&#37197;&#32622;&#20449;&#24687;,&#22914;&#19979;:  

    --- 
      :user_name: youremail@gmail.com
      :password: yourpasword  

ok,&#37197;&#32622;&#23436;&#25104;&#65292;&#25509;&#19979;&#26469;&#24320;&#21551;&#20004;&#20010;&#32456;&#31471;&#65292;&#19968;&#20010;&#24320;console&#65292;&#19968;&#20010;&#24320;development.log:  

    $  rails console  
    $  tail -f log/development.log  

&#35843;&#29992;&#21018;&#25165;&#20889;&#30340;&#26041;&#27861;:  

    &gt;&gt;  message = Notifier.signup_notification
    &gt;&gt;  message.deliver  

&#26085;&#24535;&#20013;&#26159;&#21542;&#24050;&#32463;&#26377;&#30456;&#20851;&#20449;&#24687;&#20102;&#21602;&#65311; &#19981;&#24613;&#65292;ar_mailer_rails3 &#23558;&#37038;&#20214;&#20020;&#26102;&#23384;&#36827;&#20102;&#25968;&#25454;&#24211;,&#25509;&#19979;&#26469;&#26159;&#21551;&#21160;&#21518;&#21488;&#20219;&#21153;&#30340;&#26102;&#20505;&#20102;:  

    $  ar_sendmail_rails3

&#20877;&#30475;&#30475;log&#65292;&#20320;&#30340;&#37038;&#20214;&#26159;&#21542;&#24050;&#32463;&#21457;&#36865;&#25104;&#21151;&#20102;&#21602;&#65311;

</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/8</id>
    <published>2010-09-10T11:24:56+08:00</published>
    <updated>2011-06-22T09:25:41+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/8-debug-with-passenger"/>
    <title>&#29992;passenger debug</title>
    <summary>&#26368;&#36817;&#22312;&#20570;&#19968;&#20010;&#19996;&#35199;&#65292;&#35201;&#29992;&#21040;subdomain&#65292;&#21457;&#29616;webrick&#19981;&#33021;&#25903;&#25345;&#65292;&#25152;&#20197;&#23547;&#25214;passenger&#36827;&#34892;debug&#30340;&#26041;&#27861;&#12290;

&#26041;&#27861;&#27604;&#36739;&#22303;&#65292;&#20294;&#36824;&#26159;&#31649;&#29992;&#30340;&#12290;

&#39318;&#20808;&#65292;&#24448;development.rb&#37324;&#21152;&#20837;

    if File.exists?(File.join(RAILS_ROOT,'tmp', 'debug.txt'))
      require 'ruby-debug'
      Debugger.wait_connection = true
      Debugger.start_remote
      File.delete(File.join(RAILS_ROOT,'tmp', 'debug.txt'))
    end

&#25509;&#30528;&#22312;lib/task&#30446;&#24405;&#19979;&#26032;&#24314;restart.rake&#25991;&#20214;&#65292;&#20869;&#23481;&#20026;

task :restart do
  system("touch tmp/restart.txt")
  system("touch tmp/debug.txt") if ENV["DEBUG"] == 'true'
end

&#30446;&#21069;&#20026;&#27490;&#22522;&#26412;&#19978;&#25630;&#23450;&#20102;&#65292;&#19981;&#36807;&#36825;&#20123;&#21069;&#25552;&#26159;&#24050;&#32463;&#23433;&#35013;&#20102;ruby-debug&#65292;rdebug&#36825;&#20010;&#21629;&#20196;&#21487;&#20197;&#25191;&#34892;&#12290;

&#36825;&#37324;&#26159;nginx&#65292;&#29992;development&#27169;&#24335;&#36816;&#34892;rails&#65292;&#22312;&#38656;&#35201;debug&#30340;&#22320;&#26041;&#21152;&#20837;&#19968;&#34892;"debugger"&#65292;debug&#30340;&#26102;&#20505;&#22312;&#36825;&#37324;break&#12290;&#28982;&#21518;&#36816;&#34892;rake restart DEBUG=true&#12290;

&#25171;&#24320;&#27983;&#35272;&#22120;&#65292;&#36755;&#20837;&#21487;&#20197;&#36305;&#21040;&#21018;&#21018;&#36755;&#20837;debugger&#30340;url&#65292;&#20250;&#21457;&#29616;&#39029;&#38754;&#20572;&#27490;&#22312;&#37027;&#37324;&#12290;
&#36825;&#20010;&#26102;&#20505;&#65292;&#21040;terminal&#36755;&#20837;rdebug -c&#65292;&#24590;&#20040;&#26679;&#65292;&#30475;&#21040;&#29087;&#24713;&#30340;debug&#30028;&#38754;&#20102;&#21543;&#65311;

&#21478;&#22806;&#65292;&#22312;home&#24314;&#31435;&#19968;&#20010;&#25991;&#20214;.rdebugrc&#65292;&#35774;&#32622;&#19968;&#19979;debugger&#25928;&#26524;&#20250;&#22909;&#19968;&#20123;
set autoeval
set autolist
set autoreload
</summary>
    <author>
      <name>bluecoda</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/7</id>
    <published>2010-09-10T11:21:37+08:00</published>
    <updated>2011-06-22T16:05:10+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/7-use-delayed-job-to-diliver-mails"/>
    <title>rails3&#20013;&#20351;&#29992;delayed_job&#24322;&#27493;&#21457;&#36865;&#37038;&#20214;&#30340;&#26041;&#27861;</title>
    <summary>railscasts&#26377;&#20010;&#35270;&#39057;&#65292;&#20351;&#29992;delayed_job&#21435;&#21457;&#36865;&#37038;&#20214;(http://railscasts.com/episodes/171-delayed-job)

&#20294;&#26159;&#21602;&#65292;rails3&#30340;&#21457;&#36865;&#37038;&#20214;&#30340;api&#21457;&#29983;&#20102;&#20123;&#35768;&#21464;&#21270;&#12290;(&#35814;&#24773;&#35831;&#30475;:http://lindsaar.net/2010/1/26/new-actionmailer-api-in-rails-3)
&#21457;&#36865;&#30340;&#26041;&#27861;&#19978;&#20063;&#35201;&#20570;&#20123;&#35768;&#30340;&#20462;&#25913;&#12290;&#36825;&#37324;&#20197;&#25105;&#30340;&#20195;&#30721;&#20316;&#20026;&#31034;&#20363;&#65292;&#20570;&#20010;&#31034;&#33539;&#12290;
&#36825;&#37324;&#30340;UserMailer&#22823;&#27010;&#20195;&#30721;:

    class UserMailer &lt; ActionMailer::Base
      default :from =&gt; "admin@example.com"
    
      def registration_confirmation(user)
        @user = user
        mail(:to =&gt; "#{user.username} &lt;#{user.email}&gt;", :subject =&gt; "&#27880;&#20876;&#30830;&#35748;")
      end
    end

&#36825;&#20010;&#26159;rails3&#30340;ActionMailer&#65292;&#24456;&#36190;

&#26377;&#20102;&#19978;&#38754;&#30340;&#20195;&#30721;&#65292;Controller&#20013;&#30452;&#25509;&#35843;&#29992;

    UserMailer.registration_confirmation(@user).deliver

&#23601;&#21487;&#20197;&#21457;&#36865;&#37038;&#20214;&#20102;

    def create
        @user = User.new(params[:user])
        if @user.save
          UserMailer.registration_confirmation(@user).deliver
          flash[:notice] = "&#35874;&#35874;&#24744;&#30340;&#27880;&#20876;,&#19968;&#23553;&#27880;&#20876;&#30830;&#35748;&#37038;&#20214;&#21363;&#23558;&#21457;&#24448;&#37038;&#31665;#{@user.email},&#35831;&#27880;&#24847;&#26597;&#25910;!"
          redirect_to '/login'
        else
          render :action =&gt; 'new'
        end
    end

&#20294;&#26159;&#65292;&#29616;&#22312;&#30340;&#20195;&#30721;&#26159;&#30452;&#25509;&#36827;&#34892;&#21457;&#36865;&#30340;&#65292;&#36825;&#20351;&#24471;&#29992;&#25143;&#22312;&#25805;&#20316;&#30340;&#26102;&#20505;&#65292;&#20250;&#21345;&#19968;&#19979;&#65292;&#22914;&#26524;&#25918;&#21040;&#21518;&#21488;&#21435;&#21457;&#36865;&#23601;&#19981;&#20250;&#26377;&#36825;&#20010;&#38382;&#39064;&#12290;

&#22312;rails&#30340;lib&#30446;&#24405;&#24213;&#19979;&#30340;mailing_job.rb&#25991;&#20214;&#20869;&#23481;&#65292;&#20570;&#20123;&#35768;&#30340;&#21464;&#21270;

    class MailingJob &lt; Struct.new(:notifier_method,:user_id)
      def perform
        user = User.find(user_id)
        UserMailer.send(notifier_method, user).deliver
      end
    end

&#21040;&#36825;&#37324;&#23601;&#22522;&#26412;&#19978;&#25630;&#23450;&#20102;&#65292;&#25226;UserController&#37324;&#30340;&#30452;&#25509;&#21457;&#36865;&#30340;&#20195;&#30721;&#25442;&#25104;:

    Delayed::Job.enqueue MailingJob.new(:registration_confirmation, @user.id)

delayed_job&#35760;&#24471;&#19978;&#26368;&#26032;&#29256;&#65292;gemfile&#37324;&#30452;&#25509;&#20889;gem "delayed_job", "2.1.0.pre2"&#23601;&#21487;&#20197;&#20102;</summary>
    <author>
      <name>bluecoda</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/5</id>
    <published>2010-09-10T08:35:42+08:00</published>
    <updated>2011-06-22T11:11:03+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/5-improve-your-database-yml"/>
    <title>database.yml&#30340;&#31616;&#20415;&#20889;&#27861;</title>
    <summary>    common: &amp;common
      adapter: postgresql
      encoding: utf8
      username: postgres
      password: postgres
      host: localhost
    
    development:
      &lt;&lt;&lt;&lt;: *common
      database: application_product</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/4</id>
    <published>2010-09-09T15:36:40+08:00</published>
    <updated>2011-06-22T14:01:30+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/4-deployment-of-production-enviroment-ruby-1-9-2-rails-3-nginx-passenger-and-postgresql-with-rvm"/>
    <title>&#26381;&#21153;&#22120;&#37096;&#32626;&#20043; ruby1.9.2+rails3+nginx+passenger+postgresql</title>
    <summary>**&#26381;&#21153;&#22120;&#31995;&#32479;:**   ubuntu server 10.04 64bit  
**&#26696;&#20363;&#26381;&#21153;&#22120;:**   Linode VPS 512&#31995;&#21015;. 

&#31199;&#19979;vps,&#23433;&#35013;&#22909;&#25152;&#35201;&#30340;&#31995;&#32479;,  &#20026;&#20102;&#26041;&#20415;&#36215;&#35265;&#65292;&#25105;&#23558;ruby &#32534;&#35793;&#21040;&#20102; sudo&#32452;&#19979;&#30340;&#19968;&#20010;&#29992;&#25143;&#20013;&#65292;&#25152;&#26377;&#39318;&#20808;&#35201;&#21019;&#24314;&#19968;&#20010;&#29992;&#25143;,&#20197;jerry&#20026;&#20363;:  

    $  useradd jerry  # &#28155;&#21152;&#29992;&#25143;  
    $  passwd jerry  # &#35774;&#32622;&#23494;&#30721;  
    $  gpasswd -a jerry sudo  #&#23558;&#29992;&#25143;jerry&#28155;&#21152;&#36827;sudo&#32452;(sudo&#32452;&#26159;&#40664;&#35748;&#23601;&#23384;&#22312;&#30340;&#65292;&#25152;&#20197;&#19981;&#29992;&#21019;&#24314;)  
    $  cd /home &amp;&amp; mkdir jerry   #&#20026;jerry&#21019;&#24314;&#30446;&#24405;  
    $  chown jerry /home/jerry  #&#35774;&#32622;&#26435;&#38480;  

&#28155;&#21152;&#20320;&#30340;&#35777;&#20070;&#21040;jerry&#29992;&#25143;&#30446;&#24405;&#19979;&#65292;&#36825;&#26679;&#20197;&#21518;&#23601;ssh&#30331;&#24405;&#23601;&#26080;&#38656;&#36755;&#20837;&#23494;&#30721;&#20102;(&#32769;&#26159;&#36755;&#20837;&#23494;&#30721;,&#36825;&#28857;&#24456;&#28902;&#20154;).   
 
    $  cd ~  
    $  mkdir .ssh  &amp;&amp; cd .ssh  
    $  vim authorized_keys   # &#36148;&#20837;&#20320;&#30340;&#20844;&#38053;&#35777;&#20070;

&#19975;&#20107;&#20855;&#22791;&#65292;&#29616;&#22312;&#21487;&#20197;&#29992;rvm&#26469;&#32534;&#35793;ruby 1.9.2&#20102;  
&#39318;&#20808;&#23433;&#35013;curl &#21644; git-core 

    $  sudo apt-get install curl  git-core

&#28982;&#21518;&#23433;&#35013;rvm 

    $  bash &lt; &lt;(curl -s https://rvm.beginrescueend.com/install/rvm)

&#22312;~/.bashrc &#20013;&#21152;&#20837;&#20197;&#19979;&#37197;&#32622;:  

    if [[ -s "$HOME/.rvm/scripts/rvm" ]]  ; then source "$HOME/.rvm/scripts/rvm" ; fi  

&#22312;~.bash_profile &#20013;&#24341;&#29992;.bashprofile  

    source ~/.bashrc

&#36864;&#20986;&#32456;&#31471;&#20877;&#30331;&#24405;&#23601;&#21487;&#20197;&#20351;&#29992;rvm&#20102;    

    $  rvm notes  

&#23433;&#35013;&#24517;&#35201;&#30340;packages  

    $  sudo apt-get install bison build-essential zlib1g zlib1g-dev libssl-dev libreadline5-dev libxml2-dev subversion autoconf  

&#23433;&#35013;&#23436;&#20197;&#19978;&#24517;&#39035;&#30340;packages&#21518;&#65292;&#27491;&#24335;&#29992;rvm&#32534;&#35793;ruby 1.9.2,rvm&#20250;&#23558;ruby&#33258;&#21160;&#32534;&#35793;&#21040;&#24403;&#21069;&#29992;&#25143;&#30446;&#24405;&#30340;~/.rvm&#19979;(&#38750;root&#29992;&#25143;). 

    $  rvm install 1.9.2  

&#23433;&#35013;&#23436;ruby 1.9.2&#21518;, &#25105;&#20204;&#21487;&#20197;&#25226;rvm ruby 1.9.2&#35774;&#32622;&#20026;&#40664;&#35748;  

    $  rvm --default ruby-1.9.2-p180  

&#25509;&#19979;&#26469;&#23601;&#21487;&#20197;&#26597;&#30475;ruby &#29256;&#26412;&#20102;  

    $  ruby -v  
        ruby 1.9.2p180 (2011-02-18 revision 30909) [x86_64-linux]

&#25509;&#19979;&#26469;&#23433;&#35013;rails3(&#21487;&#20197;&#19981;&#29992;&#23433;&#35013;&#65292;&#30475;&#23454;&#38469;&#24773;&#20917;&#65292;&#22914;&#26524;&#20320;&#30340;&#39033;&#30446;&#20013;&#24050;&#32463;freeze&#20102;rails3)  

    $  gem install rails  

&#33267;&#27492; Ruby 1.9.2&#32534;&#35793;&#24050;&#32463;&#23436;&#25104;    

**&#23433;&#35013; Postgresql &#25968;&#25454;&#24211;**  

&#39318;&#20808;&#38656;&#35201;&#30830;&#35748;&#24403;&#21069;root env&#30340;LANG&#26159;&#21542;&#20026;en_US.UTF8,

    $  env  

&#30475;&#26174;&#31034;&#20449;&#24687;&#26159;&#21542;&#26377; LANG=en_US.UTF8&#65292;&#22914;&#26524;&#27809;&#26377;,&#22312; /etc/profile&#20013;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;:  
    LANG=en_US.UTF8  

&#20043;&#21518;&#36864;&#20986;&#32456;&#31471;&#20877;&#36827;&#20837;&#65292;&#20320;&#30340;&#35774;&#32622;&#23601;&#29983;&#25928;&#20102;&#65292;&#28982;&#21518;&#23433;&#35013;postgresql&#25968;&#25454;&#24211;.  

    $  sudo apt-get install postgresql  

&#20462;&#25913; postgres &#29992;&#25143;&#23494;&#30721;  

    $  su postgres -c psql postgres
    $  ALTER USER postgres WITH PASSWORD 'postgres';
    $  \q  

&#20854;&#20013; &#8216;postgres&#8217; &#20026;&#35201;&#20462;&#25913;&#30340;&#23494;&#30721;  

&#32534;&#36753; /etc/postgresql/8.4/main/pg_hba.conf &#26368;&#21518;&#20462;&#25913;&#20026;  

    # Database administrative login by UNIX sockets
    # local   all         postgres                          ident
    
    # TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD
    
    # "local" is for Unix domain socket connections only
    local   all         all                               md5 #ident
    # IPv4 local connections:
    host    all         all         127.0.0.1/32          md5
    # IPv6 local connections:
    host    all         all         ::1/128               md5  

&#22914;&#26524;&#19981;&#24076;&#26395;&#20801;&#35768; postgres &#20351;&#29992;&#23494;&#30721;&#30331;&#20837;&#30340;&#21487;&#20197;&#24320;&#21551;&#31532;2&#34892; # local all postgres ident &#30340;&#27880;&#37322;  

&#32534;&#36753; /etc/postgresql/8.4/main/postgresql.conf, &#25628;&#32034; # listen_addresses = &#23558;&#20854;&#20462;&#25913;&#20026;  

    listen_addresses = 'localhost'                  # what IP address(es) to listen on;  

&#22914;&#26524;&#20801;&#35768;&#20854;&#20182;&#26426;&#22120;&#35775;&#38382;&#30340;&#35831;&#23558; localhost &#20462;&#25913;&#25104; *  

&#37325;&#21551;&#25968;&#25454;&#24211;  

    $  /etc/init.d/postgresql-8.4 restart  

&#23433;&#35013; postgresql &#30340; Ruby &#39537;&#21160;  

    $  sudo apt-get install libpq-dev
    $  gem install -V pg  

&#22914;&#26524;&#25968;&#25454;&#24211;&#19981;&#20877;&#26412;&#22320;&#20165;&#23433;&#35013;&#27492;&#27493;&#21363;&#21487;  

**&#23433;&#35013; Phusion Passenger**  

&#29992; gem &#23433;&#35013; passenger,&#23558;&#20250;&#23433;&#35013;&#21040; /home/jerry/.rvm/gems/ruby-1.9.2-p180/gems/passenger-3.0.7,  

    $  gem install -V passenger   

**&#23433;&#35013; nginx &#26381;&#21153;&#22120;**  

&#19979;&#36733;&#26368;&#26032; stable &#29256; nginx  

    $  mkdir -p /home/jerry/opt/src &amp;&amp; cd /home/jerry/opt/src
    $  wget http://nginx.org/download/nginx-1.0.0.tar.gz
    $  tar xvf nginx-1.0.0.tar.gz

&#23433;&#35013;&#32534;&#35793;&#30456;&#20851;&#31867;&#24211;  

    $  sudo apt-get install libpcre3-dev  

&#32534;&#35793;&#23433;&#35013; &#24102;&#26377; passenger &#27169;&#22359;&#30340; nginx  

&#20351;&#29992; passenger &#33050;&#26412; passenger-install-nginx-module &#32534;&#35793; nginx  

&#36873;&#25321; 2. No: I want to customize my Nginx installation. (for advanced users)  

&#36755;&#20837; src: /home/jerry/opt/src/nginx-1.0.0 &#21644; prefix: /home/jerry/opt/nginx  

&#28155;&#21152; &#32534;&#35793;&#21442;&#25968; &#24182;&#32534;&#35793;  

    $  --conf-path=/home/jerry/opt/etc/nginx/nginx.conf --with-http_gzip_static_module  

&#22914;&#26524;&#36824;&#35201;&#21551;&#21160;&#20854;&#20182;&#32534;&#35793;&#21442;&#25968;&#35831;&#33258;&#34892;&#28155;&#21152;  

&#21478;&#22806;: &#22914;&#26524;&#19981;&#24819;&#20351;&#29992; passenger &#33258;&#24102;&#33050;&#26412;&#32534;&#35793; nginx, &#20063;&#21487;&#20197;&#25163;&#24037;&#32534;&#35793; nginx &#26102;&#21152;&#20837; --add-module='/home/jerry//opt/passenger/ext/nginx &#21442;&#25968;, &#26469;&#21551;&#29992; passenger &#27169;&#22359;.  


**&#37197;&#32622; nginx**  

&#28155;&#21152;&#26381;&#21153;&#22120;&#29992;&#25143;(&#22914;&#26524;&#30452;&#25509;&#29992;jerry&#26469;&#20570;&#21457;&#24067;&#29992;&#25143;&#21487;&#20197;&#30465;&#30053;&#19979;&#19968;&#27493;,&#25105;&#23601;&#26159;&#30452;&#25509;&#29992;jerry&#20316;&#20026;&#21457;&#24067;&#29992;&#25143;&#30340;)

    $  useradd -d /var/www/ -s /bin/bash www-data
    $  usermod --shell=/bin/bash  www-data
    $  mkdir -p /var/www/vhosts/default/htdocs
    $  chown -R www-data:www-data /var/www

&#25972;&#29702;&#32534;&#35793;&#33258;&#21160;&#29983;&#25104;&#30340;&#37197;&#32622;&#25991;&#20214;  

    $  cd /home/jerry/opt/etc/nginx
    $  mkdir /home/jerry/opt/etc/nginx/default
    $  mv *.default default/
    $  mkdir conf.d
    $  mkdir sites-enabled

&#23558; /home/jerry/opt/etc/nginx/nginx.conf &#26367;&#25442;&#20026;  

    user  jerry jerry;
    worker_processes  1;

    events {
        worker_connections  1024;
    }


    http {
        include       mime.types;
        default_type  application/octet-stream;
        
        sendfile        on;
        #tcp_nopush     on;
        
        keepalive_timeout  65;
        gzip  on;
        
        include conf.d/*.conf;
        include sites-enabled/*;
    }  

&#28155;&#21152; gzip_static &#27169;&#22359;&#37197;&#32622;, &#32534;&#36753; /home/jerry/opt/etc/nginx/conf.d/gzip_static.conf  

    gzip_static on;
    gzip_types text/css application/x-javascript;

&#28155;&#21152; Passneger &#27169;&#22359;&#37197;&#32622;, &#32534;&#36753; /home/jerry/opt/etc/nginx/conf.d/passenger.conf  

    passenger_root /home/jerry/.rvm/gems/ruby-1.9.2-p180/gems/passenger-3.0.7;
    passenger_ruby /home/jerry/.rvm/bin/ruby-1.9.2-p180;

&#28155;&#21152; /home/jerry/opt/etc/nginx/sites-enabled/defaul, &#36825;&#20010;default &#26368;&#22909;&#26159;&#20174;&#21035;&#30340;&#25991;&#20214;link&#36807;&#26469;, 
    $  ln -s /home/jerry/apps/conf/nginx.conf /home/jerry/opt/etc/nginx/sites-enabled/default  

&#32534;&#36753; /home/jerry/apps/conf/nginx.conf:  

    server{
      listen 80;
      server_name  demo.com www.demo.com;
      root /home/jerry/apps/demo/current/public;  #just for example
      passenger_enabled on;

      location ~ ^/(images|javascripts|stylesheets)/  {
          root /home/jerry/apps/demo/current/public;
          expires 30d;
      }
    }

&#22914;&#26524;&#38656;&#35201;&#37197;&#32622; &#35814;&#32454;&#30340;&#37197;&#32622;&#20449;&#24687;, &#35831;&#21442;&#32771; [Nginx &#25991;&#26723;][1]  

&#28155;&#21152;&#21551;&#21160;&#33050;&#26412; /home/jerry/opt/etc/init.d/nginx &#20869;&#23481;&#20026;  

    #! /bin/sh
    
    ### BEGIN INIT INFO
    # Provides:          nginx
    # Required-Start:    $all
    # Required-Stop:     $all
    # Default-Start:     2 3 4 5
    # Default-Stop:      0 1 6
    # Short-Description: starts the nginx web server
    # Description:       starts nginx using start-stop-daemon
    ### END INIT INFO
    
    # PATH=/home/jerry/.rvm/gems/ruby-1.9.2-p180/bin:/bin:/home/jerry/.rvm/rubies/ruby-1.9.2-p180/bin:/home/jerry/.rvm/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
    DAEMON=/home/jerry/opt/nginx/sbin/nginx
    NAME=nginx
    DESC=nginx
    PIDFILE=/home/jerry/opt/nginx/logs/$NAME.pid
    
    test -x $DAEMON || exit 0
    
    # Include nginx defaults if available
    if [ -f /home/jerry/opt/etc/default/nginx ] ; then
        . /home/jerry/opt/etc/default/nginx
    fi
    
    set -e
    
    . /lib/lsb/init-functions
    
    test_nginx_config() {
        if $DAEMON -t; then
            return 0
        else
            return $?
        fi
    }
    
    case "$1" in
        start)
            echo -n "Starting $DESC: "
            test_nginx_config
            start-stop-daemon --start --quiet --pidfile $PIDFILE \
                --exec $DAEMON -- $DAEMON_OPTS || true
            echo "$NAME."
        ;;
        stop)
            echo -n "Stopping $DESC: "
            start-stop-daemon --stop --quiet --pidfile $PIDFILE \
                --exec $DAEMON || true
            echo "$NAME."
        ;;
        restart|force-reload)
            echo -n "Restarting $DESC: "
            start-stop-daemon --stop --quiet --pidfile \
                $PIDFILE --exec $DAEMON || true
            sleep 1
            test_nginx_config
            start-stop-daemon --start --quiet --pidfile \
                $PIDFILE --exec $DAEMON -- $DAEMON_OPTS || true
            echo "$NAME."
        ;;
        reload)
            echo -n "Reloading $DESC configuration: "
            test_nginx_config
            start-stop-daemon --stop --signal HUP --quiet --pidfile $PIDFILE \
               --exec $DAEMON || true
            echo "$NAME."
        ;;
        configtest)
            echo -n "Testing $DESC configuration: "
            if test_nginx_config; then
                echo "$NAME."
            else
                exit $?
            fi
        ;;
        status)
            status_of_proc -p $PIDFILE "$DAEMON" nginx &amp;&amp; exit 0 || exit $?
        ;;
        *)
            echo "Usage: $NAME {start|stop|restart|reload|force-reload|status|configtest}" &gt;&amp;2
            exit 1
        ;;
    esac
    
    exit 0

&#35774;&#32622;&#38543;&#26381;&#21153;&#22120;&#21551;&#21160;(&#20999;&#25442;&#21040;root&#29992;&#25143;&#19979;)  

    $  chmod +x /home/jerry/opt/etc/init.d/nginx
    $  ln -s /home/jerry/opt/etc/init.d/nginx /etc/init.d/nginx
    $  update-rc.d nginx defaults  


&#21040;&#36825;&#37324;nginx&#30340;&#37197;&#32622;&#24050;&#32463;&#23436;&#25104;&#65292;&#25509;&#19979;&#26469;&#20320;&#23601;&#21487;&#20197;&#23558;&#39033;&#30446;&#21457;&#24067;&#21040;&#26381;&#21153;&#22120;&#20102;.


  [1]: http://wiki.nginx.org/NginxFullExample
    </summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/3</id>
    <published>2010-09-09T11:46:31+08:00</published>
    <updated>2011-06-22T02:26:25+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/3-authorization-management-with-cancan"/>
    <title>&#29992;cancan&#26469;&#36827;&#34892;&#26435;&#38480;&#31649;&#29702;</title>
    <summary>  &#23433;&#35013;cancan  

    $  gem install cancan

&#19968;&#33324;&#39033;&#30446;&#20013;&#24635;&#20250;&#23384;&#22312;&#33509;&#24178;&#20010;namespace&#65292;&#36825;&#37324;cancan&#30340;&#26131;&#29992;&#21457;&#25381;&#20986;&#20102;&#25928;&#21147;:
&#22312;application_controller.rb&#20013;&#21152;&#20837;&#22914;&#19979;&#26041;&#27861;:  

    rescue_from CanCan::AccessDenied do |exception|
      unless current_user
        redirect_to login_path(:return_to =&gt; request.request_uri), :error =&gt; "Ooops, You must log in first."
      else
        redirect_to root_path(), :notice =&gt; "Ooops, you can't access it"
      end
    end

    def self.authorize_namespace(options = {})
      before_filter(:authorize_namespace, options.slice(:only, :except))
      write_inheritable_hash(:authorize_namespace, options)
    end

    def authorize_namespace
      options = self.class.read_inheritable_attribute(:authorize_namespace)
      authorize!(params[:action].to_sym, options[:namespace])
    end
{.ruby}

namespace&#19979;&#21487;&#20197;&#21019;&#24314;&#19968;&#20010;basc_controller.rb&#26469;&#32479;&#19968;&#26435;&#38480;&#36807;&#28388;:  

    authorize_namespace :namespace =&gt; Admin
{.ruby}


&#37197;&#32622;ability&#31867;:  

    class Ability
      include CanCan::Ability

      def initialize(current_user)
        if current_user.nil?
        elsif current_user.superadmin?
          can :manage, Admin
        else
        end
      end 
    end
{.ruby}

&#36825;&#26679; &#21482;&#26377;&#26159;superadmin&#30340;&#29992;&#25143;&#25165;&#33021;&#23545;Admin&#19979;&#30340;&#21151;&#33021;&#36827;&#34892;&#25805;&#20316;.

&#25630;&#23450;&#65292;&#31616;&#21333;&#30340;&#37197;&#32622;&#24050;&#32463;&#23436;&#25104;&#65292;&#24403;&#28982;&#21487;&#20197;&#24456;&#22823;&#31243;&#24230;&#19978;&#36827;&#34892;&#25193;&#23637;&#12290;</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
  <entry>
    <id>tag:www.thoughtrails.com,2005:Episode/1</id>
    <published>2010-09-09T10:11:10+08:00</published>
    <updated>2011-06-22T14:17:57+08:00</updated>
    <link rel="alternate" type="text/html" href="http://www.thoughtrails.com/episodes/1-installing-rails-3-on-ubuntu-10-04-lucid-lynx-with-rvm"/>
    <title>&#29992;RVM&#22312;ubuntu10.04&#25645;&#24314;ruby 1.9.2&#21644;rails3&#30340;&#24320;&#21457;&#29615;&#22659;</title>
    <summary>&#20808;&#20889;&#19968;&#31687;&#24320;&#21457;&#29615;&#22659;&#30340;&#37096;&#32626;&#25991;&#31456;&#65292;&#19979;&#27425;&#20250;&#20889;&#20851;&#20110;&#26381;&#21153;&#22120;&#19978;&#22914;&#20309;&#37096;&#32626; ruby 1.9.2, nginx, passenger&#30340;&#25991;&#31456;.

&#39318;&#20808;&#23433;&#35013;curl git-core  

    $  sudo apt-get install curl  git-core

&#28982;&#21518;&#23433;&#35013;rvm 

    $  bash &lt; &lt;( curl http://rvm.beginrescueend.com/releases/rvm-install-head )  

&#22312;~/.bashrc &#20013;&#21152;&#20837;&#20197;&#19979;&#20195;&#30721;:  

    if [[ -s "$HOME/.rvm/scripts/rvm" ]]  ; then source "$HOME/.rvm/scripts/rvm" ; fi  

&#37325;&#21551;&#32456;&#31471;  

    $  rvm notes  

&#23433;&#35013;&#24517;&#35201;&#30340;packages  

    $  sudo apt-get install bison build-essential zlib1g zlib1g-dev libssl-dev libreadline5-dev libxml2-dev subversion autoconf  

&#23433;&#35013;&#23436;&#20197;&#19978;&#24517;&#39035;&#30340;packages&#21518;&#65292;&#23601;&#21487;&#20197;&#23433;&#35013;ruby 1.9.2&#20102;  

    $  rvm install 1.9.2  

&#23433;&#35013;&#23436;ruby 1.9.2&#21518;, &#25105;&#20204;&#21487;&#20197;&#25226;rvm ruby 1.9.2&#35774;&#32622;&#20026;&#40664;&#35748;  

    $  rvm --default ruby-1.9.2-p0  

&#25509;&#19979;&#26469;&#23601;&#21487;&#20197;&#26597;&#30475;ruby &#29256;&#26412;&#20102;  

    $  ruby -v  
      ruby 1.9.2p0 (2010-08-18 revision 29034) [x86_64-linux]

&#25509;&#19979;&#26469;&#23433;&#35013;rails3  

    $  gem install rails

&#20139;&#21463;rails3&#30340;&#20048;&#36259;&#21543;


    


  [1]: http://edgeguides.rubyonrails.org/3_0_release_notes.html</summary>
    <author>
      <name>jerry</name>
    </author>
  </entry>
</feed>
